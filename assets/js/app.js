// --------------------------------------
// 
//    _  _ _/ .  _  _/ /_ _  _  _        
//   /_|/_ / /|//_  / / //_ /_// /_/     
//   https://activetheory.net    _/      
// 
// --------------------------------------
//   5/16/22 1:15p
// --------------------------------------

"undefined"==typeof console&&(window.console={},console.log=console.error=console.info=console.debug=console.warn=console.trace=function(){}),window.performance=window.performance&&window.performance.now?window.performance:Date,Date.now=Date.now||function(){return+new Date},window.requestAnimationFrame||(window.requestAnimationFrame=window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(){const start=Date.now();return function(callback){window.setTimeout((()=>callback(Date.now()-start)),1e3/60)}}()),window.defer=window.requestAnimationFrame,window.clearTimeout=function(){const _clearTimeout=window.clearTimeout;return function(ref){return window.Timer&&Timer.__clearTimeout(ref)||_clearTimeout(ref)}}(),window.requestIdleCallback=function(){const _requestIdleCallback=window.requestIdleCallback;return function(callback,max){return _requestIdleCallback?_requestIdleCallback(callback,max?{timeout:max}:null):defer((()=>{callback({didTimeout:!1})}),0)}}(),window.onIdle=window.requestIdleCallback,"undefined"==typeof Float32Array&&(Float32Array=Array),Math.sign=function(x){return 0===(x=+x)||isNaN(x)?Number(x):x>0?1:-1},Math._round=Math.round,Math.round=function(value,precision=0){let p=Math.pow(10,precision);return Math._round(value*p)/p},Math._random=Math.random,Math.rand=Math.random=function(min,max,precision=0){return void 0===min?Math._random():min===max?min:(min=min||0,max=max||1,0==precision?Math.floor(Math._random()*(max+1-min)+min):Math.round(min+Math._random()*(max-min),precision))},Math.degrees=function(radians){return radians*(180/Math.PI)},Math.radians=function(degrees){return degrees*(Math.PI/180)},Math.clamp=function(value,min=0,max=1){return Math.min(Math.max(value,Math.min(min,max)),Math.max(min,max))},Math.map=Math.range=function(value,oldMin=-1,oldMax=1,newMin=0,newMax=1,isClamp){const newValue=(value-oldMin)*(newMax-newMin)/(oldMax-oldMin)+newMin;return isClamp?Math.clamp(newValue,Math.min(newMin,newMax),Math.max(newMin,newMax)):newValue},Math.mix=function(a,b,alpha){return a*(1-alpha)+b*alpha},Math.step=function(edge,value){return value<edge?0:1},Math.smoothStep=function(min,max,value){const x=Math.max(0,Math.min(1,(value-min)/(max-min)));return x*x*(3-2*x)},Math.fract=function(value){return value-Math.floor(value)};{const mainThread=!!window.document;Math.lerp=function(target,value,alpha,calcHz=!0){let hz=mainThread&&calcHz?Render.HZ_MULTIPLIER:1;return value+(target-value)*Math.clamp(alpha*hz,0,1)}}Math.mod=function(value,n){return(value%n+n)%n},Array.prototype.shuffle=function(){let temp,r,i=this.length-1;for(;i>0;)r=Math.random(0,i,0),i-=1,temp=this[i],this[i]=this[r],this[r]=temp;return this},Array.storeRandom=function(arr){arr.randomStore=[]},Array.prototype.random=function(range){let value=Math.random(0,this.length-1);if(arguments.length&&!this.randomStore&&Array.storeRandom(this),!this.randomStore)return this[value];if(range>this.length-1&&(range=this.length),range>1){for(;~this.randomStore.indexOf(value);)(value+=1)>this.length-1&&(value=0);this.randomStore.push(value),this.randomStore.length>=range&&this.randomStore.shift()}return this[value]},Array.prototype.remove=function(element){if(!this.indexOf)return;const index=this.indexOf(element);return~index?this.splice(index,1):void 0},Array.prototype.last=function(){return this[this.length-1]},window.Promise=window.Promise||{},Array.prototype.flat||Object.defineProperty(Array.prototype,"flat",{configurable:!0,value:function flat(){var depth=isNaN(arguments[0])?1:Number(arguments[0]);return depth?Array.prototype.reduce.call(this,(function(acc,cur){return Array.isArray(cur)?acc.push.apply(acc,flat.call(cur,depth-1)):acc.push(cur),acc}),[]):Array.prototype.slice.call(this)},writable:!0}),Promise.create=function(){const promise=new Promise(((resolve,reject)=>{this.temp_resolve=resolve,this.temp_reject=reject}));return promise.resolve=this.temp_resolve,promise.reject=this.temp_reject,delete this.temp_resolve,delete this.temp_reject,promise},Promise.catchAll=function(array){return Promise.all(array.map((promise=>promise.catch((error=>{Promise.reject(error)})))))},Promise.timeout=function(promise,timeout){return Array.isArray(promise)&&(promise=Promise.all(promise)),Promise.race([promise,Timer.delayedCall(timeout)])},String.prototype.includes=function(str){if(!Array.isArray(str))return!!~this.indexOf(str);for(let i=str.length-1;i>=0;i--)if(~this.indexOf(str[i]))return!0;return!1},String.prototype.equals=function(str){let compare=String(this);if(!Array.isArray(str))return str===compare;for(let i=str.length-1;i>=0;i--)if(str[i]===compare)return!0;return!1},String.prototype.strpos=function(str){return console.warn("strpos deprecated: use .includes()"),this.includes(str)},String.prototype.clip=function(num,end=""){return this.length>num?this.slice(0,Math.max(0,num-end.length)).trim()+end:this.slice()},String.prototype.capitalize=function(){return this.charAt(0).toUpperCase()+this.slice(1)},String.prototype.replaceAll=function(find,replace){return this.split(find).join(replace)},String.prototype.replaceAt=function(index,replacement){return this.substr(0,index)+replacement+this.substr(index+replacement.length)},(!window.fetch||!window.AURA&&location.protocol.includes("file"))&&(window.fetch=function(url,options){options=options||{};const promise=Promise.create(),request=new XMLHttpRequest;request.open(options.method||"get",url),url.includes(".ktx")&&(request.responseType="arraybuffer");for(let i in options.headers)request.setRequestHeader(i,options.headers[i]);function response(){let header,keys=[],all=[],headers={};return request.getAllResponseHeaders().replace(/^(.*?):\s*([\s\S]*?)$/gm,((m,key,value)=>{keys.push(key=key.toLowerCase()),all.push([key,value]),header=headers[key],headers[key]=header?`${header},${value}`:value})),{ok:1==(request.status/200|0),status:request.status,statusText:request.statusText,url:request.responseURL,clone:response,text:()=>Promise.resolve(request.responseText),json:()=>Promise.resolve(request.responseText).then(JSON.parse),xml:()=>Promise.resolve(request.responseXML),blob:()=>Promise.resolve(new Blob([request.response])),arrayBuffer:()=>Promise.resolve(request.response),headers:{keys:()=>keys,entries:()=>all,get:n=>headers[n.toLowerCase()],has:n=>n.toLowerCase()in headers}}}return request.onload=()=>{promise.resolve(response())},request.onerror=promise.reject,request.send(options.body),promise}),window.get=function(url,options={credentials:"same-origin"}){let promise=Promise.create();return options.method="GET",fetch(url,options).then((function handleResponse(e){if(!e.ok)return promise.reject(e);e.text().then((text=>{if(text.charAt(0).includes(["[","{"]))try{promise.resolve(JSON.parse(text))}catch(err){promise.resolve(text)}else promise.resolve(text)}))})).catch(promise.reject),promise},window.post=function(url,body={},options={}){let promise=Promise.create();return options.method="POST",body&&(options.body="object"==typeof body||Array.isArray(body)?JSON.stringify(body):body),options.headers||(options.headers={"content-type":"application/json"}),fetch(url,options).then((function handleResponse(e){if(!e.ok)return promise.reject(e);e.text().then((text=>{if(text.charAt(0).includes("[")||text.charAt(0).includes("{"))try{promise.resolve(JSON.parse(text))}catch(err){promise.resolve(text)}else promise.resolve(text)}))})).catch(promise.reject),promise},window.put=function(url,body,options={}){let promise=Promise.create();return options.method="PUT",body&&(options.body="object"==typeof body||Array.isArray(body)?JSON.stringify(body):body),fetch(url,options).then((function handleResponse(e){if(!e.ok)return promise.reject(e);e.text().then((text=>{if(text.charAt(0).includes(["[","{"]))try{promise.resolve(JSON.parse(text))}catch(err){promise.resolve(text)}else promise.resolve(text)}))})).catch(promise.reject),promise},window.Class=function(_class,_type,_static){const _this=this||window,_name=_class.name||_class.toString().match(/function ?([^\(]+)/)[1];"function"==typeof _type&&(_static=_type,_type=null),(_type=(_type||"").toLowerCase())?"static"==_type?_this[_name]=new _class:"singleton"==_type&&(_this[_name]=_class,function(){let _instance;_this[_name].instance=function(a,b,c){return _instance||(_instance=new _class(a,b,c)),_instance}}(),_static&&_static()):(_this[_name]=_class,_static&&_static()),this&&this!==window&&(this[_name]._namespace=this.__namespace)},window.Inherit=function(child,parent){const args=[].slice.call(arguments,2);parent.apply(child,args);const save={};for(let method in child)save[method]=child[method];defer((()=>{for(let method in child)if(save[method]&&child[method]!==save[method]){if("destroy"==method&&child.destroy&&!child.__element)throw"Do not override destroy directly, use onDestroy :: "+child.constructor.toString();child["_"+method]=save[method]}}))},window.Namespace=function(obj){"string"==typeof obj?window[obj]||(window[obj]={Class:Class,__namespace:obj}):(obj.Class=Class,obj.__namespace=obj.constructor.name||obj.constructor.toString().match(/function ([^\(]+)/)[1])},window.Global={},window.THREAD=!1,Class((function Hydra(){const _this=this,_readyPromise=Promise.create();var _base,_callbacks=[];function initLoad(){return document&&window?window._NODE_?setTimeout(loaded,1):window._AURA_?window.Main?setTimeout(loaded,1):setTimeout(initLoad,1):void window.addEventListener("load",loaded,!1):setTimeout(initLoad,1)}function loaded(){window.removeEventListener("load",loaded,!1),_this.LOCAL=(!window._BUILT_||location.pathname.toLowerCase().includes("platform"))&&(location.hostname.indexOf("local")>-1||"10"==location.hostname.split(".")[0]||"192"==location.hostname.split(".")[0]||/atdev.online$/.test(location.hostname))&&""==location.port,_callbacks.forEach((cb=>cb())),_callbacks=null,_readyPromise.resolve(),window.Main&&_readyPromise.then((()=>Hydra.Main=new window.Main))}this.HASH=window.location.hash.slice(1),this.LOCAL=!window._BUILT_&&(location.hostname.indexOf("local")>-1||"10"==location.hostname.split(".")[0]||"192"==location.hostname.split(".")[0]||/atdev.online$/.test(location.hostname))&&""==location.port,initLoad(),this.__triggerReady=function(){loaded()},this.ready=function(callback){if(!callback)return _readyPromise;_callbacks?_callbacks.push(callback):callback()},this.absolutePath=function(path){if(window.AURA)return path;let base=_base;if(void 0===base)try{if(document.getElementsByTagName("base").length>0){var a=document.createElement("a");a.href=document.getElementsByTagName("base")[0].href,base=a.pathname,_base=base}}catch(e){_base=null}let pathname=base||location.pathname;pathname.includes("/index.html")&&(pathname=pathname.replace("/index.html",""));let port=Number(location.port)>1e3?":"+location.port:"";return path.includes("http")?path:(location.protocol.length?location.protocol+"//":"")+(location.hostname+port+pathname+"/"+path).replace("//","/")}}),"Static"),Class((function Utils(){var _queries={},_searchParams=window.URLSearchParams?new URLSearchParams(window.location.search):null;this.query=this.queryParams=function(key,value){if(void 0!==value&&(_queries[key]=value),void 0!==_queries[key])return _queries[key];if(_searchParams)"0"===(value=_searchParams.get(key))?value=0:"false"===value||null===value?value=!1:""===value&&(value=!0);else{let escapedKey=encodeURIComponent(key).replace(/[\.\+\*]/g,"\\$&");"0"==(value=decodeURIComponent(window.location.search.replace(new RegExp(`^(?:.*?[&?]${escapedKey}(?:=([^&]*)|[&$]))?.*$`,"i"),"$1")))?value=0:"false"==value?value=!1:value.length||(value=new RegExp(`[&?]${escapedKey}(?:[&=]|$)`,"i").test(window.location.search))}return _queries[key]=value,value},this.addQuery=function(query,value){return _queries[query]===value?_queries[query]:(this.removeQuery(query),window.history.replaceState({},document.title,`${location.pathname}${this.addParam(location.search,query,value)}`),_searchParams=window.URLSearchParams?new URLSearchParams(window.location.search):null,_queries[query]=value)},this.removeQuery=function(query){return window.history.replaceState({},document.title,`${location.pathname}${this.removeParam(location.search,query)}`),_searchParams=window.URLSearchParams?new URLSearchParams(window.location.search):null,delete _queries[query]},this.addParam=function(url,param,value){let u=url.split("?"),addedParam=encodeURIComponent(param)+"="+value,pars=u[1]?u[1].split(/[&;]/g):[];return pars.push(addedParam),url=u[0]+(pars.length>0?"?"+pars.join("&"):"")},this.removeParam=function(url,param){let u=url.split("?");if(u.length>=2){let prefix=encodeURIComponent(param)+"=",pars=u[1].split(/[&;]/g);for(let i=pars.length;i-- >0;)-1!==pars[i].lastIndexOf(prefix,0)&&pars.splice(i,1);return url=u[0]+(pars.length>0?"?"+pars.join("&"):"")}return url},this.getConstructorName=function(obj){return obj?"function"==typeof obj?obj.toString().match(/function ([^\(]+)/)[1]:obj.constructor.name||obj.constructor.toString().match(/function ([^\(]+)/)[1]:obj},this.nullObject=function(object){if(object&&(object.destroy||object.div))for(var key in object)void 0!==object[key]&&(object[key]=null);return null},this.cloneObject=function(obj){return JSON.parse(JSON.stringify(obj))},this.headsTails=function(n0,n1){return Math.random(0,1)?n1:n0},this.mergeObject=function(){for(var obj={},i=0;i<arguments.length;i++){var o=arguments[i];for(var key in o)obj[key]=o[key]}return obj},this.timestamp=this.uuid=function(){return Date.now()+"xx-4xx-yxx-xxx".replace(/[xy]/g,(function(c){let r=16*Math.random()|0;return("x"==c?r:3&r|8).toString(16)}))},this.randomColor=function(){var color="#"+Math.floor(16777215*Math.random()).toString(16);return color.length<7&&(color=this.randomColor()),color},this.numberWithCommas=function(num){return num.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")},this.padInt=function(num,digits,isLimit){isLimit&&(num=Math.min(num,Math.pow(10,digits)-1));let str=Math.floor(num).toString();return Math.pow(10,Math.max(0,digits-str.length)).toString().slice(1)+str},this.copyToClipboard=function(string){try{var el=document.createElement("textarea"),range=document.createRange();el.contentEditable=!0,el.readOnly=!0,el.value=string,document.body.appendChild(el),el.select(),range.selectNodeContents(el);var s=window.getSelection();return s.removeAllRanges(),s.addRange(range),el.setSelectionRange(0,string.length),document.execCommand("copy"),document.body.removeChild(el),!0}catch(e){return!1}},this.stringList=function(items=[],limit=0,options={}){if(0===items.length)return"";let output="",printed=0;"object"==typeof limit&&(options=limit,limit=0),options.oxford=!0===options.oxford,options.more=!1!==options.more&&(options.more?options.more:"more"),options.and=options.and?options.and:"&",options.comma=options.comma?options.comma:",",isNaN(options.limit)||(limit=options.limit),0===limit&&(limit=items.length);do{output=`${output}${items.shift()}${options.comma} `,printed++}while(items.length>1&&printed+1<limit);if(output=output.trim(),output=output.slice(0,output.length-1),1===items.length)output=`${output}${options.oxford&&printed>1?options.comma:""} ${options.and} ${items.shift()}`;else if(items.length>1&&options.more){let more=`${items.length} ${options.more}`;output=`${output}${options.oxford&&printed>1?options.comma:""} ${options.and} ${more}`}return output},this.debounce=function(callback,time=100){clearTimeout(callback.__interval),callback.__interval=Timer.create(callback,time)}}),"Static"),Class((function Render(){const _this=this,_render=[],_native=[],_drawFrame=[],_multipliers=[];var _last=performance.now(),_localTSL=0,_elapsed=0,_capLast=0,_sampleRefreshRate=[],_firstSample=!1,_saveRefreshRate=60,rAF=requestAnimationFrame,_refreshScale=1,_canCap=0,_screenHash=getScreenHash();function render(tsl){if(_native.length){let multiplier=60/_saveRefreshRate;for(let i=_native.length-1;i>-1;i--)_native[i](multiplier)}if(_this.capFPS>0&&++_canCap>31){let delta=tsl-_capLast;if(_capLast=tsl,(_elapsed+=delta)<1e3/_this.capFPS)return rAF(render);_this.REFRESH_RATE=_this.capFPS,_this.HZ_MULTIPLIER=60/_this.REFRESH_RATE*_refreshScale,_elapsed=0}if(_this.timeScaleUniform.value=1,_multipliers.length)for(let i=0;i<_multipliers.length;i++){let obj=_multipliers[i];_this.timeScaleUniform.value*=obj.value}_this.DT=tsl-_last,_last=tsl;let delta=_this.DT*_this.timeScaleUniform.value;if(delta=Math.min(200,delta),_sampleRefreshRate&&!_this.capFPS){let fps=1e3/_this.DT;if(_sampleRefreshRate.push(fps),_sampleRefreshRate.length>30){_sampleRefreshRate.sort(((a,b)=>a-b));let rate=_sampleRefreshRate[Math.round(_sampleRefreshRate.length/2)];rate=_this.REFRESH_TABLE.reduce(((prev,curr)=>Math.abs(curr-rate)<Math.abs(prev-rate)?curr:prev)),_this.REFRESH_RATE=_saveRefreshRate=_firstSample?Math.max(_this.REFRESH_RATE,rate):rate,_this.HZ_MULTIPLIER=60/_this.REFRESH_RATE*_refreshScale,_sampleRefreshRate=null,_firstSample=!0}}_this.TIME=tsl,_this.DELTA=delta,_this.startFrame&&_this.startFrame(tsl,delta),_localTSL+=delta;for(let i=_render.length-1;i>=0;i--){var callback=_render[i];if(callback)if(callback.fps){if(tsl-callback.last<1e3/callback.fps)continue;callback(++callback.frame),callback.last=tsl}else callback(tsl,delta);else _render.remove(callback)}for(let i=_drawFrame.length-1;i>-1;i--)_drawFrame[i](tsl,delta);_this.drawFrame&&_this.drawFrame(tsl,delta),_this.endFrame&&_this.endFrame(tsl,delta),THREAD||_this.isPaused||rAF(render)}function getScreenHash(){return window.screen?`${window.screen.width}x${window.screen.height}.${window.screen.pixelDepth}`:"none"}function checkMoveScreen(){var newScreen=getScreenHash();_screenHash!==newScreen&&(_screenHash=newScreen,_sampleRefreshRate=null,_firstSample=!1)}this.timeScaleUniform={value:1,type:"f",ignoreUIL:!0},this.REFRESH_TABLE=[30,60,72,90,100,120,144,240],this.REFRESH_RATE=60,this.HZ_MULTIPLIER=1,this.capFPS=null,THREAD||(rAF(render),setInterval((_=>_sampleRefreshRate=[]),3e3),setInterval(checkMoveScreen,5e3)),this.now=function(){return _localTSL},this.setRefreshScale=function(scale){_refreshScale=scale,_sampleRefreshRate=[]},this.start=function(callback,fps,native){fps&&(callback.fps=fps,callback.last=-1/0,callback.frame=-1),native?~_native.indexOf(callback)||_native.unshift(callback):~_render.indexOf(callback)||_render.unshift(callback)},this.stop=function(callback){_render.remove(callback),_native.remove(callback)},this.tick=function(){THREAD&&(this.TIME=performance.now(),render(this.TIME))},this.forceRender=function(time){this.TIME=time,render(this.TIME)},this.Worker=function(_callback,_budget=4){Inherit(this,Component);let _scope=this,_elapsed=0;function loop(){if(!_scope.dead){for(;_elapsed<_budget;){if(_scope.dead||_scope.paused)return;const start=performance.now();_callback&&_callback(),_elapsed+=performance.now()-start}_elapsed=0}}this.startRender(loop),this.stop=function(){this.dead=!0,this.stopRender(loop)},this.pause=function(){this.paused=!0,this.stopRender(loop)},this.resume=function(){this.paused=!1,this.startRender(loop)},this.setCallback=function(cb){_callback=cb}},this.pause=function(){_this.isPaused=!0},this.resume=function(){_this.isPaused&&(_this.isPaused=!1,rAF(render))},this.useRAF=function(raf){_firstSample=null,_last=performance.now(),(rAF=raf)(render)},this.onDrawFrame=function(cb){_drawFrame.push(cb)},this.setTimeScale=function(v){_this.timeScaleUniform.value=v},this.getTimeScale=function(){return _this.timeScaleUniform.value},this.createTimeMultiplier=function(){let obj={value:1};return _multipliers.push(obj),obj},this.destroyTimeMultiplier=function(obj){_multipliers.remove(obj)},this.tweenTimeScale=function(value,time,ease,delay){return tween(_this.timeScaleUniform,{value:value},time,ease,delay,null,null,!0)}}),"Static"),Class((function Timer(){const _this=this,_callbacks=[],_discard=[],_deferA=[],_deferB=[];var _defer=_deferA;function loop(t,delta){for(let i=_discard.length-1;i>=0;i--){let obj=_discard[i];obj.callback=null,_callbacks.remove(obj)}_discard.length&&(_discard.length=0);for(let i=_callbacks.length-1;i>=0;i--){let obj=_callbacks[i];obj?(obj.scaledTime?obj.current+=delta:obj.current+=Render.DT,obj.current>=obj.time&&(obj.callback&&obj.callback(),_discard.push(obj))):_callbacks.remove(obj)}for(let i=_defer.length-1;i>-1;i--)_defer[i]();_defer.length=0,_defer=_defer==_deferA?_deferB:_deferA}Render.start(loop),this.__clearTimeout=function(ref){const obj=function find(ref){for(let i=_callbacks.length-1;i>-1;i--)if(_callbacks[i].ref==ref)return _callbacks[i]}(ref);return!!obj&&(obj.callback=null,_callbacks.remove(obj),!0)},this.create=function(callback,time,scaledTime){if(window._NODE_)return setTimeout(callback,time);const obj={time:Math.max(1,time||1),current:0,ref:Utils.timestamp(),callback:callback,scaledTime:scaledTime};return _callbacks.unshift(obj),obj.ref},this.delayedCall=function(time){let promise=Promise.create();return _this.create(promise.resolve,time),promise},window.defer=this.defer=function(callback){let promise;return callback||(promise=Promise.create(),callback=promise.resolve),(_defer==_deferA?_deferB:_deferA).unshift(callback),promise}}),"static"),Class((function Events(){const _this=this;this.events={};const _e={},_linked=[];let _emitter;this.events.sub=function(obj,evt,callback){if("object"!=typeof obj&&(callback=evt,evt=obj,obj=null),!obj)return Events.emitter._addEvent(evt,callback.resolve?callback.resolve:callback,this),callback;let emitter=obj.events.emitter();return emitter._addEvent(evt,callback.resolve?callback.resolve:callback,this),emitter._saveLink(this),_linked.push(emitter),callback},this.events.wait=async function(obj,evt){const promise=Promise.create(),args=[obj,evt,e=>{_this.events.unsub(...args),promise.resolve(e)}];return"object"!=typeof obj&&args.splice(1,1),_this.events.sub(...args),promise},this.events.unsub=function(obj,evt,callback){if("object"!=typeof obj&&(callback=evt,evt=obj,obj=null),!obj)return Events.emitter._removeEvent(evt,callback.resolve?callback.resolve:callback);obj.events.emitter()._removeEvent(evt,callback.resolve?callback.resolve:callback)},this.events.fire=function(evt,obj,isLocalOnly){(obj=obj||_e).target=this,Events.emitter._check(evt),_emitter&&_emitter._fireEvent(evt,obj)||isLocalOnly||Events.emitter._fireEvent(evt,obj)},this.events.bubble=function(obj,evt){_this.events.sub(obj,evt,(e=>_this.events.fire(evt,e)))},this.events.destroy=function(){return Events.emitter._destroyEvents(this),_linked&&_linked.forEach((emitter=>emitter._destroyEvents(this))),_emitter&&_emitter.links&&_emitter.links.forEach((obj=>obj.events&&obj.events._unlink(_emitter))),null},this.events.emitter=function(){return _emitter||(_emitter=Events.emitter.createLocalEmitter()),_emitter},this.events._unlink=function(emitter){_linked.remove(emitter)}}),(()=>{Events.emitter=new function Emitter(){const prototype=Emitter.prototype;if(this.events=[],void 0!==prototype._check)return;prototype._check=function(evt){if(void 0===evt)throw"Undefined event"},prototype._addEvent=function(evt,callback,object){this._check(evt),this.events.push({evt:evt,object:object,callback:callback})},prototype._removeEvent=function(eventString,callback){this._check(eventString);for(let i=this.events.length-1;i>=0;i--)this.events[i].evt===eventString&&this.events[i].callback===callback&&this._markForDeletion(i)},prototype._sweepEvents=function(){for(let i=0;i<this.events.length;i++)this.events[i].markedForDeletion&&(delete this.events[i].markedForDeletion,this.events.splice(i,1),--i)},prototype._markForDeletion=function(i){this.events[i].markedForDeletion=!0,this._sweepScheduled||(this._sweepScheduled=!0,defer((()=>{this._sweepScheduled=!1,this._sweepEvents()})))},prototype._fireEvent=function(eventString,obj){this._check&&this._check(eventString),obj=obj||_e;let called=!1;for(let i=0;i<this.events.length;i++){let evt=this.events[i];evt.evt!=eventString||evt.markedForDeletion||(evt.callback(obj),called=!0)}return called},prototype._destroyEvents=function(object){for(var i=this.events.length-1;i>=0;i--)this.events[i].object===object&&this._markForDeletion(i)},prototype._saveLink=function(obj){this.links||(this.links=[]),~this.links.indexOf(obj)||this.links.push(obj)},prototype.createLocalEmitter=function(){return new Emitter}},Events.broadcast=Events.emitter._fireEvent,Events.VISIBILITY="hydra_visibility",Events.HASH_UPDATE="hydra_hash_update",Events.COMPLETE="hydra_complete",Events.PROGRESS="hydra_progress",Events.CONNECTIVITY="hydra_connectivity",Events.UPDATE="hydra_update",Events.LOADED="hydra_loaded",Events.END="hydra_end",Events.FAIL="hydra_fail",Events.SELECT="hydra_select",Events.ERROR="hydra_error",Events.READY="hydra_ready",Events.RESIZE="hydra_resize",Events.CLICK="hydra_click",Events.HOVER="hydra_hover",Events.MESSAGE="hydra_message",Events.ORIENTATION="orientation",Events.BACKGROUND="background",Events.BACK="hydra_back",Events.PREVIOUS="hydra_previous",Events.NEXT="hydra_next",Events.RELOAD="hydra_reload",Events.UNLOAD="hydra_unload",Events.FULLSCREEN="hydra_fullscreen";const _e={};Hydra.ready((()=>{let box;!function(){let _last,_lastTime=performance.now();function onfocus(){Render.blurTime=-1,"focus"!=_last&&Events.emitter._fireEvent(Events.VISIBILITY,{type:"focus"}),_last="focus"}function onblur(){Render.blurTime=Date.now(),"blur"!=_last&&Events.emitter._fireEvent(Events.VISIBILITY,{type:"blur"}),_last="blur"}Timer.create((function addVisibilityHandler(){let hidden,eventName;if([["msHidden","msvisibilitychange"],["webkitHidden","webkitvisibilitychange"],["hidden","visibilitychange"]].forEach((d=>{void 0!==document[d[0]]&&(hidden=d[0],eventName=d[1])})),!eventName){const root="ie"==Device.browser?document:window;return root.onfocus=onfocus,void(root.onblur=onblur)}document.addEventListener(eventName,(()=>{const time=performance.now();time-_lastTime>10&&(!1===document[hidden]?onfocus():onblur()),_lastTime=time}))}),250),window.addEventListener("online",(_=>Events.emitter._fireEvent(Events.CONNECTIVITY,{online:!0}))),window.addEventListener("offline",(_=>Events.emitter._fireEvent(Events.CONNECTIVITY,{online:!1}))),window.onbeforeunload=_=>(Events.emitter._fireEvent(Events.UNLOAD),null)}(),window.Stage=window.Stage||{},"social"==Device.system.browser&&"ios"==Device.system.os&&(box=document.createElement("div"),box.style.position="fixed",box.style.top=box.style.left=box.style.right=box.style.bottom="0px",box.style.zIndex="-1",box.style.opacity="0",box.style.pointerEvents="none",document.body.appendChild(box)),updateStage();let timer,iosResize="ios"===Device.system.os,html=!!iosResize&&document.querySelector("html"),delay=iosResize?500:16;function updateStage(){if(box){let bbox=box.getBoundingClientRect();Stage.width=bbox.width||window.innerWidth||document.body.clientWidth||document.documentElement.offsetWidth,Stage.height=bbox.height||window.innerHeight||document.body.clientHeight||document.documentElement.offsetHeight,document.body.parentElement.scrollTop=document.body.scrollTop=0,document.documentElement.style.width=document.body.style.width=Stage.width+"px",document.documentElement.style.height=document.body.style.height=Stage.height+"px",Events.emitter._fireEvent(Events.RESIZE)}else Stage.width=window.innerWidth||document.body.clientWidth||document.documentElement.offsetWidth,Stage.height=window.innerHeight||document.body.clientHeight||document.documentElement.offsetHeight}window.addEventListener("resize",(function handleResize(){clearTimeout(timer),timer=setTimeout((_=>{updateStage(),html&&Math.min(window.screen.width,window.screen.height)!==Stage.height&&!Mobile.isAllowNativeScroll&&(html.scrollTop=-1),Events.emitter._fireEvent(Events.RESIZE)}),delay)})),window.onorientationchange=window.onresize,"social"==Device.system.browser&&(Stage.height>=screen.height||Stage.width>=screen.width)&&setTimeout(updateStage,1e3),defer(window.onresize)}))})),Class((function Device(){var vid,_this=this;this.agent=navigator.userAgent.toLowerCase(),this.detect=function(match){return this.agent.includes(match)},this.touchCapable=!!navigator.maxTouchPoints,this.pixelRatio=window.devicePixelRatio,this.system={},this.system.retina=window.devicePixelRatio>1,this.system.webworker=void 0!==window.Worker,window._NODE_||(this.system.geolocation=void 0!==navigator.geolocation),window._NODE_||(this.system.pushstate=void 0!==window.history.pushState),this.system.webcam=!!(navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.mediaDevices),this.system.language=window.navigator.userLanguage||window.navigator.language,this.system.webaudio=void 0!==window.AudioContext,this.system.xr={},this.system.detectXR=async function(){if(window.AURA)return _this.system.xr.vr=!0,void(_this.system.xr.ar=!0);if(!navigator.xr)return _this.system.xr.vr=!1,void(_this.system.xr.ar=!1);try{[_this.system.xr.vr,_this.system.xr.ar]=await Promise.all([navigator.xr.isSessionSupported("immersive-vr"),navigator.xr.isSessionSupported("immersive-ar")])}catch(e){}"android"==_this.system.os&&(_this.detect("oculus")||(_this.system.xr.vr=!1))};try{this.system.localStorage=void 0!==window.localStorage}catch(e){this.system.localStorage=!1}this.system.fullscreen=document.fullscreenEnabled||document.webkitFullscreenEnabled||document.mozFullScreenEnabled||document.msFullscreenEnabled,this.system.os=_this.detect(["ipad","iphone","ios"])||_this.detect("mac")&&_this.touchCapable&&Math.max(screen.width,screen.height)<1370?"ios":_this.detect(["android","kindle"])?"android":_this.detect(["blackberry"])?"blackberry":_this.detect(["mac os"])?"mac":_this.detect(["windows","iemobile"])?"windows":_this.detect(["linux"])?"linux":"unknown",this.system.version=function(){try{if("ios"==_this.system.os){if(_this.agent.includes("intel mac")){let split=_this.agent.split("version/")[1].split(" ")[0].split(".");return Number(split[0]+"."+split[1])}var num=_this.agent.split("os ")[1].split("_"),main=num[0],sub=num[1].split(" ")[0];return Number(main+"."+sub)}if("android"==_this.system.os){var version=_this.agent.split("android ")[1].split(";")[0];return version.length>3&&(version=version.slice(0,-2)),"."==version.charAt(version.length-1)&&(version=version.slice(0,-1)),Number(version)}if("windows"==_this.system.os)return _this.agent.includes("rv:11")?11:Number(_this.agent.split("windows phone ")[1].split(";")[0])}catch(e){}return-1}(),this.system.browser="ios"==_this.system.os?_this.detect(["twitter","fbios","instagram"])?"social":_this.detect(["crios"])?"chrome":_this.detect(["safari"])?"safari":"unknown":"android"==_this.system.os?_this.detect(["twitter","fb","facebook","instagram"])?"social":_this.detect(["chrome"])?"chrome":_this.detect(["firefox"])?"firefox":"browser":_this.detect(["msie"])||_this.detect(["trident"])&&_this.detect(["rv:"])||_this.detect(["windows"])&&_this.detect(["edge"])?"ie":_this.detect(["chrome"])?"chrome":_this.detect(["safari"])?"safari":_this.detect(["firefox"])?"firefox":"unknown",this.system.browserVersion=function(){try{if("chrome"==_this.system.browser)return _this.detect("crios")?Number(_this.agent.split("crios/")[1].split(".")[0]):Number(_this.agent.split("chrome/")[1].split(".")[0]);if("firefox"==_this.system.browser)return Number(_this.agent.split("firefox/")[1].split(".")[0]);if("safari"==_this.system.browser)return Number(_this.agent.split("version/")[1].split(".")[0].split(".")[0]);if("ie"==_this.system.browser)return _this.detect(["msie"])?Number(_this.agent.split("msie ")[1].split(".")[0]):_this.detect(["rv:"])?Number(_this.agent.split("rv:")[1].split(".")[0]):Number(_this.agent.split("edge/")[1].split(".")[0])}catch(e){return-1}}(),this.mobile=!(window._NODE_||!("ontouchstart"in window)&&!("onpointerdown"in window)||!_this.system.os.includes(["ios","android","magicleap"]))&&{},_this.detect("oculusbrowser")&&(this.mobile=!0),_this.detect("quest")&&(this.mobile=!0),this.mobile&&this.detect(["windows"])&&!this.detect(["touch"])&&(this.mobile=!1),this.mobile&&(this.mobile.tablet=Math.max(window.screen?screen.width:window.innerWidth,window.screen?screen.height:window.innerHeight)>1e3,this.mobile.phone=!this.mobile.tablet,this.mobile.pwa=!(!window.matchMedia||!window.matchMedia("(display-mode: standalone)").matches)||!!window.navigator.standalone,Hydra.ready((()=>{_this.mobile.native=!(!Mobile.NativeCore||!Mobile.NativeCore.active)||!!window._AURA_}))),this.media={},this.media.audio=!!document.createElement("audio").canPlayType&&(_this.detect(["firefox","opera"])?"ogg":"mp3"),this.media.video=!!(vid=document.createElement("video")).canPlayType&&(vid.canPlayType("video/webm;")?"webm":"mp4"),this.media.webrtc=!!(window.webkitRTCPeerConnection||window.mozRTCPeerConnection||window.msRTCPeerConnection||window.oRTCPeerConnection||window.RTCPeerConnection),this.graphics={},this.graphics.webgl=function(){let DISABLED=!1;Object.defineProperty(_this.graphics,"webgl",{get:()=>{if(DISABLED)return!1;if(_this.graphics._webglContext)return _this.graphics._webglContext;try{const names=["webgl2","webgl","experimental-webgl"],canvas=document.createElement("canvas");let gl;for(let i=0;i<names.length&&(gl=canvas.getContext(names[i]),!gl);i++);let info=gl.getExtension("WEBGL_debug_renderer_info"),output={};if(info){let gpu=info.UNMASKED_RENDERER_WEBGL;output.gpu=gl.getParameter(gpu).toLowerCase()}else output.gpu="unknown";return output.renderer=gl.getParameter(gl.RENDERER).toLowerCase(),output.version=gl.getParameter(gl.VERSION).toLowerCase(),output.glsl=gl.getParameter(gl.SHADING_LANGUAGE_VERSION).toLowerCase(),output.extensions=gl.getSupportedExtensions(),output.webgl2=output.version.includes(["webgl 2","webgl2"]),output.canvas=canvas,output.context=gl,output.detect=function(matches){if(output.gpu&&output.gpu.toLowerCase().includes(matches))return!0;if(output.version&&output.version.toLowerCase().includes(matches))return!0;for(let i=0;i<output.extensions.length;i++)if(output.extensions[i].toLowerCase().includes(matches))return!0;return!1},output.webgl2||output.detect("instance")||window.AURA||(DISABLED=!0),_this.graphics._webglContext=output,output}catch(e){return!1}},set:v=>{!1===v&&(DISABLED=!0)}})}(),this.graphics.metal=function(){if(!window.Metal)return!1;let output={};return output.gpu=Metal.device.getName().toLowerCase(),output.detect=function(matches){return output.gpu.includes(matches)},output}(),this.graphics.gpu=function(){if(!_this.graphics.webgl&&!_this.graphics.metal)return!1;let output={};return["metal","webgl"].forEach((name=>{_this.graphics[name]&&!output.identifier&&(output.detect=_this.graphics[name].detect,output.identifier=_this.graphics[name].gpu)})),output}(),this.graphics.canvas=!!document.createElement("canvas").getContext;const checkForStyle=function(){let _tagDiv;return function(prop){_tagDiv=_tagDiv||document.createElement("div");const vendors=["Khtml","ms","O","Moz","Webkit"];if(prop in _tagDiv.style)return!0;prop=prop.replace(/^[a-z]/,(val=>val.toUpperCase()));for(let i=vendors.length-1;i>=0;i--)if(vendors[i]+prop in _tagDiv.style)return!0;return!1}}();this.styles={},this.styles.filter=checkForStyle("filter"),this.styles.blendMode=checkForStyle("mix-blend-mode"),this.tween={},this.tween.transition=checkForStyle("transition"),this.tween.css2d=checkForStyle("transform"),this.tween.css3d=checkForStyle("perspective"),this.social=_this.agent.includes("instagram")?"instagram":_this.agent.includes("fban")||_this.agent.includes("fbav")||_this.agent.includes("fbios")?"facebook":(_this.agent.includes("twitter")||!(!document.referrer||!document.referrer.includes("//t.co/")))&&"twitter"}),"Static"),Class((function Component(){Inherit(this,Events);const _this=this,_setters={},_flags={},_timers=[],_loops=[];var _onDestroy,_appStateBindings;function defineSetter(_this,prop){_setters[prop]={},Object.defineProperty(_this,prop,{set:function(v){_setters[prop]&&_setters[prop].s&&_setters[prop].s.call(_this,v),v=null},get:function(){if(_setters[prop]&&_setters[prop].g)return _setters[prop].g.apply(_this)}})}this.classes={},this.findParent=function(type){let p=_this.parent;for(;p;){if(p._cachedName||(p._cachedName=Utils.getConstructorName(p)),p._cachedName==type)return p;p=p.parent}},this.set=function(prop,callback){_setters[prop]||defineSetter(this,prop),_setters[prop].s=callback},this.get=function(prop,callback){_setters[prop]||defineSetter(this,prop),_setters[prop].g=callback},this.isPlayground=function(name){return Global.PLAYGROUND&&Global.PLAYGROUND==(name||Utils.getConstructorName(_this))},this.initClass=function(clss){if(!clss)throw console.trace(),"unable to locate class";const args=[].slice.call(arguments,1),child=Object.create(clss.prototype);if(child.parent=this,clss.apply(child,args),child.destroy){const id=Utils.timestamp();this.classes[id]=child,this.classes[id].__id=id}if(child.element){const last=arguments[arguments.length-1];Array.isArray(last)&&1==last.length&&last[0]instanceof HydraObject?last[0].add(child.element):this.element&&this.element.add&&null!==last&&this.element.add(child.element)}if(child.group){const last=arguments[arguments.length-1];this.group&&null!==last&&this.group.add(child.group)}return child},this.delayedCall=function(callback,time,scaledTime){const timer=Timer.create((()=>{_this&&_this.destroy&&callback&&callback()}),time,scaledTime);return _timers.push(timer),_timers.length>50&&_timers.shift(),timer},this.clearTimers=function(){for(let i=_timers.length-1;i>=0;i--)clearTimeout(_timers[i]);_timers.length=0},this.startRender=function(callback,fps,obj){"number"!=typeof fps&&(obj=fps,fps=void 0);for(let i=0;i<_loops.length;i++)if(_loops[i].callback==callback)return;let flagInvisible=_=>{_this._invisible||(_this._invisible=!0,_this.onInvisible&&_this.onInvisible())},loop=(a,b,c,d)=>{if(!_this.startRender)return!1;let p=_this;for(;p;){if(!1===p.visible)return flagInvisible();if(p.group&&!1===p.group.visible)return flagInvisible();p=p.parent}return!1!==_this._invisible&&(_this._invisible=!1,_this.onVisible&&_this.onVisible()),callback(a,b,c,d),!0};_loops.push({callback:callback,loop:loop}),obj?obj==RenderManager.NATIVE_FRAMERATE?Render.start(loop,null,!0):RenderManager.schedule(loop,obj):Render.start(loop,fps)},this.onResize=function(callback,callInitial=!0){callInitial&&callback(),this.events.sub(Events.RESIZE,callback)},this.stopRender=function(callback,obj){for(let i=0;i<_loops.length;i++)if(_loops[i].callback==callback){let loop=_loops[i].loop;obj&&RenderManager.unschedule(loop,obj),Render.stop(loop),_loops.splice(i,1)}},this.clearRenders=function(){for(let i=0;i<_loops.length;i++)Render.stop(_loops[i].loop);_loops.length=0},this.wait=function(object,key,callback){const promise=Promise.create();let condition;if("string"==typeof object&&(callback=key,key=object,object=_this),"number"==typeof object&&1===arguments.length)return _this.delayedCall(promise.resolve,object),promise;if("function"==typeof object&&1===arguments.length&&(condition=object,object=_this),"function"==typeof object&&"string"==typeof callback){let _object=object;object=key,key=callback,callback=_object}if(callback=callback||promise.resolve,condition||("!"===key?.charAt?.(0)?(key=key.slice(1),condition=()=>!(object[key]||_this.flag(key))):condition=()=>!!object[key]||!!_this.flag(key)),condition())callback();else{function test(){if(!object||!_this.flag||null===object.destroy)return Render.stop(test);condition()&&(callback(),Render.stop(test))}Render.start(test)}return promise},this.bindState=function(appState,key,...rest){_appStateBindings||(_appStateBindings=[]);let binding=appState.bind(key,...rest);return _appStateBindings.push(binding),binding},this.flag=function(name,value,time){if(void 0===value)return _flags[name];_flags[name]=value,time&&(clearTimeout(_flags[name+"_timer"]),_flags[name+"_timer"]=this.delayedCall((()=>{_flags[name]=!_flags[name]}),time))},this.destroy=function(){this.removeDispatch&&this.removeDispatch(),this.onDestroy&&this.onDestroy(),this.fxDestroy&&this.fxDestroy(),_onDestroy&&_onDestroy.forEach((cb=>cb()));for(let id in this.classes){var clss=this.classes[id];clss&&clss.destroy&&clss.destroy()}return this.classes=null,this.clearRenders&&this.clearRenders(),this.clearTimers&&this.clearTimers(),this.element&&window.GLUI&&this.element instanceof GLUIObject&&this.element.remove(),this.events&&(this.events=this.events.destroy()),this.parent&&this.parent.__destroyChild&&this.parent.__destroyChild(this.__id),_appStateBindings&&_appStateBindings.forEach((b=>b.destroy?.())),Utils.nullObject(this)},this._bindOnDestroy=function(cb){_onDestroy||(_onDestroy=[]),_onDestroy.push(cb)},this.__destroyChild=function(name){delete this.classes[name]}})),Class((function Model(){Inherit(this,Component),Namespace(this);const _this=this,_storage={},_requests={};let _data=0,_triggered=0;this.push=function(name,val){_storage[name]=val},this.pull=function(name){return _storage[name]},this.waitForData=this.promiseData=function(num=1){_data+=num},this.fulfillData=this.resolveData=function(){_triggered++,_triggered==_data&&(_this.dataReady=!0)},this.ready=function(callback){let promise=Promise.create();return callback&&promise.then(callback),_this.wait(_this,"dataReady").then(promise.resolve),promise},this.initWithData=function(data){for(var key in _this.STATIC_DATA=data,_this){var model=_this[key],init=!1;for(var i in data)i.toLowerCase().replace(/-/g,"")==key.toLowerCase()&&(init=!0,model.init&&model.init(data[i]));!init&&model.init&&model.init()}_this.init&&_this.init(data)},this.loadData=function(url,callback){let promise=Promise.create();callback||(callback=promise.resolve);var _this=this;return get(url+"?"+Utils.timestamp()).then((d=>{defer((()=>{_this.initWithData(d),callback(d)}))})),promise},this.handleRequest=function(type,callback){_requests[type]=callback},this.makeRequest=async function(type,data,mockData={}){if(!_requests[type])return console.warn(`Missing data handler for ${type} with mockData`,mockData),Array.isArray(mockData)?new StateArray(mockData):AppState.createLocal(mockData);let result=await _requests[type](data,mockData);if(!(result instanceof StateArray||result.createLocal))throw`makeRequest ${type} must return either an AppState or StateArray`;return result}})),Class((function Modules(){const _modules={},_constructors={};function exec(){for(let m in _modules)for(let key in _modules[m]){let module=_modules[m][key];module._ready||(module._ready=!0,module.exec&&module.exec())}}defer(exec),this.Module=function(module){let m=new module,name=module.toString().slice(0,100).match(/function ([^\(]+)/);name?(m._ready=!0,name=name[1],_modules[name]={index:m},_constructors[name]=module):(_modules[m.module]||(_modules[m.module]={}),_modules[m.module][m.path]=m)},this.require=function(path){let root;return path.includes("/")?(root=path.split("/")[0],path=path.replace(root+"/","")):(root=path,path="index"),function requireModule(root,path){let module=_modules[root];if(!module)throw`Module ${root} not found`;return module=module[path],module._ready||(module._ready=!0,module.exec&&module.exec()),module}(root,path).exports},this.getConstructor=function(name){return _constructors[name]},window.Module=this.Module,window._NODE_||(window.requireNative=window.require,window.require=this.require)}),"Static"),Class((function LinkedList(){var prototype=LinkedList.prototype;this.length=0,this.first=null,this.last=null,this.current=null,this.prev=null,void 0===prototype.push&&(prototype.push=function(obj){this.first?(obj.__next=this.first,obj.__prev=this.last,this.last.__next=obj,this.last=obj):(this.first=obj,this.last=obj,obj.__prev=obj,obj.__next=obj),this.length++},prototype.remove=function(obj){obj&&obj.__next&&(this.length<=1?this.empty():(obj==this.first?(this.first=obj.__next,this.last.__next=this.first,this.first.__prev=this.last):obj==this.last?(this.last=obj.__prev,this.last.__next=this.first,this.first.__prev=this.last):(obj.__prev.__next=obj.__next,obj.__next.__prev=obj.__prev),this.length--),obj.__prev=null,obj.__next=null)},prototype.empty=function(){this.first=null,this.last=null,this.current=null,this.prev=null,this.length=0},prototype.start=function(){return this.current=this.first,this.prev=this.current,this.current},prototype.next=function(){if(this.current&&(this.current=this.current.__next,1!=this.length&&this.prev.__next!=this.first))return this.prev=this.current,this.current},prototype.destroy=function(){return Utils.nullObject(this),null})})),Class((function ObjectPool(_type,_number=10){var _pool=[];this.array=_pool,function(){if(_type)for(var i=0;i<_number;i++)_pool.push(new _type)}(),this.get=function(){return _pool.shift()||(_type?new _type:null)},this.empty=function(){_pool.length=0},this.put=function(obj){obj&&!_pool.includes(obj)&&_pool.push(obj)},this.insert=function(array){void 0===array.push&&(array=[array]);for(var i=0;i<array.length;i++)this.put(array[i])},this.length=function(){return _pool.length},this.randomize=function(){let array=_pool;for(let i=array.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[array[i],array[j]]=[array[j],array[i]]}},this.destroy=function(){for(let i=_pool.length-1;i>=0;i--)_pool[i].destroy&&_pool[i].destroy();return _pool=null}})),Class((function Gate(){var _list=[],_map={};this.create=function(name){let promise=Promise.create();name?_map[name]=promise:_list.push(promise)},this.open=function(name){name&&(_map[name]||(_map[name]=Promise.create()),_map[name].resolve());let promise=_list.shift();promise&&promise.resolve()},this.wait=function(name){return _list.length||name?name?(_map[name]||(_map[name]=Promise.create()),_map[name]):_list[_list.length-1]||Promise.resolve():Promise.resolve()}}),"static"),Class((function Assets(){const _this=this;function AssetList(arr){return arr.__proto__=AssetList.prototype,arr}this.__loaded=[],this.FLIPY=!0,this.CDN="",this.CORS="anonymous",this.IMAGES={},this.VIDEOS={},this.AUDIOS={},this.SDF={},this.JSON={push:function(prop,value){this[prop]=value,Object.defineProperty(this,prop,{get:()=>JSON.parse(JSON.stringify(value))})}},Object.defineProperty(this.JSON,"push",{enumerable:!1,writable:!0}),this.SVG={},AssetList.prototype=new Array,AssetList.prototype.filter=function(items){for(let i=this.length-1;i>=0;i--)this[i].includes(items)||this.splice(i,1);return this},AssetList.prototype.exclude=function(items){for(let i=this.length-1;i>=0;i--)this[i].includes(items)&&this.splice(i,1);return this},AssetList.prototype.prepend=function(prefix){for(let i=this.length-1;i>=0;i--)this[i]=prefix+this[i];return this},AssetList.prototype.append=function(suffix){for(let i=this.length-1;i>=0;i--)this[i]=this[i]+suffix;return this},this.list=function(){return window.ASSETS||console.warn("ASSETS list not available"),new AssetList(window.ASSETS.slice(0)||[])},this.BASE_PATH="",this.getPath=function(path){if(path.includes("~"))return _this.BASE_PATH+path.replace("~","");if(path.includes("//"))return path;if(path=function parseResolution(path){if(!window.ASSETS||!ASSETS.RES)return path;var res=ASSETS.RES[path],ratio=Math.min(Device.pixelRatio,3);if(!res)return path;if(!res["x"+ratio])return path;var split=path.split("/"),file=split[split.length-1];return split=file.split("."),path.replace(file,split[0]+"-"+ratio+"x."+split[1])}(path),_this.replacementPaths)for(let pathKey in _this.replacementPaths)if(path.startsWith(pathKey))return path=path.replace(pathKey,_this.replacementPaths[pathKey]);if(_this.dictionary)for(let pathKey in _this.dictionary)if(_this.dictionary[pathKey].includes(path.split("?")[0]))return pathKey+path;return this.CDN&&!~path.indexOf(this.CDN)&&(path=this.CDN+path),path},this.registerPathReplacement=function(path,replacedPath){_this.replacementPaths||(_this.replacementPaths={}),_this.replacementPaths[path]=replacedPath},this.registerPath=function(path,assets){_this.dictionary||(_this.dictionary={}),_this.dictionary[path]=assets},this.loadImage=function(path,isStore){var img=new Image;return img.crossOrigin=this.CORS,img.src=_this.getPath(path),img.loadPromise=function(){let promise=Promise.create();return img.onload=promise.resolve,promise},isStore&&(this.IMAGES[path]=img),img},this.decodeImage=function(path,params,promise){promise||(promise=Promise.create());let img=_this.loadImage(path);return img.onload=()=>promise.resolve(img),img.onerror=()=>_this.decodeImage("assets/images/_scenelayout/uv.jpg",params,promise),promise}}),"static"),Class((function AssetLoader(_assets,_callback,ASSETS=Assets){Inherit(this,Events);const _this=this;let _total=_assets.length,_loaded=0,_lastFiredPercent=0;function loadAsset(){let path=_assets.splice(_assets.length-1,1)[0];const name=path.split("assets/").last().split(".")[0],ext=path.split(".").last().split("?")[0].toLowerCase();let timeout=Timer.create(timedOut,AssetLoader.TIMEOUT,path);if(!Assets.preventCache&&~Assets.__loaded.indexOf(path))return loaded();if(ext.includes(["jpg","jpeg","png","gif"])){let image=ASSETS.loadImage(path);return image.complete?loaded():(image.onload=loaded,void(image.onerror=loaded))}function loaded(){timeout&&clearTimeout(timeout),increment(),_assets.length&&loadAsset()}ext.includes(["mp4","webm"])?fetch(path).then((async response=>{let blob=await response.blob();Assets.VIDEOS[name]=URL.createObjectURL(blob),loaded()})).catch((e=>{console.warn(e),loaded()})):ext.includes(["mp3"])?fetch(path).then((async response=>{let blob=await response.blob();Assets.AUDIOS[name]=URL.createObjectURL(blob),loaded()})).catch((e=>{console.warn(e),loaded()})):get(Assets.getPath(path),Assets.HEADERS).then((data=>{Assets.__loaded.push(path),"json"==ext&&ASSETS.JSON.push(name,data),"svg"==ext&&(ASSETS.SVG[name]=data),"fnt"==ext&&(ASSETS.SDF[name.split("/")[1]]=data),"js"==ext&&window.eval(data),ext.includes(["fs","vs","glsl"])&&window.Shaders&&Shaders.parse(data,path),loaded()})).catch((e=>{console.warn(e),loaded()}))}function increment(){let percent=Math.max(_lastFiredPercent,Math.min(1,++_loaded/_total));_this.events.fire(Events.PROGRESS,{percent:percent}),_lastFiredPercent=percent,_loaded>=_total&&defer(complete)}function complete(){_this.completed||(_this.completed=!0,defer((()=>{_callback&&_callback(),_this.events.fire(Events.COMPLETE)})))}function timedOut(path){console.warn("Asset timed out",path)}!function(){if(!Array.isArray(_assets))throw"AssetLoader requires array of assets to load";_assets=_assets.slice(0).reverse(),function init(){if(!_assets.length)return complete();for(let i=0;i<AssetLoader.SPLIT;i++)_assets.length&&loadAsset()}()}(),this.loadModules=function(){if(!window._BUILT_)return;this.add(1);let src="assets/js/"+(window._ES5_?"es5-modules":"modules")+".js?"+window._CACHE_,s=document.createElement("link");return s.href=src,s.rel="preload",s.as="script",document.head.appendChild(s),s=document.createElement("script"),s.src=src,s.async=!0,document.head.appendChild(s),AssetLoader.waitForLib("_MODULES_").then((_=>_this.trigger(1)))},this.add=function(num){_total+=num||1},this.trigger=function(num){for(let i=0;i<(num||1);i++)increment()}}),(()=>{AssetLoader.SPLIT=2,AssetLoader.TIMEOUT=5e3,AssetLoader.loadAllAssets=function(callback){let promise=Promise.create();return callback||(callback=promise.resolve),promise.loader=new AssetLoader(Assets.list(),(()=>{callback&&callback(),promise.loader&&promise.loader.destroy&&(promise.loader=promise.loader.destroy())})),promise},AssetLoader.loadAssets=function(list,callback){let promise=Promise.create();return callback||(callback=promise.resolve),promise.loader=new AssetLoader(list,(()=>{callback&&callback(),promise.loader&&promise.loader.destroy&&(promise.loader=promise.loader.destroy())})),promise},AssetLoader.waitForLib=function(name,callback){let promise=Promise.create();return callback||(callback=promise.resolve),Render.start((function check(){window[name]&&(Render.stop(check),callback&&callback())})),promise},AssetLoader.waitForModules=function(){return AssetLoader.waitForLib(window._BUILT_?"_MODULES_":"zUtils3D")}})),function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e=e||self).goober={})}(this,(function(e){let t={data:""},n=e=>"undefined"!=typeof window?((e?e.querySelector("#_goober"):window._goober)||Object.assign((e||document.head).appendChild(document.createElement("style")),{innerHTML:" ",id:"_goober"})).firstChild:e||t,o=/(?:([A-Z0-9-%@]+) *:? *([^{;]+?);|([^;}{]*?) *{)|(})/gi,r=/\/\*[^]*?\*\/|\s\s+|\n/g,l=(e,t)=>{let n,o="",r="",a="";for(let s in e){let c=e[s];"object"==typeof c?(n=t?t.replace(/([^,])+/g,(e=>s.replace(/([^,])+/g,(t=>/&/.test(t)?t.replace(/&/g,e):e?e+" "+t:t)))):s,r+="@"==s[0]?"f"==s[1]?l(c,s):s+"{"+l(c,"k"==s[1]?"":t)+"}":l(c,n)):"@"==s[0]&&"i"==s[1]?o=s+" "+c+";":(s=s.replace(/[A-Z]/g,"-$&").toLowerCase(),a+=l.p?l.p(s,c):s+":"+c+";")}return a[0]?(n=t?t+"{"+a+"}":a,o+n+r):o+r},a={},s=e=>{let t="";for(let n in e)t+=n+("object"==typeof e[n]?s(e[n]):e[n]);return t},c=(e,t,n,c,i)=>{let f="object"==typeof e?s(e):e,p=a[f]||(a[f]=(e=>{let t=0,n=11;for(;t<e.length;)n=101*n+e.charCodeAt(t++)>>>0;return"go"+n})(f));if(!a[p]){let t="object"==typeof e?e:(e=>{let t,n=[{}];for(;t=o.exec(e.replace(r,""));)t[4]&&n.shift(),t[3]?n.unshift(n[0][t[3]]=n[0][t[3]]||{}):t[4]||(n[0][t[1]]=t[2]);return n[0]})(e);a[p]=l(i?{["@keyframes "+p]:t}:t,n?"":"."+p)}return((e,t,n)=>{-1==t.data.indexOf(e)&&(t.data=n?e+t.data:t.data+e)})(a[p],t,c),p},i=(e,t,n)=>e.reduce(((e,o,r)=>{let a=t[r];if(a&&a.call){let e=a(n),t=e&&e.props&&e.props.className||/^go/.test(e)&&e;a=t?"."+t:e&&"object"==typeof e?e.props?"":l(e,""):e}return e+o+(null==a?"":a)}),"");function f(e){let t=this||{},o=e.call?e(t.p):e;return c(o.unshift?o.raw?i(o,[].slice.call(arguments,1),t.p):o.reduce(((e,n)=>n?Object.assign(e,n.call?n(t.p):n):e),{}):o,n(t.target),t.g,t.o,t.k)}let p,d,u,g=f.bind({g:1}),b=f.bind({k:1});e.css=f,e.extractCss=e=>{let t=n(e),o=t.data;return t.data="",o},e.glob=g,e.keyframes=b,e.setup=function(e,t,n,o){l.p=t,p=e,d=n,u=o},e.styled=function(e,t){let n=this||{};return function(){let o=arguments;function r(l,a){let s=Object.assign({},l),c=s.className||r.className;n.p=Object.assign({theme:d&&d()},s),n.o=/ *go\d+/.test(c),s.className=f.apply(n,o)+(c?" "+c:""),t&&(s.ref=a);let i=s.as||e;return u&&i[0]&&u(s),p(i,s)}return t?t(r):r}}})),function(i,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports):"function"==typeof define&&define.amd?define(["exports"],n):n((i=i||self).gooberPrefixer={})}(this,(function(i){var n=new Map([["align-self","-ms-grid-row-align"],["color-adjust","-webkit-print-color-adjust"],["column-gap","grid-column-gap"],["gap","grid-gap"],["grid-template-columns","-ms-grid-columns"],["grid-template-rows","-ms-grid-rows"],["justify-self","-ms-grid-column-align"],["margin-inline-end","-webkit-margin-end"],["margin-inline-start","-webkit-margin-start"],["overflow-wrap","word-wrap"],["padding-inline-end","-webkit-padding-end"],["padding-inline-start","-webkit-padding-start"],["row-gap","grid-row-gap"],["scroll-margin-bottom","scroll-snap-margin-bottom"],["scroll-margin-left","scroll-snap-margin-left"],["scroll-margin-right","scroll-snap-margin-right"],["scroll-margin-top","scroll-snap-margin-top"],["scroll-margin","scroll-snap-margin"],["text-combine-upright","-ms-text-combine-horizontal"]]);i.prefix=function(i,r){let t="";const e=n.get(i);e&&(t+=`${e}:${r};`);const o=function(i){var n=/^(?:(text-(?:decoration$|e|or|si)|back(?:ground-cl|d|f)|box-d|(?:mask(?:$|-[ispro]|-cl)))|(tab-|column(?!-s)|text-align-l)|(ap)|(u|hy))/i.exec(i);return n?n[1]?1:n[2]?2:n[3]?3:5:0}(i);1&o&&(t+=`-webkit-${i}:${r};`),2&o&&(t+=`-moz-${i}:${r};`),4&o&&(t+=`-ms-${i}:${r};`);const a=function(i,n){var r=/^(?:(pos)|(background-i)|((?:max-|min-)?(?:block-s|inl|he|widt))|(dis))/i.exec(i);return r?r[1]?/^sti/i.test(n)?1:0:r[2]?/^image-/i.test(n)?1:0:r[3]?"-"===n[3]?2:0:/^(inline-)?grid$/i.test(n)?4:0:0}(i,r);return 1&a?t+=`${i}:-webkit-${r};`:2&a?t+=`${i}:-moz-${r};`:4&a&&(t+=`${i}:-ms-${r};`),t+=`${i}:${r};`,t}})),function(e,o){"object"==typeof exports&&"undefined"!=typeof module?o(exports,require("goober")):"function"==typeof define&&define.amd?define(["exports","goober"],o):o((e=e||self).gooberGlobal={},e.goober)}(this,(function(e,o){let n=o.css.bind({g:1});e.createGlobalStyles=function(){const e=o.styled.call({g:1},"div").apply(null,arguments);return function(o){return e(o),null}},e.glob=n})),Hydra.ready((function(){window.__window=$(window),window.__document=$(document),window.__body=$(document.getElementsByTagName("body")[0]),window.Stage=window.Stage&&window.Stage.style?$(window.Stage):__body.create("#Stage"),Stage.size("100%"),Stage.__useFragment=!0,Stage.width=window.innerWidth||document.body.clientWidth||document.documentElement.offsetWidth,Stage.height=window.innerHeight||document.body.clientHeight||document.documentElement.offsetHeight})),Class((function HydraCSS(){var _tag,_obj,_style,_needsUpdate,_this=this;function objToCSS(key){var match=key.match(/[A-Z]/),camelIndex=match?match.index:null;if(camelIndex){var start=key.slice(0,camelIndex),end=key.slice(camelIndex);key=start+"-"+end.toLowerCase()}return key}function setHTML(){_tag.innerHTML=_style,_needsUpdate=!1}Hydra.ready((function(){_obj={},_style="",(_tag=document.createElement("style")).type="text/css",document.getElementsByTagName("head")[0].appendChild(_tag)})),this._read=function(){return _style},this._write=function(css){_style=css,_needsUpdate||(_needsUpdate=!0,defer(setHTML))},this.style=function(selector,obj={}){_obj[selector]||(_obj[selector]={}),Object.assign(_obj[selector],obj),function render(){var s="";for(let selector in _obj){let obj=_obj[selector];for(var key in s+=selector+" {",obj){var prop=objToCSS(key),val=obj[key];"string"!=typeof val&&"opacity"!=key&&(val+="px"),s+=prop+":"+val+"!important;"}s+="}"}_this._write(s)}()},this.get=function(selector,prop){if(!_obj[selector])return prop?null:{};let obj=Object.assign({},_obj[selector]);return prop?obj[prop]:obj},this.textSize=function($obj){var $clone=$obj.clone();$clone.css({position:"relative",cssFloat:"left",styleFloat:"left",marginTop:-99999,width:"",height:""}),__body.addChild($clone);var width=$clone.div.offsetWidth,height=$clone.div.offsetHeight;return $clone.remove(),{width:width,height:height}},this.prefix=function(style){return""==_this.styles.vendor?style.charAt(0).toLowerCase()+style.slice(1):_this.styles.vendor+style},this._toCSS=objToCSS}),"Static"),Class((function HydraObject(_selector,_type,_exists,_useFragment){this._children=new LinkedList,this._onDestroy,this.__useFragment=_useFragment,this._initSelector(_selector,_type,_exists)}),(()=>{var prototype=HydraObject.prototype;prototype._initSelector=function(_selector,_type,_exists){if(_selector&&"string"!=typeof _selector)this.div=_selector;else{var first=_selector?_selector.charAt(0):null,name=_selector?_selector.slice(1):null;if("."!=first&&"#"!=first&&(name=_selector,first="."),_exists){if("#"!=first)throw"Hydra Selectors Require #ID";this.div=document.getElementById(name)}else this._type=_type||"div","svg"==this._type?(this.div=document.createElementNS("http://www.w3.org/2000/svg",this._type),this.div.setAttributeNS("http://www.w3.org/2000/xmlns/","xmlns:xlink","http://www.w3.org/1999/xlink")):(this.div=document.createElement(this._type),first&&("#"==first?this.div.id=name:this.div.className=name))}this.div.hydraObject=this},prototype.add=function(child){var div=this.div,_this=this,createFrag=function(){_this.__useFragment&&(_this._fragment||(_this._fragment=document.createDocumentFragment(),defer((function(){if(!_this._fragment||!_this.div)return _this._fragment=null;_this.div.appendChild(_this._fragment),_this._fragment=null}))),div=_this._fragment)};return child.element&&child.element instanceof HydraObject?(createFrag(),div.appendChild(child.element.div),this._children.push(child.element),child.element._parent=this,child.element.div.parentNode=this.div):child.div?(createFrag(),div.appendChild(child.div),this._children.push(child),child._parent=this,child.div.parentNode=this.div):child.nodeName&&(createFrag(),div.appendChild(child),child.parentNode=this.div),this},prototype.clone=function(){return $(this.div.cloneNode(!0))},prototype.create=function(name,type){var $obj=$(name,type);return this.add($obj),$obj},prototype.empty=function(){for(var child=this._children.start();child;){var next=this._children.next();child&&child.remove&&child.remove(),child=next}return this.div.innerHTML="",this},prototype.parent=function(){return this._parent},prototype.children=function(isHydraChildren=!1){let children=this.div.children?this.div.children:this.div.childNodes;if(isHydraChildren){children=[];for(var child=this._children.start();child;)child&&(children.push(child),child=this._children.next())}return children},prototype.removeChild=function(object,keep){try{object.div.parentNode.removeChild(object.div)}catch(e){}keep||this._children.remove(object)},prototype.remove=function(param){param&&console.warn("HydraObject.remove removes ITSELF from its parent. use removeChild instead"),this._onDestroy&&this._onDestroy.forEach((cb=>cb())),this.removed=!0;var parent=this._parent;parent&&!parent.removed&&parent.removeChild&&parent.removeChild(this,!0);for(var child=this._children.start();child;){var next=this._children.next();child&&child.remove&&child.remove(),child=next}this._children.destroy(),this.div.hydraObject=null,Utils.nullObject(this)},prototype.destroy=function(){this.remove()},prototype._bindOnDestroy=function(cb){this._onDestroy||(this._onDestroy=[]),this._onDestroy.push(cb)},window.$=function(selector,type,exists){return new HydraObject(selector,type,exists)},$.fn=HydraObject.prototype})),$.fn.text=function(text){return void 0!==text?(this.__cacheText!=text&&(this.div.textContent=text),this.__cacheText=text,this):this.div.textContent},$.fn.html=function(text,force){return!text||text.includes("<")||force?void 0!==text?(this.div.innerHTML=text,this):this.div.innerHTML:this.text(text)},$.fn.hide=function(){return this.div.style.display="none",this},$.fn.show=function(){return this.div.style.display="",this},$.fn.visible=function(){return this.div.style.visibility="visible",this},$.fn.invisible=function(){return this.div.style.visibility="hidden",this},$.fn.setZ=function(z){return this.div.style.zIndex=z,this},$.fn.clearAlpha=function(){return this.div.style.opacity="",this},$.fn.size=function(w,h,noScale){return"string"==typeof w?(void 0===h?h="100%":"string"!=typeof h&&(h+="px"),this.div.style.width=w,this.div.style.height=h):(this.div.style.width=w+"px",this.div.style.height=h+"px",noScale||(this.div.style.backgroundSize=w+"px "+h+"px")),this.width=w,this.height=h,this},$.fn.mouseEnabled=function(bool){return this.div.style.pointerEvents=bool?"auto":"none",this},$.fn.fontStyle=function(family,size,color,style){var font={};return family&&(font.fontFamily=family),size&&(font.fontSize=size),color&&(font.color=color),style&&(font.fontStyle=style),this.css(font),this},$.fn.font=function(font){return this.css("font",font),this},$.fn.bg=function(src,x,y,repeat){return src?(src.includes(".")&&(src=Assets.getPath(src)),src.includes(".")?this.div.style.backgroundImage="url("+src+")":this.div.style.backgroundColor=src,void 0!==x&&(x="number"==typeof x?x+"px":x,y="number"==typeof y?y+"px":y,this.div.style.backgroundPosition=x+" "+y),repeat&&(this.div.style.backgroundSize="",this.div.style.backgroundRepeat=repeat),"cover"!=x&&"contain"!=x||(this.div.style.backgroundSize=x,this.div.style.backgroundPosition=void 0!==y?y+" "+repeat:"center"),this):this},$.fn.center=function(x,y,noPos){var css={};return void 0===x?(css.left="50%",css.top="50%",css.marginLeft=-this.width/2,css.marginTop=-this.height/2):(x&&(css.left="50%",css.marginLeft=-this.width/2),y&&(css.top="50%",css.marginTop=-this.height/2)),noPos&&(delete css.left,delete css.top),this.css(css),this},$.fn.max=function(width,height){let w,h;return void 0!==width&&(w="number"==typeof width?width+"px":width,this.div.style.maxWidth=w),void 0!==height?(h="number"==typeof height?height+"px":height,this.div.style.maxHeight=h):(h=w,this.div.style.maxHeight=h),this},$.fn.min=function(width,height){let w,h;return void 0!==width&&(w="number"==typeof width?width+"px":width,this.div.style.minWidth=w),void 0!==height?(h="number"==typeof height?height+"px":height,this.div.style.minHeight=h):(h=w,this.div.style.minHeight=h),this},$.fn.flex=function(inline){return this.div.style.display=inline?"inline-flex":"flex",this.div.style.justifyContent="center",this.div.style.alignItems="center",this.div.classList.add("relative-children"),this},$.fn.order=function(opts={}){let s=this.div.style;return"none"===opts.flexWrap&&(opts.flexWrap="nowrap"),opts.direction&&(s.flexDirection=opts.direction),opts.wrap&&(s.flexWrap=opts.wrap),opts.order&&(s.order=opts.order),this},$.fn.align=function(opts={}){let s=this.div.style;function flex(str,contentMode=!1){return"start"===str?"flex-start":"end"===str?"flex-end":"between"===str?contentMode?"space-between":"flex-between":"around"===str?contentMode?"space-around":"flex-around":"none"===str?"nowrap":str}return opts.justify&&(s.justifyContent=flex(opts.justify)),opts.items&&(s.alignItems=flex(opts.items)),opts.self&&(s.alignSelf=flex(opts.self)),opts.content&&(s.alignContent=flex(opts.content,!0)),this},$.fn.flexibility=function(opts={}){let s=this.div.style;return"undefined"!==opts.grow&&(s.flexGrow=opts.grow),"undefined"!==opts.shrink&&(s.flexGrow=opts.shrink),void 0!==opts.basis&&(s.flexBasis="number"==typeof opts.basis?opts.basis+"px":opts.basis),this},$.fn.mask=function(arg){let maskPrefix="Moz"===HydraCSS.styles.vendor?"mask":HydraCSS.prefix("Mask");return this.div.style[maskPrefix]=(arg.includes(".")?"url("+arg+")":arg)+" no-repeat",this.div.style[maskPrefix+"Size"]="contain",this},$.fn.blendMode=function(mode,bg){return bg?this.div.style["background-blend-mode"]=mode:this.div.style["mix-blend-mode"]=mode,this},$.fn.css=function(obj,value){if("boolean"==typeof value&&(value=null),"object"!=typeof obj){if(value)return this.div.style[obj]=value,this;var style=this.div.style[obj];if("number"!=typeof style){if(!style)return!1;style.includes("px")&&(style=Number(style.slice(0,-2))),"opacity"==obj&&(style=isNaN(Number(this.div.style.opacity))?1:Number(this.div.style.opacity))}return style||(style=0),style}for(var type in TweenManager._clearCSSTween(this),obj){var val=obj[type];"string"!=typeof val&&"number"!=typeof val||("string"!=typeof val&&"opacity"!=type&&"zIndex"!=type&&"lineHeight"!=type&&(val+="px"),"position"==type&&"sticky"==val&&"safari"==Device.system.browser&&(val="-webkit-sticky"),this.div.style[type]=val)}return this},$.fn.transform=function(props){if(Hydra.LOCAL&&props&&!this.__warningShown&&!props._mathTween&&(this.__lastTransform&&performance.now()-this.__lastTransform<20&&(this.__warningCount=++this.__warningCount||1,props.__warningCount2=++props.__warningCount2||1,this.__warningCount>10&&props.__warningCount2!==this.__warningCount&&(console.warn("Are you using .transform() in a loop? Avoid creating a new object {} every frame. Ex. assign .x = 1; and .transform();"),console.log(this),this.__warningShown=!0)),this.__lastTransform=performance.now()),TweenManager._clearCSSTween(this),Device.tween.css2d){if(props)for(var key in props)"number"!=typeof props[key]&&"string"!=typeof props[key]||(this[key]=props[key]);else props=this;var transformString=TweenManager._parseTransform(props);this.__transformCache!=transformString&&(this.div.style[HydraCSS.styles.vendorTransform]=transformString,this.__transformCache=transformString)}return this},$.fn.willChange=function(props){if("boolean"==typeof props)this._willChangeLock=!0===props;else if(this._willChangeLock)return;var string="string"==typeof props;this._willChange&&!string||"null"==typeof props?(this._willChange=!1,this.div.style["will-change"]=""):(this._willChange=!0,this.div.style["will-change"]=string?props:HydraCSS.transformProperty+", opacity")},$.fn.backfaceVisibility=function(visible){this.div.style[HydraCSS.prefix("BackfaceVisibility")]=visible?"visible":"hidden"},$.fn.enable3D=function(perspective,x,y){return Device.tween.css3d?(this.div.style[HydraCSS.prefix("TransformStyle")]="preserve-3d",perspective&&(this.div.style[HydraCSS.prefix("Perspective")]=perspective+"px"),void 0!==x&&(x="number"==typeof x?x+"px":x,y="number"==typeof y?y+"px":y,this.div.style[HydraCSS.prefix("PerspectiveOrigin")]=x+" "+y),this):this},$.fn.disable3D=function(){return this.div.style[HydraCSS.prefix("TransformStyle")]="",this.div.style[HydraCSS.prefix("Perspective")]="",this},$.fn.transformPoint=function(x,y,z){var origin="";return void 0!==x&&(origin+="number"==typeof x?x+"px ":x+" "),void 0!==y&&(origin+="number"==typeof y?y+"px ":y+" "),void 0!==z&&(origin+="number"==typeof z?z+"px":z),this.div.style[HydraCSS.prefix("TransformOrigin")]=origin,this},$.fn.tween=function(props,time,ease,delay,callback,manual){"boolean"==typeof delay?(manual=delay,delay=0,callback=null):"function"==typeof delay&&(callback=delay,delay=0),"boolean"==typeof callback&&(manual=callback,callback=null),delay||(delay=0);var usePromise=null;callback&&callback instanceof Promise&&(usePromise=callback,callback=callback.resolve);var tween=TweenManager._detectTween(this,props,time,ease,delay,callback,manual);return usePromise||tween},$.fn.clearTransform=function(){return"number"==typeof this.x&&(this.x=0),"number"==typeof this.y&&(this.y=0),"number"==typeof this.z&&(this.z=0),"number"==typeof this.scale&&(this.scale=1),"number"==typeof this.scaleX&&(this.scaleX=1),"number"==typeof this.scaleY&&(this.scaleY=1),"number"==typeof this.rotation&&(this.rotation=0),"number"==typeof this.rotationX&&(this.rotationX=0),"number"==typeof this.rotationY&&(this.rotationY=0),"number"==typeof this.rotationZ&&(this.rotationZ=0),"number"==typeof this.skewX&&(this.skewX=0),"number"==typeof this.skewY&&(this.skewY=0),this.div.style[HydraCSS.styles.vendorTransform]="",this.__transformCache="",this},$.fn.clearTween=function(){return this._cssTween&&this._cssTween.stop(),this._mathTween&&this._mathTween.stop(),this},$.fn.stopTween=function(){return console.warn(".stopTween deprecated. use .clearTween instead"),this.clearTween()},$.fn.keypress=function(callback){this.div.onkeypress=function(e){(e=e||window.event).code=e.keyCode?e.keyCode:e.charCode,callback&&callback(e)}},$.fn.keydown=function(callback){this.div.onkeydown=function(e){(e=e||window.event).code=e.keyCode,callback&&callback(e)}},$.fn.keyup=function(callback){this.div.onkeyup=function(e){(e=e||window.event).code=e.keyCode,callback&&callback(e)}},$.fn.attr=function(attr,value){return"string"!=typeof attr?this:void 0===value?this.div.getAttribute(attr):(!1===value||null===value?this.div.removeAttribute(attr):this.div.setAttribute(attr,value),this)},$.fn.val=function(value){return void 0===value?this.div.value:(this.div.value=value,this)},$.fn.change=function(callback){var _this=this;this.div.onchange=function(){callback({object:_this,value:_this.div.value||""})}},$.fn.svgSymbol=function(id,width,height){var config=SVG.getSymbolConfig(id),svgHTML='<svg viewBox="0 0 '+config.width+" "+config.height+'" width="'+width+'" height="'+height+'"><use xlink:href="#'+config.id+'" x="0" y="0" /></svg>';this.html(svgHTML,!0)},$.fn.svg=async function(url){let promise=Promise.create();return fetch(url).then((async res=>{let svgHTML=await res.text();this.html(svgHTML,!0),promise.resolve()})),promise},$.fn.overflowScroll=function(dir){var x=!!dir.x,y=!!dir.y,overflow={};(!x&&!y||x&&y)&&(overflow.overflow="auto"),!x&&y&&(overflow.overflowY="auto",overflow.overflowX="hidden"),x&&!y&&(overflow.overflowX="auto",overflow.overflowY="hidden"),Device.mobile&&(overflow["-webkit-overflow-scrolling"]="touch",Mobile._addOverflowScroll(this)),this.css(overflow)},$.fn.removeOverflowScroll=function(){this.css({overflow:"hidden",overflowX:"",overflowY:"","-webkit-overflow-scrolling":""}),Device.mobile&&Mobile._removeOverflowScroll(this)},$.fn.accessible=function(type="label",tabIndex=-1){switch(tabIndex>-1&&this.attr("tabindex",tabIndex),type){case"label":this.attr("aria-label",this.div.textContent);break;case"hidden":this.attr("aria-hidden",!0)}},$.fn.tabIndex=function(tabIndex){return this.attr("tabindex",tabIndex),this},$.fn.createObserver=function(callback,{isViewport:isViewport=!1,...options}={}){isViewport&&(options.root=this.div);const observer=this._observer=new IntersectionObserver((array=>{array.forEach((entry=>{entry.object=entry.target.hydraObject})),callback(array)}),options);return this._bindOnDestroy((()=>{observer.disconnect()})),this},$.fn.observe=function(obj=this){return this._observer?.observe(obj.div),this},$.fn.unobserve=function(obj=this){return this._observer?.unobserve(obj.div),this},$.fn.cursor=function(cursor,lock){return lock&&(this.cursorLock||(this.cursorLock=new Map),"auto"==cursor?this.cursorLock.delete(lock):this.cursorLock.set(lock,cursor)),this.cursorLock&&"auto"==cursor&&this.cursorLock.forEach((v=>{cursor=v})),this.css("cursor",cursor),this},$.fn.classList=function(){return this.div.classList},$.fn.goob=function(styles){let _styles;return _styles="string"==typeof styles?goober.css`${styles}`:goober.css(styles),this.goobClass=_styles,this.div.classList.add(_styles),this},function(){var windowsPointer=!!window.MSGesture,translateEvent=function(evt){if(windowsPointer)switch(evt){case"touchstart":return"pointerdown";case"touchmove":return"MSGestureChange";case"touchend":return"pointerup"}return evt},convertTouchEvent=function(e){var touchEvent={x:0,y:0};if(e.windowsPointer)return e;if(!e)return touchEvent;if(e.touches||e.changedTouches?e.touches.length?(touchEvent.x=e.touches[0].clientX,touchEvent.y=e.touches[0].clientY):(touchEvent.x=e.changedTouches[0].clientX,touchEvent.y=e.changedTouches[0].clientY):(touchEvent.x=e.clientX,touchEvent.y=e.clientY),Mobile.ScreenLock&&Mobile.ScreenLock.isActive&&Mobile.orientationSet&&Mobile.orientation!==Mobile.orientationSet){if(90==window.orientation||0===window.orientation){var x=touchEvent.y;touchEvent.y=touchEvent.x,touchEvent.x=Stage.width-x}if(-90==window.orientation||180===window.orientation){var y=touchEvent.x;touchEvent.x=touchEvent.y,touchEvent.y=Stage.height-y}}return touchEvent};$.fn.click=function(callback){var _this=this;return this.div.addEventListener(translateEvent("click"),(function click(e){return!!_this.div&&(!Mouse._preventClicks&&(e.object="hit"==_this.div.className?_this.parent():_this,e.action="click",callback&&callback(e),void(Mouse.autoPreventClicks&&Mouse.preventClicks())))}),!0),this.div.style.cursor="pointer",this},$.fn.hover=function(callback){var _time,_this=this,_over=!1;function hover(e){if(!_this.div)return!1;var time=performance.now(),original=e.toElement||e.relatedTarget;if(_time&&time-_time<5)return _time=time,!1;switch(_time=time,e.object="hit"==_this.div.className?_this.parent():_this,e.type){case"mouseout":case"mouseleave":e.action="out";break;default:e.action="over"}if(_over){if(Mouse._preventClicks)return!1;if("over"==e.action)return!1;if("out"==e.action&&isAChild(_this.div,original))return!1;_over=!1}else{if("out"==e.action)return!1;_over=!0}callback&&callback(e)}function isAChild(div,object){for(var len=div.children.length-1,i=len;i>-1;i--)if(object==div.children[i])return!0;for(i=len;i>-1;i--)if(isAChild(div.children[i],object))return!0}return this.div.addEventListener(translateEvent("mouseover"),hover,!0),this.div.addEventListener(translateEvent("mouseout"),hover,!0),this},$.fn.press=function(callback){var _this=this;function press(e){if(!_this.div)return!1;switch(e.object="hit"==_this.div.className?_this.parent():_this,e.type){case"mousedown":e.action="down";break;default:e.action="up"}callback&&callback(e)}return this.div.addEventListener(translateEvent("mousedown"),press,!0),this.div.addEventListener(translateEvent("mouseup"),press,!0),this},$.fn.bind=function(evt,callback){if(this._events=this._events||{},windowsPointer&&this==__window)return Stage.bind(evt,callback);"touchstart"==evt?Device.mobile||(Device.touchCapable?this.bind("mousedown",callback):evt="mousedown"):"touchmove"==evt?(Device.mobile||(Device.touchCapable?this.bind("mousemove",callback):evt="mousemove"),windowsPointer&&!this.div.msGesture&&(this.div.msGesture=new MSGesture,this.div.msGesture.target=this.div)):"touchend"==evt&&(Device.mobile||(Device.touchCapable?this.bind("mouseup",callback):evt="mouseup")),this._events["bind_"+evt]=this._events["bind_"+evt]||[];var _events=this._events["bind_"+evt],e={},target=this.div;function touchEvent(e){windowsPointer&&target.msGesture&&"touchstart"==evt&&target.msGesture.addPointer(e.pointerId),Device.mobile||"touchstart"!=evt||e.preventDefault();var touch=convertTouchEvent(e);if(windowsPointer){var windowsEvt=e;(e={}).preventDefault=()=>windowsEvt.preventDefault(),e.stopPropagation=()=>windowsEvt.stopPropagation(),e.x=Number(windowsEvt.clientX),e.y=Number(windowsEvt.clientY),e.target=windowsEvt.target,e.currentTarget=windowsEvt.currentTarget,e.path=[];for(var node=e.target;node;)e.path.push(node),node=node.parentElement||null;e.windowsPointer=!0}else e.x=touch.x,e.y=touch.y;for(var i=0;i<_events.length;i++){var ev=_events[i];ev.target==e.currentTarget&&ev.callback(e)}}return e.callback=callback,e.target=this.div,_events.push(e),this._events["fn_"+evt]||(this._events["fn_"+evt]=touchEvent,this.div.addEventListener(translateEvent(evt),touchEvent,{capture:!0,passive:!1})),this},$.fn.unbind=function(evt,callback){if(this._events=this._events||{},windowsPointer&&this==__window)return Stage.unbind(evt,callback);"touchstart"==evt?Device.mobile||(Device.touchCapable?this.unbind("mousedown",callback):evt="mousedown"):"touchmove"==evt?Device.mobile||(Device.touchCapable?this.unbind("mousemove",callback):evt="mousemove"):"touchend"==evt&&(Device.mobile||(Device.touchCapable?this.unbind("mouseup",callback):evt="mouseup"));var _events=this._events["bind_"+evt];if(!_events)return this;for(var i=0;i<_events.length;i++){_events[i].callback==callback&&_events.splice(i,1)}return this._events["fn_"+evt]&&!_events.length&&(this.div.removeEventListener(translateEvent(evt),this._events["fn_"+evt],!Device.mobile||{passive:!0}),this._events["fn_"+evt]=null),this},$.fn.interact=function(overCallback,clickCallback,seoLink,seoText,zIndex,options){if(!this.hit){"object"==typeof arguments[arguments.length-1]&&(options=arguments[arguments.length-1],[overCallback,clickCallback,seoLink,seoText,zIndex]=Array.prototype.slice.call(arguments,0,-1),options.overCallback&&(overCallback=options.overCallback),options.clickCallback&&(clickCallback=options.clickCallback),options.seoLink&&(seoLink=options.seoLink),options.seoText&&(seoText=options.seoText),options.zIndex&&(zIndex=options.zIndex)),options||(options={}),this.hit=$(".hit",seoLink?"a":void 0),this.hit.css({width:"100%",height:"100%",zIndex:zIndex||99999,top:0,left:0,position:"absolute"}),this.add(this.hit);var _this=this;seoLink&&(this.hit.attr("href","#"===seoLink?seoLink:Hydra.absolutePath(seoLink)),this.hit.text(seoText||this.div.textContent),this.hit.css({fontSize:0}),this.hit.accessible(),"function"==typeof overCallback&&(this.hit.div.onfocus=_=>overCallback({action:"over",object:this}),this.hit.div.onblur=_=>overCallback({action:"out",object:this})),this.hit.div.onclick=e=>{e.preventDefault(),e.object=_this,e.action="click",clicked(e)}),options.role&&(this.hit.attr("role",options.role),"button"===options.role&&(this.hit.div.onkeydown=e=>{switch(e.key){case" ":case"Spacebar":e.preventDefault(),e.stopPropagation(),e.object=_this,e.action="click",clicked(e)}}))}let time=Render.TIME;function clicked(e){clickCallback&&Render.TIME-time>250&&clickCallback(e),time=Render.TIME}Device.mobile?this.hit.touchClick(overCallback,clicked).click(clicked):this.hit.hover(overCallback).click(clicked)},$.fn.clearInteract=function(){this.hit&&(this.hit=this.hit.destroy())},$.fn.disableInteract=function(){this.hit&&this.hit.css({pointerEvents:"none"})},$.fn.enableInteract=function(){this.hit&&this.hit.css({pointerEvents:"auto"})},$.fn.touchSwipe=function(callback,distance){if(!window.addEventListener)return this;var _startX,_startY,_this=this,_distance=distance||75,_moving=!1,_move={};function touchMove(e){if(!_this.div)return!1;if(_moving){var touch=convertTouchEvent(e),dx=_startX-touch.x,dy=_startY-touch.y;_move.direction=null,_move.moving=null,_move.x=null,_move.y=null,_move.evt=e,Math.abs(dx)>=_distance?(touchEnd(),_move.direction=dx>0?"left":"right"):Math.abs(dy)>=_distance?(touchEnd(),_move.direction=dy>0?"up":"down"):(_move.moving=!0,_move.x=dx,_move.y=dy),callback&&callback(_move,e)}}function touchEnd(e){if(!_this.div)return!1;_startX=_startY=_moving=!1,_this.div.removeEventListener(translateEvent("touchmove"),touchMove)}return Device.mobile&&(this.div.addEventListener(translateEvent("touchstart"),(function touchStart(e){var touch=convertTouchEvent(e);if(!_this.div)return!1;1==e.touches.length&&(_startX=touch.x,_startY=touch.y,_moving=!0,_this.div.addEventListener(translateEvent("touchmove"),touchMove,{passive:!0}))}),{passive:!0}),this.div.addEventListener(translateEvent("touchend"),touchEnd,{passive:!0}),this.div.addEventListener(translateEvent("touchcancel"),touchEnd,{passive:!0})),this},$.fn.touchClick=function(hover,click){if(!window.addEventListener)return this;var _time,_move,_this=this,_start={},_touch={};function setTouch(e){var touch=convertTouchEvent(e);e.touchX=touch.x,e.touchY=touch.y,_start.x=e.touchX,_start.y=e.touchY}return Device.mobile&&(this.div.addEventListener(translateEvent("touchstart"),(function touchStart(e){if(!_this.div)return!1;_time=performance.now(),e.action="over",e.object="hit"==_this.div.className?_this.parent():_this,setTouch(e),hover&&!_move&&hover(e)}),{passive:!0}),this.div.addEventListener(translateEvent("touchend"),(function touchEnd(e){if(!_this.div)return!1;var time=performance.now();if(_touch=convertTouchEvent(e),_move=function findDistance(p1,p2){var dx=p2.x-p1.x,dy=p2.y-p1.y;return Math.sqrt(dx*dx+dy*dy)}(_start,_touch)>25,e.object="hit"==_this.div.className?_this.parent():_this,setTouch(e),_time&&time-_time<750){if(Mouse._preventClicks)return!1;click&&!_move&&(!0,e.action="click",click&&!_move&&click(e),Mouse.autoPreventClicks&&Mouse.preventClicks())}hover&&(e.action="out",Mouse._preventFire||hover(e));_move=!1}),{passive:!0})),this}}(),Class((function Element(type="div"){Inherit(this,Component);var name=Utils.getConstructorName(this);this.__element=!0,this.element=$("."+name,type),this.element.__useFragment=!0,this.destroy=function(){this.element&&this.element.remove&&(this.element=this.element.remove()),this._destroy&&this._destroy()},this.querySelector=async function(selector){if(await defer(),Array.isArray(selector)){let values=[];return selector.forEach((s=>{values.push($(this.element.div.querySelector(s)))})),values}return $(this.element.div.querySelector(selector))},this.querySelectorAll=async function(selector){await defer();let list=this.element.div.querySelectorAll(selector),values=[];for(let i=0;i<list.length;i++)values.push($(list[i]));return values}})),(()=>{var Wi=Object.create,Je=Object.defineProperty,Ui=Object.defineProperties,Ki=Object.getOwnPropertyDescriptor,Gi=Object.getOwnPropertyDescriptors,Hi=Object.getOwnPropertyNames,it=Object.getOwnPropertySymbols,Ji=Object.getPrototypeOf,dr=Object.prototype.hasOwnProperty,_o=Object.prototype.propertyIsEnumerable,mr=(e,t,r)=>t in e?Je(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,v=(e,t)=>{for(var r in t||(t={}))dr.call(t,r)&&mr(e,r,t[r]);if(it)for(var r of it(t))_o.call(t,r)&&mr(e,r,t[r]);return e},w=(e,t)=>Ui(e,Gi(t)),jo=e=>Je(e,"__esModule",{value:!0}),st=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports),hr=(e,t)=>{for(var r in jo(e),t)Je(e,r,{get:t[r],enumerable:!0})},pt=e=>((e,t,r)=>{if(t&&"object"==typeof t||"function"==typeof t)for(let o of Hi(t))!dr.call(e,o)&&"default"!==o&&Je(e,o,{get:()=>t[o],enumerable:!(r=Ki(t,o))||r.enumerable});return e})(jo(Je(null!=e?Wi(Ji(e)):{},"default",e&&e.__esModule&&"default"in e?{get:()=>e.default,enumerable:!0}:{value:e,enumerable:!0})),e),f=(e,t,r)=>(mr(e,"symbol"!=typeof t?t+"":t,r),r),wn=st(((qg,An)=>{An.exports=function(){function e(t,r,o,n){this.set(t,r,o,n)}return e.prototype.set=function(t,r,o,n){this._cx=3*t,this._bx=3*(o-t)-this._cx,this._ax=1-this._cx-this._bx,this._cy=3*r,this._by=3*(n-r)-this._cy,this._ay=1-this._cy-this._by},e.epsilon=1e-6,e.prototype._sampleCurveX=function(t){return((this._ax*t+this._bx)*t+this._cx)*t},e.prototype._sampleCurveY=function(t){return((this._ay*t+this._by)*t+this._cy)*t},e.prototype._sampleCurveDerivativeX=function(t){return(3*this._ax*t+2*this._bx)*t+this._cx},e.prototype._solveCurveX=function(t,r){var o,n,a,i,s,u;for(a=void 0,i=void 0,s=void 0,u=void 0,o=void 0,n=void 0,s=t,n=0;n<8;){if(u=this._sampleCurveX(s)-t,Math.abs(u)<r)return s;if(o=this._sampleCurveDerivativeX(s),Math.abs(o)<r)break;s-=u/o,n++}if((s=t)<(a=0))return a;if(s>(i=1))return i;for(;a<i;){if(u=this._sampleCurveX(s),Math.abs(u-t)<r)return s;t>u?a=s:i=s,s=.5*(i-a)+a}return s},e.prototype.solve=function(t,r){return this._sampleCurveY(this._solveCurveX(t,r))},e.prototype.solveSimple=function(t){return this._sampleCurveY(this._solveCurveX(t,1e-6))},e}()})),Nn=st(((Tb,En)=>{var kt,Mr;kt=[],Mr=[],En.exports=function hu(e,t,r){var o,n,a,i,s,u,p,l;if(e===t)return 0;if(o=e.length,n=t.length,0===o)return n;if(0===n)return o;for(r&&(e=e.toLowerCase(),t=t.toLowerCase()),p=0;p<o;)Mr[p]=e.charCodeAt(p),kt[p]=++p;for(l=0;l<n;)for(a=t.charCodeAt(l),i=s=l++,p=-1;++p<o;)u=a===Mr[p]?s:s+1,s=kt[p],kt[p]=i=s>i?u>i?i+1:u:u>s?s+1:u;return i}})),Rn=st(((Ib,Fn)=>{var $n=Nn();Fn.exports=function yu(){var e,t,r,o,n,a=0,i=arguments[0],s=arguments[1],u=s.length,p=arguments[2];p&&(o=p.threshold,n=p.ignoreCase),void 0===o&&(o=0);for(var l=0;l<u;++l)(e=(t=n?$n(i,s[l],!0):$n(i,s[l]))>i.length?1-t/s[l].length:1-t/i.length)>a&&(a=e,r=s[l]);return a>=o?r:null}})),eo=st(((RP,Ai)=>{"use strict";Ai.exports=function e(t,r){if(t===r)return!0;if(t&&r&&"object"==typeof t&&"object"==typeof r){if(t.constructor!==r.constructor)return!1;var o,n,a;if(Array.isArray(t)){if((o=t.length)!=r.length)return!1;for(n=o;0!=n--;)if(!e(t[n],r[n]))return!1;return!0}if(t.constructor===RegExp)return t.source===r.source&&t.flags===r.flags;if(t.valueOf!==Object.prototype.valueOf)return t.valueOf()===r.valueOf();if(t.toString!==Object.prototype.toString)return t.toString()===r.toString();if((o=(a=Object.keys(t)).length)!==Object.keys(r).length)return!1;for(n=o;0!=n--;)if(!Object.prototype.hasOwnProperty.call(r,a[n]))return!1;for(n=o;0!=n--;){var i=a[n];if(!e(t[i],r[i]))return!1}return!0}return t!=t&&r!=r}})),vo={};hr(vo,{disableDefaultTicker:()=>kr,enableDefaultTicker:()=>Dr,getProject:()=>Bi,onChange:()=>qi,ticker:()=>L,types:()=>Qt,val:()=>zi});var bo={};hr(bo,{disableDefaultTicker:()=>kr,enableDefaultTicker:()=>Dr,getProject:()=>Bi,onChange:()=>qi,ticker:()=>L,types:()=>Qt,val:()=>zi});var A=Array.isArray,ut="object"==typeof window&&window&&window.Object===Object&&window,Qi="object"==typeof self&&self&&self.Object===Object&&self,I=ut||Qi||Function("return this")(),$=I.Symbol,Po=Object.prototype,rs=Po.hasOwnProperty,os=Po.toString,Ye=$?$.toStringTag:void 0;var So=function ns(e){var t=rs.call(e,Ye),r=e[Ye];try{e[Ye]=void 0;var o=!0}catch(a){}var n=os.call(e);return o&&(t?e[Ye]=r:delete e[Ye]),n},is=Object.prototype.toString;var To=function ss(e){return is.call(e)},Io=$?$.toStringTag:void 0;var V=function ls(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":Io&&Io in Object(e)?So(e):To(e)};var M=function fs(e){return null!=e&&"object"==typeof e};var ee=function ds(e){return"symbol"==typeof e||M(e)&&"[object Symbol]"==V(e)},ms=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,hs=/^\w*$/;var Pe=function ys(e,t){if(A(e))return!1;var r=typeof e;return!("number"!=r&&"symbol"!=r&&"boolean"!=r&&null!=e&&!ee(e))||(hs.test(e)||!ms.test(e)||null!=t&&e in Object(t))};var F=function gs(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)};var e,lt=function xs(e){if(!F(e))return!1;var t=V(e);return"[object Function]"==t||"[object GeneratorFunction]"==t||"[object AsyncFunction]"==t||"[object Proxy]"==t},ft=I["__core-js_shared__"],Ao=(e=/[^.]+$/.exec(ft&&ft.keys&&ft.keys.IE_PROTO||""))?"Symbol(src)_1."+e:"";var wo=function Ss(e){return!!Ao&&Ao in e},Is=Function.prototype.toString;var H=function As(e){if(null!=e){try{return Is.call(e)}catch(t){}try{return e+""}catch(t){}}return""},Os=/^\[object .+?Constructor\]$/,Cs=Function.prototype,Ds=Object.prototype,ks=Cs.toString,Vs=Ds.hasOwnProperty,Ms=RegExp("^"+ks.call(Vs).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");var Oo=function Es(e){return!(!F(e)||wo(e))&&(lt(e)?Ms:Os).test(H(e))};var Co=function Ns(e,t){return null==e?void 0:e[t]};var C=function $s(e,t){var r=Co(e,t);return Oo(r)?r:void 0},J=C(Object,"create");var Do=function Rs(){this.__data__=J?J(null):{},this.size=0};var ko=function Bs(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t},Ls=Object.prototype.hasOwnProperty;var Vo=function Ws(e){var t=this.__data__;if(J){var r=t[e];return"__lodash_hash_undefined__"===r?void 0:r}return Ls.call(t,e)?t[e]:void 0},Ks=Object.prototype.hasOwnProperty;var Mo=function Gs(e){var t=this.__data__;return J?void 0!==t[e]:Ks.call(t,e)};var Eo=function Js(e,t){var r=this.__data__;return this.size+=this.has(e)?0:1,r[e]=J&&void 0===t?"__lodash_hash_undefined__":t,this};function Se(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var o=e[t];this.set(o[0],o[1])}}Se.prototype.clear=Do,Se.prototype.delete=ko,Se.prototype.get=Vo,Se.prototype.has=Mo,Se.prototype.set=Eo;var yr=Se;var No=function Ys(){this.__data__=[],this.size=0};var Te=function Xs(e,t){return e===t||e!=e&&t!=t};var te=function Zs(e,t){for(var r=e.length;r--;)if(Te(e[r][0],t))return r;return-1},ep=Array.prototype.splice;var $o=function tp(e){var t=this.__data__,r=te(t,e);return!(r<0)&&(r==t.length-1?t.pop():ep.call(t,r,1),--this.size,!0)};var Fo=function rp(e){var t=this.__data__,r=te(t,e);return r<0?void 0:t[r][1]};var Ro=function op(e){return te(this.__data__,e)>-1};var Bo=function np(e,t){var r=this.__data__,o=te(r,e);return o<0?(++this.size,r.push([e,t])):r[o][1]=t,this};function Ie(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var o=e[t];this.set(o[0],o[1])}}Ie.prototype.clear=No,Ie.prototype.delete=$o,Ie.prototype.get=Fo,Ie.prototype.has=Ro,Ie.prototype.set=Bo;var re=Ie,oe=C(I,"Map");var qo=function ip(){this.size=0,this.__data__={hash:new yr,map:new(oe||re),string:new yr}};var zo=function sp(e){var t=typeof e;return"string"==t||"number"==t||"symbol"==t||"boolean"==t?"__proto__"!==e:null===e};var ne=function pp(e,t){var r=e.__data__;return zo(t)?r["string"==typeof t?"string":"hash"]:r.map};var Lo=function up(e){var t=ne(this,e).delete(e);return this.size-=t?1:0,t};var Wo=function lp(e){return ne(this,e).get(e)};var Uo=function fp(e){return ne(this,e).has(e)};var Ko=function cp(e,t){var r=ne(this,e),o=r.size;return r.set(e,t),this.size+=r.size==o?0:1,this};function Ae(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var o=e[t];this.set(o[0],o[1])}}Ae.prototype.clear=qo,Ae.prototype.delete=Lo,Ae.prototype.get=Wo,Ae.prototype.has=Uo,Ae.prototype.set=Ko;var fe=Ae;function gr(e,t){if("function"!=typeof e||null!=t&&"function"!=typeof t)throw new TypeError("Expected a function");var r=function(){var o=arguments,n=t?t.apply(this,o):o[0],a=r.cache;if(a.has(n))return a.get(n);var i=e.apply(this,o);return r.cache=a.set(n,i)||a,i};return r.cache=new(gr.Cache||fe),r}gr.Cache=fe;var Go=gr;var yp=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,gp=/\\(\\)?/g,Jo=function hp(e){var t=Go(e,(function(o){return 500===r.size&&r.clear(),o})),r=t.cache;return t}((function(e){var t=[];return 46===e.charCodeAt(0)&&t.push(""),e.replace(yp,(function(r,o,n,a){t.push(n?a.replace(gp,"$1"):o||r)})),t}));var Yo=function vp(e,t){for(var r=-1,o=null==e?0:e.length,n=Array(o);++r<o;)n[r]=t(e[r],r,e);return n},Xo=$?$.prototype:void 0,Zo=Xo?Xo.toString:void 0;var ct=function Qo(e){if("string"==typeof e)return e;if(A(e))return Yo(e,Qo)+"";if(ee(e))return Zo?Zo.call(e):"";var t=e+"";return"0"==t&&1/e==-Infinity?"-0":t};var dt=function jp(e){return null==e?"":ct(e)};var we=function xp(e,t){return A(e)?e:Pe(e,t)?[e]:Jo(dt(e))};var W=function Sp(e){if("string"==typeof e||ee(e))return e;var t=e+"";return"0"==t&&1/e==-Infinity?"-0":t};var mt=function Tp(e,t){for(var r=0,o=(t=we(t,e)).length;null!=e&&r<o;)e=e[W(t[r++])];return r&&r==o?e:void 0};var Oe=function Ip(e,t,r){var o=null==e?void 0:mt(e,t);return void 0===o?r:o};var ht=function Ap(e,t){return function(r){return e(t(r))}},en=ht(Object.getPrototypeOf,Object),Cp=Function.prototype,Dp=Object.prototype,tn=Cp.toString,kp=Dp.hasOwnProperty,Vp=tn.call(Object);var Xe=function Mp(e){if(!M(e)||"[object Object]"!=V(e))return!1;var t=en(e);if(null===t)return!0;var r=kp.call(t,"constructor")&&t.constructor;return"function"==typeof r&&r instanceof r&&tn.call(r)==Vp};var O,o,rn=function Ep(e){var t=null==e?0:e.length;return t?e[t-1]:void 0},ae=class{constructor(){this._lastTapperId=0,this._tappers=new Map,this.tappable=new class{constructor(t){this._untapFromSourceTimeout=null,this._cb=t=>{this._tappers.forEach((r=>{r(t)}))},this._lastTapperId=0,this._untapFromSource=null,this._props=t,this._tappers=new Map}_check(){this._untapFromSource?0===this._tappers.size&&this._scheduleToUntapFromSource():0!==this._tappers.size&&(this._untapFromSource=this._props.tapToSource(this._cb))}_scheduleToUntapFromSource(){null===this._untapFromSourceTimeout&&(this._untapFromSourceTimeout=setTimeout((()=>{this._untapFromSourceTimeout=null,0===this._tappers.size&&(this._untapFromSource(),this._untapFromSource=null)}),0))}tap(t){let r=this._lastTapperId++;return this._tappers.set(r,t),this._check(),()=>{this._removeTapperById(r)}}_removeTapperById(t){this._tappers.delete(t),this._check()}}({tapToSource:t=>this._tap(t)})}_tap(t){let r=this._lastTapperId++;return this._tappers.set(r,t),this._onNumberOfTappersChangeListener&&this._onNumberOfTappersChangeListener(this._tappers.size),()=>{this._removeTapperById(r)}}_removeTapperById(t){let r=this._tappers.size;this._tappers.delete(t),r!==this._tappers.size&&this._onNumberOfTappersChangeListener&&this._onNumberOfTappersChangeListener(this._tappers.size)}emit(t){this._tappers.forEach((r=>{r(t)}))}hasTappers(){return 0!==this._tappers.size}onNumberOfTappersChange(t){this._onNumberOfTappersChangeListener=t}};function U(e){return e&&e.isDerivation&&!0===e.isDerivation}(o=O||(O={}))[o.none=0]="none",o[o.dep=1]="dep",o[o.inner=2]="inner";var br,Np=()=>{class e extends E{constructor(r,o){return super(),this._depDerivation=r,this._fn=o,this._innerDerivation=void 0,this._staleDependency=1,this._addDependency(r),this}_recalculateHot(){let r=this._staleDependency;if(this._staleDependency=0,2===r)return this._innerDerivation.getValue();let o=this._fn(this._depDerivation.getValue());return U(o)?(this._innerDerivation=o,this._addDependency(o),o.getValue()):o}_recalculateCold(){let r=this._fn(this._depDerivation.getValue());return U(r)?r.getValue():r}_recalculate(){return this.isHot?this._recalculateHot():this._recalculateCold()}_reactToDependencyBecomingStale(r){let o=r===this._depDerivation?1:2;if(2===o&&r!==this._innerDerivation)throw Error("got a _reactToDependencyBecomingStale() from neither the dep nor the inner derivation");0===this._staleDependency?(this._staleDependency=o,1===o&&this._removeInnerDerivation()):1===this._staleDependency||1===o&&(this._staleDependency=1,this._removeInnerDerivation())}_removeInnerDerivation(){this._innerDerivation&&(this._removeDependency(this._innerDerivation),this._innerDerivation=void 0)}_keepHot(){this._staleDependency=1,this.getValue()}_becomeCold(){this._staleDependency=1,this._removeInnerDerivation()}}return e.displayName="flatMap",e};var _r,$p=()=>class extends E{constructor(t,r){super(),this._dep=t,this._fn=r,this._addDependency(t)}_recalculate(){return this._fn(this._dep.getValue())}_reactToDependencyBecomingStale(){}};var Ce=class{constructor(){this._head=void 0}peek(){return this._head&&this._head.data}pop(){let t=this._head;if(t)return this._head=t.next,t.data}push(t){let r={next:this._head,data:t};this._head=r}};function on(){let t=new Ce,r=()=>{};return{type:"Dataverse_discoveryMechanism",startIgnoringDependencies:()=>{t.push(r)},stopIgnoringDependencies:()=>{t.peek()!==r||t.pop()},reportResolutionStart:p=>{let l=t.peek();l&&l(p),t.push(r)},reportResolutionEnd:p=>{t.pop()},pushCollector:p=>{t.push(p)},popCollector:p=>{if(t.peek()!==p)throw new Error("Popped collector is not on top of the stack");t.pop()}}}var{startIgnoringDependencies:De,stopIgnoringDependencies:ke,reportResolutionEnd:nn,reportResolutionStart:an,pushCollector:sn,popCollector:pn}=function Fp(){let e="__dataverse_discoveryMechanism_sharedStack";if(window){let t=window[e];if(t&&"object"==typeof t&&"Dataverse_discoveryMechanism"===t.type)return t;{let r=on();return window[e]=r,r}}return on()}(),E=class{constructor(){this.isDerivation=!0,this._didMarkDependentsAsStale=!1,this._isHot=!1,this._isFresh=!1,this._lastValue=void 0,this._dependents=new Set,this._dependencies=new Set,this._internal_markAsStale=t=>{this._reactToDependencyBecomingStale(t),!this._didMarkDependentsAsStale&&(this._didMarkDependentsAsStale=!0,this._isFresh=!1,this._dependents.forEach((r=>{r(this)})))}}get isHot(){return this._isHot}_addDependency(t){this._dependencies.has(t)||(this._dependencies.add(t),this._isHot&&t.addDependent(this._internal_markAsStale))}_removeDependency(t){!this._dependencies.has(t)||(this._dependencies.delete(t),this._isHot&&t.removeDependent(this._internal_markAsStale))}changes(t){return new class{constructor(t,r){return this._possiblyMarkAsStale=()=>{this._ticker.onThisOrNextTick(this._refresh)},this._refresh=()=>{let t=this._derivation.getValue();t===this._lastValue&&!0===this._lastValueRecorded||(this._lastValue=t,this._lastValueRecorded=!0,this._emitter.emit(t))},this._derivation=t,this._ticker=r,this._emitter=new ae,this._emitter.onNumberOfTappersChange((()=>{this._reactToNumberOfTappersChange()})),this._hadTappers=!1,this._lastValueRecorded=!1,this._lastValue=void 0,this}_reactToNumberOfTappersChange(){let t=this._emitter.hasTappers();t!==this._hadTappers&&(this._hadTappers=t,t?this._derivation.addDependent(this._possiblyMarkAsStale):this._derivation.removeDependent(this._possiblyMarkAsStale))}tappable(){return this._emitter.tappable}}(this,t).tappable()}changesWithoutValues(){return new class{constructor(t,r=!1){return this.dontEmitValues=r,this._possiblyMarkAsStale=()=>{this._emitter.emit(void 0)},this._derivation=t,this._emitter=new ae,this._emitter.onNumberOfTappersChange((()=>{this._reactToNumberOfTappersChange()})),this._hadTappers=!1,this}_reactToNumberOfTappersChange(){let t=this._emitter.hasTappers();t!==this._hadTappers&&(this._hadTappers=t,t?this._derivation.addDependent(this._possiblyMarkAsStale):this._derivation.removeDependent(this._possiblyMarkAsStale))}tappable(){return this._emitter.tappable}}(this).tappable()}keepHot(){return this.changesWithoutValues().tap((()=>{}))}tapImmediate(t,r){let o=this.changes(t).tap(r);return r(this.getValue()),o}addDependent(t){let r=this._dependents.size>0;this._dependents.add(t),r!==this._dependents.size>0&&this._reactToNumberOfDependentsChange()}removeDependent(t){let r=this._dependents.size>0;this._dependents.delete(t),r!==this._dependents.size>0&&this._reactToNumberOfDependentsChange()}_markAsStale(t){this._internal_markAsStale(t)}getValue(){if(an(this),!this._isFresh){let t=this._recalculate();this._lastValue=t,this._isHot&&(this._isFresh=!0,this._didMarkDependentsAsStale=!1)}return nn(this),this._lastValue}_reactToNumberOfDependentsChange(){let t=this._dependents.size>0;t!==this._isHot&&(this._isHot=t,this._didMarkDependentsAsStale=!1,this._isFresh=!1,t?(this._dependencies.forEach((r=>{r.addDependent(this._internal_markAsStale)})),this._keepHot()):(this._dependencies.forEach((r=>{r.removeDependent(this._internal_markAsStale)})),this._becomeCold()))}_keepHot(){}_becomeCold(){}map(t){return function jr(e,t){return _r||(_r=$p()),new _r(e,t)}(this,t)}flatMap(t){return function vr(e,t){return br||(br=Np()),new br(e,t)}(this,t)}},un=()=>{},ce=class extends E{constructor(t,r){super(),this._tapToSource=t,this._getValueFromSource=r,this._untapFromChanges=un,this._cachedValue=void 0,this._hasCachedValue=!1}_recalculate(){return this.isHot?(this._hasCachedValue||(this._cachedValue=this._getValueFromSource(),this._hasCachedValue=!0),this._cachedValue):this._getValueFromSource()}_keepHot(){this._hasCachedValue=!1,this._cachedValue=void 0,this._untapFromChanges=this._tapToSource((t=>{this._hasCachedValue=!0,this._cachedValue=t,this._markAsStale(this)}))}_becomeCold(){this._untapFromChanges(),this._untapFromChanges=un,this._hasCachedValue=!1,this._cachedValue=void 0}_reactToDependencyBecomingStale(){}},xr=new WeakMap,ln=Symbol("pointerMeta"),fn=new WeakMap,Rp={get(e,t){if(t===ln)return xr.get(e);let r=fn.get(e);if(r||(r={},fn.set(e,r)),r[t])return r[t];let o=xr.get(e),n=cn({root:o.root,path:[...o.path,t]});return r[t]=n,n}},vt=e=>e[ln],Ze=e=>{let{root:t,path:r}=vt(e);return{root:t,path:r}};function cn(e){var o;let t={root:e.root,path:null!=(o=e.path)?o:[]},r={};return xr.set(r,t),new Proxy(r,Rp)}var Y=cn,ie=e=>e&&!!vt(e);var se,_t=(e,t,r)=>{if(0===t.length)return r(e);if(Array.isArray(e)){let[o,...n]=t;o=parseInt(String(o),10),isNaN(o)&&(o=0);let a=e[o],i=_t(a,n,r);if(a===i)return e;let s=[...e];return s.splice(o,1,i),s}if("object"==typeof e&&null!==e){let[o,...n]=t,a=e[o],i=_t(a,n,r);return a===i?e:w(v({},e),{[o]:i})}{let[o,...n]=t;return{[o]:_t(void 0,n,r)}}};!function(o){o[o.Dict=0]="Dict",o[o.Array=1]="Array",o[o.Other=2]="Other"}(se||(se={}));var Sr=e=>Array.isArray(e)?1:Xe(e)?0:2,dn=(e,t,r=Sr(e))=>0===r&&"string"==typeof t||1===r&&Bp(t)?e[t]:void 0,Bp=e=>{let t="number"==typeof e?e:parseInt(e,10);return!isNaN(t)&&t>=0&&t<1/0&&(0|t)===t},jt=class{constructor(t,r){this._parent=t,this._path=r,this.children=new Map,this.identityChangeListeners=new Set}addIdentityChangeListener(t){this.identityChangeListeners.add(t)}removeIdentityChangeListener(t){this.identityChangeListeners.delete(t),this._checkForGC()}removeChild(t){this.children.delete(t),this._checkForGC()}getChild(t){return this.children.get(t)}getOrCreateChild(t){let r=this.children.get(t);return r||(r=r=new jt(this,this._path.concat([t])),this.children.set(t,r)),r}_checkForGC(){this.identityChangeListeners.size>0||this.children.size>0||this._parent&&this._parent.removeChild(rn(this._path))}},j=class{constructor(t){this.$$isIdentityDerivationProvider=!0,this.reduceState=(t,r)=>{let o=function Pr(e,t,r){return 0===t.length?r(e):_t(e,t,r)}(this.getState(),t,r);return this.setState(o),o},this._onPathValueChange=(t,r)=>{let o=this._getOrCreateScopeForPath(t);return o.identityChangeListeners.add(r),()=>{o.identityChangeListeners.delete(r)}},this._currentState=t,this._rootScope=new jt(void 0,[]),this.pointer=Y({root:this,path:[]})}setState(t){let r=this._currentState;this._currentState=t,this._checkUpdates(this._rootScope,r,t)}getState(){return this._currentState}getIn(t){return 0===t.length?this.getState():Oe(this.getState(),t)}setIn(t,r){return this.reduceState(t,(()=>r))}_checkUpdates(t,r,o){if(r===o||(t.identityChangeListeners.forEach((i=>i(o))),0===t.children.size))return;let n=Sr(r),a=Sr(o);2===n&&n===a||t.children.forEach(((i,s)=>{let u=dn(r,s,n),p=dn(o,s,a);this._checkUpdates(i,u,p)}))}_getOrCreateScopeForPath(t){let r=this._rootScope;for(let o of t)r=r.getOrCreateChild(o);return r}getIdentityDerivation(t){return new ce((r=>this._onPathValueChange(t,r)),(()=>this.getIn(t)))}},mn=new WeakMap,D=e=>{let t=vt(e),r=mn.get(t);if(!r){let o=t.root;if(!function qp(e){return"object"==typeof e&&null!==e&&!0===e.$$isIdentityDerivationProvider}(o))throw new Error("Cannot run valueDerivation() on a pointer whose root is not an IdentityChangeProvider");let{path:n}=t;r=o.getIdentityDerivation(n),mn.set(t,r)}return r};var g=e=>ie(e)?D(e).getValue():U(e)?e.getValue():e,X=class{constructor(t){this._value=t,this._emitter=new ae,this._publicDerivation=new ce((r=>this._emitter.tappable.tap(r)),this.get.bind(this))}set(t){t!==this._value&&(this._value=t,this._emitter.emit(t))}get(){return this._value}get derivation(){return this._publicDerivation}},K=class extends E{constructor(t){return super(),this._v=t,this}_recalculate(){return this._v}_reactToDependencyBecomingStale(){}},hn=()=>{},yn=class extends E{constructor(t){super(),this._fn=t,this._cacheOfDendencyValues=new Map,this._possiblyStaleDeps=new Set,this._prismScope=new Me}_recalculate(){let t;if(this._possiblyStaleDeps.size>0){let n=!1;De();for(let a of this._possiblyStaleDeps)if(this._cacheOfDendencyValues.get(a)!==a.getValue()){n=!0;break}if(ke(),this._possiblyStaleDeps.clear(),!n)return this._lastValue}let r=new Set;this._cacheOfDendencyValues.clear();let o=n=>{r.add(n),this._addDependency(n)};sn(o),G.push(this._prismScope);try{t=this._fn()}catch(n){console.error(n)}finally{G.pop()!==this._prismScope&&console.warn("The Prism hook stack has slipped. This is a bug.")}return pn(o),this._dependencies.forEach((n=>{r.has(n)||this._removeDependency(n)})),this._dependencies=r,De(),r.forEach((n=>{this._cacheOfDendencyValues.set(n,n.getValue())})),ke(),t}_reactToDependencyBecomingStale(t){this._possiblyStaleDeps.add(t)}_keepHot(){this._prismScope=new Me,De(),this.getValue(),ke()}_becomeCold(){gn(this._prismScope),this._prismScope=new Me}},Me=class{constructor(){this.isPrismScope=!0,this._subs={}}sub(t){return this._subs[t]||(this._subs[t]=new Me),this._subs[t]}get subs(){return this._subs}};function gn(e){for(let[t,r]of Object.entries(e.subs))gn(r);!function zp(e){let t=Pt.get(e);if(t)for(let r of Object.keys(t)){xt(t[r].cleanup,void 0)}Pt.delete(e)}(e)}function xt(e,t){let r=t,o=!1;try{r=e(),o=!0}catch(n){setTimeout((()=>{throw n}))}return{success:o,returnValue:r}}var G=new Ce,bn=new WeakMap,Pt=new WeakMap,vn=new WeakMap;function _n(e,t){return void 0===e||void 0===t||e.length!==t.length||e.some(((r,o)=>r!==t[o]))}function jn(e,t,r){let o=G.peek();if(!o)throw new Error("prism.memo() is called outside of a prism() call.");let n=vn.get(o);n||(n={},vn.set(o,n)),n[e]||(n[e]={cachedValue:null,deps:[{}]});let a=n[e];return _n(a.deps,r)&&(De(),a.cachedValue=xt(t,void 0).returnValue,ke(),a.deps=r),a.cachedValue}var z=e=>new yn(e);z.ref=function Lp(e,t){let r=G.peek();if(!r)throw new Error("prism.ref() is called outside of a prism() call.");let o=bn.get(r);if(o||(o={},bn.set(r,o)),o[e])return o[e];{let n={current:t};return o[e]=n,n}},z.effect=function Wp(e,t,r){let o=G.peek();if(!o)throw new Error("prism.effect() is called outside of a prism() call.");let n=Pt.get(o);n||(n={},Pt.set(o,n)),n[e]||(n[e]={cleanup:hn,deps:[{}]});let a=n[e];_n(a.deps,r)&&(a.cleanup(),De(),a.cleanup=xt(t,hn).returnValue,ke(),a.deps=r)},z.memo=jn,z.ensurePrism=function Kp(){if(!G.peek())throw new Error("The parent function is called outside of a prism() call.")},z.state=function Up(e,t){let{b:r,setValue:o}=z.memo("state/"+e,(()=>{let n=new X(t);return{b:n,setValue:i=>n.set(i)}}),[]);return[r.derivation.getValue(),o]},z.scope=function Gp(e,t){let r=G.peek();if(!r)throw new Error("prism.scope() is called outside of a prism() call.");let o=r.sub(e);G.push(o);let n=xt(t,void 0).returnValue;return G.pop(),n},z.sub=function Hp(e,t,r){return jn(e,(()=>z(t)),r).getValue()},z.inPrism=function Jp(){return!!G.peek()};var y=z;var de=class{constructor(t){this.$$isIdentityDerivationProvider=!0,this._currentPointerBox=new X(t),this.pointer=Y({root:this,path:[]})}setPointer(t){this._currentPointerBox.set(t)}getIdentityDerivation(t){return this._currentPointerBox.derivation.flatMap((r=>{let o=t.reduce(((n,a)=>n[a]),r);return D(o)}))}},Ee=new class{constructor(){f(this,"atom",new j({projects:{}}))}add(t,r){this.atom.reduceState(["projects",t],(()=>r))}get(t){return this.atom.getState().projects[t]}has(t){return!!this.get(t)}},Pn=new WeakMap;function b(e){return Pn.get(e)}function pe(e,t){Pn.set(e,t)}var Tt=[];var ue=class{constructor(){f(this,"_values",{})}get(t,r){if(this.has(t))return this._values[t];{let o=r();return this._values[t]=o,o}}has(t){return this._values.hasOwnProperty(t)}},Ir=function(){try{var e=C(Object,"defineProperty");return e({},"",{}),e}catch(t){}}();var It=function Zp(e,t,r){"__proto__"==t&&Ir?Ir(e,t,{configurable:!0,enumerable:!0,value:r,writable:!0}):e[t]=r},eu=Object.prototype.hasOwnProperty;var Sn=function tu(e,t,r){var o=e[t];(!eu.call(e,t)||!Te(o,r)||void 0===r&&!(t in e))&&It(e,t,r)},ou=/^(?:0|[1-9]\d*)$/;var Ne=function nu(e,t){var r=typeof e;return!!(t=null==t?9007199254740991:t)&&("number"==r||"symbol"!=r&&ou.test(e))&&e>-1&&e%1==0&&e<t};var Tn=function au(e,t,r,o){if(!F(e))return e;for(var n=-1,a=(t=we(t,e)).length,i=a-1,s=e;null!=s&&++n<a;){var u=W(t[n]),p=r;if("__proto__"===u||"constructor"===u||"prototype"===u)return e;if(n!=i){var l=s[u];void 0===(p=o?o(l,u,s):void 0)&&(p=F(l)?l:Ne(t[n+1])?[]:{})}Sn(s,u,p),s=s[u]}return e};var In=function iu(e,t,r){return null==e?e:Tn(e,t,r)},Ar=new WeakMap;function Or(e){if(Ar.has(e))return Ar.get(e);let t="compound"===e.type?function pu(e){let t={};for(let[r,o]of Object.entries(e.props))t[r]=Or(o);return t}(e):"enum"===e.type?function su(e){let t={$case:e.defaultCase};for(let[r,o]of Object.entries(e.cases))t[r]=Or(o);return t}(e):e.default;return Ar.set(e,t),t}var $e={log:console.log,warn:console.warn,error:console.error,trace:console.trace},On=pt(wn());function Cr(e,t){return y((()=>{let r=g(e);return y.memo("driver",(()=>r?"BasicKeyframedTrack"===r.type?function fu(e,t){return y((()=>{let r=y.ref("state",{started:!1}),o=r.current,n=t.getValue();return(!o.started||n<o.validFrom||o.validTo<=n)&&(r.current=o=cu(t,e)),o.der.getValue()}))}(r,t):($e.error("Track type not yet supported."),new K(void 0)):new K(void 0)),[r]).getValue()}))}var Cn=new K(void 0),cu=(e,t)=>{let r=e.getValue();if(0===t.keyframes.length)return{started:!0,validFrom:-1/0,validTo:1/0,der:Cn};let o=0;for(;;){let n=t.keyframes[o];if(!n)return me.error;let a=o===t.keyframes.length-1;if(r<n.position)return 0===o?me.beforeFirstKeyframe(n):me.error;if(n.position===r)return a?me.lastKeyframe(n):me.between(n,t.keyframes[o+1],e);if(o===t.keyframes.length-1)return me.lastKeyframe(n);{let i=o+1;if(t.keyframes[i].position<=r){o=i;continue}return me.between(n,t.keyframes[o+1],e)}}},me={beforeFirstKeyframe:e=>({started:!0,validFrom:-1/0,validTo:e.position,der:new K({left:e.value,progression:0})}),lastKeyframe:e=>({started:!0,validFrom:e.position,validTo:1/0,der:new K({left:e.value,progression:0})}),between(e,t,r){if(!e.connectedRight)return{started:!0,validFrom:e.position,validTo:t.position,der:new K({left:e.value,progression:0})};let o=new On.default(e.handles[2],e.handles[3],t.handles[0],t.handles[1]),a=y((()=>{let i=(i=>(i-e.position)/(t.position-e.position))(r.getValue()),s=o.solveSimple(i);return{left:e.value,right:t.value,progression:s}}));return{started:!0,validFrom:e.position,validTo:t.position,der:a}},error:{started:!0,validFrom:-1/0,validTo:1/0,der:Cn}};function Fe(e,t,r){let n=r.get(e);if(n&&n.override===t)return n.merged;let a=v({},e);for(let i of Object.keys(t)){let s=t[i],u=e[i];a[i]="object"==typeof s&&"object"==typeof u?Fe(u,s,r):void 0===s?u:s}return r.set(e,{override:t,merged:a}),a}function At(e,t){let r=e;for(let o of t)r=r[o];return r}var{ticker:du,enableDefaultTicker:Dr,disableDefaultTicker:kr}=function St(){let e=new class{constructor(){this._ticking=!1,this._scheduledForThisOrNextTick=new Set,this._scheduledForNextTick=new Set,this._timeAtCurrentTick=0}onThisOrNextTick(t){this._scheduledForThisOrNextTick.add(t)}onNextTick(t){this._scheduledForNextTick.add(t)}offThisOrNextTick(t){this._scheduledForThisOrNextTick.delete(t)}offNextTick(t){this._scheduledForNextTick.delete(t)}get time(){return this._ticking?this._timeAtCurrentTick:performance.now()}tick(t=performance.now()){this._ticking=!0,this._timeAtCurrentTick=t,this._scheduledForNextTick.forEach((r=>this._scheduledForThisOrNextTick.add(r))),this._scheduledForNextTick.clear(),this._tick(0),this._ticking=!1}_tick(t){let r=this.time;if(t>10&&console.warn("_tick() recursing for 10 times"),t>100)throw new Error("Maximum recursion limit for _tick()");let o=this._scheduledForThisOrNextTick;if(this._scheduledForThisOrNextTick=new Set,o.forEach((n=>{n(r)})),this._scheduledForThisOrNextTick.size>0)return this._tick(t+1)}},t=!0,r=null;function a(){t&&!r&&(r=window.requestAnimationFrame(i))}function i(s){r=null,e.tick(s),a()}return a(),{ticker:e,enableDefaultTicker:function o(){t||(t=!0,a())},disableDefaultTicker:function n(){t=!1,r&&(window.cancelAnimationFrame(r),r=null)}}}(),L=du;function Ot(e){return"compound"===e.type||"enum"===e.type}function Qe(e,t){if(!e)return;let[r,...o]=t;return void 0===r?e:Ot(e)?Qe("enum"===e.type?e.cases[r]:e.props[r],o):void 0}var kn=new WeakMap;function Vn(e,t,r){for(let[o,n]of Object.entries(t.props))if(!Ot(n)){let a=[...e,o];r.set(JSON.stringify(a),r.size),Mn(a,n,r)}for(let[o,n]of Object.entries(t.props))if(Ot(n)){let a=[...e,o];r.set(JSON.stringify(a),r.size),Mn(a,n,r)}}function Mn(e,t,r){if("compound"===t.type)Vn(e,t,r);else{if("enum"===t.type)throw new Error("Enums aren't supported yet");r.set(JSON.stringify(e),r.size)}}function mu(e){try{return JSON.parse(e)}catch(t){return void $e.warn(`property ${JSON.stringify(e)} cannot be parsed. Skipping.`)}}pt(Rn());var Bn=class extends Error{},R=class extends Bn{},bu=/\s/;var qn=function vu(e){for(var t=e.length;t--&&bu.test(e.charAt(t)););return t},_u=/^\s+/;var zn=function ju(e){return e&&e.slice(0,qn(e)+1).replace(_u,"")},xu=/^[-+]0x[0-9a-f]+$/i,Pu=/^0b[01]+$/i,Su=/^0o[0-7]+$/i,Tu=parseInt;var Wn=function Iu(e){if("number"==typeof e)return e;if(ee(e))return NaN;if(F(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=F(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=zn(e);var r=Pu.test(e);return r||Su.test(e)?Tu(e.slice(2),r?2:8):xu.test(e)?NaN:+e};var Kn=function wu(e){return e?Infinity===(e=Wn(e))||-Infinity===e?17976931348623157e292*(e<0?-1:1):e==e?e:0:0===e?e:0};var Gn=function Ou(e){var t=Kn(e),r=t%1;return t==t?r?t-r:t:0};var Hn=function Cu(e){return e},Vt=C(I,"WeakMap");var Re=function Vu(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=9007199254740991};var Jn=function Mu(e){return null!=e&&Re(e.length)&&!lt(e)},Eu=Object.prototype;var Yn=function Nu(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||Eu)};var Xn=function $u(e,t){for(var r=-1,o=Array(e);++r<e;)o[r]=t(r);return o};var Er=function Ru(e){return M(e)&&"[object Arguments]"==V(e)},Zn=Object.prototype,Bu=Zn.hasOwnProperty,qu=Zn.propertyIsEnumerable,Mt=Er(function(){return arguments}())?Er:function(e){return M(e)&&Bu.call(e,"callee")&&!qu.call(e,"callee")};var Qn=function Lu(){return!1},ea="object"==typeof exports&&exports&&!exports.nodeType&&exports,ta=ea&&"object"==typeof module&&module&&!module.nodeType&&module,ra=ta&&ta.exports===ea?I.Buffer:void 0,et=(ra?ra.isBuffer:void 0)||Qn,_={};_["[object Float32Array]"]=_["[object Float64Array]"]=_["[object Int8Array]"]=_["[object Int16Array]"]=_["[object Int32Array]"]=_["[object Uint8Array]"]=_["[object Uint8ClampedArray]"]=_["[object Uint16Array]"]=_["[object Uint32Array]"]=!0,_["[object Arguments]"]=_["[object Array]"]=_["[object ArrayBuffer]"]=_["[object Boolean]"]=_["[object DataView]"]=_["[object Date]"]=_["[object Error]"]=_["[object Function]"]=_["[object Map]"]=_["[object Number]"]=_["[object Object]"]=_["[object RegExp]"]=_["[object Set]"]=_["[object String]"]=_["[object WeakMap]"]=!1;var oa=function gl(e){return M(e)&&Re(e.length)&&!!_[V(e)]};var na=function bl(e){return function(t){return e(t)}},aa="object"==typeof exports&&exports&&!exports.nodeType&&exports,tt=aa&&"object"==typeof module&&module&&!module.nodeType&&module,Nr=tt&&tt.exports===aa&&ut.process,_l=function(){try{return tt&&tt.require&&tt.require("util").types||Nr&&Nr.binding&&Nr.binding("util")}catch(t){}}(),ia=_l&&_l.isTypedArray,Et=ia?na(ia):oa,Pl=Object.prototype.hasOwnProperty;var sa=function Sl(e,t){var r=A(e),o=!r&&Mt(e),n=!r&&!o&&et(e),a=!r&&!o&&!n&&Et(e),i=r||o||n||a,s=i?Xn(e.length,String):[],u=s.length;for(var p in e)(t||Pl.call(e,p))&&(!i||!("length"==p||n&&("offset"==p||"parent"==p)||a&&("buffer"==p||"byteLength"==p||"byteOffset"==p)||Ne(p,u)))&&s.push(p);return s},pa=ht(Object.keys,Object),Al=Object.prototype.hasOwnProperty;var ua=function wl(e){if(!Yn(e))return pa(e);var t=[];for(var r in Object(e))Al.call(e,r)&&"constructor"!=r&&t.push(r);return t};var Be=function Ol(e){return Jn(e)?sa(e):ua(e)};var la=function Cl(e,t){for(var r=-1,o=t.length,n=e.length;++r<o;)e[n+r]=t[r];return e};var fa=function Dl(e,t,r){var o=-1,n=e.length;t<0&&(t=-t>n?0:n+t),(r=r>n?n:r)<0&&(r+=n),n=t>r?0:r-t>>>0,t>>>=0;for(var a=Array(n);++o<n;)a[o]=e[o+t];return a};var ca=function kl(e,t,r){var o=e.length;return r=void 0===r?o:r,!t&&r>=o?e:fa(e,t,r)},Bl=RegExp("[\\u200d\\ud800-\\udfff\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff\\ufe0e\\ufe0f]");var qe=function ql(e){return Bl.test(e)};var da=function zl(e){return e.split("")},ma="\\ud800-\\udfff",Hl="["+ma+"]",Fr="[\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff]",Rr="\\ud83c[\\udffb-\\udfff]",ha="[^"+ma+"]",ya="(?:\\ud83c[\\udde6-\\uddff]){2}",ga="[\\ud800-\\udbff][\\udc00-\\udfff]",ba="(?:"+Fr+"|"+Rr+")"+"?",va="[\\ufe0e\\ufe0f]?",Zl=va+ba+("(?:\\u200d(?:"+[ha,ya,ga].join("|")+")"+va+ba+")*"),Ql="(?:"+[ha+Fr+"?",Fr,ya,ga,Hl].join("|")+")",ef=RegExp(Rr+"(?="+Rr+")|"+Ql+Zl,"g");var _a=function tf(e){return e.match(ef)||[]};var ja=function rf(e){return qe(e)?_a(e):da(e)};var xa=function of(){this.__data__=new re,this.size=0};var Pa=function nf(e){var t=this.__data__,r=t.delete(e);return this.size=t.size,r};var Sa=function af(e){return this.__data__.get(e)};var Ta=function sf(e){return this.__data__.has(e)};var Ia=function uf(e,t){var r=this.__data__;if(r instanceof re){var o=r.__data__;if(!oe||o.length<199)return o.push([e,t]),this.size=++r.size,this;r=this.__data__=new fe(o)}return r.set(e,t),this.size=r.size,this};function ze(e){var t=this.__data__=new re(e);this.size=t.size}ze.prototype.clear=xa,ze.prototype.delete=Pa,ze.prototype.get=Sa,ze.prototype.has=Ta,ze.prototype.set=Ia;var Le=ze;var Aa=function lf(e,t){for(var r=-1,o=null==e?0:e.length,n=0,a=[];++r<o;){var i=e[r];t(i,r,e)&&(a[n++]=i)}return a};var wa=function ff(){return[]},df=Object.prototype.propertyIsEnumerable,Oa=Object.getOwnPropertySymbols,Ca=Oa?function(e){return null==e?[]:(e=Object(e),Aa(Oa(e),(function(t){return df.call(e,t)})))}:wa;var Da=function hf(e,t,r){var o=t(e);return A(e)?o:la(o,r(e))};var Br=function yf(e){return Da(e,Be,Ca)},Nt=C(I,"DataView"),$t=C(I,"Promise"),Ft=C(I,"Set"),ka="[object Map]",Va="[object Promise]",Ma="[object Set]",Ea="[object WeakMap]",Na="[object DataView]",jf=H(Nt),xf=H(oe),Pf=H($t),Sf=H(Ft),Tf=H(Vt),he=V;(Nt&&he(new Nt(new ArrayBuffer(1)))!=Na||oe&&he(new oe)!=ka||$t&&he($t.resolve())!=Va||Ft&&he(new Ft)!=Ma||Vt&&he(new Vt)!=Ea)&&(he=function(e){var t=V(e),r="[object Object]"==t?e.constructor:void 0,o=r?H(r):"";if(o)switch(o){case jf:return Na;case xf:return ka;case Pf:return Va;case Sf:return Ma;case Tf:return Ea}return t});var qr=he,zr=I.Uint8Array;var $a=function wf(e){return this.__data__.set(e,"__lodash_hash_undefined__"),this};var Fa=function Of(e){return this.__data__.has(e)};function Rt(e){var t=-1,r=null==e?0:e.length;for(this.__data__=new fe;++t<r;)this.add(e[t])}Rt.prototype.add=Rt.prototype.push=$a,Rt.prototype.has=Fa;var Ra=Rt;var Ba=function Cf(e,t){for(var r=-1,o=null==e?0:e.length;++r<o;)if(t(e[r],r,e))return!0;return!1};var qa=function Df(e,t){return e.has(t)};var Bt=function Mf(e,t,r,o,n,a){var i=1&r,s=e.length,u=t.length;if(s!=u&&!(i&&u>s))return!1;var p=a.get(e),l=a.get(t);if(p&&l)return p==t&&l==e;var c=-1,d=!0,m=2&r?new Ra:void 0;for(a.set(e,t),a.set(t,e);++c<s;){var h=e[c],x=t[c];if(o)var P=i?o(x,h,c,t,e,a):o(h,x,c,e,t,a);if(void 0!==P){if(P)continue;d=!1;break}if(m){if(!Ba(t,(function(S,T){if(!qa(m,T)&&(h===S||n(h,S,r,o,a)))return m.push(T)}))){d=!1;break}}else if(h!==x&&!n(h,x,r,o,a)){d=!1;break}}return a.delete(e),a.delete(t),d};var za=function Ef(e){var t=-1,r=Array(e.size);return e.forEach((function(o,n){r[++t]=[n,o]})),r};var La=function Nf(e){var t=-1,r=Array(e.size);return e.forEach((function(o){r[++t]=o})),r},Wa=$?$.prototype:void 0,Lr=Wa?Wa.valueOf:void 0;var Ua=function Yf(e,t,r,o,n,a,i){switch(r){case"[object DataView]":if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case"[object ArrayBuffer]":return!(e.byteLength!=t.byteLength||!a(new zr(e),new zr(t)));case"[object Boolean]":case"[object Date]":case"[object Number]":return Te(+e,+t);case"[object Error]":return e.name==t.name&&e.message==t.message;case"[object RegExp]":case"[object String]":return e==t+"";case"[object Map]":var s=za;case"[object Set]":var u=1&o;if(s||(s=La),e.size!=t.size&&!u)return!1;var p=i.get(e);if(p)return p==t;o|=2,i.set(e,t);var l=Bt(s(e),s(t),o,n,a,i);return i.delete(e),l;case"[object Symbol]":if(Lr)return Lr.call(e)==Lr.call(t)}return!1},Qf=Object.prototype.hasOwnProperty;var Ka=function ec(e,t,r,o,n,a){var i=1&r,s=Br(e),u=s.length;if(u!=Br(t).length&&!i)return!1;for(var c=u;c--;){var d=s[c];if(!(i?d in t:Qf.call(t,d)))return!1}var m=a.get(e),h=a.get(t);if(m&&h)return m==t&&h==e;var x=!0;a.set(e,t),a.set(t,e);for(var P=i;++c<u;){var S=e[d=s[c]],T=t[d];if(o)var q=i?o(T,S,d,t,e,a):o(S,T,d,e,t,a);if(!(void 0===q?S===T||n(S,T,r,o,a):q)){x=!1;break}P||(P="constructor"==d)}if(x&&!P){var xe=e.constructor,at=t.constructor;xe!=at&&"constructor"in e&&"constructor"in t&&!("function"==typeof xe&&xe instanceof xe&&"function"==typeof at&&at instanceof at)&&(x=!1)}return a.delete(e),a.delete(t),x},Ga="[object Arguments]",Ha="[object Array]",qt="[object Object]",Ja=Object.prototype.hasOwnProperty;var Ya=function oc(e,t,r,o,n,a){var i=A(e),s=A(t),u=i?Ha:qr(e),p=s?Ha:qr(t),l=(u=u==Ga?qt:u)==qt,c=(p=p==Ga?qt:p)==qt,d=u==p;if(d&&et(e)){if(!et(t))return!1;i=!0,l=!1}if(d&&!l)return a||(a=new Le),i||Et(e)?Bt(e,t,r,o,n,a):Ua(e,t,u,r,o,n,a);if(!(1&r)){var m=l&&Ja.call(e,"__wrapped__"),h=c&&Ja.call(t,"__wrapped__");if(m||h){var x=m?e.value():e,P=h?t.value():t;return a||(a=new Le),n(x,P,r,o,a)}}return!!d&&(a||(a=new Le),Ka(e,t,r,o,n,a))};var zt=function Xa(e,t,r,o,n){return e===t||(null==e||null==t||!M(e)&&!M(t)?e!=e&&t!=t:Ya(e,t,r,o,Xa,n))};var Za=function ic(e,t,r,o){var n=r.length,a=n,i=!o;if(null==e)return!a;for(e=Object(e);n--;){var s=r[n];if(i&&s[2]?s[1]!==e[s[0]]:!(s[0]in e))return!1}for(;++n<a;){var u=(s=r[n])[0],p=e[u],l=s[1];if(i&&s[2]){if(void 0===p&&!(u in e))return!1}else{var c=new Le;if(o)var d=o(p,l,u,e,t,c);if(!(void 0===d?zt(l,p,3,o,c):d))return!1}}return!0};var Lt=function sc(e){return e==e&&!F(e)};var Qa=function pc(e){for(var t=Be(e),r=t.length;r--;){var o=t[r],n=e[o];t[r]=[o,n,Lt(n)]}return t};var Wt=function uc(e,t){return function(r){return null!=r&&(r[e]===t&&(void 0!==t||e in Object(r)))}};var ei=function lc(e){var t=Qa(e);return 1==t.length&&t[0][2]?Wt(t[0][0],t[0][1]):function(r){return r===e||Za(r,e,t)}};var ti=function fc(e,t){return null!=e&&t in Object(e)};var ri=function cc(e,t,r){for(var o=-1,n=(t=we(t,e)).length,a=!1;++o<n;){var i=W(t[o]);if(!(a=null!=e&&r(e,i)))break;e=e[i]}return a||++o!=n?a:!!(n=null==e?0:e.length)&&Re(n)&&Ne(i,n)&&(A(e)||Mt(e))};var oi=function dc(e,t){return null!=e&&ri(e,t,ti)};var ni=function yc(e,t){return Pe(e)&&Lt(t)?Wt(W(e),t):function(r){var o=Oe(r,e);return void 0===o&&o===t?oi(r,e):zt(t,o,3)}};var Ut=function gc(e){return function(t){return null==t?void 0:t[e]}};var ai=function bc(e){return function(t){return mt(t,e)}};var ii=function vc(e){return Pe(e)?Ut(W(e)):ai(e)};var si=function _c(e){return"function"==typeof e?e:null==e?Hn:"object"==typeof e?A(e)?ni(e[0],e[1]):ei(e):ii(e)};var ui=function jc(e){return function(t,r,o){for(var n=-1,a=Object(t),i=o(t),s=i.length;s--;){var u=i[e?s:++n];if(!1===r(a[u],u,a))break}return t}}();var li=function Pc(e,t){return e&&ui(e,t,Be)};var Wr=function Sc(e,t){var r={};return t=si(t,3),li(e,(function(o,n,a){It(r,n,t(o,n,a))})),r},Ic=Math.floor;var Ur=function Ac(e,t){var r="";if(!e||t<1||t>9007199254740991)return r;do{t%2&&(r+=e),(t=Ic(t/2))&&(e+=e)}while(t);return r},fi=Ut("length"),ci="\\ud800-\\udfff",Mc="["+ci+"]",Kr="[\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff]",Gr="\\ud83c[\\udffb-\\udfff]",di="[^"+ci+"]",mi="(?:\\ud83c[\\udde6-\\uddff]){2}",hi="[\\ud800-\\udbff][\\udc00-\\udfff]",yi="(?:"+Kr+"|"+Gr+")"+"?",gi="[\\ufe0e\\ufe0f]?",Fc=gi+yi+("(?:\\u200d(?:"+[di,mi,hi].join("|")+")"+gi+yi+")*"),Rc="(?:"+[di+Kr+"?",Kr,mi,hi,Mc].join("|")+")",bi=RegExp(Gr+"(?="+Gr+")|"+Rc+Fc,"g");var vi=function Bc(e){for(var t=bi.lastIndex=0;bi.test(e);)++t;return t};var Kt=function qc(e){return qe(e)?vi(e):fi(e)},zc=Math.ceil;var _i=function Lc(e,t){var r=(t=void 0===t?" ":ct(t)).length;if(r<2)return r?Ur(t,e):t;var o=Ur(t,zc(e/Kt(t)));return qe(t)?ca(ja(o),0,e).join(""):o.slice(0,e)};var ye=function Wc(e,t,r){e=dt(e);var o=(t=Gn(t))?Kt(e):0;return t&&o<t?_i(t-o,r)+e:e};function Z(){let e,t,r=new Promise(((n,a)=>{e=i=>{n(i),o.status="resolved"},t=i=>{a(i),o.status="rejected"}})),o={resolve:e,reject:t,promise:r,status:"pending"};return o}var We=()=>{};var ji=class{constructor(t){this._fps=t}formatSubUnitForGrid(t){let r=t%1,o=1/this._fps;return Math.round(r/o)+"f"}formatFullUnitForGrid(t){let r=t,o="";r>=Ue&&(o+=Math.floor(r/Ue)+"h",r%=Ue),r>=be&&(o+=Math.floor(r/be)+"m",r%=be),r>=ge&&(o+=Math.floor(r/ge)+"s",r%=ge);let n=1/this._fps;return r>=n&&(o+=Math.floor(r/n)+"f",r%=n),0===o.length?"0s":o}formatForPlayhead(t){let r=t,o="";if(r>=Ue){let a=Math.floor(r/Ue);o+=ye(a.toString(),2,"0")+"h",r%=Ue}if(r>=be){let a=Math.floor(r/be);o+=ye(a.toString(),2,"0")+"m",r%=be}else o.length>0&&(o+="00m");if(r>=ge){let a=Math.floor(r/ge);o+=ye(a.toString(),2,"0")+"s",r%=ge}else o+="00s";let n=1/this._fps;if(r>=n){let a=Math.round(r/n);o+=ye(a.toString(),2,"0")+"f",r%=n}else r/n>.98?(o+=ye(1..toString(),2,"0")+"f",r%=n):o+="00f";return 0===o.length?"00s00f":o}formatBasic(t){return t.toFixed(2)+"s"}},ge=1,be=60*ge,Ue=60*be,Qt={};function Xt(e,t){return e.length<=t?e:e.substr(0,t-3)+"..."}hr(Qt,{boolean:()=>Xr,compound:()=>rt,number:()=>Yr,rgba:()=>Zc,string:()=>Zr,stringLiteral:()=>rd});var Ke=e=>"string"==typeof e?`string("${Xt(e,10)}")`:"number"==typeof e?`number(${Xt(String(e),10)})`:null===e?"null":void 0===e?"undefined":"boolean"==typeof e?String(e):Array.isArray(e)?"array":"object"==typeof e?"object":"unknown";function Zt(e){return w(v({},e),{toString(){return function Hc(e){return"#"+((255*e.r|256).toString(16).slice(1)+(255*e.g|256).toString(16).slice(1)+(255*e.b|256).toString(16).slice(1)+(255*e.a|256).toString(16).slice(1))}(this)}})}function Hr(e){function t(r){return r>=.04045?((r+.055)/1.055)**2.4:r/12.92}return{r:t(e.r),g:t(e.g),b:t(e.b),a:e.a}}function Jr(e){let t=.4122214708*e.r+.5363325363*e.g+.0514459929*e.b,r=.2119034982*e.r+.6806995451*e.g+.1073969566*e.b,o=.0883024619*e.r+.2817188376*e.g+.6299787005*e.b,n=Math.cbrt(t),a=Math.cbrt(r),i=Math.cbrt(o);return{L:.2104542553*n+.793617785*a-.0040720468*i,a:1.9779984951*n-2.428592205*a+.4505937099*i,b:.0259040371*n+.7827717662*a-.808675766*i,alpha:e.a}}var le=Symbol("TheatrePropType_Basic");function Si(e){return"object"==typeof e&&!!e&&"TheatrePropType"===e[le]}function Jc(e){if("number"==typeof e)return Yr(e);if("boolean"==typeof e)return Xr(e);if("string"==typeof e)return Zr(e);if("object"==typeof e&&e){if(Si(e))return e;if(Xe(e))return rt(e);throw new R("This value is not a valid prop type: "+Ke(e))}throw new R("This value is not a valid prop type: "+Ke(e))}var rt=(e,t)=>{let r=function Ti(e){let t={};for(let r of Object.keys(e)){let o=e[r];Si(o)?t[r]=o:t[r]=Jc(o)}return t}(e);return{type:"compound",props:r,valueType:null,[le]:"TheatrePropType",label:null==t?void 0:t.label,default:Wr(r,(o=>o.default))}},Yr=(e,t)=>{var o,n;let r=(null==t?void 0:t.sanitize)?a=>{let i=Ii(a);if("number"==typeof i)return t.sanitize(i)}:Ii;return w(v({type:"number",valueType:0,default:e,[le]:"TheatrePropType"},t||{}),{label:null==t?void 0:t.label,nudgeFn:null!=(o=null==t?void 0:t.nudgeFn)?o:od,nudgeMultiplier:"number"==typeof(null==t?void 0:t.nudgeMultiplier)?t.nudgeMultiplier:1,isScalar:!0,sanitize:r,interpolate:null!=(n=null==t?void 0:t.interpolate)?n:Xc})},Ii=e=>"number"==typeof e&&isFinite(e)?e:void 0,Xc=(e,t,r)=>e+r*(t-e),Zc=(e={r:0,g:0,b:0,a:1},t)=>{let r={};for(let o of["r","g","b","a"])r[o]=Math.min(Math.max(e[o],0),1);return{type:"rgba",valueType:null,default:Zt(r),[le]:"TheatrePropType",label:null==t?void 0:t.label,sanitize:Qc,interpolate:ed}},Qc=e=>{let t=!0;for(let o of["r","g","b","a"])(!Object.prototype.hasOwnProperty.call(e,o)||"number"!=typeof e[o])&&(t=!1);let r={};for(let o of["r","g","b","a"])r[o]=Math.min(Math.max(e[o],0),1);return t?Zt(r):void 0},ed=(e,t,r)=>{let o=Jr(Hr(e)),n=Jr(Hr(t));return Zt(function xi(e){function t(r){return r>=.0031308?1.055*r**(1/2.4)-.055:12.92*r}return{r:t(e.r),g:t(e.g),b:t(e.b),a:e.a}}(function Pi(e){let t=e.L+.3963377774*e.a+.2158037573*e.b,r=e.L-.1055613458*e.a-.0638541728*e.b,o=e.L-.0894841775*e.a-1.291485548*e.b,n=t*t*t,a=r*r*r,i=o*o*o;return{r:4.0767416621*n-3.3077115913*a+.2309699292*i,g:-1.2684380046*n+2.6097574011*a-.3413193965*i,b:-.0041960863*n-.7034186147*a+1.707614701*i,a:e.alpha}}({L:(1-r)*o.L+r*n.L,a:(1-r)*o.a+r*n.a,b:(1-r)*o.b+r*n.b,alpha:(1-r)*o.alpha+r*n.alpha})))},Xr=(e,t)=>({type:"boolean",default:e,valueType:null,[le]:"TheatrePropType",label:null==t?void 0:t.label,sanitize:td,interpolate:Qr}),td=e=>"boolean"==typeof e?e:void 0;function Qr(e){return e}var Zr=(e,t)=>{var r;return{type:"string",default:e,valueType:null,[le]:"TheatrePropType",label:null==t?void 0:t.label,sanitize:o=>(null==t?void 0:t.sanitize)?t.sanitize(o):"string"==typeof o?o:void 0,interpolate:null!=(r=null==t?void 0:t.interpolate)?r:Qr}};function rd(e,t,r){var o;return{type:"stringLiteral",default:e,options:v({},t),[le]:"TheatrePropType",valueType:null,as:null!=(o=null==r?void 0:r.as)?o:"menu",label:null==r?void 0:r.label,sanitize(n){if("string"==typeof n&&Object.hasOwnProperty.call(t,n))return n},interpolate:Qr}}var od=({config:e,deltaX:t,deltaFraction:r,magnitude:o})=>{let{range:n}=e;return n?r*(n[1]-n[0])*o*e.nudgeMultiplier:t*o*e.nudgeMultiplier};function er(e,t){return(e=>e.replace(/^[\s\/]*/,"").replace(/[\s\/]*$/,"").replace(/\s*\/\s*/," / "))(e)}pt(eo()),new WeakMap;var wi=e=>new Promise((t=>setTimeout(t,e)));function B(e){for(var t=arguments.length,r=Array(t>1?t-1:0),o=1;o<t;o++)r[o-1]=arguments[o];throw Error("[Immer] minified error nr: "+e+(r.length?" "+r.map((function(i){return"'"+i+"'"})).join(","):"")+". Find the full error at: https://bit.ly/3cXEKWf")}function ve(e){return!!e&&!!e[k]}function _e(e){return!!e&&(function(t){if(!t||"object"!=typeof t)return!1;var r=Object.getPrototypeOf(t);if(null===r)return!0;var o=Object.hasOwnProperty.call(r,"constructor")&&r.constructor;return o===Object||"function"==typeof o&&Function.toString.call(o)===md}(e)||Array.isArray(e)||!!e[Ri]||!!e.constructor[Ri]||ro(e)||oo(e))}function ot(e,t,r){void 0===r&&(r=!1),0===Ge(e)?(r?Object.keys:yo)(e).forEach((function(o){r&&"symbol"==typeof o||t(o,e[o],e)})):e.forEach((function(o,n){return t(n,o,e)}))}function Ge(e){var t=e[k];return t?t.i>3?t.i-4:t.i:Array.isArray(e)?1:ro(e)?2:oo(e)?3:0}function to(e,t){return 2===Ge(e)?e.has(t):Object.prototype.hasOwnProperty.call(e,t)}function Ci(e,t,r){var o=Ge(e);2===o?e.set(t,r):3===o?(e.delete(t),e.add(r)):e[t]=r}function ro(e){return cd&&e instanceof Map}function oo(e){return dd&&e instanceof Set}function je(e){return e.o||e.t}function no(e){if(Array.isArray(e))return Array.prototype.slice.call(e);var t=hd(e);delete t[k];for(var r=yo(t),o=0;o<r.length;o++){var n=r[o],a=t[n];!1===a.writable&&(a.writable=!0,a.configurable=!0),(a.get||a.set)&&(t[n]={configurable:!0,writable:!0,enumerable:a.enumerable,value:e[n]})}return Object.create(Object.getPrototypeOf(e),t)}function ao(e,t){return void 0===t&&(t=!1),io(e)||ve(e)||!_e(e)||(Ge(e)>1&&(e.set=e.add=e.clear=e.delete=ud),Object.freeze(e),t&&ot(e,(function(r,o){return ao(o,!0)}),!0)),e}function ud(){B(2)}function io(e){return null==e||"object"!=typeof e||Object.isFrozen(e)}function Q(e){var t=yd[e];return t||B(18,e),t}function Di(){return nt}function so(e,t){t&&(Q("Patches"),e.u=[],e.s=[],e.v=t)}function nr(e){po(e),e.p.forEach(ld),e.p=null}function po(e){e===nt&&(nt=e.l)}function ki(e){return nt={p:[],l:nt,h:e,m:!0,_:0}}function ld(e){var t=e[k];0===t.i||1===t.i?t.j():t.O=!0}function uo(e,t){t._=t.p.length;var r=t.p[0],o=void 0!==e&&e!==r;return t.h.g||Q("ES5").S(t,e,o),o?(r[k].P&&(nr(t),B(4)),_e(e)&&(e=ar(t,e),t.l||ir(t,e)),t.u&&Q("Patches").M(r[k],e,t.u,t.s)):e=ar(t,r,[]),nr(t),t.u&&t.v(t.u,t.s),e!==Fi?e:void 0}function ar(e,t,r){if(io(t))return t;var o=t[k];if(!o)return ot(t,(function(a,i){return Vi(e,o,t,a,i,r)}),!0),t;if(o.A!==e)return t;if(!o.P)return ir(e,o.t,!0),o.t;if(!o.I){o.I=!0,o.A._--;var n=4===o.i||5===o.i?o.o=no(o.k):o.o;ot(3===o.i?new Set(n):n,(function(a,i){return Vi(e,o,n,a,i,r)})),ir(e,n,!1),r&&e.u&&Q("Patches").R(o,r,e.u,e.s)}return o.o}function Vi(e,t,r,o,n,a){if(ve(n)){var i=ar(e,n,a&&t&&3!==t.i&&!to(t.D,o)?a.concat(o):void 0);if(Ci(r,o,i),!ve(i))return;e.m=!1}if(_e(n)&&!io(n)){if(!e.h.F&&e._<1)return;ar(e,n),t&&t.A.l||ir(e,n)}}function ir(e,t,r){void 0===r&&(r=!1),e.h.F&&e.m&&ao(t,r)}function lo(e,t){var r=e[k];return(r?je(r):e)[t]}function Mi(e,t){if(t in e)for(var r=Object.getPrototypeOf(e);r;){var o=Object.getOwnPropertyDescriptor(r,t);if(o)return o;r=Object.getPrototypeOf(r)}}function fo(e){e.P||(e.P=!0,e.l&&fo(e.l))}function co(e){e.o||(e.o=no(e.t))}function mo(e,t,r){var o=ro(t)?Q("MapSet").N(t,r):oo(t)?Q("MapSet").T(t,r):e.g?function(n,a){var i=Array.isArray(n),s={i:i?1:0,A:a?a.A:Di(),P:!1,I:!1,D:{},l:a,t:n,k:null,o:null,j:null,C:!1},u=s,p=sr;i&&(u=[s],p=pr);var l=Proxy.revocable(u,p),c=l.revoke,d=l.proxy;return s.k=d,s.j=c,d}(t,r):Q("ES5").J(t,r);return(r?r.A:Di()).p.push(o),o}function fd(e){return ve(e)||B(22,e),function t(r){if(!_e(r))return r;var o,n=r[k],a=Ge(r);if(n){if(!n.P&&(n.i<4||!Q("ES5").K(n)))return n.t;n.I=!0,o=Ei(r,a),n.I=!1}else o=Ei(r,a);return ot(o,(function(i,s){n&&function sd(e,t){return 2===Ge(e)?e.get(t):e[t]}(n.t,i)===s||Ci(o,i,t(s))})),3===a?new Set(o):o}(e)}function Ei(e,t){switch(t){case 2:return new Map(e);case 3:return Array.from(e)}return no(e)}var Ni,nt,ho="undefined"!=typeof Symbol&&"symbol"==typeof Symbol("x"),cd="undefined"!=typeof Map,dd="undefined"!=typeof Set,$i="undefined"!=typeof Proxy&&void 0!==Proxy.revocable&&"undefined"!=typeof Reflect,Fi=ho?Symbol.for("immer-nothing"):((Ni={})["immer-nothing"]=!0,Ni),Ri=ho?Symbol.for("immer-draftable"):"__$immer_draftable",k=ho?Symbol.for("immer-state"):"__$immer_state",md=("undefined"!=typeof Symbol&&Symbol.iterator,""+Object.prototype.constructor),yo="undefined"!=typeof Reflect&&Reflect.ownKeys?Reflect.ownKeys:void 0!==Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:Object.getOwnPropertyNames,hd=Object.getOwnPropertyDescriptors||function(e){var t={};return yo(e).forEach((function(r){t[r]=Object.getOwnPropertyDescriptor(e,r)})),t},yd={},sr={get:function(e,t){if(t===k)return e;var n,s,u,r=je(e);if(!to(r,t))return n=e,(u=Mi(r,t))?"value"in u?u.value:null===(s=u.get)||void 0===s?void 0:s.call(n.k):void 0;var o=r[t];return e.I||!_e(o)?o:o===lo(e.t,t)?(co(e),e.o[t]=mo(e.A.h,o,e)):o},has:function(e,t){return t in je(e)},ownKeys:function(e){return Reflect.ownKeys(je(e))},set:function(e,t,r){var o=Mi(je(e),t);if(null==o?void 0:o.set)return o.set.call(e.k,r),!0;if(!e.P){var n=lo(je(e),t),a=null==n?void 0:n[k];if(a&&a.t===r)return e.o[t]=r,e.D[t]=!1,!0;if(function pd(e,t){return e===t?0!==e||1/e==1/t:e!=e&&t!=t}(r,n)&&(void 0!==r||to(e.t,t)))return!0;co(e),fo(e)}return e.o[t]===r&&"number"!=typeof r&&(void 0!==r||t in e.o)||(e.o[t]=r,e.D[t]=!0,!0)},deleteProperty:function(e,t){return void 0!==lo(e.t,t)||t in e.t?(e.D[t]=!1,co(e),fo(e)):delete e.D[t],e.o&&delete e.o[t],!0},getOwnPropertyDescriptor:function(e,t){var r=je(e),o=Reflect.getOwnPropertyDescriptor(r,t);return o&&{writable:!0,configurable:1!==e.i||"length"!==t,enumerable:o.enumerable,value:r[t]}},defineProperty:function(){B(11)},getPrototypeOf:function(e){return Object.getPrototypeOf(e.t)},setPrototypeOf:function(){B(12)}},pr={};ot(sr,(function(e,t){pr[e]=function(){return arguments[0]=arguments[0][0],t.apply(this,arguments)}})),pr.deleteProperty=function(e,t){return sr.deleteProperty.call(this,e[0],t)},pr.set=function(e,t,r){return sr.set.call(this,e[0],t,r,e[0])};var N=new(function(){function e(r){var o=this;this.g=$i,this.F=!0,this.produce=function(n,a,i){if("function"==typeof n&&"function"!=typeof a){var s=a;a=n;var u=o;return function(m){var h=this;void 0===m&&(m=s);for(var x=arguments.length,P=Array(x>1?x-1:0),S=1;S<x;S++)P[S-1]=arguments[S];return u.produce(m,(function(T){var q;return(q=a).call.apply(q,[h,T].concat(P))}))}}var p;if("function"!=typeof a&&B(6),void 0!==i&&"function"!=typeof i&&B(7),_e(n)){var l=ki(o),c=mo(o,n,void 0),d=!0;try{p=a(c),d=!1}finally{d?nr(l):po(l)}return"undefined"!=typeof Promise&&p instanceof Promise?p.then((function(m){return so(l,i),uo(m,l)}),(function(m){throw nr(l),m})):(so(l,i),uo(p,l))}if(!n||"object"!=typeof n)return(p=a(n))===Fi?void 0:(void 0===p&&(p=n),o.F&&ao(p,!0),p);B(21,n)},this.produceWithPatches=function(n,a){return"function"==typeof n?function(u){for(var p=arguments.length,l=Array(p>1?p-1:0),c=1;c<p;c++)l[c-1]=arguments[c];return o.produceWithPatches(u,(function(d){return n.apply(void 0,[d].concat(l))}))}:[o.produce(n,a,(function(u,p){i=u,s=p})),i,s];var i,s},"boolean"==typeof(null==r?void 0:r.useProxies)&&this.setUseProxies(r.useProxies),"boolean"==typeof(null==r?void 0:r.autoFreeze)&&this.setAutoFreeze(r.autoFreeze)}var t=e.prototype;return t.createDraft=function(r){_e(r)||B(8),ve(r)&&(r=fd(r));var o=ki(this),n=mo(this,r,void 0);return n[k].C=!0,po(o),n},t.finishDraft=function(r,o){var a=(r&&r[k]).A;return so(a,o),uo(void 0,a)},t.setAutoFreeze=function(r){this.F=r},t.setUseProxies=function(r){r&&!$i&&B(20),this.g=r},t.applyPatches=function(r,o){var n;for(n=o.length-1;n>=0;n--){var a=o[n];if(0===a.path.length&&"replace"===a.op){r=a.value;break}}var i=Q("Patches").$;return ve(r)?i(r,o):this.produce(r,(function(s){return i(s,o.slice(n+1))}))},e}()),He=(N.produce,N.produceWithPatches.bind(N),N.setAutoFreeze.bind(N),N.setUseProxies.bind(N),N.applyPatches.bind(N),N.createDraft.bind(N),N.finishDraft.bind(N),{currentProjectStateDefinitionVersion:"0.4.0"});async function go(e,t,r){await wi(0),e.transaction((({drafts:o})=>{var l;let n=t.address.projectId;o.ephemeral.coreByProject[n]={lastExportedObject:null,loadingState:{type:"loading"}},o.ahistoric.coreByProject[n]={ahistoricStuff:""};let p=null==(l=function Oi(e){return ve(e)||B(23,e),e[k].t}(o.historic))?void 0:l.coreByProject[t.address.projectId];p?r&&-1==p.revisionHistory.indexOf(r.revisionHistory[0])?function u(c){o.ephemeral.coreByProject[n].loadingState={type:"browserStateIsNotBasedOnDiskState",onDiskState:c}}(r):function s(){o.ephemeral.coreByProject[n].loadingState={type:"loaded"}}():r?function i(c){o.ephemeral.coreByProject[n].loadingState={type:"loaded"},o.historic.coreByProject[n]=c}(r):function a(){o.ephemeral.coreByProject[n].loadingState={type:"loaded"},o.historic.coreByProject[n]={sheetsById:{},definitionVersion:He.currentProjectStateDefinitionVersion,revisionHistory:[]}}()}))}pt(eo());function Bi(e,t={}){let r=((e,t)=>{var r={};for(var o in e)dr.call(e,o)&&t.indexOf(o)<0&&(r[o]=e[o]);if(null!=e&&it)for(var o of it(e))t.indexOf(o)<0&&_o.call(e,o)&&(r[o]=e[o]);return r})(t,[]),o=Ee.get(e);return o?o.publicApi:(t.state&&_d(e,t.state),new class{get type(){return"Theatre_Project_PublicAPI"}constructor(t,r={}){pe(this,new class{constructor(t,r={},o){var a;this.config=r,this.publicApi=o,f(this,"pointers"),f(this,"_pointerProxies"),f(this,"address"),f(this,"_readyDeferred"),f(this,"_sheetTemplates",new j({})),f(this,"sheetTemplatesP",this._sheetTemplates.pointer),f(this,"_studio"),f(this,"type","Theatre_Project"),this.address={projectId:t};let n=new j({ahistoric:{ahistoricStuff:""},historic:null!=(a=r.state)?a:{sheetsById:{},definitionVersion:He.currentProjectStateDefinitionVersion,revisionHistory:[]},ephemeral:{loadingState:{type:"loaded"},lastExportedObject:null}});this._pointerProxies={historic:new de(n.pointer.historic),ahistoric:new de(n.pointer.ahistoric),ephemeral:new de(n.pointer.ephemeral)},this.pointers={historic:this._pointerProxies.historic.pointer,ahistoric:this._pointerProxies.ahistoric.pointer,ephemeral:this._pointerProxies.ephemeral.pointer},Ee.add(t,this),this._readyDeferred=Z(),r.state?setTimeout((()=>{this._studio||this._readyDeferred.resolve(void 0)}),0):setTimeout((()=>{if(!this._studio)throw new Error(`Argument config.state in Theatre.getProject("${t}", config) is empty. This is fine while you are using @theatre/core along with @theatre/sutdio. But since @theatre/studio is not loaded, the state of project "${t}" will be empty.\n\nTo fix this, you need to add @theatre/studio into the bundle and export the projet's state. Learn how to do that at https://docs.theatrejs.com/in-depth/#exporting`)}),1e3)}attachToStudio(t){if(this._studio){if(this._studio!==t)throw new Error(`Project ${this.address.projectId} is already attached to studio ${this._studio.address.studioId}`);console.warn(`Project ${this.address.projectId} is already attached to studio ${this._studio.address.studioId}`)}else this._studio=t,t.initialized.then((async()=>{await go(t,this,this.config.state),this._pointerProxies.historic.setPointer(t.atomP.historic.coreByProject[this.address.projectId]),this._pointerProxies.ahistoric.setPointer(t.atomP.ahistoric.coreByProject[this.address.projectId]),this._pointerProxies.ephemeral.setPointer(t.atomP.ephemeral.coreByProject[this.address.projectId]),this._readyDeferred.resolve(void 0)}))}get isAttachedToStudio(){return!!this._studio}get ready(){return this._readyDeferred.promise}isReady(){return"resolved"===this._readyDeferred.status}getOrCreateSheet(t,r="default"){let o=this._sheetTemplates.getState()[t];return o||(o=new class{constructor(t,r){this.project=t,f(this,"type","Theatre_SheetTemplate"),f(this,"address"),f(this,"_instances",new j({})),f(this,"instancesP",this._instances.pointer),f(this,"_objectTemplates",new j({})),f(this,"objectTemplatesP",this._objectTemplates.pointer),this.address=w(v({},t.address),{sheetId:r})}getInstance(t){let r=this._instances.getState()[t];return r||(r=new class{constructor(t,r){this.template=t,this.instanceId=r,f(this,"_objects",new j({})),f(this,"_sequence"),f(this,"address"),f(this,"publicApi"),f(this,"project"),f(this,"objectsP",this._objects.pointer),f(this,"type","Theatre_Sheet"),this.project=t.project,this.address=w(v({},t.address),{sheetInstanceId:this.instanceId}),this.publicApi=new class{get type(){return"Theatre_Sheet_PublicAPI"}constructor(t){pe(this,t)}object(t,r){let o=b(this),n=er(t),a=o.getObject(n);if(a)return a.publicApi;{let s=rt(r);return o.createObject(n,null,s).publicApi}}get sequence(){return b(this).getSequence().publicApi}get project(){return b(this).project.publicApi}get address(){return v({},b(this).address)}}(this)}createObject(t,r,o){let a=this.template.getObjectTemplate(t,r,o).createInstance(this,r,o);return this._objects.setIn([t],a),a}getObject(t){return this._objects.getState()[t]}getSequence(){if(!this._sequence){let t=D(this.project.pointers.historic.sheetsById[this.address.sheetId].sequence.length).map((o=>"number"==typeof o?o:10)),r=D(this.project.pointers.historic.sheetsById[this.address.sheetId].sequence.subUnitsPerUnit).map((o=>"number"==typeof o?o:30));this._sequence=new class{constructor(t,r,o,n,a){this._project=t,this._sheet=r,this._lengthD=o,this._subUnitsPerUnitD=n,f(this,"address"),f(this,"publicApi"),f(this,"_playbackControllerBox"),f(this,"_statePointerDerivation"),f(this,"_positionD"),f(this,"_positionFormatterD"),f(this,"_playableRangeD"),f(this,"pointer",Y({root:this,path:[]})),f(this,"$$isIdentityDerivationProvider",!0),f(this,"closestGridPosition",(t=>{let o=1/this.subUnitsPerUnit;return parseFloat((Math.round(t/o)*o).toFixed(3))})),this.address=w(v({},this._sheet.address),{sequenceName:"default"}),this.publicApi=new class{get type(){return"Theatre_Sequence_PublicAPI"}constructor(t){pe(this,t)}play(t){if(b(this)._project.isReady())return b(this).play(t);{let r=Z();return r.resolve(!0),r.promise}}pause(){b(this).pause()}get position(){return b(this).position}set position(t){b(this).position=t}async attachAudio(t){let{audioContext:r,destinationNode:o,decodedBuffer:n,gainNode:a}=await async function Kc(e){function t(){if(e.audioContext)return Promise.resolve(e.audioContext);let p=new AudioContext;return"running"===p.state?Promise.resolve(p):new Promise((l=>{let c=()=>{p.resume()},d=["mousedown","keydown","touchstart"],m={capture:!0,passive:!1};d.forEach((h=>{window.addEventListener(h,c,m)})),p.addEventListener("statechange",(()=>{"running"===p.state&&(d.forEach((h=>{window.removeEventListener(h,c,m)})),l(p))}))}))}async function r(){if(e.source instanceof AudioBuffer)return e.source;let l,c,m,p=Z();if("string"!=typeof e.source)throw new Error("Error validating arguments to sequence.attachAudio(). args.source must either be a string or an instance of AudioBuffer.");try{l=await fetch(e.source)}catch(h){throw console.error(h),new Error(`Could not fetch '${e.source}'. Network error logged above.`)}try{c=await l.arrayBuffer()}catch(h){throw console.error(h),new Error(`Could not read '${e.source}' as an arrayBuffer.`)}(await o).decodeAudioData(c,p.resolve,p.reject);try{m=await p.promise}catch(h){throw console.error(h),new Error(`Could not decode ${e.source} as an audio file.`)}return m}let o=t(),n=r(),[a,i]=await Promise.all([o,n]),s=e.destinationNode||a.destination,u=a.createGain();return u.connect(s),{audioContext:a,decodedBuffer:i,gainNode:u,destinationNode:s}}(t),i=new class{constructor(t,r,o,n){this._ticker=t,this._decodedBuffer=r,this._audioContext=o,this._nodeDestination=n,f(this,"_mainGain"),f(this,"_state",new j({position:0,playing:!1})),f(this,"statePointer"),f(this,"_stopPlayCallback",We),this.statePointer=this._state.pointer,this._mainGain=this._audioContext.createGain(),this._mainGain.connect(this._nodeDestination)}get _playing(){return this._state.getState().playing}set _playing(t){this._state.setIn(["playing"],t)}destroy(){}pause(){this._stopPlayCallback(),this._playing=!1,this._stopPlayCallback=We}gotoPosition(t){this._updatePositionInState(t)}_updatePositionInState(t){this._state.reduceState(["position"],(()=>t))}getCurrentPosition(){return this._state.getState().position}play(t,r,o,n){this._playing&&this.pause(),this._playing=!0;let a=this._ticker,i=this.getCurrentPosition(),s=r[1]-r[0];if("normal"!==n)throw new R(`Audio-controlled sequences can only be played in the "normal" direction. '${n}' given.`);(i<r[0]||i>r[1]||i===r[1])&&this._updatePositionInState(r[0]),i=this.getCurrentPosition();let u=Z(),p=this._audioContext.createBufferSource();p.buffer=this._decodedBuffer,p.connect(this._mainGain),p.playbackRate.value=o,t>1e3&&(console.warn("Audio-controlled sequences cannot have an iterationCount larger than 1000. It has been clamped to 1000."),t=1e3),t>1&&(p.loop=!0,p.loopStart=r[0],p.loopEnd=r[1]);let l=a.time,c=i-r[0],d=s*t;p.start(0,i,d-c);let m=P=>{let T=Math.max(P-l,0)/1e3,q=Math.min(T*o+c,d);if(q!==d){let xe=q/s%1*s;this._updatePositionInState(xe+r[0]),x()}else this._updatePositionInState(r[1]),this._playing=!1,h(),u.resolve(!0)},h=()=>{p.stop(),p.disconnect()};this._stopPlayCallback=()=>{h(),a.offThisOrNextTick(m),a.offNextTick(m),this._playing&&u.resolve(!1)};let x=()=>a.onNextTick(m);return a.onThisOrNextTick(m),u.promise}}(L,n,r,a);return b(this).replacePlaybackController(i),{audioContext:r,destinationNode:o,decodedBuffer:n,gainNode:a}}get pointer(){return b(this).pointer}}(this),this._playbackControllerBox=new X(null!=a?a:new class{constructor(t){this._ticker=t,f(this,"_stopPlayCallback",We),f(this,"_state",new j({position:0,playing:!1})),f(this,"statePointer"),this.statePointer=this._state.pointer}destroy(){}pause(){this._stopPlayCallback(),this.playing=!1,this._stopPlayCallback=We}gotoPosition(t){this._updatePositionInState(t)}_updatePositionInState(t){this._state.reduceState(["position"],(()=>t))}getCurrentPosition(){return this._state.getState().position}get playing(){return this._state.getState().playing}set playing(t){this._state.setIn(["playing"],t)}play(t,r,o,n){this.playing&&this.pause(),this.playing=!0;let a=this._ticker,i=r[1]-r[0];{let m=this.getCurrentPosition();m<r[0]||m>r[1]?"normal"===n||"alternate"===n?this._updatePositionInState(r[0]):("reverse"===n||"alternateReverse"===n)&&this._updatePositionInState(r[1]):"normal"===n||"alternate"===n?m===r[1]&&this._updatePositionInState(r[0]):m===r[0]&&this._updatePositionInState(r[1])}let s=Z(),u=a.time,p=i*t,l=this.getCurrentPosition()-r[0];("reverse"===n||"alternateReverse"===n)&&(l=r[1]-this.getCurrentPosition());let c=m=>{let x=Math.max(m-u,0)/1e3,P=Math.min(x*o+l,p);if(P!==p){let S=Math.floor(P/i),T=P/i%1*i;if("normal"!==n)if("reverse"===n)T=i-T;else{let q=S%2==0;"alternate"===n?q||(T=i-T):q&&(T=i-T)}this._updatePositionInState(T+r[0]),d()}else{if("normal"===n)this._updatePositionInState(r[1]);else if("reverse"===n)this._updatePositionInState(r[0]);else{let S=(t-1)%2==0;"alternate"===n?S?this._updatePositionInState(r[1]):this._updatePositionInState(r[0]):S?this._updatePositionInState(r[0]):this._updatePositionInState(r[1])}this.playing=!1,s.resolve(!0)}};this._stopPlayCallback=()=>{a.offThisOrNextTick(c),a.offNextTick(c),this.playing&&s.resolve(!1)};let d=()=>a.onNextTick(c);return a.onThisOrNextTick(c),s.promise}}(L)),this._statePointerDerivation=this._playbackControllerBox.derivation.map((i=>i.statePointer)),this._positionD=this._statePointerDerivation.flatMap((i=>D(i.position))),this._positionFormatterD=this._subUnitsPerUnitD.map((i=>new ji(i)))}getIdentityDerivation(t){if(0===t.length)return y((()=>({length:g(this.pointer.length),playing:g(this.pointer.playing),position:g(this.pointer.position)})));if(t.length>1)return y((()=>{}));let[r]=t;return"length"===r?this._lengthD:"position"===r?this._positionD:y("playing"===r?()=>g(this._statePointerDerivation.getValue().playing):()=>{})}get positionFormatter(){return this._positionFormatterD.getValue()}get derivationToStatePointer(){return this._statePointerDerivation}get length(){return this._lengthD.getValue()}get positionDerivation(){return this._positionD}get position(){return this._playbackControllerBox.get().getCurrentPosition()}get subUnitsPerUnit(){return this._subUnitsPerUnitD.getValue()}get positionSnappedToGrid(){return this.closestGridPosition(this.position)}set position(t){let r=t;this.pause(),r>this.length&&(r=this.length);let o=this.length;this._playbackControllerBox.get().gotoPosition(r>o?o:r)}getDurationCold(){return this._lengthD.getValue()}get playing(){return g(this._playbackControllerBox.get().statePointer.playing)}_makeRangeFromSequenceTemplate(){return y((()=>[0,g(this._lengthD)]))}async play(t){let r=this.length,o=t&&t.range?t.range:[0,r],n=t&&"number"==typeof t.iterationCount?t.iterationCount:1,a=t&&void 0!==t.rate?t.rate:1,i=t&&t.direction?t.direction:"normal";return await this._play(n,[o[0],o[1]],a,i)}_play(t,r,o,n){return this._playbackControllerBox.get().play(t,r,o,n)}pause(){this._playbackControllerBox.get().pause()}replacePlaybackController(t){this.pause();let r=this._playbackControllerBox.get();this._playbackControllerBox.set(t);let o=r.getCurrentPosition();r.destroy(),t.gotoPosition(o)}}(this.template.project,this,t,r)}return this._sequence}}(this,t),this._instances.setIn([t],r)),r}getObjectTemplate(t,r,o){let n=this._objectTemplates.getState()[t];return n||(n=new class{constructor(t,r,o,n){this.sheetTemplate=t,f(this,"address"),f(this,"type","Theatre_SheetObjectTemplate"),f(this,"_config"),f(this,"_cache",new ue),f(this,"project"),this.address=w(v({},t.address),{objectKey:r}),this._config=new j(n),this.project=t.project}get config(){return this._config.getState()}createInstance(t,r,o){return this._config.setState(o),new class{constructor(t,r,o){this.sheet=t,this.template=r,this.nativeObject=o,f(this,"$$isIdentityDerivationProvider",!0),f(this,"address"),f(this,"publicApi"),f(this,"_initialValue",new j({})),f(this,"_cache",new ue),this.address=w(v({},r.address),{sheetInstanceId:t.address.sheetInstanceId}),this.publicApi=new class{constructor(t){f(this,"_cache",new ue),pe(this,t)}get type(){return"Theatre_SheetObject_PublicAPI"}get props(){return b(this).propsP}get sheet(){return b(this).sheet.publicApi}get project(){return b(this).sheet.project.publicApi}get address(){return v({},b(this).address)}_valuesDerivation(){return this._cache.get("onValuesChangeDerivation",(()=>{let t=b(this);return y((()=>g(t.getValues().getValue())))}))}onValuesChange(t){return this._valuesDerivation().tapImmediate(L,t)}get value(){return this._valuesDerivation().getValue()}set initialValue(t){b(this).setInitialValue(t)}}(this)}get type(){return"Theatre_SheetObject"}getValues(){return this._cache.get("getValues()",(()=>y((()=>{let p,n=Fe(g(this.template.getDefaultValues()),g(this._initialValue.pointer),y.memo("withInitialCache",(()=>new WeakMap),[])),u=Fe(n,g(this.template.getStaticValues()),y.memo("withStatics",(()=>new WeakMap),[]));{let c=y.memo("seq",(()=>this.getSequencedValues()),[]),d=y.memo("withSeqsCache",(()=>new WeakMap),[]);p=g(g(c)),u=Fe(u,p,d)}return((e,t)=>{let r=y.memo(e,(()=>new j(t)),[]);return r.setState(t),r})("finalAtom",u).pointer}))))}getValueByPointer(t){let r=g(this.getValues()),{path:o}=Ze(t);return g(At(r,o))}getIdentityDerivation(t){return y((()=>{let r=g(this.getValues());return g(At(r,t))}))}getSequencedValues(){return y((()=>{let t=y.memo("tracksToProcess",(()=>this.template.getArrayOfValidSequenceTracks()),[]),r=g(t),o=new j({});return y.effect("processTracks",(()=>{let n=[];for(let{trackId:a,pathToProp:i}of r){let s=this._trackIdToDerivation(a),u=Qe(this.template.config,i),p=u.sanitize,l=u.interpolate,c=()=>{let m=s.getValue();if(!m)return o.setIn(i,u.default);let h=p(m.left),x=void 0===h?u.default:h;if(void 0===m.right)return o.setIn(i,x);let P=p(m.right),S=void 0===P?u.default:P;return o.setIn(i,l(x,S,m.progression))},d=s.changesWithoutValues().tap(c);c(),n.push(d)}return()=>{for(let a of n)a()}}),r),o.pointer}))}_trackIdToDerivation(t){return Cr(this.template.project.pointers.historic.sheetsById[this.address.sheetId].sequence.tracksByObject[this.address.objectKey].trackData[t],this.sheet.getSequence().positionDerivation)}get propsP(){return this._cache.get("propsP",(()=>Y({root:this,path:[]})))}validateValue(t,r){}setInitialValue(t){this.validateValue(this.propsP,t),this._initialValue.setState(t)}}(t,this,r)}overrideConfig(t){this._config.setState(t)}getDefaultValues(){return this._cache.get("getDefaultValues()",(()=>y((()=>function wr(e){return Or(e)}(g(this._config.pointer))))))}getStaticValues(){return this._cache.get("getDerivationOfStatics",(()=>y((()=>{let t=this.sheetTemplate.project.pointers.historic.sheetsById[this.address.sheetId];return g(t.staticOverrides.byObject[this.address.objectKey])||{}}))))}getArrayOfValidSequenceTracks(){return this._cache.get("getArrayOfValidSequenceTracks",(()=>y((()=>{let t=this.project.pointers.historic.sheetsById[this.address.sheetId],r=g(t.sequence.tracksByObject[this.address.objectKey].trackIdByPropPath);if(!r)return Tt;let o=[];if(!r)return Tt;let n=Object.entries(r);for(let[i,s]of n){let u=mu(i);if(!u)continue;let p=Qe(this.config,u);!p||!(null==p?void 0:p.sanitize)||!p.interpolate||o.push({pathToProp:u,trackId:s})}let a=function Vr(e){let t=kn.get(e);if(t)return t;let r=new Map;return kn.set(e,r),Vn([],e,r),r}(this.config);return o.sort(((i,s)=>{let u=i.pathToProp,p=s.pathToProp;return a.get(JSON.stringify(u))>a.get(JSON.stringify(p))?1:-1})),0===o.length?Tt:o}))))}getMapOfValidSequenceTracks_forStudio(){return this._cache.get("getMapOfValidSequenceTracks_forStudio",(()=>this.getArrayOfValidSequenceTracks().map((t=>{let r={};for(let{pathToProp:o,trackId:n}of t)In(r,o,n);return r}))))}getDefaultsAtPointer(t){let{path:r}=Ze(t);return function Tr(e,t){return 0===t.length?e:Oe(e,t)}(this.getDefaultValues().getValue(),r)}}(this,t,r,o),this._objectTemplates.setIn([t],n)),n}}(this,t),this._sheetTemplates.setIn([t],o)),o.getInstance(r)}}(t,r,this))}get ready(){return b(this).ready}get isReady(){return b(this).isReady()}get address(){return v({},b(this).address)}sheet(t,r="default"){let o=er(t);return b(this).getOrCreateSheet(o,r).publicApi}}(e,r))}var _d=(e,t)=>{((e,t)=>{if(Array.isArray(t)||null==t||t.definitionVersion!==He.currentProjectStateDefinitionVersion)throw new R(`Error validating conf.state in Theatre.getProject(${JSON.stringify(e)}, conf). The state seems to be formatted in a way that is unreadable to Theatre.js. Read more at https://docs.theatrejs.com`)})(e,t)};function qi(e,t){if(ie(e))return D(e).tapImmediate(L,t);if(U(e))return e.tapImmediate(L,t);throw new Error("Called onChange(p) where p is neither a pointer nor a derivation.")}function zi(e){if(ie(e))return D(e).getValue();throw new Error("Called val(p) where p is not a pointer.")}var fr="__TheatreJS_CoreBundle";!function jd(){if("undefined"==typeof window)return;let e=window[fr];if(void 0!==e)throw"object"==typeof e&&e&&"string"==typeof e.version?new Error("It seems that the module '@theatre/core' is loaded more than once. This could have two possible causes:\n1. You might have two separate versions of theatre in node_modules.\n2. Or this might be a bundling misconfiguration, in case you're using a bundler like Webpack/ESBuild/Rollup.\n\nNote that it **is okay** to import '@theatre/core' multiple times. But those imports should point to the same module."):new Error(`The variable window.${fr} seems to be already set by a module other than @theatre/core.`);let t=new class{constructor(){f(this,"_studio")}get type(){return"Theatre_CoreBundle"}get version(){return process.env.version}getBitsForStudio(t,r){if(this._studio)throw new Error("@theatre/core is already attached to @theatre/studio");this._studio=t,r({projectsP:Ee.atom.pointer.projects,privateAPI:b,coreExports:bo})}};window[fr]=t;let r=window.__TheatreJS_StudioBundle;r&&null!==r&&"Theatre_StudioBundle"===r.type&&r.registerCoreBundle(t)}(),window.Theatre={core:vo,get studio(){alert("Theatre.studio is only available in the core-and-studio.js bundle. You're using the core-only.min.js bundle.")}}})(),Hydra.ready((()=>{TweenManager.Transforms=["scale","scaleX","scaleY","x","y","z","rotation","rotationX","rotationY","rotationZ","skewX","skewY","perspective"],TweenManager.CubicEases=[{name:"easeOutCubic",curve:"cubic-bezier(0.215, 0.610, 0.355, 1.000)"},{name:"easeOutQuad",curve:"cubic-bezier(0.250, 0.460, 0.450, 0.940)"},{name:"easeOutQuart",curve:"cubic-bezier(0.165, 0.840, 0.440, 1.000)"},{name:"easeOutQuint",curve:"cubic-bezier(0.230, 1.000, 0.320, 1.000)"},{name:"easeOutSine",curve:"cubic-bezier(0.390, 0.575, 0.565, 1.000)"},{name:"easeOutExpo",curve:"cubic-bezier(0.190, 1.000, 0.220, 1.000)"},{name:"easeOutCirc",curve:"cubic-bezier(0.075, 0.820, 0.165, 1.000)"},{name:"easeOutBack",curve:"cubic-bezier(0.175, 0.885, 0.320, 1.275)"},{name:"easeInCubic",curve:"cubic-bezier(0.550, 0.055, 0.675, 0.190)"},{name:"easeInQuad",curve:"cubic-bezier(0.550, 0.085, 0.680, 0.530)"},{name:"easeInQuart",curve:"cubic-bezier(0.895, 0.030, 0.685, 0.220)"},{name:"easeInQuint",curve:"cubic-bezier(0.755, 0.050, 0.855, 0.060)"},{name:"easeInSine",curve:"cubic-bezier(0.470, 0.000, 0.745, 0.715)"},{name:"easeInCirc",curve:"cubic-bezier(0.600, 0.040, 0.980, 0.335)"},{name:"easeInBack",curve:"cubic-bezier(0.600, -0.280, 0.735, 0.045)"},{name:"easeInOutCubic",curve:"cubic-bezier(0.645, 0.045, 0.355, 1.000)"},{name:"easeInOutQuad",curve:"cubic-bezier(0.455, 0.030, 0.515, 0.955)"},{name:"easeInOutQuart",curve:"cubic-bezier(0.770, 0.000, 0.175, 1.000)"},{name:"easeInOutQuint",curve:"cubic-bezier(0.860, 0.000, 0.070, 1.000)"},{name:"easeInOutSine",curve:"cubic-bezier(0.445, 0.050, 0.550, 0.950)"},{name:"easeInOutExpo",curve:"cubic-bezier(1.000, 0.000, 0.000, 1.000)"},{name:"easeInOutCirc",curve:"cubic-bezier(0.785, 0.135, 0.150, 0.860)"},{name:"easeInOutBack",curve:"cubic-bezier(0.680, -0.550, 0.265, 1.550)"},{name:"easeInOut",curve:"cubic-bezier(.42,0,.58,1)"},{name:"linear",curve:"linear"}],TweenManager.useCSSTrans=function(props,ease,object){return!(props.math||"string"==typeof ease&&ease.includes(["Elastic","Bounce"])||object.multiTween||TweenManager._inspectEase(ease).path||!Device.tween.transition)},TweenManager._detectTween=function(object,props,time,ease,delay,callback){return TweenManager.useCSSTrans(props,ease,object)?new CSSTransition(object,props,time,ease,delay,callback):new FrameTween(object,props,time,ease,delay,callback)},TweenManager._parseTransform=function(props){var unitRequiresCSSTween=["%","vw","vh","em"],transforms="",translate="";if(props.perspective>0&&(transforms+="perspective("+props.perspective+"px)"),void 0!==props.x||void 0!==props.y||void 0!==props.z){var x=props.x||0,y=props.y||0,z=props.z||0;translate+=x+("string"==typeof props.x&&props.x.includes(unitRequiresCSSTween)?"":"px")+", ",translate+=y+("string"==typeof props.y&&props.y.includes(unitRequiresCSSTween)?"":"px"),Device.tween.css3d?transforms+="translate3d("+(translate+=", "+z+"px")+")":transforms+="translate("+translate+")"}return void 0!==props.scale?transforms+="scale("+props.scale+")":(void 0!==props.scaleX&&(transforms+="scaleX("+props.scaleX+")"),void 0!==props.scaleY&&(transforms+="scaleY("+props.scaleY+")")),void 0!==props.rotation&&(transforms+="rotate("+props.rotation+"deg)"),void 0!==props.rotationX&&(transforms+="rotateX("+props.rotationX+"deg)"),void 0!==props.rotationY&&(transforms+="rotateY("+props.rotationY+"deg)"),void 0!==props.rotationZ&&(transforms+="rotateZ("+props.rotationZ+"deg)"),void 0!==props.skewX&&(transforms+="skewX("+props.skewX+"deg)"),void 0!==props.skewY&&(transforms+="skewY("+props.skewY+"deg)"),transforms},TweenManager._clearCSSTween=function(obj){obj&&!obj._cssTween&&obj.div._transition&&!obj.persistTween&&(obj.div.style[HydraCSS.styles.vendorTransition]="",obj.div._transition=!1,obj._cssTween=null)},TweenManager._isTransform=function(key){return TweenManager.Transforms.indexOf(key)>-1},TweenManager._getAllTransforms=function(object){for(var obj={},i=TweenManager.Transforms.length-1;i>-1;i--){var tf=TweenManager.Transforms[i],val=object[tf];0===val||"number"!=typeof val&&"string"!=typeof val||(obj[tf]=val)}return obj};const prefix=function(){let pre="",dom="";try{var styles=window.getComputedStyle(document.documentElement,"");return pre=(Array.prototype.slice.call(styles).join("").match(/-(moz|webkit|ms)-/)||""===styles.OLink&&["","o"])[1],dom="WebKit|Moz|MS|O".match(new RegExp("("+pre+")","i"))[1],{unprefixed:"ie"==Device.system.browser&&!Device.detect("msie 9"),dom:dom,lowercase:pre,css:"-"+pre+"-",js:("ie"==Device.system.browser?pre[0]:pre[0].toUpperCase())+pre.substr(1)}}catch(e){return{unprefixed:!0,dom:"",lowercase:"",css:"",js:""}}}();HydraCSS.styles={},HydraCSS.styles.vendor=prefix.unprefixed?"":prefix.js,HydraCSS.styles.vendorTransition=HydraCSS.styles.vendor.length?HydraCSS.styles.vendor+"Transition":"transition",HydraCSS.styles.vendorTransform=HydraCSS.styles.vendor.length?HydraCSS.styles.vendor+"Transform":"transform",HydraCSS.vendor=prefix.css,HydraCSS.transformProperty=function(){switch(prefix.lowercase){case"moz":return"-moz-transform";case"webkit":return"-webkit-transform";case"o":return"-o-transform";case"ms":return"-ms-transform";default:return"transform"}}(),HydraCSS.tween={},HydraCSS.tween.complete=prefix.unprefixed?"transitionend":prefix.lowercase+"TransitionEnd"})),Class((function CSSTransition(_object,_props,_time,_ease,_delay,_callback){const _this=this;let _transformProps,_transitionProps;function killed(){return!_this||_this.kill||!_object||!_object.div}function clearCSSTween(){killed()||(_this.playing=!1,_object._cssTween=null,_object.willChange(null),_object=_props=null,Utils.nullObject(this))}this.playing=!0,function(){if("number"!=typeof _time)throw"CSSTween Requires object, props, time, ease";!function initProperties(){var transform=TweenManager._getAllTransforms(_object),properties=[];for(var key in _props)TweenManager._isTransform(key)?(transform.use=!0,transform[key]=_props[key],delete _props[key]):("number"==typeof _props[key]||key.includes(["-","color"]))&&properties.push(key);transform.use&&(properties.push(HydraCSS.transformProperty),delete transform.use);_transformProps=transform,_transitionProps=properties}(),async function initCSSTween(values){if(killed())return;_object._cssTween&&(_object._cssTween.kill=!0);_object._cssTween=_this,_object.div._transition=!0;var strings=function buildStrings(time,ease,delay){for(var props="",str="",len=_transitionProps.length,i=0;i<len;i++){var transitionProp=_transitionProps[i];props+=(props.length?", ":"")+transitionProp,str+=(str.length?", ":"")+transitionProp+" "+time+"ms "+TweenManager._getEase(ease)+" "+delay+"ms"}return{props:props,transition:str}}(_time,_ease,_delay);_object.willChange(strings.props);var time=values?values.time:_time,delay=values?values.delay:_delay,props=values?values.props:_props,transformProps=values?values.transform:_transformProps,singleFrame=1e3/Render.REFRESH_RATE;if(_this.time=_time,_this.delay=_delay,await Timer.delayedCall(3*singleFrame),killed())return;if(_object.div.style[HydraCSS.styles.vendorTransition]=strings.transition,_this.playing=!0,"safari"==Device.system.browser){if(Device.system.browserVersion<11&&await Timer.delayedCall(singleFrame),killed())return;_object.css(props),_object.transform(transformProps)}else _object.css(props),_object.transform(transformProps);Timer.create((function(){killed()||(clearCSSTween(),_callback&&_callback(),_this.completePromise&&_this.completePromise.resolve())}),time+delay)}()}(),this.stop=function(){this.playing&&(this.kill=!0,this.playing=!1,_object.div.style[HydraCSS.styles.vendorTransition]="",_object.div._transition=!1,_object.willChange(null),_object._cssTween=null,Utils.nullObject(this))},this.onComplete=function(callback){return _callback=callback,this},this.promise=function(){return _this.completePromise=Promise.create(),_this.completePromise}})),Class((function FrameTween(_object,_props,_time,_ease,_delay,_callback,_manual){var _endValues,_transformEnd,_transformStart,_startValues,_isTransform,_isCSS,_transformProps,_cssTween,_transformTween,_this=this;function copy(obj){let newObj={};for(let key in obj)"number"==typeof obj[key]&&(newObj[key]=obj[key]);return newObj}function clear(){_object._cssTweens&&_object._cssTweens.remove(_this),_this.playing=!1,_object._cssTween=null,_object=_props=null}function update(){if(!function killed(){return _this.kill||!_object||!_object.div||!_object.css}()){if(_isCSS&&_object.css(_props),_isTransform)if(_object.multiTween){for(var key in _transformProps)"number"==typeof _transformProps[key]&&(_object[key]=_transformProps[key]);_object.transform()}else _object.transform(_transformProps);undefined}}function tweenComplete(){_this.playing&&(clear(),_callback&&_callback(),_this.completePromise&&_this.completePromise.resolve())}this.playing=!0,_this.object=_object,_this.props=_props,_this.time=_time,_this.ease=_ease,_this.delay=_delay,defer((function(){if(_this.overrideValues){let values=_this.overrideValues(_this,_object,_props,_time,_ease,_delay);values&&(_this.props=_props=values.props||_props,_this.time=_time=values.time||_time,_this.ease=_ease=values.ease||_ease,_this.delay=_delay=values.delay||_delay)}if("object"==typeof _ease&&(_ease="easeOutCubic"),_object&&_props){if(_this.object=_object,"number"!=typeof _time)throw"FrameTween Requires object, props, time, ease";!function initValues(){_props.math&&delete _props.math;Device.tween.transition&&_object.div&&_object.div._transition&&(_object.div.style[HydraCSS.styles.vendorTransition]="",_object.div._transition=!1);_this.time=_time,_this.delay=_delay,_endValues={},_transformEnd={},_transformStart={},_startValues={},_object.multiTween||(void 0===_props.x&&(_props.x=_object.x),void 0===_props.y&&(_props.y=_object.y),void 0===_props.z&&(_props.z=_object.z));for(var key in _props)if(key.includes(["damping","spring"]))_endValues[key]=_props[key],_transformEnd[key]=_props[key];else if(TweenManager._isTransform(key))_isTransform=!0,_transformStart[key]=_object[key]||("scale"==key?1:0),_transformEnd[key]=_props[key];else{_isCSS=!0;var v=_props[key];"string"==typeof v?_object.div.style[key]=v:"number"==typeof v&&(_startValues[key]=_object.css?Number(_object.css(key)):0,_endValues[key]=v)}}(),function startTween(){!_object._cssTween||_manual||_object.multiTween||(_object._cssTween.kill=!0);_this.time=_time,_this.delay=_delay,_object.multiTween&&(_object._cssTweens||(_object._cssTweens=[]),_object._cssTweens.push(_this));_object._cssTween=_this,_this.playing=!0,_props=copy(_startValues),_transformProps=copy(_transformStart),_isCSS&&(_cssTween=tween(_props,_endValues,_time,_ease,_delay,null,_manual).onUpdate(update).onComplete(tweenComplete));_isTransform&&(_transformTween=tween(_transformProps,_transformEnd,_time,_ease,_delay,null,_manual).onComplete(_isCSS?null:tweenComplete).onUpdate(_isCSS?null:update))}()}})),this.stop=function(){this.playing&&(_cssTween&&_cssTween.stop&&_cssTween.stop(),_transformTween&&_transformTween.stop&&_transformTween.stop(),clear())},this.interpolate=function(elapsed){_cssTween&&_cssTween.interpolate(elapsed),_transformTween&&_transformTween.interpolate(elapsed),update()},this.getValues=function(){return{start:_startValues,transformStart:_transformStart,end:_endValues,transformEnd:_transformEnd}},this.setEase=function(ease){_cssTween&&_cssTween.setEase(ease),_transformTween&&_transformTween.setEase(ease)},this.onUpdate=function(){return this},this.onComplete=function(callback){return _callback=callback,this},this.promise=function(){return _this.completePromise||(_this.completePromise=Promise.create()),_this.completePromise}}));class DOMAttribute{constructor({name:name,value:value,belongsTo:belongsTo,bindingLookup:bindingLookup}){this.name=name,this.value=value,this.belongsTo=belongsTo,this.bindingLookup=bindingLookup}}class TemplateRoot{constructor(string,values){this.string=string,this.values=values}consolidate(){let template=this.string;const consolidatedValues={};for(const[marker,value]of Object.entries(this.values))if(value instanceof TemplateHTML){const[innerTemplate,innerValues]=value.consolidate();template=template.replace(marker,innerTemplate),Object.assign(consolidatedValues,innerValues)}else if(Array.isArray(value)){let childTemplate="";for(let k=0;k<value.length;k++){const[innerString,innerValue]=value[k].consolidate();childTemplate+=innerString,Object.assign(consolidatedValues,innerValue)}template=template.replace(marker,childTemplate)}else consolidatedValues[marker]=value;return[template,consolidatedValues]}modifyMarkers(template,config,dataMarkers,bindings){let count=0;return template.replace(/@([a-z]+)="\{\{(hydra-[0-9]+)\}\}"/g,(function(_,event,marker){const dataMarker="data-attach-event-"+count++;return dataMarkers.push(dataMarker),`${dataMarker}="${event}|${marker}"`})).replace(/\{\{hydra-[0-9]+\}\}/g,(function(marker){if(config[marker]&&config[marker].state)return bindings.push({lookup:marker.trim()}),marker;if(config[marker]["@style"]){const styles=config[marker]["@style"];if(!styles||"object"!=typeof styles)return void console.error("@style must contain an object");let styleString="";return Object.keys(styles).forEach((prop=>{const kebabProp=prop.replace(/([a-z0-9]|(?=[A-Z]))([A-Z])/g,"$1-$2").toLowerCase();styleString+=`${kebabProp}: ${styles[prop]};\n`})),styleString}return config[marker]}))}}class TemplateHTML extends TemplateRoot{constructor(string,values){super(string,values)}inflate(root,cssElement){let[template,config]=this.consolidate(),dataMarkers=[],nestedComponents=[],bindings=new LinkedList,scrollTop=root.firstChild?.scrollTop;const t=this.modifyMarkers(template,config,dataMarkers,bindings);for(;root.firstChild;)root.removeChild(root.firstChild);root.flatBindings&&root.flatBindings.forEach((b=>b.destroy())),root.flatBindings=[];let fragment=document.createDocumentFragment(),newNode=DOMTemplate.parser.parseFromString(t,"text/html"),els=newNode.body.firstChild.querySelectorAll("*"),length=els.length;fragment.appendChild(newNode.body.firstChild),cssElement&&fragment.appendChild(cssElement);for(let index=length-1;index>-1;index--){let el=els[index];~el.tagName.indexOf("-")&&nestedComponents.push(el);let innerText=el.innerText,innerHTML=el.innerHTML,attributes=[...el.attributes].map((a=>({name:a.name,value:a.value})));if(~innerHTML.indexOf("<"))continue;let binding=bindings.start();for(;binding;){let bindingLookup=binding.lookup;if(attributes.forEach((attr=>{if(~attr?.value?.indexOf(bindingLookup)){let obj=config[bindingLookup];const attrObject=new DOMAttribute({name:attr.name,value:el.getAttribute(attr.name),belongsTo:el,bindingLookup:bindingLookup});root.flatBindings.push(obj.state.bind(obj.key,attrObject))}})),~innerText.indexOf(bindingLookup)){let obj=config[bindingLookup];~innerText.indexOf("@[")&&(el.innerText=innerText.replace(bindingLookup,obj.key)),root.flatBindings.push(obj.state.bind(obj.key,el))}binding=bindings.next()}}root.appendChild(fragment),dataMarkers.forEach((dataMarker=>{const element=root.querySelector(`[${dataMarker}]`),dataEvent=element.getAttribute(dataMarker),[event,marker]=dataEvent.split("|");element.removeAttribute(dataMarker),element.addEventListener(""+event,config[`{{${marker}}}`])})),defer((()=>{nestedComponents.forEach((template=>{const className=template.tagName.toLowerCase().replace(/(^\w|-\w)/g,(str=>str.replace(/-/,"").toUpperCase()));$("#"+template.id,className,!0).add(new window[className])}))})),scrollTop&&(root.firstChild.scrollTop=scrollTop)}}class TemplateCSS extends TemplateRoot{constructor(string,values){super(string,values)}inflate(root){let[template,config]=this.consolidate(),bindings=new LinkedList,element=document.createElement("style");return element.innerHTML=this.modifyMarkers(template,config,[],bindings),element}}function styleMap(object){return Object.keys(object).map((key=>object[key]?key:"")).join(" ")}!function(){let markerID=0;function makeMarker(){return`{{hydra-${markerID++}}}`}function html(strings,...values){const config={};let string="";for(let i=0;i<strings.length-1;i++){const marker=makeMarker();string+=strings[i],string+=marker,config[marker]=values[i]}return string+=strings[strings.length-1],new TemplateHTML(string,config)}function css(strings,...values){const config={};let string="";for(let i=0;i<strings.length-1;i++){const marker=makeMarker();string+=strings[i],string+=marker,config[marker]=values[i]}return string+=strings[strings.length-1],new TemplateCSS(string,config)}Class((function DOMTemplate(){Inherit(this,Element);const _this=this;if(this.data=[],Hydra.LOCAL&&window.UILSocket){let name=Utils.getConstructorName(_this);_this.events.sub(UILSocket.JS_FILE,(e=>{e.file.includes(name)&&(DOMTemplate.updateGlobalStyles(),_this.update())}))}function update(){let cssContent;_this.dynamicStyle&&(cssContent=_this.dynamicStyle(css).inflate(_this.element.div)),_this.render?.(html).inflate?.(_this.element.div,cssContent),_this.postRender?.()}this.update=function(){DOMTemplate.clearScheduled(update),DOMTemplate.schedule(update)},this.render=function(html){throw new Error("render() needs to be overwritten.")},this.setSourceData=function(data){_this.data=data,this.update(),_this.events.sub(data,Events.UPDATE,this.update)},_this.update()}),(_=>{DOMTemplate.parser=new DOMParser;const queue=[],worker=new Render.Worker((_=>{let callback=queue.shift();callback?callback():worker.pause()}),2);var _css;worker.pause(),DOMTemplate.schedule=function(callback){queue.push(callback),worker.resume()},DOMTemplate.clearScheduled=function(callback){for(let i=0;i<queue.length;i++){if(queue[i]==callback)return queue.splice(i,1)}},DOMTemplate.updateGlobalStyles=function(){Utils.debounce((async _=>{let css=await get(Assets.getPath("assets/css/style-scss.css"));_css||(_css=$(document.head).create("DOMTemplate-hotload","style")),_css.div.innerHTML=css}),20)}}))}(),Class((function Interaction(_object){Inherit(this,Events);const _this=this;var _touchId,_velocity=[],_moved=0,_time=performance.now();function Vec2(){this.x=0,this.y=0,this.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)}}var _vec2Pool=new ObjectPool(Vec2,10);let _distance,_timeDown,_timeMove;function loop(){_moved++>10&&(_this.velocity.x=_this.velocity.y=0,_this.delta.x=_this.delta.y=0)}function down(e){if(_this.isTouching&&!_this.multiTouch||"hit"==e.target.className&&e.target.hydraObject!=_object||Interaction.hitIsBound(e.target,_object))return;_this.isTouching=!0;let x=e.x,y=e.y;e.changedTouches&&(x=e.changedTouches[0].clientX,y=e.changedTouches[0].clientY,_touchId=e.changedTouches[0].identifier),e.touches&&"number"==typeof e.touches[0].force&&(e.force=e.touches[0].force),e.x=_this.x=x,e.y=_this.y=y,_this.hold.x=_this.last.x=x,_this.hold.y=_this.last.y=y,_this.delta.x=_this.move.x=_this.velocity.x=0,_this.delta.y=_this.move.y=_this.velocity.y=0,_distance=0,_this.events.fire(Interaction.START,e,!0),_timeDown=_timeMove=Render.TIME}function move(e){if(!_this.isTouching&&!_this.unlocked)return;let now=performance.now();if(now-_time<16)return;_time=now;let x=e.x,y=e.y;if(e.touches)for(let i=0;i<e.touches.length;i++){let touch=e.touches[i];touch.identifier==_touchId&&(x=touch.clientX,y=touch.clientY)}_this.isTouching&&(_this.move.x=x-_this.hold.x,_this.move.y=y-_this.hold.y),e.touches&&"number"==typeof e.touches[0].force&&(e.force=e.touches[0].force),e.x=_this.x=x,e.y=_this.y=y,_this.delta.x=x-_this.last.x,_this.delta.y=y-_this.last.y,_this.last.x=x,_this.last.y=y,_moved=0,_distance+=_this.delta.length();let delta=Render.TIME-(_timeMove||Render.TIME);if(_timeMove=Render.TIME,delta>.01){let velocity=_vec2Pool.get();velocity.x=Math.abs(_this.delta.x)/delta,velocity.y=Math.abs(_this.delta.y)/delta,_velocity.push(velocity),_velocity.length>5&&_vec2Pool.put(_velocity.shift())}_this.velocity.x=_this.velocity.y=0;for(let i=0;i<_velocity.length;i++)_this.velocity.x+=_velocity[i].x,_this.velocity.y+=_velocity[i].y;_this.velocity.x/=_velocity.length,_this.velocity.y/=_velocity.length,_this.velocity.x=_this.velocity.x||0,_this.velocity.y=_this.velocity.y||0,_this.events.fire(Interaction.MOVE,e,!0),_this.isTouching&&_this.events.fire(Interaction.DRAG,e,!0)}function up(e){if(e&&e.changedTouches)for(let i=0;i<e.changedTouches.length;i++)if(e.changedTouches[i].identifier!=_touchId)return;if(!_this.isTouching&&!_this.unlocked)return;_this.isTouching=!1,_this.move.x=0,_this.move.y=0,Math.max(.001,Render.TIME-(_timeMove||Render.TIME))>100&&(_this.delta.x=0,_this.delta.y=0),_distance<20&&Render.TIME-_timeDown<1e3&&!e.isLeaveEvent&&_this.events.fire(Interaction.CLICK,e,!0),_this.events.fire(Interaction.END,e,!0),Device.mobile&&(_this.velocity.x=_this.velocity.y=0)}function leave(){_this.ignoreLeave||(_this.delta.x=0,_this.delta.y=0,up({isLeaveEvent:!0}))}this.x=0,this.y=0,this.hold=new Vec2,this.last=new Vec2,this.delta=new Vec2,this.move=new Vec2,this.velocity=new Vec2,function(){if(!_object instanceof HydraObject)throw"Interaction.Input requires a HydraObject";!function addHandlers(){_object==Stage||_object==__window?Interaction.bind("touchstart",down):(_object.bind("touchstart",down),Interaction.bindObject(_object));Interaction.bind("touchmove",move),Interaction.bind("touchend",up),Interaction.bind("leave",leave)}(),Render.start(loop)}(),this.onDestroy=function(){Interaction.unbind("touchstart",down),Interaction.unbind("touchmove",move),Interaction.unbind("touchend",up),Render.stop(loop),Interaction.unbindObject(_object),_object&&_object.unbind&&_object.unbind("touchstart",down)}}),(()=>{Namespace(Interaction),Interaction.CLICK="interaction_click",Interaction.START="interaction_start",Interaction.MOVE="interaction_move",Interaction.DRAG="interaction_drag",Interaction.END="interaction_end";const _objects=[],_events={touchstart:[],touchmove:[],touchend:[],leave:[]};function touchMove(e){_events.touchmove.forEach((c=>c(e)))}function touchStart(e){_events.touchstart.forEach((c=>c(e)))}function touchEnd(e){_events.touchend.forEach((c=>c(e)))}function leave(e){e.leave=!0,_events.leave.forEach((c=>c(e)))}Hydra.ready((async()=>{await defer(),__window.bind("touchstart",touchStart),__window.bind("touchmove",touchMove),__window.bind("touchend",touchEnd),__window.bind("touchcancel",touchEnd),__window.bind("contextmenu",touchEnd),__window.bind("mouseleave",leave),__window.bind("mouseout",leave)})),Interaction.bind=function(evt,callback){_events[evt].push(callback)},Interaction.unbind=function(evt,callback){_events[evt].remove(callback)},Interaction.bindObject=function(obj){_objects.push(obj)},Interaction.unbindObject=function(obj){_objects.remove(obj)},Interaction.hitIsBound=function(element,boundObj){let obj=element.hydraObject;if(!obj)return!1;for(;obj;){if(obj!=boundObj&&_objects.includes(obj))return!0;obj=obj._parent}return!1}})),Class((function Mouse(){Inherit(this,Events);const _this=this;this.x=0,this.y=0,this.normal={x:0,y:0},this.tilt={x:0,y:0},this.inverseNormal={x:0,y:0},this.resetOnRelease=!1;const _offset={x:0,y:0};function init(){_this.x=Stage.width/2,_this.y=Stage.height/2,defer((_=>{_this.resetOnRelease&&Device.mobile&&(_this.x=Stage.width/2,_this.y=Stage.height/2)})),_this.input=new Interaction(__window),_this.input.unlocked=!0,_this.events.sub(_this.input,Interaction.START,start),_this.events.sub(_this.input,Interaction.MOVE,update),_this.events.sub(_this.input,Interaction.END,end),_this.hold=_this.input.hold,_this.last=_this.input.last,_this.delta=_this.input.delta,_this.move=_this.input.move,_this.velocity=_this.input.velocity,defer((()=>{_this.events.sub(Events.RESIZE,resize),resize()}))}function start(e){_this.down=!0,update(e)}function update(e){_this.x=e.x,_this.y=e.y,Stage.width&&Stage.height&&(_this.normal.x=e.x/Stage.width-_offset.x,_this.normal.y=e.y/Stage.height-_offset.y,_this.tilt.x=2*_this.normal.x-1,_this.tilt.y=1-2*_this.normal.y,_this.inverseNormal.x=_this.normal.x,_this.inverseNormal.y=1-_this.normal.y)}function end(e){_this.down=!1,Device.mobile&&_this.resetOnRelease&&update({x:Stage.width/2,y:Stage.height/2})}function resize(){Stage.css("top")&&(_offset.y=Stage.css("top")/Stage.height),Stage.css("left")&&(_offset.x=Stage.css("left")/Stage.width)}Hydra.ready(init)}),"Static"),Class((function Keyboard(){Inherit(this,Component);var _this=this;function addListeners(){__window.keydown(keydown),__window.keyup(keyup),__window.keypress(keypress),window.addEventListener("focus",onFocus)}function keydown(e){_this.pressing.includes(e.key)||_this.pressing.push(e.key),_this.events.fire(_this.DOWN,e),2==_this.pressing.length&&_this.pressing.includes("Meta")&&_this.pressing.includes("Shift")&&(_this.pressing.length=0)}function keyup(e){_this.pressing.remove(e.key),_this.events.fire(_this.UP,e)}function keypress(e){_this.events.fire(_this.PRESS,e)}function onFocus(){_this.pressing.length=0}this.pressing=[],_this.DOWN="keyboard_down",_this.PRESS="keyboard_press",_this.UP="keyboard_up",Hydra.ready(addListeners)}),"static"),Class((function Mobile(){Inherit(this,Component),Namespace(this);const _this=this;var $html,$featureDetects,_is100vh=!1;function preventNativeScroll(e){if(_this.isAllowNativeScroll)return;let target=e.target;if("LABEL"==target.nodeName||"INPUT"==target.nodeName||"TEXTAREA"==target.nodeName||"SELECT"==target.nodeName||"A"==target.nodeName)return;let prevent=target.hydraObject;for(;target.parentNode&&prevent;)target._scrollParent&&(prevent=!1),target=target.parentNode;prevent&&e.preventDefault()}function resize(){updateOrientation(),checkResizeRefresh(),updateMobileFullscreen(),_this.isAllowNativeScroll||(document.body.scrollTop=0)}function updateOrientation(){_this.orientation=Stage.width>Stage.height?"landscape":"portrait",_this.orientationSet&&(window.Fullscreen.isOpen||Device.mobile.pwa)&&window.screen&&window.screen.orientation&&window.screen.orientation.lock(_this.orientationSet)}Hydra.ready((()=>{if(Device.mobile){if(function initFeatureDetects(){$featureDetects=__body.create("feature-detects")}(),function addHandlers(){_this.events.sub(Events.RESIZE,resize),Device.mobile.native||window.addEventListener("touchstart",preventNativeScroll,{passive:!1})}(),Device.mobile?.phone&&!Device.mobile.native){$html=$(document.documentElement);let ios="safari"===Device.system.browser;ios?$html.div.classList.add("ios"):$html.div.classList.add("mob"),_is100vh=!0,ios&&(__body.css({height:"100%"}).div.scrollTop=0),updateMobileFullscreen()}Device.mobile.native&&Stage.css({width:"100vw",height:"100vh"})}}));const checkResizeRefresh=function(){let _lastWidth;return function(){_this.isPreventResizeReload||_lastWidth!=Stage.width&&(_lastWidth=Stage.width,("ios"===Device.system.os||"android"==Device.system.os&&Device.system.version>=7)&&(!Device.mobile.tablet||Math.max(Stage.width,Stage.height)>800||window.location.reload()))}}();function updateMobileFullscreen(){if($html){let vh100=$featureDetects.div.offsetHeight;$html.div.offsetHeight!==Stage.height?Stage.height===vh100?($html.css({height:""}),_is100vh=!0):($html.css({height:Stage.height}),_is100vh=!1):_is100vh||Stage.height!==vh100||($html.css({height:""}),_is100vh=!0)}}this.vibrate=function(duration){navigator.vibrate&&navigator.vibrate(duration)},this.fullscreen=function(){if(Device.mobile&&!Device.mobile.native&&!Device.mobile.pwa&&!Dev.emulator){if(!window.Fullscreen)throw"Mobile.fullscreen requires Fullscreen module";"android"!==Device.system.os||Device.detect("oculus")||(__window.bind("touchend",(()=>{Fullscreen.open()})),_this.ScreenLock&&_this.ScreenLock.isActive&&window.onresize())}},this.setOrientation=function(orientation,isForce){if(_this.System&&_this.NativeCore.active)return _this.System.orientation=_this.System[orientation.toUpperCase()];if(_this.orientationSet=orientation,updateOrientation(),isForce){if(!_this.ScreenLock)throw"Mobile.setOrientation isForce argument requires ScreenLock module";"any"===orientation?_this.ScreenLock.unlock():_this.ScreenLock.lock()}},this.isKeyboardOpen=function(){return Device.mobile&&document.activeElement.tagName.toLowerCase().includes(["textarea","input"])},this.allowNativeScroll=function(enabled=!0){_this.isAllowNativeScroll=enabled;let action=enabled?"unset":"";[$(document.documentElement),__body,Stage].forEach(($el=>$el.css({touchAction:action,MSContentZooming:action,MSTouchAction:action})))},this.preventResizeReload=function(){_this.isPreventResizeReload=!0},this._addOverflowScroll=function($obj){$obj.div._scrollParent=!0,Device.mobile.native||($obj.div._preventEvent=function(e){e.stopPropagation()},$obj.bind("touchmove",$obj.div._preventEvent))},this._removeOverflowScroll=function($obj){$obj.unbind("touchmove",$obj.div._preventEvent)},this.get("phone",(()=>{throw"Mobile.phone is removed. Use Device.mobile.phone"})),this.get("tablet",(()=>{throw"Mobile.tablet is removed. Use Device.mobile.tablet"})),this.get("os",(()=>{throw"Mobile.os is removed. Use Device.system.os"})),function(){var _props=["--safe-area-inset-top","--safe-area-inset-right","--safe-area-inset-bottom","--safe-area-inset-left"];function getSafeAreaInset(index){if(!$featureDetects)return 0;let style=getComputedStyle($featureDetects.div);return parseInt(style.getPropertyValue(_props[index]))||0}_this.getSafeAreaInsets=()=>_props.map(((_,i)=>getSafeAreaInset(i))),_this.getSafeAreaInsetTop=()=>getSafeAreaInset(0),_this.getSafeAreaInsetRight=()=>getSafeAreaInset(1),_this.getSafeAreaInsetBottom=()=>getSafeAreaInset(2),_this.getSafeAreaInsetLeft=()=>getSafeAreaInset(3)}()}),"Static"),Class((function PushState(_isHash){const _this=this;let _store,_useInternal,_root="";function getState(){return _useInternal?new String(_store):_isHash?String(window.location.hash.slice(3)):("/"!==_root&&""!==_root?location.pathname.split(_root)[1]:location.pathname.slice(1))||""}function handleStateChange(state,forced){if(state!==_store||forced)if(!_this.isLocked||forced)_store=state,_this.events.fire(Events.UPDATE,{value:state,split:state.split("/")});else{if(!_store)return;_useInternal?_store=_store:_isHash?window.location.hash="!/"+_store:window.history.pushState(null,null,_root+_store)}}"boolean"!=typeof _isHash&&(_isHash=Hydra.LOCAL||!Device.system.pushstate),this.isLocked=!1,function(){if(!_this.flag)throw"Inherit PushState/Router after main class";_this.flag("isNotBlocked",!0),function addHandlers(){if(_isHash)return window.addEventListener("hashchange",(()=>handleStateChange(getState())),!1);window.onpopstate=history.onpushstate=()=>handleStateChange(getState())}(),_store=getState()}(),this.getState=this._getState=function(){return Device.mobile.native?Storage.get("app_state")||"":getState()},this.setRoot=function(root){_root="/"===root.charAt(0)?root:"/"+root},this.setState=this._setState=async function(state,forced){if(_this.events.fire(PushState.SET_STATE),await _this.wait("isNotBlocked"),Device.mobile.native&&Storage.set("app_state",state),state!==_store||forced)return _useInternal?_store=state:_isHash?window.location.hash="!/"+state:window.history.pushState(null,null,_root+state),_this.fireChangeWhenSet&&handleStateChange(getState(),forced),_store=state,!0},this.enableBlocker=function(){_this.flag("isNotBlocked",!1)},this.disableBlocker=function(){_this.flag("isNotBlocked",!0)},this.replaceState=function(state){state!==_store&&(_store=state,_useInternal&&(_store=state),_isHash?window.location.hash="!/"+state:window.history.replaceState(null,null,_root+state))},this.setTitle=function(title){document.title=title},this.lock=function(){this.isLocked=!0,_this.events.fire(PushState.LOCK)},this.unlock=function(){this.isLocked=!1,_this.events.fire(PushState.UNLOCK)},this.useHash=function(){_isHash=!0},this.useInternal=function(){_useInternal=!0}}),(_=>{PushState.SET_STATE="push_state_set_state",PushState.LOCK="push_state_lock",PushState.UNLOCK="push_state_unlock"})),Class((function Router(_isHash,_rootPath){Inherit(this,PushState,_isHash);const _this=this;var _debounce,_prevView,_nextView,_404Route,_routes=[];function matchRoute(path){let matchedRoute=null;return _routes.forEach((routesList=>{const match=routesList.list.find((route=>{if(route.root===path[0]){if(route.pathSplit.length===path.length&&"*"===route.pathSplit[path.length-1])return!0;if(!path[1]&&!route.params)return!0;if(path[1]&&route.params&&!(route.children&&route.children.length>0||path[2]))return!0;if(path[1]&&route.children&&route.children.length>0)return route.children.forEach((c=>{c.active=c.path===path[2]})),!0;if(path[1]&&route.pathSplit.length===path.length){let didMatchAll=!0;if(route.pathSplit.forEach(((pathSplitPath,index)=>{pathSplitPath!==path[index]&&(didMatchAll=!1)})),didMatchAll)return!0}}return!1}));if(match)matchedRoute=match;else if(1===path.length){const paramedRootMatch=routesList.list.find((route=>!(1!==route.pathSplit.length||!route.params)));paramedRootMatch&&(matchedRoute=paramedRootMatch)}})),matchedRoute}function handleState(e){let value=e?.value,split=e?.split;value||(value=_this.getState(),split=value.split("/"));let route=null,cb=null;if(_this.lock(),_routes.forEach((({callback:callback,list:list})=>{route||(route=matchRoute(split),cb=callback)})),route&&route.redirect){let redirectedRoute=matchRoute(route.redirect.split("/"));if(redirectedRoute){if(route.updateURL)return _this.unlock(),void _this.setState(route.redirect);route=redirectedRoute}}route||(route=_404Route),async function doRoute(route,split,callback){_nextView=route.view;let params=null;if(route.params){let param=split.length>=2?split?.[1]:split?.[0];params={[Object.keys(route.params)[0]]:param}}else params=split?.[1];await callback(_prevView,_nextView,split.join("/"),params,route),await(_nextView?.onRouteChange?.({params:params,path:split.join("/"),name:route.name,children:route.children,meta:route.meta})),_prevView=_nextView,_this.currentRoute={...route,params:params},_this.unlock()}(route,split,cb)}_this.currentRoute=null,_this.fireChangeWhenSet=!0,function setRootPath(val){let rootPath;rootPath="string"==typeof _rootPath?_rootPath:Hydra.LOCAL?"":"/",_this.setRoot(rootPath)}(),function initEvents(){_this.events.sub(_this,Events.UPDATE,handleState)}(),this.registerRoutes=function(callback,list){if(list.forEach((element=>{const split=element.path.split("/");if(element.path.startsWith("/"))throw new Error("router paths should not start with /");element.root=split[0],element.pathSplit=split,"404"===element.path&&(_404Route=element),split.forEach((s=>{":"!==s[0]||(element.params={[""+s.substring(1)]:""})}))})),!_404Route)throw new Error('Error: no 404 route defined.  Please define a route whos path is "404" ');_routes.push({callback:callback,list:list}),clearTimeout(_debounce),_debounce=_this.delayedCall(handleState,1)},this.navigate=function(path){path.startsWith("/")&&(path=path.substring(1)),_this.setState(path)},this.replace=function(path){path.startsWith("/")&&(path=path.substring(1)),_this.replaceState(path)}})),Class((function AppState(_default){Inherit(this,Component);const _this=this;var _map=new Map,_bindings=new Map;const iGLUI=!!window.GLUI;class StateBinding{constructor(_keys,_obj){if(this._keys=_keys,this._obj=_obj,this._string="",this._oldValue="",this._type="",this._bindingLookup="",_obj instanceof HTMLElement)"INPUT"==_obj.nodeName?this._string=_obj.value:this._string=_obj.innerText,this._type="HTMLElement";else if(_obj instanceof DOMAttribute)this._string=_obj.value,this._name=_obj.name,this._belongsTo=_obj.belongsTo,this._bindingLookup=_obj.bindingLookup,this._type="DOMAttribute";else if(_obj instanceof HydraObject)"input"==_obj._type?this._string=_obj.val():this._string=_obj.text(),this._type="HydraObject";else if(iGLUI&&_obj instanceof GLUIText)this._string=_obj.getTextString(),this._type="GLUIText";else if(_obj.createLocal&&(this._type="appState"),_obj.onStateChange&&(this._type="class"),"function"==typeof _obj&&(this._type="function"),Array.isArray(_obj)&&_obj.every((el=>"function"==typeof el))){this._type="piped";const lastFunctionInChain=this._obj.pop();this._operators=this._obj,this._obj=lastFunctionInChain,this._count=0}}parse(key,value){if(!this._string||!this._string.includes("@["))return value;let string=this._string;return this._keys.forEach((key=>{string=string.replace(`@[${key}]`,_this.get(key))})),string}async operateOnValue(value){return await this._operators.reduce((async(prev,fn)=>{const prevResolved=await prev;return(await fn)(prevResolved,this._count++,this)}),value)}update(key,value){let newValue=this.parse(key,value);if(newValue!==this._oldValue||value&&value.push){this._oldValue=newValue;try{switch(this._type){case"HTMLElement":"input"==this._obj._type?this._obj.value=newValue:this._obj.innerText=newValue;break;case"DOMAttribute":this._obj.belongsTo.setAttribute(this._obj.name,this._obj.value.replace(this._obj.bindingLookup,newValue));break;case"HydraObject":"input"==this._obj._type?this._obj.val(newValue):this._obj.text(newValue);break;case"GLUIText":this._obj.setText(newValue);break;case"function":this._obj(value);break;case"piped":this.operateOnValue(value).then((val=>this._obj(val)),(reject=>null));break;case"class":this._obj.onStateChange(value);break;case"appState":this._obj.set(key,value)}}catch(err){throw console.warn("AppState binding failed to execute. You should probably be using _this.bindState instead"),err}return!0}}destroy(){this._keys=null,this._obj=null,this._string=null,this._oldValue=null,this._type=null,this._operators=null,this._count=null,this.update=()=>null}}this.set=function(key,value){if(_this.flag("readonly"))return console.warn("This AppState is locked and can not make changes");_map.set(key,value),_this.onUpdate&&_this.onUpdate();let array=_bindings.get(key);if(array){let len=array.length;for(let i=0;i<len;i++){let b=array[i];b&&b.update?b.update(key,value):array.remove(b)}}},this.get=function(key){return _map.get(key)},this.getMap=function(){return _map},this.toJSON=function(){return Object.fromEntries(_map)},this.bind=function(keys,...rest){if(!rest.length)return{state:_this,key:keys};Array.isArray(keys)||(keys=[keys]);const obj=1===rest.length?rest[0]:rest;let binding=new StateBinding(keys,obj);return keys.forEach((key=>{_bindings.has(key)?_bindings.get(key).push(binding):_bindings.set(key,[binding]);let value=_map.get(key);void 0!==value&&binding.update(key,value)})),binding},this.createLocal=function(obj){let appState=new AppState(obj);return new Proxy(appState,{set:(target,property,value)=>("origin"===property?appState[property]=value:appState.set(property,value),!0),get:(target,property)=>target[property]?target[property]:appState.get(property)})},this.setAll=function(obj){for(let key in obj)_this.set(key,obj[key])},this.lock=function(){_this.flag("readonly",!0)},this.unlock=function(){_this.flag("readonly",!1)},_default&&this.setAll(_default)}),"static"),Class((function AppStateOperators(_default){Inherit(this,Component),this.map=fn=>value=>fn(value),this.tap=fn=>value=>(fn(value),value),this.filter=fn=>(value,emittedCount)=>fn(value,emittedCount)?value:Promise.reject(),this.skip=skipCount=>this.filter(((_,emittedCount)=>skipCount<=emittedCount)),this.untilDestroyed=ctx=>{let checked=!1;return(value,_,binding)=>(checked||(checked=!0,ctx._bindOnDestroy((_=>{Hydra.LOCAL&&console.log("binding destroyed "),binding.destroy?.()}))),value)}}),"static"),Class((function AppStore(){const _this=this;this.state=AppState.createLocal();const _mutations={},_actions={};let _subscribers=[],_actionSubscribers=[];function registerMutation(type,handler){(_mutations[type]||(_mutations[type]=[])).push((function wrappedMutationHandler(payload){handler.call(_this,_this.state,payload)}))}function registerAction(type,handler){(_actions[type]||(_actions[type]=[])).push((function wrappedActionHandler(payload){let res=handler.call(_this,{dispatch:_this.dispatch,commit:_this.commit,state:_this.state,rootState:_this.state},payload);return function isPromise(val){return val&&"function"==typeof val.then}(res)||(res=Promise.resolve(res)),res}))}function genericSubscribe(fn,subscribers,options){return subscribers.indexOf(fn)<0&&(options&&options.prepend?subscribers.unshift(fn):subscribers.push(fn)),()=>{const i=subscribers.indexOf(fn);i>-1&&subscribers.splice(i,1)}}this.createAppStore=function(_params){!function setInitState(_params){const{state:state}=_params;for(let key in state)_this.state.set(key,state[key])}(_params),function mapMutations(_params){const{mutations:mutations}=_params;for(let key in mutations)registerMutation(key,mutations[key])}(_params),function mapActions(_params){const{actions:actions}=_params;for(let key in actions)registerAction(key,actions[key])}(_params)},this.commit=function(type,payload){const mutation={type:type,payload:payload},entry=_mutations[type];entry?(entry.forEach((function commitIterator(handler){handler(payload)})),_subscribers.slice().forEach((sub=>sub(mutation,this.state)))):Hydra.LOCAL&&console.error("Error: no mutation for type "+type)},this.dispatch=function(type,payload){const action={type:type,payload:payload},entry=_actions[type];entry||Hydra.LOCAL&&console.error("Error: no action for type "+type);try{_actionSubscribers.slice().filter((sub=>sub.before)).forEach((sub=>sub.before(action,_this.state)))}catch(e){Hydra.LOCAL&&(console.warn("Error in before action subscribers: "),console.error(e))}const result=entry.length>1?Promise.all(entry.map((handler=>handler(payload)))):entry[0](payload);return new Promise(((resolve,reject)=>{result.then((res=>{try{_actionSubscribers.filter((sub=>sub.after)).forEach((sub=>sub.after(action,_this.state)))}catch(e){Hydra.LOCAL&&(console.warn("Error in after action subscribers: "),console.error(e))}resolve(res)}),(error=>{try{_actionSubscribers.filter((sub=>sub.error)).forEach((sub=>sub.error(action,_this.state,error)))}catch(e){Hydra.LOCAL&&(console.warn("Error in error action subscribers: "),console.error(e))}reject(error)}))}))},this.subscribeAction=function(key,fn,options){let subs={};return"function"==typeof fn?subs.before=function subscriberEmptyBeforeWrapper(action){action.type===key&&fn(action)}:(fn.before&&(subs.before=function subscriberBeforeWrapper(action){action.type===key&&fn.before(action)}),fn.after&&(subs.after=function subscriberAfterWrapper(action){action.type===key&&fn.after(action)})),genericSubscribe(subs,_actionSubscribers,options)},this.subscribe=function(key,fn,options){return genericSubscribe((function subscriberWrapper(mutation){mutation.type===key&&fn(mutation)}),_subscribers,options)},this.bind=this.state.bind,this.watch=this.state.bind,this.get=this.state.get})),Class((function StateArray(_src=[],_filterFn=null){Inherit(this,Events);const _this=this;var _data=[];if(Object.defineProperty(_this,"length",{get:function(){return _data.length}}),this.setFilter=function(fn,refresh=!0){_filterFn=fn,refresh&&this.refresh(_data.filter(fn))},this.push=function(obj){if(_filterFn&&!_filterFn(obj))return;let state=function wrap(obj){if(obj.createLocal)return obj;if("object"!=typeof obj||Array.isArray(obj))throw"StateArray entries must be {objects}!";obj._uid||(obj._uid=Utils.uuid());let state=AppState.createLocal();for(let key in obj)state.set(key,obj[key]);return state.origin=obj,state}(obj);_data.push(state);let index=_data.length-1;return void 0===_this[index]&&Object.defineProperty(_this,index,{set:function(v){for(let key in v)_data[index].set(key,v[key])},get:function(){return _data[index]}}),_this.events.fire(Events.UPDATE,{type:"add",state:state}),state},this.remove=function(obj){for(let i=0;i<_data.length;i++){let state=_data[i];state.origin!==obj&&state!==obj||(_data.splice(i,1),_this.events.fire(Events.UPDATE,{type:"remove",state:state},!0))}},this.update=async function(obj){var _found=!1;for(let i=0;i<_data.length;i++){var state=_data[i];if(state.origin._uid===obj._uid||state._uid===obj._uid)return await state.setAll(obj),_this.events.fire(Events.UPDATE,{type:"modify",state:state,index:i}),_found=!0}return _found},this.forEach=function(cb){_data.forEach((function(...args){return cb.apply(this,args)}))},this.map=function(cb){let array=[];return _data.forEach((function(...args){return array.push(cb.apply(this,args))})),array},this.toJSON=function(){let array=[];return _data.forEach((appState=>{array.push(appState.toJSON())})),array},this.getMap=function(){let array=[];return _data.forEach((appState=>{array.push(appState.getMap())})),array},this.indexOf=function(obj){for(let i=0;i<_data.length;i++){let state=_data[i];if(state.origin===obj||state===obj)return i}},this.refresh=function(array){if(_this.events.fire(StateArray.REFRESH,{type:"refresh"},!0),!Array.isArray(array))throw"StateArray can only take an array as a parameter";let i=_data.length;for(;i--;){let state=_data.pop();_this.events.fire(Events.UPDATE,{type:"remove",state:state},!0)}_data.length=0,array.forEach(_this.push)},this.reflow=function(){this.refresh(_data.map((d=>d.origin)))},!Array.isArray(_src))throw"StateArray can only take an array as a parameter";_src.forEach(_this.push)}),(_=>{StateArray.REFRESH="state_array_refresh"})),Class((function ViewState(ViewClass,...rest){const _this=this;var _stateArray,_instances=this.views=[];function remove(data){for(let i=0;i<_instances.length;i++){let inst=_instances[i];if(data==inst.data){_this.onRemoveView?.(inst,i),_instances.splice(i,1),0===_instances.length&&_this.onEmpty?.();break}}ViewState.clearScheduled(data)}function dataUpdate(e){switch(e.type){case"add":_this.dataFilter(e.state)&&ViewState.schedule(_this,ViewClass,e.state,_stateArray.indexOf(e.state),rest);break;case"remove":remove(e.state);break;case"modify":_this.dataFilter(e.state)?function update(data,index){var _exists=!1;for(let i=0;i<_instances.length;i++){let inst=_instances[i];if(data._uid===inst.data._uid)return _this.onUpdateView?.(_instances[i],i),void(_exists=!0)}_exists||ViewState.schedule(_this,ViewClass,data,_stateArray.indexOf(data))}(e.state,e.index):remove(e.state)}}this.setSourceData=function(array){if(!(array instanceof StateArray))throw"ViewState::setSourceData must be instance of StateArray";_stateArray=_this.stateArray=array,_this.events.sub(array,Events.UPDATE,dataUpdate),array.forEach((state=>{_this.dataFilter(state)&&ViewState.schedule(_this,ViewClass,state,_stateArray.indexOf(state),rest)}))},this.dataFilter=function(data){return!0},this.onInitialize=function(instance){_instances.push(instance),_this.onAddView?.(instance,_instances.length-1)}}),(_=>{const queue=[],worker=new Render.Worker((_=>{let obj=queue.shift();if(obj){let{ref:ref,ViewClass:ViewClass,data:data,index:index,additionalArgs:additionalArgs}=obj;if(!ref.initClass)return;let args=[];additionalArgs.forEach((arg=>{args.push(...arg)}));let inst=ref.initClass(ViewClass,data,index,...args);inst.data=data,ref.onInitialize(inst)}else worker.pause()}),2);worker.pause(),ViewState.clearScheduled=function(data){for(let i=0;i<queue.length;i++){if(queue[i].data===data)return queue.splice(i,1)}},ViewState.schedule=function(ref,ViewClass,data,index,...rest){ref.initClass&&(queue.push({ref:ref,ViewClass:ViewClass,data:data,index:index,additionalArgs:rest}),worker.resume())}})),Class((function StateComponent(){const _this=this;let _mutationsUnsubscribers=[],_actionsUnsubscribers=[];this.unsubscribeMutations=function(){_mutationsUnsubscribers.forEach((u=>u()))},this.unsubscribeActions=function(){_actionsUnsubscribers.forEach((u=>u()))},this.unsubscribeAll=function(){_this.unsubscribeMutations(),_this.unsubscribeActions()},this.subscribeMutation=function(store,type,fn){_mutationsUnsubscribers.push(store.subscribe(type,fn))},this.subscribeAction=function(store,type,fn){_actionsUnsubscribers.push(store.subscribeAction(type,fn))},this.commit=function(store,type,payload){store.commit(type,payload)},this.dispatch=async function(store,type,payload){await store.dispatch(type,payload)},this.getState=function(store,key){return store.get(key)},this.watch=function(store,key,fn,callInitial=!0){let hasCalled=!1;const callback=params=>{hasCalled||callInitial?fn(params):hasCalled=!0};return _this.bindState?_this.bindState(store,key,callback):store.watch(key,callback)},this.bind=this.watch,"function"==typeof this._bindOnDestroy&&this._bindOnDestroy((()=>{_this.unsubscribeAll()}))})),Class((function Dev(){const _this=this;let _post,_inter,_timerName;Utils.timestamp();function postError(error){let device={gpu:Device.graphics.webgl?Device.graphics.webgl.gpu:"WEBGL UNAVAILABLE",version:Device.graphics.webgl?Device.graphics.webgl.version:"WEBGL UNAVAILABLE",tier:window.GPU?Device.mobile?GPU.M_TIER:GPU.TIER:"",mobile:JSON.stringify(Device.mobile),userAgent:Device.agent,dpr:Device.pixelRatio,screenSize:`${screen.width} x ${screen.height}`,stageSize:`${Stage.width} x ${Stage.height}`,href:window.location.href},tests={};try{if(window.Tests)for(let key in Tests)"function"==typeof Tests[key]&&(tests[key]=Tests[key]())}catch(e){}post(_post,{error:error,device:device,tests:tests}).catch((function(){Hydra.LOCAL&&console.log("Error whle posting to server")}))}this.emulator=Device.mobile&&navigator.platform&&navigator.platform.toLowerCase().includes(["mac","windows"]),this.postErrorsToServer=function(server){_post=server,function catchErrors(){window.onerror=function(message,file,line,column,e){postError({message:message,file:file,line:line,column:column,stack:e&&e.stack.toString()})},window.addEventListener("unhandledrejection",(e=>{postError({type:"unhandledrejection",message:e.reason.message,stack:e.reason.stack})}))}()},this.expose=function(name,val,force){(Hydra.LOCAL||force)&&(window[name]=val)},this.unsupported=function(needsAlert){needsAlert&&alert("Hi! This build is not yet ready for this device, things may not work as expected. Refer to build schedule for when this device will be supported.")},this.checkForLeaks=function(flag,array){if(!window.AURA){var matchArray=function(prop){if(!array)return!1;for(var i=0;i<array.length;i++)if(prop.includes(array[i]))return!0;return!1};clearInterval(_inter),flag&&(_inter=setInterval((function(){for(var prop in window){if(!prop.includes("webkit"))if("function"!=typeof window[prop]&&prop.length>2){if(prop.includes("_ga")||prop.includes("_typeface_js")||prop.includes("_xdc_")||matchArray(prop))continue;var char1=prop.charAt(0),char2=prop.charAt(1);if(("_"==char1||"$"==char1)&&char2!==char2.toUpperCase())throw console.log(window[prop]),"Hydra Warning:: "+prop+" leaking into global scope"}}}),1e3))}},this.startTimer=function(name){_timerName=name||"Timer",console.time&&!window._NODE_?console.time(_timerName):_timer=performance.now()},this.stopTimer=function(){console.time&&!window._NODE_?console.timeEnd(_timerName):console.log("Render "+_timerName+": "+(performance.now()-_timer))},this.writeFile=function(file,data){let promise=Promise.create(),protocol=location.protocol,port="https:"===protocol?":8018":":8017",url=protocol+"//"+location.hostname+port+location.pathname+file;return post(url,data,{headers:{"content-type":"text/plain"}}).then((e=>{"OK"!=e?(console.warn("Unable to write to "+file),promise.reject()):promise.resolve()})),promise},this.execUILScript=async function(name,data){if(!Hydra.LOCAL)return;let url=`${location.protocol}//${location.hostname}:8017${_this.pathName||location.pathname}/uil/${name}`,response=await post(url,data,{headers:{"Content-Type":"text/plain"}});if("ERROR"===response||!1===response.success)throw response;return response},Hydra.LOCAL&&_this.checkForLeaks(!0)}),"static"),Class((function Service(){Inherit(this,Component);var _sw,_this=this;function getSWAssets(){if(!window.ASSETS.SW||_this.cached)return[];var assets=window.ASSETS.SW;return assets.forEach(((asset,i)=>{asset.includes(".js")&&(asset=assets[i].replace(".js",".js?"+window._CACHE_))})),assets}function handleRegistration(e){}function handleReady(e){_this.isReady=!0,_this.events.fire(Events.READY,e,!0),_sw=navigator.serviceWorker.controller,function checkCache(){Storage.get("service_cache")!=window._CACHE_&&_this.post("clearCache")}()}function handleError(e){e&&(_this.events.fire(Events.ERROR,e,!0),_this.active=!1)}function handleMessage(e){var data=e.data;data.evt&&_this.events.fire(data.evt,data)}this.active=!1,this.ready=!1,this.cached=!1,this.offline=!1,this.disabled=!1,this.ready=function(){return this.wait(this,"isReady")},this.init=function(){Hydra.ready((()=>{!("serviceWorker"in navigator)||Hydra.LOCAL&&""==location.port||window.process||_this.disabled||function initWorker(){_this.active=!0,navigator.serviceWorker.register((window._SW_PATH_?window._SW_PATH_:"")+"sw.js").then(handleRegistration).then(handleReady).then(handleError)}()}))},this.cache=function(assets=[]){assets=Array.from(assets);_this.active&&_this.wait(_this,"ready",(function(){_this.post("upload",{assets:assets,cdn:Assets.CDN,hostname:location.hostname,sw:getSWAssets(),offline:_this.offline}),Storage.set("service_cache",window._CACHE_),_this.cached=!0}))},this.post=function(fn,data={}){if(!_this.active)return;_this.wait(_this,"ready",(function(){let mc=new MessageChannel;mc.port1.onmessage=handleMessage,data.fn=fn,_sw&&_sw.postMessage(data,[mc.port2])}))}}),"static"),Class((function Storage(){var _storage,_this=this,_sessionData={};function cookie(key,value,expires){var options;if(arguments.length>1&&(null===value||"object"!=typeof value)){if((options={}).path="/",options.expires=expires||1,null===value&&(options.expires=-1),"number"==typeof options.expires){var days=options.expires,t=options.expires=new Date;t.setDate(t.getDate()+days)}return document.cookie=[encodeURIComponent(key),"=",options.raw?String(value):encodeURIComponent(String(value)),options.expires?"; expires="+options.expires.toUTCString():"",options.path?"; path="+options.path:"",options.domain?"; domain="+options.domain:"",options.secure?"; secure":""].join("")}var result,decode=(options=value||{}).raw?function(s){return s}:decodeURIComponent;return(result=new RegExp("(?:^|; )"+encodeURIComponent(key)+"=([^;]*)").exec(document.cookie))?decode(result[1]):null}this.noTracking=!1,function testStorage(){try{if(window.localStorage)try{window.localStorage.test=1,window.localStorage.removeItem("test"),_storage=!0}catch(e){_storage=!1}else _storage=!1}catch(e){_storage=!1}}(),this.setCookie=function(key,value,expires){cookie(key,value,expires)},this.getCookie=function(key){return cookie(key)},this.set=function(key,value){_this.noTracking?_sessionData[key]=value:(null!=value&&"object"==typeof value&&(value=JSON.stringify(value)),_storage?null===value?window.localStorage.removeItem(key):window.localStorage[key]=value:cookie(key,value,365))},this.get=function(key){if(_this.noTracking)return _sessionData[key];var val,char0;(val=_storage?window.localStorage[key]:cookie(key))&&(val.charAt&&(char0=val.charAt(0)),"{"!=char0&&"["!=char0||(val=JSON.parse(val)),"true"!=val&&"false"!=val||(val="true"==val));return val}}),"Static"),Class((function Thread(_class){Inherit(this,Component);var _this=this,_worker,_callbacks,_path,_mvc,_msg={};function init(){let file=window._ES5_?"/hydra-thread-es5.js":"/hydra-thread.js";_callbacks={},_worker=new Worker(Thread.PATH+file)}function importClasses(){importClass(Utils),importClass(Component),importClass(Events),importClass(_class,!0),importES5()}function importClass(_class,scoped){if(_class){var code;if(scoped){code=(code=_class.toString().replace("{","!!!")).split("!!!")[1];for(var splitChar=window._MINIFIED_?"=":" ";code.includes("this.");){var name=code.slice(code.indexOf("this.")).split("this.")[1].split(splitChar)[0];code=code.replace("this","self"),createMethod(name)}code=(code=code.slice(0,-1)).replace(/_self/g,"_this")}else if("function"!=typeof _class){if((code=_class.constructor.toString()).includes("[native"))return;code=(_class._namespace?_class._namespace+".":"")+"Class("+code+', "static");'}else code=(_class._namespace?_class._namespace+".":"")+"Class("+_class.toString()+");";_worker.postMessage({code:code})}}function createMethod(name){_this[name]=function(message={},callback,buffer){let promise;return Array.isArray(callback)&&(buffer=callback,callback=void 0),Array.isArray(buffer)&&((message={msg:message,transfer:!0}).buffer=buffer),void 0===callback&&(promise=Promise.create(),callback=promise.resolve),_this.send(name,message,callback),promise}}function importES5(){window._ES5_&&(["_createSuper","_isNativeReflectConstruct"].forEach((name=>{let code=window[name].toString();code.includes("[native")||_worker.postMessage({code:code})})),_worker.postMessage({code:"function _getPrototypeOf(o){_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(o){return o.__proto__||Object.getPrototypeOf(o);};return _getPrototypeOf(o);}"}))}function addListeners(){_worker.addEventListener("message",workerMessage)}function workerMessage(e){if(e.data.console)console.log(e.data.message);else if(e.data.id){(callback=_callbacks[e.data.id])&&callback(e.data.message),delete _callbacks[e.data.id]}else if(e.data.emit){(callback=_callbacks[e.data.evt])&&callback(e.data.msg)}else{var callback;(callback=_callbacks.transfer)&&callback(e.data)}}init(),importClasses(),addListeners(),this.on=function(evt,callback){_callbacks[evt]=callback},this.off=function(evt){delete _callbacks[evt]},this.loadFunction=function(){let names=[],load=code=>{var split=(code=(code=code.toString()).replace("(","!!!")).split("!!!"),name=split[0].split(" ")[1];code="self."+name+" = function("+split[1],_worker.postMessage({code:code}),createMethod(name),names.push(name)};for(var i=0;i<arguments.length;i++)load(arguments[i]);return names},this.importScript=function(path){_worker.postMessage({path:Thread.absolutePath(path),importScript:!0})},this.importCode=function(code){_worker.postMessage({code:code})},this.importClass=function(){for(var i=0;i<arguments.length;i++){var code=arguments[i];importClass(code)}},this.importModules=this.importModule=function(){for(var i=0;i<arguments.length;i++){let code=Modules.getConstructor(arguments[i]).toString();_worker.postMessage({code:`Module(${code})`})}},this.importES6Class=function(name){if(window._ES5_){let Class=window[name],base=Class.toString(),proto=[],sup,matches=/(_this\w+)\s*=\s*(_super\w+)\.call/g.exec(base);if(matches){let superVar=matches[2],superConstructor=Object.getPrototypeOf(Class);if(!superConstructor.toString().includes("[native")){let superName=Utils.getConstructorName(superConstructor);sup=`_inherits(${name}, ${superName}); var ${superVar} = _createSuper(${name});`}}Object.getOwnPropertyNames(Class.prototype).forEach((fn=>{"constructor"!=fn&&Class.prototype[fn]&&proto.push({key:fn,string:Class.prototype[fn].toString()})})),_worker.postMessage({es5:base,name:name,proto:proto,sup:sup})}else _worker.postMessage({es6:`(${eval(name)})`,name:name})},this.send=function(name,message,callback){if("string"==typeof name){(message=message||{}).fn=name}else callback=message,message=name;Thread.UNIQUE_ID>999999&&(Thread.UNIQUE_ID=1);var id=Thread.UNIQUE_ID++;callback&&(_callbacks[id]=callback),message.transfer?(message.msg.id=id,message.msg.fn=message.fn,message.msg.transfer=!0,_worker.postMessage(message.msg,message.buffer)):(_msg.message=message,_msg.id=id,_worker.postMessage(_msg))},this.onDestroy=function(){_worker.terminate&&_worker.terminate()}}),(()=>{var _shared;Thread.PATH=window._THREAD_PATH_||"assets/js/hydra",Thread.UNIQUE_ID=1,Thread.absolutePath=Hydra.absolutePath,Thread.cluster=function(){return new function(){let index=0,array=[];this.push=function(thread){array.push(thread)},this.get=function(){let thread=array[index];return index++,index>=array.length&&(index=0),thread},this.array=array}},Thread.upload=function(...args){let name;Thread.shared();for(let i=0;i<_shared.array.length;i++)name=_shared.array[i].loadFunction(...args);return name},Thread.uploadClass=function(...args){let name;Thread.shared();for(let i=0;i<_shared.array.length;i++)name=_shared.array[i].importClass(...args);return name},Thread.shared=function(list){if(!_shared){_shared=Thread.cluster();let hardware=navigator.hardwareConcurrency||4,count=Math.max(Math.min(hardware,8),4);for(let i=0;i<count;i++)_shared.push(new Thread)}return list?_shared:_shared.get()}})),Class((function TweenManager(){Namespace(this);var _this=this,_tweens=[];function updateTweens(time,dt){for(let i=_tweens.length-1;i>=0;i--){let tween=_tweens[i];tween.update?tween.update(dt):_this._removeMathTween(tween)}}function findEase(name){for(var eases=_this.CubicEases,i=eases.length-1;i>-1;i--)if(eases[i].name==name)return eases[i];return!1}this.CubicEases=[],Render.start(updateTweens),this._addMathTween=function(tween){_tweens.push(tween)},this._removeMathTween=function(tween){_tweens.remove(tween)},this._getEase=function(name,values){var ease=findEase(name);return!!ease&&(values?ease.path?ease.path.solve:ease.values:ease.curve)},this._inspectEase=function(name){return findEase(name)},this.tween=function(object,props,time,ease,delay,complete,isManual,scaledTime){"number"!=typeof delay&&(update=complete,complete=delay,delay=0);const tween=new MathTween(object,props,time,ease,delay,complete,isManual,scaledTime);let usePromise=null;return complete&&complete instanceof Promise&&(usePromise=complete,complete=complete.resolve),usePromise||tween},this.clearTween=function(object){if(object._mathTween&&object._mathTween.stop&&object._mathTween.stop(),object._mathTweens){for(var tweens=object._mathTweens,i=0;i<tweens.length;i++){var tw=tweens[i];tw&&tw.stop&&tw.stop()}object._mathTweens=null}},this.addCustomEase=function(ease){var add=!0;if("object"!=typeof ease||!ease.name||!ease.curve)throw"TweenManager :: addCustomEase requires {name, curve}";for(var i=_this.CubicEases.length-1;i>-1;i--)ease.name==_this.CubicEases[i].name&&(add=!1);if(add){if("m"==ease.curve.charAt(0).toLowerCase()){if(!window.EasingPath)throw"Using custom eases requires easingpath module";ease.path=new EasingPath(ease.curve)}else ease.values=function stringToValues(str){for(var values=str.split("(")[1].slice(0,-1).split(","),i=0;i<values.length;i++)values[i]=parseFloat(values[i]);return values}(ease.curve);_this.CubicEases.push(ease)}return ease},Math.interpolate=function(start,end,alpha,ease){const fn=_this.Interpolation.convertEase(ease);return Math.mix(start,end,"function"==typeof fn?fn(alpha):_this.Interpolation.solve(fn,alpha))},window.tween=this.tween,window.clearTween=this.clearTween}),"Static"),TweenManager.Class((function Interpolation(){function calculateBezier(aT,aA1,aA2){return((A(aA1,aA2)*aT+B(aA1,aA2))*aT+C(aA1))*aT}function A(aA1,aA2){return 1-3*aA2+3*aA1}function B(aA1,aA2){return 3*aA2-6*aA1}function C(aA1){return 3*aA1}this.convertEase=function(ease){var fn=function(){switch(ease){case"easeInQuad":return TweenManager.Interpolation.Quad.In;case"easeInCubic":return TweenManager.Interpolation.Cubic.In;case"easeInQuart":return TweenManager.Interpolation.Quart.In;case"easeInQuint":return TweenManager.Interpolation.Quint.In;case"easeInSine":return TweenManager.Interpolation.Sine.In;case"easeInExpo":return TweenManager.Interpolation.Expo.In;case"easeInCirc":return TweenManager.Interpolation.Circ.In;case"easeInElastic":return TweenManager.Interpolation.Elastic.In;case"easeInBack":return TweenManager.Interpolation.Back.In;case"easeInBounce":return TweenManager.Interpolation.Bounce.In;case"easeOutQuad":return TweenManager.Interpolation.Quad.Out;case"easeOutCubic":return TweenManager.Interpolation.Cubic.Out;case"easeOutQuart":return TweenManager.Interpolation.Quart.Out;case"easeOutQuint":return TweenManager.Interpolation.Quint.Out;case"easeOutSine":return TweenManager.Interpolation.Sine.Out;case"easeOutExpo":return TweenManager.Interpolation.Expo.Out;case"easeOutCirc":return TweenManager.Interpolation.Circ.Out;case"easeOutElastic":return TweenManager.Interpolation.Elastic.Out;case"easeOutBack":return TweenManager.Interpolation.Back.Out;case"easeOutBounce":return TweenManager.Interpolation.Bounce.Out;case"easeInOutQuad":return TweenManager.Interpolation.Quad.InOut;case"easeInOutCubic":return TweenManager.Interpolation.Cubic.InOut;case"easeInOutQuart":return TweenManager.Interpolation.Quart.InOut;case"easeInOutQuint":return TweenManager.Interpolation.Quint.InOut;case"easeInOutSine":return TweenManager.Interpolation.Sine.InOut;case"easeInOutExpo":return TweenManager.Interpolation.Expo.InOut;case"easeInOutCirc":return TweenManager.Interpolation.Circ.InOut;case"easeInOutElastic":return TweenManager.Interpolation.Elastic.InOut;case"easeInOutBack":return TweenManager.Interpolation.Back.InOut;case"easeInOutBounce":return TweenManager.Interpolation.Bounce.InOut;case"linear":return TweenManager.Interpolation.Linear.None}}();if(!fn){var curve=TweenManager._getEase(ease,!0);fn=curve||TweenManager.Interpolation.Cubic.Out}return fn},this.solve=function(values,elapsed){return values[0]==values[1]&&values[2]==values[3]?elapsed:calculateBezier(function getTForX(aX,mX1,mX2){for(var aT,aA1,aA2,aGuessT=aX,i=0;i<4;i++){var currentSlope=(aT=aGuessT,3*A(aA1=mX1,aA2=mX2)*aT*aT+2*B(aA1,aA2)*aT+C(aA1));if(0==currentSlope)return aGuessT;aGuessT-=(calculateBezier(aGuessT,mX1,mX2)-aX)/currentSlope}return aGuessT}(elapsed,values[0],values[2]),values[1],values[3])},this.Linear={None:function(k){return k}},this.Quad={In:function(k){return k*k},Out:function(k){return k*(2-k)},InOut:function(k){return(k*=2)<1?.5*k*k:-.5*(--k*(k-2)-1)}},this.Cubic={In:function(k){return k*k*k},Out:function(k){return--k*k*k+1},InOut:function(k){return(k*=2)<1?.5*k*k*k:.5*((k-=2)*k*k+2)}},this.Quart={In:function(k){return k*k*k*k},Out:function(k){return 1- --k*k*k*k},InOut:function(k){return(k*=2)<1?.5*k*k*k*k:-.5*((k-=2)*k*k*k-2)}},this.Quint={In:function(k){return k*k*k*k*k},Out:function(k){return--k*k*k*k*k+1},InOut:function(k){return(k*=2)<1?.5*k*k*k*k*k:.5*((k-=2)*k*k*k*k+2)}},this.Sine={In:function(k){return 1-Math.cos(k*Math.PI/2)},Out:function(k){return Math.sin(k*Math.PI/2)},InOut:function(k){return.5*(1-Math.cos(Math.PI*k))}},this.Expo={In:function(k){return 0===k?0:Math.pow(1024,k-1)},Out:function(k){return 1===k?1:1-Math.pow(2,-10*k)},InOut:function(k){return 0===k?0:1===k?1:(k*=2)<1?.5*Math.pow(1024,k-1):.5*(2-Math.pow(2,-10*(k-1)))}},this.Circ={In:function(k){return 1-Math.sqrt(1-k*k)},Out:function(k){return Math.sqrt(1- --k*k)},InOut:function(k){return(k*=2)<1?-.5*(Math.sqrt(1-k*k)-1):.5*(Math.sqrt(1-(k-=2)*k)+1)}},this.Elastic={In:function(k,a=1,p=.4){var s;return 0===k?0:1===k?1:(!a||a<1?(a=1,s=p/4):s=p*Math.asin(1/a)/(2*Math.PI),-a*Math.pow(2,10*(k-=1))*Math.sin((k-s)*(2*Math.PI)/p))},Out:function(k,a=1,p=.4){var s;return 0===k?0:1===k?1:(!a||a<1?(a=1,s=p/4):s=p*Math.asin(1/a)/(2*Math.PI),a*Math.pow(2,-10*k)*Math.sin((k-s)*(2*Math.PI)/p)+1)},InOut:function(k,a=1,p=.4){var s;return 0===k?0:1===k?1:(!a||a<1?(a=1,s=p/4):s=p*Math.asin(1/a)/(2*Math.PI),(k*=2)<1?a*Math.pow(2,10*(k-=1))*Math.sin((k-s)*(2*Math.PI)/p)*-.5:a*Math.pow(2,-10*(k-=1))*Math.sin((k-s)*(2*Math.PI)/p)*.5+1)}},this.Back={In:function(k){var s=1.70158;return k*k*((s+1)*k-s)},Out:function(k){var s=1.70158;return--k*k*((s+1)*k+s)+1},InOut:function(k){var s=2.5949095;return(k*=2)<1?k*k*((s+1)*k-s)*.5:.5*((k-=2)*k*((s+1)*k+s)+2)}},this.Bounce={In:function(k){return 1-this.Bounce.Out(1-k)},Out:function(k){return k<1/2.75?7.5625*k*k:k<2/2.75?7.5625*(k-=1.5/2.75)*k+.75:k<2.5/2.75?7.5625*(k-=2.25/2.75)*k+.9375:7.5625*(k-=2.625/2.75)*k+.984375},InOut:function(k){return k<.5?.5*this.Bounce.In(2*k):.5*this.Bounce.Out(2*k-1)+.5}}}),"Static"),Class((function MathTween(_object,_props,_time,_ease,_delay,_callback,_manual,_scaledTime){var _startTime,_startValues,_endValues,_easeFunction,_paused,_newEase,_spring,_damping,_update,_currentTime,_this=this,_elapsed=0;function clear(){if(!_object&&!_props)return!1;_object._mathTween=null,TweenManager._removeMathTween(_this),Utils.nullObject(_this),_object._mathTweens&&_object._mathTweens.remove(_this._tweenWrapper)}_this.object=_object,_this.props=_props,_this.time=_time,_this.ease=_ease,_this.delay=_delay,defer((function(){if(!_this.stopped){if(_this.overrideValues){let values=_this.overrideValues(_this,_object,_props,_time,_ease,_delay);values&&(_this.props=_props=values.props||_props,_this.time=_time=values.time||_time,_this.ease=_ease=values.ease||_ease,_this.delay=_delay=values.delay||_delay)}if(_object&&_props){if(_this.object=_object,"number"!=typeof _time)throw"MathTween Requires object, props, time, ease";!function start(){_object.multiTween||!_object._mathTween||_manual||TweenManager.clearTween(_object);_manual||TweenManager._addMathTween(_this);_this.time=_time,_this.delay=_delay;let propString=function getPropString(){let string="";for(let key in _props)"number"==typeof _props[key]&&(string+=key+" ");return string}();_object._mathTween=_this,_object.multiTween&&(_object._mathTweens||(_object._mathTweens=[]),_object._mathTweens.forEach((t=>{t.props==propString&&t.tween.stop()})),_this._tweenWrapper={props:propString,tween:_this},_object._mathTweens.push(_this._tweenWrapper));_ease||(_ease="linear");"string"==typeof _ease&&(_ease=TweenManager.Interpolation.convertEase(_ease),_easeFunction="function"==typeof _ease);_startTime=_scaledTime?Render.now():performance.now(),_currentTime=_startTime,_startTime+=_delay,_endValues=_props,_startValues={},_props.spring&&(_spring=_props.spring);_props.damping&&(_damping=_props.damping);for(var prop in _this.startValues=_startValues,_endValues)"number"==typeof _object[prop]&&(_startValues[prop]=_object[prop])}()}}})),this.update=function(dt){if(_paused)return;if((_currentTime+=_scaledTime?dt:Render.DT)<_startTime)return;_elapsed=(_elapsed=(_currentTime-_startTime)/_time)>1?1:_elapsed;let delta=this.interpolate(_elapsed);_update&&_update(delta),1==_elapsed&&(_callback&&_callback(),_this.completePromise&&_this.completePromise.resolve(),clear())},this.pause=function(){_paused=!0},this.resume=function(){_paused=!1},this.stop=function(){return _this.stopped=!0,clear(),null},this.setEase=function(ease){_newEase!=ease&&(_newEase=ease,_ease=TweenManager.Interpolation.convertEase(ease),_easeFunction="function"==typeof _ease)},this.getValues=function(){return{start:_startValues,end:_endValues}},this.interpolate=function(elapsed){var delta=_easeFunction?_ease(elapsed,_spring,_damping):TweenManager.Interpolation.solve(_ease,elapsed);for(var prop in _startValues)if("number"==typeof _startValues[prop]&&"number"==typeof _endValues[prop]){var start=_startValues[prop],end=_endValues[prop];_object[prop]=start+(end-start)*delta}return delta},this.onUpdate=function(callback){return _update=callback,this},this.onComplete=function(callback){return _callback=callback,this},this.promise=function(){return _this.completePromise=Promise.create(),_this.completePromise},this.setElapsed=function(elapsed){_startTime=performance.now(),_currentTime=_startTime+_time*elapsed}})),Class((function TweenTimeline(){Inherit(this,Component);const _this=this;let _tween,_total=0;const _tweens=[];function calculate(){_tweens.sort((function(a,b){const ta=a.time+a.delay;return b.time+b.delay-ta}));const first=_tweens[0];_total=first.time+first.delay}function loop(){let time=_this.elapsed*_total;for(let i=_tweens.length-1;i>-1;i--){let t=_tweens[i],relativeTime=time-t.delay,elapsed=Math.clamp(relativeTime/t.time,0,1);t.interpolate(elapsed)}_this.events.fire(Events.UPDATE,_this,!0)}this.elapsed=0,this.get("timeRemaining",(()=>_total-_this.elapsed*_total)),this.add=function(object,props,time,ease,delay=0){let tween;return(object instanceof MathTween||object instanceof FrameTween)&&(props=object.props,time=object.time,ease=object.ease,delay=object.delay,object=object.object),tween=object instanceof HydraObject?new FrameTween(object,props,time,ease,delay,null,!0):new MathTween(object,props,time,ease,delay,null,!0),_tweens.push(tween),defer(calculate),tween},this.tween=function(to,time,ease,delay,callback){return _this.clearTween(),_tween=tween(_this,{elapsed:to},time,ease,delay).onUpdate(loop).onComplete(callback),_tween},this.clearTween=function(){_tween&&_tween.stop&&_tween.stop()},this.start=function(){_this.startRender(loop)},this.stop=function(){_this.stopRender(loop)},this.update=function(){loop()},this.onDestroy=function(){_this.clearTween(),Render.stop(loop);for(var i=0;i<_tweens.length;i++)_tweens[i].stop()}})),Class((function Data(){Inherit(this,Model);const _this=this;!async function(){await Hydra.ready(),_this.dataReady=!0}(),_this.fetch=async function(url,params={},options={}){if(!1!==options.cache&&_this.pull(url))return _this.pull(url);let res=await fetch(url,params);if(!res.ok)throw new Error(res.statusText);return!1!==options.parseResponse&&204!==res.status?(_this.push(url,await res.json()),_this.pull(url)):res}}),"static"),window.ASSETS=["assets/js/lib/agora.min.js","assets/js/lib/brightcove.js","assets/js/lib/bvh.js","assets/js/lib/bvh.min.js","assets/js/lib/firebase-analytics.js","assets/js/lib/firebase-app-check.js","assets/js/lib/firebase-app.js","assets/js/lib/firebase-auth.js","assets/js/lib/firebase-database.js","assets/js/lib/firebase-firestore.js","assets/js/lib/firebase-functions.js","assets/js/lib/firebase-storage.js","assets/js/lib/fm.liveswitch.js","assets/js/lib/gamecentermedia-agora-es5.js","assets/js/lib/gamecentermedia-agora.js","assets/js/lib/oimo.min.js","assets/js/lib/video.min.js","assets/js/lib/videojs-http-streaming.min.js","assets/js/lib/videojs.min.css","assets/js/lib/vtt.min.js","assets/data/uil.json","assets/shaders/compiled.vs"],ASSETS.SW=["assets/fonts/proxima-nova.json","assets/fonts/proxima-nova.png","assets/fonts/proxima-nova.ttf","assets/css/style.css","assets/css/variables.css","assets/js/app.js"],Class((function Config(){Inherit(this,Model);const _this=this;let _config;function checkIfOvereride(key,value){return!_this.LOCAL_OVERRIDE||_this.LOCAL_OVERRIDE&&!_this[key]?value:_this[key]}!async function(){if(window.CONFIG)_config=window.CONFIG;else{let configPath="config.json";window.CONFIG_PATH&&(configPath=window.CONFIG_PATH),Utils.query("config")&&(configPath=`config-${Utils.query("config")}.json`),_config=await get(`${configPath}?${Date.now()}`)}for(const key of Object.keys(_config))_this[key.toUpperCase()]=_config[key];if(Utils.query("localSocket")&&(_this.GAMECENTER_SOCKET="ws://localhost",_this.GAMECENTER_PORTS=2),_this.CMS){var cmsConfig;if(_this.LOAD_CONFIG)try{cmsConfig=await get(`${_this.CMS}/config/index.json?${Date.now()}`)}catch(err){_this.PROD||console.warn("Config not found in CMS",err)}cmsConfig&&(_this.PLATFORM_CONFIG=checkIfOvereride("PLATFORM_CONFIG",{apiKey:cmsConfig.platformApiKey,authDomain:cmsConfig.platformAuthDomain||cmsConfig.platformProjectName+".firebaseapp.com",projectId:cmsConfig.platformProjectName,databaseURL:cmsConfig.platformDatabaseURL||cmsConfig.platformProjectName+"-default-rtdb.firebaseio.com",storageBucket:cmsConfig.platformProjectName+".appspot.com",messagingSenderId:cmsConfig.platformSenderId,appId:cmsConfig.platformAppId,measurementId:cmsConfig.platformMeasurementId}),cmsConfig.gamecenterProjectName.length>0&&cmsConfig.gamecenterProjectName!=cmsConfig.platformProjectName?_this.GAMECENTER_FIREBASE=checkIfOvereride("GAMECENTER_FIREBASE",{apiKey:cmsConfig.gamecenterApiKey,authDomain:cmsConfig.gamecenterProjectName+".firebaseapp.com",projectId:cmsConfig.gamecenterProjectName,databaseURL:cmsConfig.gamecenterDatabaseURL||cmsConfig.gamecenterProjectName+"-default-rtdb.firebaseio.com",storageBucket:cmsConfig.gamecenterProjectName+".appspot.com",messagingSenderId:cmsConfig.gamecenterSenderId,appId:cmsConfig.gamecenterAppId,measurementId:cmsConfig.gamecenterMeasurementId}):_this.GAMECENTER_FIREBASE=!0,cmsConfig.agoraAppId&&cmsConfig.agoraAppId.length>0&&(_this.AGORA_APP_ID=checkIfOvereride("AGORA_APP_ID",cmsConfig.agoraAppId),_this.AGORA_TOKEN_SERVER=checkIfOvereride("AGORA_TOKEN_SERVER",cmsConfig.agoraTokenServer),_this.AGORA_BROADCAST_CODE_VERIFY=checkIfOvereride("AGORA_BROADCAST_CODE_VERIFY",cmsConfig.agoraCodeVerify)),cmsConfig.recaptchaKey&&(_this.RECAPTCHA_KEY=checkIfOvereride("RECAPTCHA_KEY",cmsConfig.recaptchaKey)),_this.API=Utils.query("localServer")||_this.SERVICES?.emulate?.active?`http://localhost:5000/${_this.PLATFORM_CONFIG.projectId}/us-central1/dream`:cmsConfig.apiUrl)}else(Utils.query("localServer")||_this.SERVICES?.emulate?.active)&&(_this.API=`http://localhost:5000/${_this.PLATFORM_CONFIG.projectId}/us-central1/dream`);_this.dataReady=!0}(),_this.getValue=function(path,defaultValue=null){return String.prototype.split.call(path,/[,[\].]+?/).filter(Boolean).reduce(((a,c)=>Object.hasOwnProperty.call(a,c)?a[c]:defaultValue),_this)}}),"static"),window.UIL_ASSETS_GEOMETRIES=[{filename:"avatar/defaultavatar_body.json",bytes:106542,lastChange:"2022-03-23T14:04:19.304Z"},{filename:"avatar/defaultavatar_eyes.json",bytes:102118,lastChange:"2022-01-25T14:52:03.843Z"},{filename:"avatar/defaultavatar_hair.json",bytes:323701,lastChange:"2022-01-25T14:52:03.843Z"},{filename:"avatar/defaultavatar_hand.json",bytes:78010,lastChange:"2022-01-25T14:52:03.844Z"},{filename:"avatar/defaultavatar_head.json",bytes:146322,lastChange:"2022-01-25T14:52:03.844Z"},{filename:"avatar/defaultavatar_torus.json",bytes:16184,lastChange:"2022-01-25T14:52:03.844Z"},{filename:"controller.json",bytes:176274,lastChange:"2022-05-06T07:34:53.685Z"},{filename:"hand_indexed.bin",bytes:2529,lastChange:"2022-05-06T07:34:53.685Z"}],window.UIL_ASSETS_TEXTURES=[{filename:"_lighting/arealights.json",bytes:307348,lastChange:"2022-01-25T14:52:03.845Z"},{filename:"_scenelayout/black.jpg",bytes:1129,lastChange:"2022-01-25T14:52:03.845Z"},{filename:"_scenelayout/mask.jpg",bytes:1129,lastChange:"2022-01-25T14:52:03.845Z"},{filename:"_scenelayout/uv.jpg",bytes:138695,lastChange:"2022-01-25T14:52:03.846Z"},{filename:"avatar/default.png",bytes:110366,lastChange:"2022-03-23T14:04:19.304Z"},{filename:"avatar/matcap.jpg",bytes:43475,lastChange:"2022-03-23T14:04:19.305Z"},{filename:"avatar/normal.png",bytes:928,lastChange:"2022-03-23T14:04:19.305Z"},{filename:"avatar/placeholder.png",bytes:5375,lastChange:"2022-03-23T14:04:19.305Z"},{filename:"avatar/roughness.png",bytes:928,lastChange:"2022-03-23T14:04:19.305Z"},{filename:"avatar/shadow.jpg",bytes:9776,lastChange:"2022-03-23T14:04:19.305Z"},{filename:"avatar/shadow1.jpg",bytes:9776,lastChange:"2022-03-23T14:04:19.305Z"},{filename:"close-orange.svg",bytes:696,lastChange:"2022-03-23T14:04:19.306Z"},{filename:"conference/icons/1.svg",bytes:211,lastChange:"2022-03-23T14:04:19.306Z"},{filename:"conference/icons/2.svg",bytes:510,lastChange:"2022-03-23T14:04:19.306Z"},{filename:"conference/icons/chat-send.svg",bytes:1e3,lastChange:"2022-03-23T14:04:19.306Z"},{filename:"conference/icons/github.svg",bytes:594,lastChange:"2022-03-23T14:04:19.306Z"},{filename:"conference/icons/linkedin.svg",bytes:891,lastChange:"2022-03-23T14:04:19.306Z"},{filename:"conference/icons/twitter.svg",bytes:1593,lastChange:"2022-03-23T14:04:19.307Z"},{filename:"conference/icons/user-multiple.svg",bytes:2053,lastChange:"2022-03-23T14:04:19.307Z"},{filename:"conference/placeholder.png",bytes:16485,lastChange:"2022-03-23T14:04:19.307Z"},{filename:"core-sprites.svg",bytes:44843,lastChange:"2022-03-30T07:39:14.239Z"},{filename:"emotes/emotes.png",bytes:44762,lastChange:"2022-04-13T21:12:04.748Z"},{filename:"icon/3rdView.svg",bytes:275,lastChange:"2022-03-23T14:04:19.308Z"},{filename:"icon/add.svg",bytes:415,lastChange:"2022-03-23T14:04:19.308Z"},{filename:"icon/altclock.svg",bytes:418,lastChange:"2022-03-23T14:04:19.308Z"},{filename:"icon/arrow-left.svg",bytes:556,lastChange:"2022-03-23T14:04:19.308Z"},{filename:"icon/arrow-right.svg",bytes:549,lastChange:"2022-03-23T14:04:19.308Z"},{filename:"icon/camera-off.svg",bytes:1355,lastChange:"2022-03-23T14:04:19.308Z"},{filename:"icon/camera-on-grey.svg",bytes:921,lastChange:"2022-03-23T14:04:19.308Z"},{filename:"icon/camera-on-orange.svg",bytes:921,lastChange:"2022-03-23T14:04:19.308Z"},{filename:"icon/camera-on.svg",bytes:919,lastChange:"2022-03-23T14:04:19.309Z"},{filename:"icon/camera-video-zone-red.svg",bytes:940,lastChange:"2022-03-23T14:04:19.309Z"},{filename:"icon/camera-video-zone.svg",bytes:911,lastChange:"2022-03-23T14:04:19.309Z"},{filename:"icon/chat-alt.svg",bytes:2058,lastChange:"2022-03-23T14:04:19.309Z"},{filename:"icon/check.svg",bytes:486,lastChange:"2022-03-23T14:04:19.309Z"},{filename:"icon/chevron-down-white.svg",bytes:163,lastChange:"2022-03-23T14:04:19.309Z"},{filename:"icon/chevron-down.svg",bytes:487,lastChange:"2022-03-23T14:04:19.309Z"},{filename:"icon/chevron-left.svg",bytes:487,lastChange:"2022-03-23T14:04:19.310Z"},{filename:"icon/chevron-up.svg",bytes:486,lastChange:"2022-03-23T14:04:19.310Z"},{filename:"icon/clock.svg",bytes:414,lastChange:"2022-03-23T14:04:19.310Z"},{filename:"icon/close-orange.svg",bytes:696,lastChange:"2022-03-23T14:04:19.310Z"},{filename:"icon/close.svg",bytes:683,lastChange:"2022-03-23T14:04:19.310Z"},{filename:"icon/download.svg",bytes:920,lastChange:"2022-03-23T14:04:19.310Z"},{filename:"icon/exit.svg",bytes:1235,lastChange:"2022-03-23T14:04:19.310Z"},{filename:"icon/expand-video-gl.png",bytes:5295,lastChange:"2022-03-23T14:04:19.311Z"},{filename:"icon/external-link.svg",bytes:989,lastChange:"2022-03-23T14:04:19.311Z"},{filename:"icon/filter.svg",bytes:296,lastChange:"2022-03-23T14:04:19.311Z"},{filename:"icon/location.svg",bytes:1777,lastChange:"2022-03-23T14:04:19.311Z"},{filename:"icon/menu-alt.svg",bytes:923,lastChange:"2022-03-23T14:04:19.311Z"},{filename:"icon/menu.svg",bytes:297,lastChange:"2022-03-23T14:04:19.311Z"},{filename:"icon/mic-off.svg",bytes:2436,lastChange:"2022-03-23T14:04:19.311Z"},{filename:"icon/mic-on-grey.svg",bytes:1960,lastChange:"2022-03-23T14:04:19.311Z"},{filename:"icon/mic-on.svg",bytes:1905,lastChange:"2022-03-23T14:04:19.311Z"},{filename:"icon/mic-video-zone-red.svg",bytes:1701,lastChange:"2022-03-23T14:04:19.312Z"},{filename:"icon/mic-video-zone.svg",bytes:1662,lastChange:"2022-03-23T14:04:19.312Z"},{filename:"icon/screenshare.svg",bytes:846,lastChange:"2022-03-23T14:04:19.312Z"},{filename:"icon/setting.svg",bytes:5194,lastChange:"2022-03-23T14:04:19.312Z"},{filename:"icon/settings-video-chat-zone.svg",bytes:3517,lastChange:"2022-03-23T14:04:19.312Z"},{filename:"icon/share2-alt.svg",bytes:2839,lastChange:"2022-03-23T14:04:19.312Z"},{filename:"icon/share2.svg",bytes:2877,lastChange:"2022-03-23T14:04:19.312Z"},{filename:"icon/sound-level2-grey.svg",bytes:1453,lastChange:"2022-03-23T14:04:19.313Z"},{filename:"icon/sound-level2.svg",bytes:1453,lastChange:"2022-03-23T14:04:19.313Z"},{filename:"icon/speaker-grey.svg",bytes:998,lastChange:"2022-03-23T14:04:19.313Z"},{filename:"icon/speaker.svg",bytes:998,lastChange:"2022-03-23T14:04:19.313Z"},{filename:"icon/spinner.png",bytes:4291,lastChange:"2022-03-23T14:04:19.313Z"},{filename:"icon/user-alt.svg",bytes:901,lastChange:"2022-03-23T14:04:19.313Z"},{filename:"icon/user.svg",bytes:1241,lastChange:"2022-03-23T14:04:19.314Z"},{filename:"icon/video.svg",bytes:550,lastChange:"2022-03-23T14:04:19.314Z"},{filename:"icon/warning.svg",bytes:846,lastChange:"2022-03-23T14:04:19.314Z"},{filename:"pbr/lut.png",bytes:16623,lastChange:"2022-01-25T14:52:03.851Z"},{filename:"trivia/check.svg",bytes:3094,lastChange:"2022-03-23T14:04:19.314Z"},{filename:"trivia/correct.svg",bytes:533,lastChange:"2022-03-23T14:04:19.314Z"},{filename:"trivia/incorrect.svg",bytes:295,lastChange:"2022-03-23T14:04:19.314Z"},{filename:"trivia/question.svg",bytes:2283,lastChange:"2022-03-23T14:04:19.314Z"},{filename:"tutorial/core-audio-settings.png",bytes:3382,lastChange:"2022-03-23T14:04:19.314Z"},{filename:"tutorial/core-audio-toggle.png",bytes:4950,lastChange:"2022-03-23T14:04:19.315Z"},{filename:"tutorial/core-camera-toggle.png",bytes:4767,lastChange:"2022-03-23T14:04:19.315Z"},{filename:"tutorial/core-chat-zone-join.png",bytes:4634,lastChange:"2022-03-23T14:04:19.315Z"},{filename:"tutorial/core-chat-zone.png",bytes:6339,lastChange:"2022-03-22T13:13:30.234Z"},{filename:"tutorial/core-movement-arrows.png",bytes:1802,lastChange:"2022-03-23T14:04:19.315Z"},{filename:"tutorial/core-movement-desktop.png",bytes:9247,lastChange:"2022-03-22T13:13:30.234Z"},{filename:"tutorial/core-movement-joystick.png",bytes:2296,lastChange:"2022-03-23T14:04:19.315Z"},{filename:"tutorial/core-movement-mobile.png",bytes:10309,lastChange:"2022-03-22T13:13:30.234Z"},{filename:"tutorial/core-movement-mouse.png",bytes:2536,lastChange:"2022-03-23T14:04:19.316Z"},{filename:"tutorial/core-movement-pov.png",bytes:2375,lastChange:"2022-03-23T14:04:19.316Z"},{filename:"tutorial/core-screens-content.png",bytes:6611,lastChange:"2022-03-22T13:13:30.235Z"},{filename:"tutorial/core-settings.png",bytes:5526,lastChange:"2022-03-22T13:13:30.235Z"},{filename:"tutorial/core-vr-joystick.png",bytes:5636,lastChange:"2022-03-23T14:04:19.316Z"},{filename:"tutorial/core-vr-settings.png",bytes:9177,lastChange:"2022-03-23T14:04:19.316Z"},{filename:"tutorial/core-vr-teleport.png",bytes:5636,lastChange:"2022-03-23T14:04:19.316Z"},{filename:"tutorial/core-watch-party.png",bytes:8026,lastChange:"2022-03-22T13:13:30.235Z"},{filename:"ui/path-circle.png",bytes:4976,lastChange:"2022-03-21T14:26:24.796Z"},{filename:"ui/prompt-button.png",bytes:2091,lastChange:"2022-03-23T14:04:19.317Z"},{filename:"ui/prompt-close-button.png",bytes:3693,lastChange:"2022-03-23T14:04:19.317Z"}],Mobile.Class((function Accelerometer(){var _this=this;function updateAccel(e){switch(window.orientation){case 0:_this.x=-e.accelerationIncludingGravity.x,_this.y=e.accelerationIncludingGravity.y,_this.z=e.accelerationIncludingGravity.z,e.rotationRate&&(_this.rotationRate.alpha=e.rotationRate.beta*_this.toRadians,_this.rotationRate.beta=-e.rotationRate.alpha*_this.toRadians,_this.rotationRate.gamma=e.rotationRate.gamma*_this.toRadians);break;case 180:_this.x=e.accelerationIncludingGravity.x,_this.y=-e.accelerationIncludingGravity.y,_this.z=e.accelerationIncludingGravity.z,e.rotationRate&&(_this.rotationRate.alpha=-e.rotationRate.beta*_this.toRadians,_this.rotationRate.beta=e.rotationRate.alpha*_this.toRadians,_this.rotationRate.gamma=e.rotationRate.gamma*_this.toRadians);break;case 90:_this.x=e.accelerationIncludingGravity.y,_this.y=e.accelerationIncludingGravity.x,_this.z=e.accelerationIncludingGravity.z,e.rotationRate&&(_this.rotationRate.alpha=e.rotationRate.alpha*_this.toRadians,_this.rotationRate.beta=e.rotationRate.beta*_this.toRadians,_this.rotationRate.gamma=e.rotationRate.gamma*_this.toRadians);break;case-90:_this.x=-e.accelerationIncludingGravity.y,_this.y=-e.accelerationIncludingGravity.x,_this.z=e.accelerationIncludingGravity.z,e.rotationRate&&(_this.rotationRate.alpha=-e.rotationRate.alpha*_this.toRadians,_this.rotationRate.beta=-e.rotationRate.beta*_this.toRadians,_this.rotationRate.gamma=e.rotationRate.gamma*_this.toRadians)}"android"==Device.system.os&&(_this.x*=-1,_this.y*=-1,_this.z*=-1)}function updateOrientation(e){for(var key in e)key.toLowerCase().includes("heading")&&(_this.heading=e[key]);switch(window.orientation){case 0:_this.alpha=e.beta*_this.toRadians,_this.beta=-e.alpha*_this.toRadians,_this.gamma=e.gamma*_this.toRadians;break;case 180:_this.alpha=-e.beta*_this.toRadians,_this.beta=e.alpha*_this.toRadians,_this.gamma=e.gamma*_this.toRadians;break;case 90:_this.alpha=e.alpha*_this.toRadians,_this.beta=e.beta*_this.toRadians,_this.gamma=e.gamma*_this.toRadians;break;case-90:_this.alpha=-e.alpha*_this.toRadians,_this.beta=-e.beta*_this.toRadians,_this.gamma=e.gamma*_this.toRadians}_this.tilt=e.beta*_this.toRadians,_this.yaw=e.alpha*_this.toRadians,_this.roll=-e.gamma*_this.toRadians,"android"==Device.system.os&&(_this.heading=function compassHeading(alpha,beta,gamma){var degtorad=Math.PI/180,_x=beta?beta*degtorad:0,_y=gamma?gamma*degtorad:0,_z=alpha?alpha*degtorad:0,cY=(Math.cos(_x),Math.cos(_y)),cZ=Math.cos(_z),sX=Math.sin(_x),sY=Math.sin(_y),sZ=Math.sin(_z),Vx=-cZ*sY-sZ*sX*cY,Vy=-sZ*sY+cZ*sX*cY,compassHeading=Math.atan(Vx/Vy);Vy<0?compassHeading+=Math.PI:Vx<0&&(compassHeading+=2*Math.PI);return compassHeading*(180/Math.PI)}(e.alpha,e.beta,e.gamma))}this.x=0,this.y=0,this.z=0,this.alpha=0,this.beta=0,this.gamma=0,this.heading=0,this.rotationRate={},this.rotationRate.alpha=0,this.rotationRate.beta=0,this.rotationRate.gamma=0,this.toRadians="ios"==Device.system.os?Math.PI/180:1,this.capture=function(){this.active||(this.active=!0,window.DeviceMotionEvent&&"function"==typeof DeviceMotionEvent.requestPermission?DeviceMotionEvent.requestPermission().then((permissionState=>{"granted"===permissionState&&window.addEventListener("devicemotion",updateAccel)})).catch(console.error):window.addEventListener("devicemotion",updateAccel),window.DeviceOrientationEvent&&"function"==typeof DeviceOrientationEvent.requestPermission?DeviceOrientationEvent.requestPermission().then((permissionState=>{"granted"===permissionState&&window.addEventListener("deviceorientation",updateOrientation)})).catch(console.error):window.addEventListener("deviceorientation",updateOrientation))},this.stop=function(){this.active=!1,window.ondevicemotion=null,_this.x=_this.y=_this.z=0,window.removeEventListener("deviceorientation",updateOrientation)}}),"Static"),Module((function ConsoleSecurity(){this.exports=function(){let err=new Error;if(err.stack){if(err.stack.toString().toLowerCase().includes(["@debugger","_evaluateandwrap","eval code:1:1)","at <anonymous>:1:","(<anonymous>:1:"]))return!0}return!1}})),Class((function CSSFilter($object,_vert,_frag){Inherit(this,Component);var _killTween,_tween,_this=this,_filter="",_filters=["grayscale","sepia","saturate","hue","invert","opacity","brightness","contrast","blur"];function checkFilter(key){for(var i=_filters.length-1;i>-1;i--)if(_filters[i]==key)return!0;return!1}this.apply=function(){!function buildFilters(){var str="";for(var key in _this)if(checkFilter(key)){var filter=key,value=_this[key];"number"==typeof value&&(value="hue-rotate"==(filter="hue"==filter?"hue-rotate":filter)?value+"deg":value,str+=filter+"("+(value="blur"==filter?value+"px":value)+") ")}_filter=str}(),$object.div.style[HydraCSS.prefix("Filter")]=_filter},this.tween=async function(props,time,ease,delay,callback){"function"==typeof delay&&(callback=delay,delay=0),delay=delay||0,_killTween=!1;var filter="-"+HydraCSS.styles.vendor.toLowerCase()+"-filter";if($object.willChange(filter),await defer(),await defer(),!_killTween){for(var key in $object.div.style[HydraCSS.prefix("Transition")]=filter+" "+time+"ms "+TweenManager._getEase(ease)+" "+delay+"ms",props)_this[key]=props[key];_tween=_this.delayedCall((function(){$object.willChange(null),callback&&callback()}),time+delay),_this.apply()}},this.stopTween=function(){clearTimeout(_tween),_killTween=!0,function clearTween(){if(_tween||!$object||!$object.div)return!1;$object.div.style[HydraCSS.prefix("Transition")]=""}()},this.clear=function(){for(var key in _this)checkFilter(key)&&delete _this[key];_tween&&this.stopTween(),this.apply()},this.onDestroy=function(){this.clear(),$object=null,_tween=null}})),Class((function ImageDecoder(){Inherit(this,Component);var _compressed,_this=this;const ACTIVE=!(!(window.fetch&&window.createImageBitmap&&Device.system.browser.includes("chrome"))||window.AURA);function decodeImage(data,id){(async _=>{try{let e=await fetch(data.path,{mode:"cors"});if(200!=e.status)throw resolve({fail:!0},id),"Image not found :: "+data.path;let blob=await e.blob(),obj={imageOrientation:"flipY",crossOrigin:"anonymous"};data.params&&!1===data.params.premultiplyAlpha&&(obj.premultiplyAlpha="none"),obj.imageOrientation=data.params&&!1===data.params.flipY?void 0:"flipY";let bitmap=await createImageBitmap(blob,obj),message={post:!0,id:id,message:bitmap};self.postMessage(message,[bitmap])}catch(e){throw resolve({fail:!0},id),e}})()}function decodeCompressedImage(data,id){(async _=>{let ext;data.settings.dxt?ext="dxt":data.settings.etc?ext="astc":data.settings.pvrtc?ext="pvrtc":data.settings.astc&&(ext="astc");let fileName=data.path.split("/");fileName=fileName[fileName.length-1];let e=await fetch(`${data.path}/${fileName}-${ext}.ktx`);if(200!=e.status)throw"Image not found :: "+data.path;try{let arrayBuffer=await e.arrayBuffer(),header=new Int32Array(arrayBuffer,12,13),gliFormat=(header[1],header[2],header[3],header[4]),width=(header[5],header[6]),height=header[7],miplevels=header[11],bytesOfKeyValueData=header[12],buffers=[],compressedData=[],sizes=[],dataOffset=64+bytesOfKeyValueData;for(let level=0;level<miplevels;level++){let imageSize=new Int32Array(arrayBuffer,dataOffset,1)[0];dataOffset+=4;let byteArray=new Uint8Array(arrayBuffer,dataOffset,imageSize);dataOffset+=imageSize,dataOffset+=3-(imageSize+3)%4,sizes.push(width),width=Math.max(1,.5*width),height=Math.max(1,.5*height);let clone=new Uint8Array(byteArray);compressedData.push(clone),buffers.push(clone.buffer)}resolve({gliFormat:gliFormat,compressedData:compressedData,sizes:sizes,width:width,height:height},id,buffers)}catch(e){throw data.path+" could not be decoded"}})()}this.scale=1,async function(){await Hydra.ready(),Thread.upload(decodeImage),Thread.upload(decodeCompressedImage)}(),this.decode=async function(path,params={}){let fallback=Thread.absolutePath(Assets.getPath("assets/images/_scenelayout/uv.jpg"));if(path=Thread.absolutePath(Assets.getPath(path)),!_compressed){_compressed={dxt:!!Renderer.extensions.s3tc,etc:!!Renderer.extensions.etc1,pvrtc:!!Renderer.extensions.pvrtc,astc:!!Renderer.extensions.astc};let found=!1;for(let key in _compressed)1==_compressed[key]&&(found=!0);found||(_compressed=null)}if(!_compressed&&path.includes("-compressedKtx")&&(path=path.replace("-compressedKtx","")),path.includes("-compressedKtx"))try{return path=path.substring(0,path.lastIndexOf(".")),await Thread.shared().decodeCompressedImage({path:path,params:params,settings:_compressed})}catch(e){return _this.decode(fallback,params)}else{let getBitmap=(path,params)=>ACTIVE?Thread.shared().decodeImage({path:path,params:params}):Assets.decodeImage(path,params);try{let bitmap=await getBitmap(path,params);if(bitmap.fail&&(bitmap=await getBitmap(fallback,params),bitmap.fail))throw"could not decode "+path;return function process(bitmap,scale){if(1==scale*_this.scale)return bitmap;let pow2=Math.isPowerOf2(bitmap.width,bitmap.height),canvas=document.createElement("canvas");return canvas.context=canvas.getContext("2d"),canvas.width=Math.round(bitmap.width*_this.scale*scale),canvas.height=Math.round(bitmap.height*_this.scale*scale),pow2&&scale*_this.scale<1&&(canvas.width=canvas.height=Math.floorPowerOf2(Math.max(canvas.width,canvas.height))),canvas.context.drawImage(bitmap,0,0,canvas.width,canvas.height),canvas}(bitmap,params.scale||1)}catch(e){throw"could not decode "+path}}}}),"static"),Class((function Firebase(){Inherit(this,Model);const _this=this;let _hasInit;function init(){if(!firebase)return _this.delayedCall(init,100);_this.dataReady=!0}this.init=async function(){_hasInit||(_hasInit=!0,await AssetLoader.loadAssets(["~assets/js/lib/firebase-app.js"]),await AssetLoader.waitForLib("firebase"),init())},this.initApp=async function(firebaseConfig,name){name?firebase.initializeApp(firebaseConfig,name):firebase.initializeApp(firebaseConfig)}}),"Static"),Class((function FirebaseAnalytics(){Inherit(this,Model);const _this=this;var _hasInit;function init(){if(!firebase.analytics)return _this.delayedCall(init);_this.dataReady=!0}this.init=async function(){_hasInit||(_hasInit=!0,await Firebase.ready(),await AssetLoader.loadAssets(["assets/js/lib/firebase-analytics.js"]),init())}}),"Static"),Class((function FirebaseAppCheck(){Inherit(this,Model);const _this=this;var _hasInit;function init(){if(!firebase.appCheck)return _this.delayedCall(init);_this.dataReady=!0}this.init=async function(){_hasInit||(_hasInit=!0,await Firebase.ready(),await AssetLoader.loadAssets(["~assets/js/lib/firebase-app-check.js"]),init())}}),"Static"),Class((function Auth(){Inherit(this,Model);const _this=this;let _app,_auth,_user,_loggedIn,_reload,_hasInit=!1,_providers={};function onAuth(user){if(user){if(_user=user,_loggedIn=!0,_reload)return window.location.reload();_this.events.fire("logged_in")}else _user=null,_loggedIn=!1,_this.events.fire("logged_out");_this.dataReady=!0}this.init=async function(app){_hasInit||(await FirebaseAuth.ready(),_app=app,function init(){_auth=_app.auth(),function initProviders(){_providers.google=new firebase.auth.GoogleAuthProvider}(),function addListeners(){_auth.onAuthStateChanged(onAuth)}(),_hasInit=!0}())},this.isLoggedIn=function(){return _loggedIn},this.user=function(){return _user||null},this.login=function(email,password){if(_auth)return _auth.signInWithEmailAndPassword(email,password);console.error("Auth not ready")},this.loginGoogle=function(r=!1){if(_reload=r,_auth&&_providers.google)return _auth.signInWithPopup(_providers.google);console.error("Google login error")},this.logout=function(){if(_auth)return _user=null,_auth.signOut();console.error("Auth not ready")}}),"Static"),Class((function FirebaseAuth(){Inherit(this,Model);const _this=this;var _hasInit;function init(){if(!firebase.auth)return _this.delayedCall(init);_this.dataReady=!0}this.init=async function(){_hasInit||(_hasInit=!0,await Firebase.ready(),await AssetLoader.loadAssets(["~assets/js/lib/firebase-auth.js"]),init())}}),"Static"),Class((function ServicesAuth(){Inherit(this,Model);const _this=this;let _app,_auth,_user,_loggedIn,_reload,_hasInit=!1,_providers={};function onAuth(user){if(user){if(_user=user,_loggedIn=!0,_reload)return window.location.reload();_this.events.fire("logged_in")}else _user=null,_loggedIn=!1,_this.events.fire("logged_out");_this.dataReady=!0}this.init=async function(app){_hasInit||(await FirebaseAuth.ready(),_app=app,function init(){_auth=_app.auth(),function initProviders(){_providers.google=new firebase.auth.GoogleAuthProvider}(),function addListeners(){_auth.onAuthStateChanged(onAuth)}(),_hasInit=!0}())},this.isLoggedIn=function(){return _loggedIn},this.user=function(){return _user||null},this.login=function(email,password){if(_auth)return _auth.signInWithEmailAndPassword(email,password);console.error("Auth not ready")},this.loginGoogle=function(r=!1){if(_reload=r,_auth&&_providers.google)return _auth.signInWithPopup(_providers.google);console.error("Google login error")},this.logout=function(){if(_auth)return _user=null,_auth.signOut();console.error("Auth not ready")}}),"Static"),Class((function FirebaseDB(){Inherit(this,Model);const _this=this;var _hasInit;function init(){if(!firebase.database)return _this.delayedCall(init);_this.dataReady=!0}this.init=async function(){_hasInit||(_hasInit=!0,await Firebase.ready(),await AssetLoader.loadAssets(["~assets/js/lib/firebase-database.js"]),init())},this.sanitize=function(key){return key.replace(/[.$#[\]/]/g,"-")}}),"Static"),Class((function FirebaseFunctions(){Inherit(this,Model);const _this=this;var _hasInit;function init(){if(!firebase.functions)return _this.delayedCall(init);_this.dataReady=!0}this.init=async function(){_hasInit||(_hasInit=!0,await Firebase.ready(),await AssetLoader.loadAssets(["~assets/js/lib/firebase-functions.js"]),init())}}),"Static"),Class((function FirebaseStorage(){Inherit(this,Model);const _this=this;let _hasInit;function init(){if(!firebase.storage)return _this.delayedCall(init);_this.dataReady=!0}this.init=async function(){_hasInit||(_hasInit=!0,await Firebase.ready(),await AssetLoader.loadAssets(["~assets/js/lib/firebase-storage.js"]),init())}}),"Static"),Class((function Firestore(){Inherit(this,Model);const _this=this;var _hasInit;function init(){if(!firebase.firestore)return _this.delayedCall(init);_this.FieldValue=firebase.firestore.FieldValue,_this.dataReady=!0}this.init=async function(){_hasInit||(_hasInit=!0,await Firebase.ready(),await AssetLoader.loadAssets(["~assets/js/lib/firebase-firestore.js"]),init())}}),"Static"),Class((function FirebaseThread(){Inherit(this,Component);let app,auth,db,rtdb,_user,_queue=[],_unsub={};function flush(){emit("data",{data:_queue}),_queue.length=0}this.publish=function(key,data){_queue.push({key:key,data:data})},this.auth=function(){return auth},this.database=function(){return rtdb},this.firestore=function(){return db},this.user=function(){return _user},this.callback=function(key,query){_unsub[key]=query},this.unsub=function({key:key}){_unsub[key]()},this.auth=function(options){switch(options.method){case"sendSignInLinkToEmail":return auth[options.method](options.metadata.email,options.metadata.options);case"signInWithEmailLink":return auth[options.method](options.metadata.email,options.metadata.href);case"signInWithCustomToken":return auth[options.method](options.metadata.token);case"signOut":return auth[options.method]()}},this.initializeApp=function(config){app=firebase.initializeApp(config),db=app.firestore(),rtdb=app.database(),auth=app.auth(),auth.onAuthStateChanged((user=>{_user=user})),setInterval(flush,30)}})),Class((function Fireworker(){Inherit(this,Model);const _this=this;let _initiated,_thread,_listeners={};function handleListener(e,id){for(let i=e.data.length-1;i>-1;i--){let obj=e.data[i];_listeners[obj.key]&&_listeners[obj.key](obj.data)}}_this.init=function(config){_initiated||(_initiated=!0,function initThread(firebaseConfig){_thread=_this.initClass(Thread,FirebaseThread),_thread.importScript("assets/js/lib/firebase-app.js"),_thread.importScript("assets/js/lib/firebase-firestore.js"),_thread.importScript("assets/js/lib/firebase-database.js"),_thread.importScript("assets/js/lib/firebase-auth.js"),_thread.initializeApp(firebaseConfig),_thread.on("data",handleListener)}(config),_this.dataReady=!0)},_this.commit=function(query){_thread.loadFunction(query)},_this.query=function(key,data,callback,commit="listener"){return callback?(_listeners[key]=callback,_thread[commit]?.(data),key=>{_thread.unsub({key:key})}):_thread[key]?.(data)},_this.removeQuery=function(key){_thread.unsub({key:key})},_this.removeListener=function(key){delete _listeners[key]},_this.auth=function(options){return _thread.auth(options)},_this.get("thread",(()=>_thread))}),"static"),Class((function Fullscreen(){Inherit(this,Events);const _this=this;function update(){const isOpen=!!(document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement);isOpen!==_this.isOpen&&(_this.isOpen=isOpen,_this.events.fire(Events.FULLSCREEN,{fullscreen:_this.isOpen}))}this.isOpen=!1,function addHandlers(){["onfullscreenchange","onwebkitfullscreenchange","onmozfullscreenchange","onmsfullscreenchange","onfullscreenerror","onwebkitfullscreenerror","onmozfullscreenerror","onmsfullscreenerror"].forEach((evt=>{void 0!==document[evt]&&(document[evt]=update)}))}(),this.open=function(element){element=element||document.body,["requestFullscreen","webkitRequestFullscreen","mozRequestFullScreen","msRequestFullscreen"].every((method=>{if(void 0===element[method])return!0;element[method]({navigationUI:"hide"})}))},this.close=function(){["exitFullscreen","webkitExitFullscreen","mozCancelFullScreen","msExitFullscreen"].every((method=>{if(void 0===document[method])return!0;document[method]()}))},Object.defineProperty(this,"enabled",{get:()=>["fullscreenEnabled","webkitFullscreenEnabled","mozFullScreenEnabled","msFullscreenEnabled"].some((prop=>Boolean(document[prop])))})}),"static"),Class((function FXAA(){Inherit(this,NukePass);this.uniforms={tMask:{value:null}},this.init("FXAA","FXAA"),this.setMask=function(texture){this.uniforms.tMask.value=texture}})),Class((function GLA11y(){Inherit(this,Element);const _this=this;var $this,_groups=[],_links=[];function isVisible(group){if(group.__glseoParent){const seoHidden=!!group.__glseoParent.seoHidden,hidden=!!group.__glseoParent.hidden;return!seoHidden&&!hidden}return group.seo.enabled&&group.determineVisible()}function isDeleted(group){return group.__glseoParent?group.__glseoParent.deleted:group.deleted}function loop(){for(let i=_groups.length-1;i>-1;i--){let group=_groups[i];if(isDeleted(group))return $this.removeChild(group.seo),_groups.splice(i,1);isVisible(group)?(group.seo&&group.seo.hidden&&(group.seo.hidden=!1,$this.add(group.seo)),seo=group.seo,Array.prototype.slice.call(seo.div.children).forEach((div=>{let seo=div.hydraObject,group=seo&&seo.group;if(!seo||!group)return;let hidden=!group.determineVisible();hidden!==seo.hidden&&(hidden?seo.hide():seo.show(),seo.hidden=hidden)}))):group.seo&&!group.seo.hidden&&(group.seo.hidden=!0,$this.removeChild(group.seo,!0))}var seo;for(let i=_links.length-1;i>-1;i--){let group=_links[i];if(isDeleted(group))return $this.removeChild(group.seo),_groups.splice(i,1);isVisible(group)?group.seoHidden&&(group.seoHidden=!1,group.seoDOM.forEach((obj=>obj.show()))):group.seoHidden||(group.seoHidden=!0,group.seoDOM.forEach((obj=>obj.hide())))}}function aLink($object,url,label,options={}){let seo=$("link","a");return seo.group=$object.group,seo.attr("href","#"===url?url:Hydra.absolutePath(url)),seo.text(label),seo.accessible(),seo.div.onfocus=_=>$object._divFocus(),seo.div.onblur=_=>$object._divBlur(),seo.div.onclick=e=>{e.preventDefault(),$object._divSelect()},options.role&&(seo.attr("role",options.role),seo.div.onkeydown=e=>{switch(e.key){case" ":case"Spacebar":e.preventDefault(),e.stopPropagation(),$object._divSelect()}}),seo}!async function(){window.GLSEO=_this,await Hydra.ready(),function initHTML(){($this=_this.element).setZ(-1),Stage.add($this)}(),HydraCSS.style(".GLA11y *",{position:"relative"})}(),this.registerPage=function(group,name){let topLevel=group;!(group=group instanceof GLUIObject?group:group.group||group.scene||group).determineVisible&&group.group&&(group.determineVisible=group.group.determineVisible.bind(group.group)),Global.PLAYGROUND||World.ELEMENT.mouseEnabled(!1),topLevel.seo=group.seo=$(name),group.seo.hidden=!0,group.seo.enabled=!0;let remove=group.seo.remove.bind(group.seo);group.seo.remove=_=>{_groups.remove(group),remove()},_groups.push(group),_this.startRender(loop,10)},this.setPageH1=function(group,title){let $h1=group.seo.h1;$h1||($h1=group.seo.create("title","h1"),defer((()=>{let el=$h1.div;el.parentNode.insertBefore(el,el.parentNode.firstChild)}))),$h1.text(title)},this.registerPersist=function(group,name){let topLevel=group;group=group instanceof GLUIObject?group:group.group||group.scene||group,Global.PLAYGROUND||World.ELEMENT.mouseEnabled(!1),topLevel.seo=group.seo=$this.create(name)},this.link=function($dom,group){$dom instanceof HydraObject&&((group=group.group||group.scene||group).seoDOM||(group.seoDOM=[]),group.seoDOM.push($dom),_links.push(group)),$dom instanceof GLUIObject&&($dom.seo=group.seo)},this.textNode=function($text,text){let parent=($text._3d?$text.anchor||$text.group:$text)._parent;if($text.parentSeo){let parentSeo=$text.parentSeo;parent=parentSeo.group&&parentSeo.group.seo?parentSeo.group:parentSeo}else if(parent)for(;parent&&!parent.seo;)parent=parent._parent;parent&&parent.seo&&($text.seo?($text.seo.text(text),$text.seo.accessible()):($text.seo=$("text"),$text.seo.group=$text.group,$text.seo.text(text),$text.seo.accessible(),parent.seo.add($text.seo),$text.seo.aLink=function(url,options){let index=Array.prototype.slice.call(parent.seo.div.children).indexOf($text.seo.div);$text.seo.remove(),$text.seo=aLink($text,url,text,options),parent.seo.div.insertBefore($text.seo.div,parent.seo.div.children[index])},$text.seo.unlink=function(){parent.seo.div.removeChild($text.seo.div),$text.seo.group=null,$text.seo=null}))},this.bindToPage=function(parent,child,name){child.__glseoParent=parent,_this.registerPage(child,name)},this.objectNode=function($object,$parent){let parent=$parent||($object._3d?$object.group:$object)._parent;if($object.parentSeo)parent=$object.parentSeo.group||$object.parentSeo;else{if(!parent)return;for(;parent&&!parent.seo;)parent=parent._parent}parent&&parent.seo&&($object.seo||($object.seo={},$object.seo.group=$object.group,$object.seo.aLink=function(url,label,options){let index=Array.prototype.slice.call(parent.seo.div.children).indexOf($object.seo.div);$object.seo=aLink($object,url,label,options),parent.seo.div.insertBefore($object.seo.div,parent.seo.div.children[index]),$object.seo.unlink=function(){parent.seo.div.removeChild($object.seo.div),$object.seo.group=null,$object.seo=null}}))}}),"static"),Class((function GLScreenProjection(_camera=World.CAMERA,_target=new Vector2){Inherit(this,Object3D);var _this=this,_projection=new ScreenProjection(_camera),_m0=new Matrix4,_m1=new Matrix4;function loop(){_this.pos.set(_target.x,_target.y),_this.pos3D.copy(_projection.unproject(_this.pos)),_this.group.updateMatrixWorld(),_m0.copy(_camera.projectionMatrix),_m1.getInverse(_camera.matrixWorld),_this.matrix.multiplyMatrices(_m0,_m1),_this.uniforms.normalMatrix.value.copy(_camera.matrixWorld),_this.uniforms.modelMatrix.value.copy(_this.group.matrixWorld)}this.resolution=new Vector2,this.pos=new Vector2,this.pos3D=new Vector3,this.matrix=new Matrix4,this.uniforms={projMatrix:{type:"m4",value:this.matrix},pos:{type:"v2",value:this.pos},pos3D:{type:"v3",value:this.pos3D},normalMatrix:{type:"m4",value:new Matrix4},modelMatrix:{type:"m4",value:new Matrix4}},this.set("camera",(v=>{_camera=v,_projection.camera=_camera})),this.set("target",(v=>{_target=v})),this.update=loop,this.start=function(){_this.startRender(loop)},this.stop=function(){_this.stopRender(loop)}})),Class((function GLText({font:font,italic:italic=!1,bold:bold=!1,text:text,width:width=1/0,align:align="left",size:size=1,direction:direction="ltr",letterSpacing:letterSpacing=0,lineHeight:lineHeight=1.4,wordSpacing:wordSpacing=0,wordBreak:wordBreak=!1,langBreak:langBreak=!1,paragraphSpacing:paragraphSpacing=1,color:color=new Color("#000000"),alpha:alpha=1,shader:shader="DefaultText",customCompile:customCompile=!1}){const _this=this;var _override,_promise=Promise.create();const config=GLText.FONT_CONFIG[font];function overrideParams(){if(GLText.overrideParams){_override={letterSpacing:letterSpacing,size:size,wordSpacing:wordSpacing,lineHeight:lineHeight};let obj=GLText.overrideParams({letterSpacing:letterSpacing,size:size,wordSpacing:wordSpacing,lineHeight:lineHeight});letterSpacing=obj.letterSpacing,size=obj.size,wordSpacing=obj.wordSpacing,lineHeight=obj.lineHeight}}function resetOverride(){_override&&(letterSpacing=_override.letterSpacing,size=_override.size,wordSpacing=_override.wordSpacing,lineHeight=_override.lineHeight)}!function init(){overrideParams(),_this.charLength=text.length,_this.text=new GLTextGeometry({font:font,italic:italic,bold:bold,text:text,width:width,align:align,direction:direction,wordSpacing:wordSpacing,letterSpacing:letterSpacing,paragraphSpacing:paragraphSpacing,size:size,lineHeight:lineHeight,wordBreak:wordBreak,langBreak:langBreak,config:config}),_this.string=text,resetOverride(),_this.text.loaded.then((({buffers:buffers,image:image,imageBold:imageBold,imageItalic:imageItalic,height:height,numLines:numLines})=>{_this.texture=GLText.getTexture(image),bold&&(_this.textureBold=GLText.getTexture(imageBold)),italic&&(_this.textureItalic=GLText.getTexture(imageItalic)),_this.shader=new Shader(shader,{tMap:{value:_this.texture,ignoreUIL:!0},tMapBold:{value:_this.textureBold||Utils3D.getEmptyTexture(),ignoreUIL:!0},tMapItalic:{value:_this.textureItalic||Utils3D.getEmptyTexture(),ignoreUIL:!0},uColor:{value:color,ignoreUIL:!0},uAlpha:{value:alpha,ignoreUIL:!0},transparent:!0,customCompile:customCompile}),_this.onCreateShader&&_this.onCreateShader(_this.shader),function createGeometry(buffers){_this.geometry=new Geometry,_this.geometry.addAttribute("position",new GeometryAttribute(buffers.position,3)),_this.geometry.addAttribute("uv",new GeometryAttribute(buffers.uv,2)),_this.geometry.addAttribute("animation",new GeometryAttribute(buffers.animation,3)),_this.geometry.addAttribute("weight",new GeometryAttribute(buffers.weight,1)),_this.geometry.setIndex(new GeometryAttribute(buffers.index,1)),_this.geometry.boundingBox=buffers.boundingBox,_this.geometry.boundingSphere=buffers.boundingSphere,_this.geometry.letterCount=buffers.letterCount+1,_this.geometry.wordCount=buffers.wordCount+1,_this.geometry.lineCount=buffers.lineCount+1}(buffers),_this.mesh=new Mesh(_this.geometry,_this.shader),_this.height=height,_promise.resolve()}))}(),void 0===font&&console.log(font,text),this.destroy=function(){_this.mesh&&_this.mesh.destroy&&_this.mesh.destroy()},this.ready=this.loaded=function(){return _promise},this.centerY=function(){_this.mesh.position.y=.5*_this.height,_this.needsCenterY=!0},this.resize=function(options){return this.setText(text,options)},this.tweenColor=function(c,time=300,ease="easeOutCubic"){c&&color.tween(c,time,ease)},this.setColor=function(c){c&&color.set(c)},this.setText=function(txt,options){if((text!=txt||!function match(options){return!options||options.font==font&&options.italic==italic&&options.bold==bold&&options.width==width&&options.align==align&&options.direction==direction&&!(options.wordSpacing>0&&options.wordSpacing!=wordSpacing)&&options.letterSpacing==letterSpacing&&options.paragraphSpacing==paragraphSpacing&&options.size==size&&options.lineHeight==lineHeight&&!(!0===options.wordBreak&&!options.wordBreak||0==options.wordBreak&&options.wordBreak)}(options))&&(text=txt))return function setVars(options){font=options.font||font,bold=options.bold||bold,italic=options.italic||italic,width=options.width||width,align=options.align||align,wordSpacing=options.wordSpacing||wordSpacing,letterSpacing=options.letterSpacing||letterSpacing,paragraphSpacing=options.paragraphSpacing||paragraphSpacing,size=options.size||size,lineHeight=options.lineHeight||lineHeight,wordBreak=options.wordBreak||wordBreak,langBreak=options.langBreak||langBreak,direction=options.direction||direction}(options||{}),overrideParams(),_this.string=text,_this.charLength=text.length,_this.text=new GLTextGeometry({font:font,italic:italic,bold:bold,text:text,width:width,align:align,direction:direction,wordSpacing:wordSpacing,letterSpacing:letterSpacing,paragraphSpacing:paragraphSpacing,size:size,lineHeight:lineHeight,wordBreak:wordBreak,langBreak:langBreak,config:config}),resetOverride(),_promise=Promise.create(),_this.text.loaded.then((({buffers:buffers,image:image,imageBold:imageBold,imageItalic:imageItalic,height:height,numLines:numLines})=>{!function updateGeometry(buffers){_this.geometry.attributes.position.setArray(buffers.position),_this.geometry.attributes.uv.setArray(buffers.uv),_this.geometry.attributes.animation.setArray(buffers.animation),_this.geometry.attributes.weight.setArray(buffers.weight),_this.geometry.index=buffers.index,_this.geometry.indexNeedsUpdate=!0,_this.geometry.boundingBox=buffers.boundingBox,_this.geometry.boundingSphere=buffers.boundingSphere,_this.geometry.letterCount=buffers.letterCount+1,_this.geometry.wordCount=buffers.wordCount+1,_this.geometry.lineCount=buffers.lineCount+1}(buffers),_this.height=height,_this.needsCenterY&&_this.centerY(),_promise.resolve()})),_promise},this.getData=function(){return{font:font,italic:italic,bold:bold,text:text,width:width,align:align,direction:direction,wordSpacing:wordSpacing,letterSpacing:letterSpacing,paragraphSpacing:paragraphSpacing,size:size,lineHeight:lineHeight,wordBreak:wordBreak,langBreak:langBreak,color:color}}}),(_=>{GLText.FONT_CONFIG={};var _map=new Map;GLText.getTexture=function(image){if(!_map.get(image)){let texture=new Texture(image);texture.generateMipmaps=!1,texture.minFilter=Texture.LINEAR,_map.set(image,texture)}return _map.get(image)}})),Class((function GLTextGeometry({font:font,italic:italic,bold:bold,text:text,width:width=1/0,align:align="left",size:size=1,direction:direction="ltr",letterSpacing:letterSpacing=0,paragraphSpacing:paragraphSpacing=1,lineHeight:lineHeight=1.4,wordSpacing:wordSpacing=0,wordBreak:wordBreak=!1,langBreak:langBreak=!1,config:config={}}){let json,image,glyphs,bJson,bImage,bGlyphs,iJson,iImage,iGlyphs,_this=this;_this.loaded=Promise.create(),_this.fontLoaded=Promise.create(),async function init(){await async function loadFont(){[json,image,glyphs]=await GLTextGeometry.loadFont(font),bold&&([bJson,bImage,bGlyphs]=await GLTextGeometry.loadFont(bold));italic&&([iJson,iImage,iGlyphs]=await GLTextGeometry.loadFont(italic));_this.fontLoaded.resolve()}(),async function createGeometry(){let buffers=await GLTextThread.generate({font:font,bold:bold,italic:italic,text:text,width:width,align:align,size:size,direction:direction,letterSpacing:letterSpacing,paragraphSpacing:paragraphSpacing,lineHeight:lineHeight,wordSpacing:wordSpacing,wordBreak:wordBreak,langBreak:langBreak,json:json,glyphs:glyphs,bJson:bJson,bGlyphs:bGlyphs,iJson:iJson,iGlyphs:iGlyphs,config:config});_this.buffers=buffers,_this.image=image,_this.imageBold=bImage,_this.imageItalic=iImage,_this.numLines=buffers.lineLength,_this.height=_this.numLines*size*lineHeight,_this.onLayout&&_this.onLayout(buffers,image,_this.height,_this.numLines),_this.loaded.resolve({buffers:buffers,image:image,imageBold:bImage,imageItalic:iImage,height:_this.height,numLines:_this.numLines})}()}()}),(_=>{async function loadJSON(font){return await get(getPathTo(font,"json"))}async function loadImage(font){return await new Promise((resolve=>{let img=new Image;img.onload=()=>resolve(img),img.crossOrigin="anonymous",img.src=getPathTo(font,"png")}))}function getPathTo(font,ext){let mapped=!1,fontName=function(){for(let key in GLTextGeometry.fontMapping){let mapping=GLTextGeometry.fontMapping[key];if(key==font)return mapped=!0,mapping}return font}(),path=mapped&&GLTextGeometry.fontPath?GLTextGeometry.fontPath:"assets/fonts/";return Assets.getPath(path+fontName+"."+ext+"?"+(window._CACHE_||Date.now()))}let _promises={};GLTextGeometry.fontMapping={},GLTextGeometry.chars={},GLTextGeometry.loadFont=function(font){if(!_promises[font]){let promise=Promise.create();_promises[font]=promise,async function(){let[json,image]=await Promise.all([loadJSON(font),loadImage(font)]);glyphs={},json.chars.forEach((d=>glyphs[d.char]=d)),promise.resolve([json,image,glyphs]),GLTextGeometry.chars[font]=json.chars}()}return _promises[font]}})),Class((function GLTextThread(){function loadTextGeometry({font:font,bold:bold,italic:italic,text:text,width:width,align:align,size:size,direction:direction,letterSpacing:letterSpacing,paragraphSpacing:paragraphSpacing,lineHeight:lineHeight,wordSpacing:wordSpacing,wordBreak:wordBreak,langBreak:langBreak,json:json,glyphs:glyphs,bJson:bJson,bGlyphs:bGlyphs,iJson:iJson,iGlyphs:iGlyphs,config:config},pid){const newline=/\n/,whitespace=/[^\S]/,langbreak=!!langBreak&&new RegExp(langBreak),dir="rtl"===direction?-1:1;config||(config={}),config.boldBaseOffset=config.boldBaseOffset?config.boldBaseOffset:0,config.italicBaseOffset=config.italicBaseOffset?config.italicBaseOffset:0;let weights=[],weight={0:glyphs,1:bGlyphs,2:iGlyphs};var buffers;function getKernPairOffset(id1,id2){for(let i=0;i<json.kernings.length;i++){let k=json.kernings[i];if(!(k.first<id1)&&!(k.second<id2))return k.first>id1||k.first===id1&&k.second>id2?0:k.amount}return 0}!function setWeights(){let i=0,w=0;for(;i<text.length;){let code=text.substring(i,i+3).toLowerCase(),endcode=text.substring(i,i+4).toLowerCase();"<b>"!==code&&"<i>"!==code||(w="<b>"===code?1:2,text=text.substr(0,i)+text.substr(i+3)),"</b>"!==endcode&&"</i>"!==endcode||(w=0,text=text.substr(0,i)+text.substr(i+4)),weights.push(w),i++}}(),function createGeometry(){fontHeight=json.common.lineHeight,baseline=json.common.base,scale=size/baseline;let numChars=text.replace(/[ \n]/g,"").length;buffers={position:new Float32Array(4*numChars*3),uv:new Float32Array(4*numChars*2),animation:new Float32Array(3*numChars*4),index:new Uint16Array(6*numChars),weight:new Float32Array(4*numChars)};for(let i=0;i<numChars;i++)buffers.index.set([4*i,4*i+2,4*i+1,4*i+1,4*i+2,4*i+3],6*i);!function layout(){const lines=[];let cursor=0,wordCursor=0,wordWidth=0,line=newLine();function newLine(br=!1){const line={width:0,glyphs:[]};return lines.last()&&(lines.last().br=br),lines.push(line),wordCursor=cursor,wordWidth=0,line}for(;cursor<text.length;){let prev=text[cursor-1],char=text[cursor];text[cursor+1];if(!line.width&&whitespace.test(char)&&!(prev&&newline.test(char)&&newline.test(prev))){cursor++,wordCursor=cursor,wordWidth=0;continue}if(newline.test(char)){cursor++,line=newLine(!0);continue}let style=weight[weights[cursor]]||weight[0],glyph=style[char];if(glyph||(console.warn(`font ${font} missing character '${char}'`),char=Object.keys(style)[0],glyph=style[char]),glyph.weight=weights[cursor],line.glyphs.length){const prevGlyph=line.glyphs[line.glyphs.length-1][0];let kern=getKernPairOffset(glyph.id,prevGlyph.id)*scale;line.width+=kern,wordWidth+=kern*dir}let gl=Object.assign({},glyph);gl.weight=weights[cursor],line.glyphs.push([gl,line.width]);let advance=0;if(whitespace.test(char)?(gl.whitespace=!0,wordCursor=cursor,wordWidth=0,advance+=wordSpacing*size):advance+=letterSpacing*size,advance+=glyph.xadvance*scale,line.width+=advance,wordWidth+=advance,line.width>width){if((wordBreak||char&&langBreak&&!langbreak.test(char))&&line.glyphs.length>1){line.width-=advance,line.glyphs.pop(),line=newLine();continue}if(!wordBreak&&wordWidth!==line.width){let numGlyphs=cursor-wordCursor+1;line.glyphs.splice(-numGlyphs,numGlyphs),cursor=wordCursor,line.width-=wordWidth,line=newLine();continue}}cursor++}line.width||lines.pop();if("justify"===align){let max=-1/0;lines.forEach((l=>{l.whitespaces=0,max<l.width&&(max=l.width),l.glyphs.forEach((g=>{g[0].whitespace&&l.whitespaces++}))})),lines.forEach((l=>{let totalToAdd=max-l.width,addToWhitespace=0===l.whitespaces?0:totalToAdd/l.whitespaces;l.width=max;let additionalOffset=0;l.glyphs.forEach((g=>{g[1]+=additionalOffset,g[0].whitespace&&(additionalOffset+=addToWhitespace)}))}))}!function populateBuffers(lines){const texW=json.common.scaleW,texH=json.common.scaleH;let geom,y=(config.baseOffset?config.baseOffset:.07)*size,j=0,glyphIndex=0,wordIndex=-1,lineId=-1;for(let lineIndex=0;lineIndex<lines.length;lineIndex++){let line=lines[lineIndex];wordIndex++,lineId++;for(let i=0;i<line.glyphs.length;i++){const glyph=line.glyphs[i][0];let x=line.glyphs[i][1];if(-1===dir&&(x=line.width-x),"center"===align||"justify"===align?x-=.5*line.width:"right"===align&&(x-=line.width*dir),whitespace.test(glyph.char)){wordIndex++;continue}1===glyph.weight&&(y+=config.boldBaseOffset*scale),2===glyph.weight&&(y+=config.italicBaseOffset*scale),x+=glyph.xoffset*scale*dir,y-=glyph.yoffset*scale,buffers.weight.set([glyph.weight,glyph.weight,glyph.weight,glyph.weight],4*glyphIndex);let w=glyph.width*scale,h=glyph.height*scale;-1===dir?buffers.position.set([x-w,y-h,0,x-w,y,0,x,y-h,0,x,y,0],4*j*3):buffers.position.set([x,y-h,0,x,y,0,x+w,y-h,0,x+w,y,0],4*j*3),buffers.animation.set([glyphIndex,wordIndex,lineId,glyphIndex,wordIndex,lineId,glyphIndex,wordIndex,lineId,glyphIndex,wordIndex,lineId],3*glyphIndex*4),glyphIndex++;let u=glyph.x/texW,uw=glyph.width/texW,v=1-glyph.y/texH,vh=glyph.height/texH;buffers.uv.set([u,v-vh,u,v,u+uw,v-vh,u+uw,v],4*j*2),1===glyph.weight&&(y-=config.boldBaseOffset*scale),2===glyph.weight&&(y-=config.italicBaseOffset*scale),y+=glyph.yoffset*scale,j++}y-=size*lineHeight*(line.br?paragraphSpacing:1)}window.zUtils3D&&(geom=new Geometry,geom.addAttribute("position",new GeometryAttribute(buffers.position,3)),geom.computeBoundingBox(),geom.computeBoundingSphere());let backing=[];for(let key in buffers)backing.push(buffers[key].buffer);buffers.lineLength=lines.length,geom&&(buffers.boundingBox=geom.boundingBox,buffers.boundingSphere=geom.boundingSphere);buffers.letterCount=glyphIndex,buffers.lineCount=lineId,buffers.wordCount=wordIndex,resolve(buffers,pid,backing)}(lines)}()}()}Thread.upload(loadTextGeometry),this.generate=async function(obj){return Thread.shared().loadTextGeometry(obj)}}),"static"),Class((function GLUI(){Inherit(this,Component);const _this=this,hasMetal=!!window.Metal,hasAuraAR=!!window.AURA_AR;function loop(){hasMetal||(hasAuraAR&&AURA_AR.active&&(World.NUKE.postRender=null,AURA_AR.postRender=loop),_this.Scene&&_this.Scene.render(),_this.Stage&&_this.Stage.render())}window.$gl=function(width,height,map,customCompile){return new GLUIObject(width,height,map,customCompile)},window.$glText=function(text,fontName,fontSize,options,customCompile){return new GLUIText(text,fontName,fontSize,options,customCompile)},this.init=async function(is2D,is3D){_this.initialized||(void 0===is2D&&(is2D=!0,is3D=!0),await AssetLoader.waitForLib("zUtils3D"),is2D&&(_this.Stage=new GLUIStage),is3D&&(_this.Scene=new GLUIStage3D,_this.Scene.interaction.input=Mouse),_this.wait(World,"NUKE",(_=>{_this.initialized=!0,_this.Scene&&(World.NUKE.onBeforeRender=_this.Scene.mark),World.NUKE.postRender=loop})))},this.clear=function(){_this.Stage.clear(),_this.Scene.clear()},this.ready=function(){return _this.wait(_this,"initialized")},this.renderDirect=function(render){_this.Scene&&_this.Scene.renderDirect(render),_this.Stage&&_this.Stage.renderDirect(render)}}),"static"),Class((function GLUIElement(){Inherit(this,Component);this.element=$gl(),this.create=function(w,h,t){return this.element.create(w,h,t)}})),Class((function GLUIUtils(){const _this=this;_this.setRetinaMode=function($obj,retinaMode,parent){if(RenderManager.type===RenderManager.WEBVR&&(retinaMode=!1),parent||(parent=$obj.anchor&&$obj.anchor._parent||$obj.group._parent))if(retinaMode){let gluiToRTScene,p=parent;for(;p;)p.glSceneEnabled&&(gluiToRTScene=p),p=p.parent;gluiToRTScene?gluiToRTScene.glScene.add($obj):GLUI.Scene.add($obj),parent.add($obj.anchor),$obj.anchor.retinaAnchorFor=$obj,$obj.group.asyncPromise&&!$obj.anchor.asyncPromise&&($obj.anchor.asyncPromise=$obj.group.asyncPromise),1===$obj.scaleX&&1===$obj.scaleY||($obj.isDirty=!0,$obj.mesh&&$obj.mesh.onBeforeRender&&$obj.mesh.onBeforeRender())}else _this.isRetinaMode($obj)&&(parent.remove($obj.anchor),GLUI.Scene.remove($obj),$obj.anchor._parent=null,$obj.group.visible=parent.determineVisible(),"boolean"==typeof $obj.isDirty&&$obj.mesh&&$obj.mesh.onBeforeRender?($obj.isDirty=!0,$obj.mesh.onBeforeRender()):($obj.group.position.setScalar(0),$obj.group.quaternion.set(0,0,0,1),$obj.group.scale.setScalar(1)),$obj.deferred=!1,$obj.parent=null),parent.add($obj.group)},_this.isRetinaMode=function($obj){return RenderManager.type!==RenderManager.WEBVR&&$obj.anchor&&$obj.anchor._parent&&$obj.parent===GLUI.Scene}}),"static"),Class((function GLUIBatch(globalUniforms={},_useWorldCoords){Inherit(this,Component);const _this=this;var _timer,_geometry,_shader,_objects=[];function loop(){if(_geometry)for(let i=0;i<_objects.length;i++){let obj=_objects[i];obj._buffers&&(obj.mesh.onBeforeRender(),_useWorldCoords&&(obj.group.updateMatrixWorld(),obj.mesh.getWorldPosition(obj.worldPosition),obj.worldRotation.setFromQuaternion(obj.mesh.getWorldQuaternion()),obj.mesh.getWorldScale(obj.worldScale)),obj._buffers.forEach((buffer=>{let dirty=!1;if(dirty=!buffer.value.equals(buffer.lookup),buffer.value.copy(buffer.lookup),dirty){let attribute=_geometry.attributes[buffer.key],array=attribute.array;switch(buffer.key){case"scale":_useWorldCoords?(array[2*i+0]=obj.worldScale.x,array[2*i+1]=obj.worldScale.y):(array[2*i+0]=obj.group.scale.x*obj.mesh.scale.x,array[2*i+1]=obj.group.scale.y*obj.mesh.scale.y);break;case"rotation":array[i]=buffer.lookup.z;break;default:_useWorldCoords?(array[3*i+0]=obj.worldPosition.x,array[3*i+1]=obj.worldPosition.y):(array[3*i+0]=obj.group.position.x,array[3*i+1]=obj.group.position.y),array[3*i+2]=obj.mesh.renderOrder}attribute.needsUpdate=!0}})),obj._uniforms.forEach((uniform=>{let dirty=!1;if("f"==uniform.type?(dirty=obj.mesh.shader.uniforms[uniform.key].value!=uniform.value,uniform.value=obj.mesh.shader.uniforms[uniform.key].value):(dirty=!obj.mesh.shader.uniforms[uniform.key].value.equals(uniform.value),uniform.value.copy(obj.mesh.shader.uniforms[uniform.key].value)),dirty){let attribute=_geometry.attributes["a_"+uniform.key],array=attribute.array;"f"==uniform.type?array[i]=uniform.value:uniform.value.toArray(array,i*uniform.components),attribute.needsUpdate=!0}})))}}function getTypeFromSize(size){switch(size){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4"}}function createMesh(){let shader=_objects[0].mesh.shader;_geometry=(new Geometry).instanceFrom(_objects[0].mesh.geometry.clone());let map={},arrays={};_objects.forEach(((obj,i)=>{obj.mesh.onBeforeRender();let buffers=[],uniforms=[];for(let key in shader.uniforms){let uniform=shader.uniforms[key];uniform&&(uniform.value instanceof Color&&uniforms.push({key:key,type:"c",components:3}),uniform.value instanceof Vector4&&uniforms.push({key:key,type:"v4",components:4}),uniform.value instanceof Vector3&&uniforms.push({key:key,type:"v3",components:3}),uniform.value instanceof Vector2&&uniforms.push({key:key,type:"v",components:2}),"number"==typeof uniform.value&&uniforms.push({key:key,type:"f",components:1}))}_useWorldCoords&&(obj.worldScale=new Vector3,obj.worldRotation=new Euler,obj.worldPosition=new Vector3),buffers.push({key:"scale",lookup:_useWorldCoords?obj.worldScale:obj.group.scale,components:2}),buffers.push({key:"rotation",lookup:_useWorldCoords?obj.worldRotation:obj.group.rotation,components:1}),buffers.push({key:"offset",lookup:_useWorldCoords?obj.worldPosition:obj.group.position,components:3}),uniforms.forEach((uniform=>{arrays["a_"+uniform.key]||(arrays["a_"+uniform.key]=[]),map["a_"+uniform.key]||(map["a_"+uniform.key]=uniform);let value=shader.uniforms[uniform.key].value;"object"==typeof value?(uniform.value=value.clone(),uniform.value.toArray(arrays["a_"+uniform.key],i*uniform.components)):(uniform.value=shader.uniforms[uniform.key].value,arrays["a_"+uniform.key].push(uniform.value))})),buffers.forEach((buffer=>{switch(arrays[buffer.key]||(arrays[buffer.key]=[]),map[buffer.key]||(map[buffer.key]=buffer),buffer.value=buffer.lookup.clone(),buffer.key){case"scale":arrays[buffer.key].push(obj.group.scale.x*obj.mesh.scale.x,obj.group.scale.y*obj.mesh.scale.y);break;case"rotation":arrays[buffer.key].push(buffer.lookup.z);break;default:arrays[buffer.key].push(buffer.lookup.x,buffer.lookup.y,obj.mesh.renderOrder)}})),obj._buffers=buffers,obj._uniforms=uniforms,obj.shader.neverRender=!0}));let attributes=[],defines=[];for(let key in map)key.includes("a_")&&(attributes.push(`% ${getTypeFromSize(map[key].components)} ${key};`),defines.push(`${key.replace("a_","v_")} = ${key};`));attributes=attributes.join("\n"),defines=defines.join("\n");for(let key in arrays)_geometry.addAttribute(key,new GeometryAttribute(new Float32Array(arrays[key]),map[key].components,1));if(GLUIBatch.cache[shader.fsName])_shader=GLUIBatch.cache[shader.fsName];else{let vsSplit=(_shader=_this.initClass(Shader,"GLUIBatch",shader.fsName,Object.assign({},{transparent:!0,depthWrite:!1,depthTest:!1},globalUniforms))).vertexShader.split("__ACTIVE_THEORY_LIGHTS__"),fsSplit=_shader.fragmentShader.split("__ACTIVE_THEORY_LIGHTS__"),definitions=[];fsSplit[1].split("\n").forEach((line=>{if(line.includes("uniform")){if(line.includes("sampler2D"))return;let data=line.split(" ");definitions.push(`${data[2].replace(";","")} = a_${data[2]}`),vsSplit[1]=`\nattribute ${data[1]} a_${data[2]}\nvarying ${data[1]} ${data[2]}`+vsSplit[1],vsSplit[1]=vsSplit[1].replace(line,""),fsSplit[1]=fsSplit[1].replace(line,`varying ${data[1]} ${data[2]}`)}})),vsSplit[1]=vsSplit[1].replace("//vdefines","\n"+definitions.join("\n")),_shader.vertexShader=vsSplit.join("__ACTIVE_THEORY_LIGHTS__"),_shader.fragmentShader=fsSplit.join("__ACTIVE_THEORY_LIGHTS__"),GLUIBatch.cache[shader.fsName]=_shader}shader.copyUniformsTo(_shader),_this.mesh=new Mesh(_geometry,_shader),_this.mesh.frustumCulled=!1,_this.group.add(_this.mesh)}this.group=new Group,"boolean"==typeof globalUniforms&&(_useWorldCoords=globalUniforms,globalUniforms={}),GLUIBatch.cache||(GLUIBatch.cache={}),_this.startRender(loop),this.add=function(obj){if(clearTimeout(_timer),_timer=_this.delayedCall(createMesh,50),_useWorldCoords){let getAlpha=obj.getAlpha;getAlpha&&(obj.getAlpha=()=>(_this.parent?_this.parent.getAlpha():1)*getAlpha.call(obj))}else _this.parent.add(obj);_objects.push(obj)},this.setZ=async function(z){await _this.wait("mesh"),_this.mesh.renderOrder=z},this.onDestroy=function(){_this.mesh&&_this.mesh.destroy()}})),Class((function GLUIBatchText(globalUniforms={},_useWorldCoords,_shaderName){Inherit(this,Component);const _this=this;var _geometry,_shader,_timer,_forceUpdate,_promises=[],_toSplice=[],_objects=[],_offset=0;function loop(){if(!_geometry)return;let updated=!1;for(let key in _geometry.attributes){let attrib=_geometry.attributes[key];attrib.updateRange.length&&(attrib.updateRange.length=0)}let len=_objects.length;for(let i=0;i<len;i++){let obj=_objects[i];obj.mesh.onBeforeRender(),_useWorldCoords&&(obj.group.updateMatrixWorld(),obj.mesh.getWorldPosition(obj.worldPosition),obj.worldRotation.setFromQuaternion(obj.mesh.getWorldQuaternion()),obj.mesh.getWorldScale(obj.worldScale));let offset=obj._offset,count=obj._count,end=offset+count;obj._buffers.forEach((buffer=>{let dirty=!1;if(dirty=!buffer.value.equals(buffer.lookup),buffer.value.copy(buffer.lookup),dirty){let array=_geometry.attributes[buffer.key].array;for(let j=offset;j<end;j++)switch(buffer.components){case 4:array[4*j+0]=buffer.lookup.x,array[4*j+1]=buffer.lookup.y,array[4*j+2]=buffer.lookup.z,array[4*j+3]=buffer.lookup.w;break;case 3:array[3*j+0]=buffer.lookup.x,array[3*j+1]=buffer.lookup.y,array[3*j+2]=buffer.lookup.z;break;case 2:array[2*j+0]=buffer.lookup.x,array[2*j+1]=buffer.lookup.y;break;case 1:array[j]=buffer.lookup.z}updated=!0,buffer.updateRange.offset=offset*buffer.components,buffer.updateRange.count=count*buffer.components,_geometry.attributes[buffer.key].updateRange.push(buffer.updateRange),_geometry.attributes[buffer.key].needsUpdate=!0}})),obj._uniforms.forEach((uniform=>{let dirty=!1;if("f"==uniform.type?(dirty=obj.mesh.shader.uniforms[uniform.key].value!=uniform.value,uniform.value=obj.mesh.shader.uniforms[uniform.key].value):(dirty=!obj.mesh.shader.uniforms[uniform.key].value.equals(uniform.value),uniform.value.copy(obj.mesh.shader.uniforms[uniform.key].value)),dirty||_forceUpdate){let array=_geometry.attributes["a_"+uniform.key].array;for(let j=offset;j<end;j++)"f"==uniform.type?array[j]=obj.mesh.shader.uniforms[uniform.key].value:obj.mesh.shader.uniforms[uniform.key].value.toArray(array,j*uniform.components);updated=!0,uniform.updateRange.offset=offset*uniform.components,uniform.updateRange.count=count*uniform.components,_geometry.attributes["a_"+uniform.key].updateRange.push(uniform.updateRange),_geometry.attributes["a_"+uniform.key].needsUpdate=!0}}))}if(updated)for(let key in _geometry.attributes){let bottom,attrib=_geometry.attributes[key];if(!attrib.updateRange.length)continue;let toSplice=_toSplice;toSplice.length=0;for(let i=0;i<attrib.updateRange.length;i++){let current=attrib.updateRange[i],prev=attrib.updateRange[i-1];prev?prev.offset+prev.count==current.offset?(bottom.count+=current.count,toSplice.push(i)):bottom=current:bottom=current}for(let i=toSplice.length-1;i>-1;i--)attrib.updateRange.splice(toSplice[i],1)}_forceUpdate=!1}async function createMesh(){if(_this.flag("mesh"))return;_this.flag("mesh",!0),await Promise.all(_promises),await _this.wait(100);let mesh=new Mesh(_geometry,_shader);_this.mesh=mesh,mesh.frustumCulled=!1,_this.group.add(mesh)}this.group=new Group,this.enable3D=()=>{},"boolean"==typeof globalUniforms&&(_useWorldCoords=globalUniforms,globalUniforms={}),_this.flag("canLoad",!0),_this.startRender(loop),_this.add=async function(obj){if(await _this.flag("canLoad"),_this.flag("canLoad",!1),await obj.loaded(),obj.mesh.shader.neverRender=!0,_promises.push(obj.loaded()),function addAttributes(obj,mesh){let{geometry:geometry,shader:shader}=mesh,count=geometry.attributes.uv.count;mesh.onBeforeRender();let buffers=[],uniforms=[];for(let key in shader.uniforms){let uniform=shader.uniforms[key];uniform.value instanceof Color&&uniforms.push({key:key,type:"c",components:3}),uniform.value instanceof Vector3&&uniforms.push({key:key,type:"v3",components:3}),uniform.value instanceof Vector4&&uniforms.push({key:key,type:"v4",components:4}),uniform.value instanceof Vector2&&uniforms.push({key:key,type:"v",components:2}),"number"==typeof uniform.value&&uniforms.push({key:key,type:"f",components:1})}_useWorldCoords&&(obj.worldScale=new Vector3,obj.worldRotation=new Euler,obj.worldPosition=new Vector3),buffers.push({key:"offset",lookup:_useWorldCoords?obj.worldPosition:obj.group.position,components:3}),buffers.push({key:"scale",lookup:_useWorldCoords?obj.worldScale:obj.group.scale,components:2}),buffers.push({key:"rotation",lookup:_useWorldCoords?obj.worldRotation:obj.group.rotation,components:1}),uniforms.forEach((uniform=>{uniform.updateRange={},uniform.value=shader.uniforms[uniform.key].value,"object"==typeof uniform.value&&(uniform.value=uniform.value.clone()),uniform.buffer=new Float32Array(count*uniform.components)})),buffers.forEach((buffer=>{buffer.updateRange={},buffer.value=buffer.lookup.clone(),buffer.buffer=new Float32Array(count*buffer.components)}));for(let i=0;i<count;i++)buffers.forEach((buffer=>{switch(buffer.components){case 4:buffer.buffer[4*i+0]=buffer.lookup.x,buffer.buffer[4*i+1]=buffer.lookup.y,buffer.buffer[4*i+2]=buffer.lookup.z,buffer.buffer[4*i+3]=buffer.lookup.w;break;case 3:buffer.buffer[3*i+0]=buffer.lookup.x,buffer.buffer[3*i+1]=buffer.lookup.y,buffer.buffer[3*i+2]=buffer.lookup.z;break;case 2:buffer.buffer[2*i+0]=buffer.lookup.x,buffer.buffer[2*i+1]=buffer.lookup.y;break;case 1:buffer.buffer[i]=buffer.lookup.z}})),uniforms.forEach((uniform=>{"f"==uniform.type?uniform.buffer[i]=shader.uniforms[uniform.key].value:shader.uniforms[uniform.key].value.toArray(uniform.buffer,i*uniform.components)}));buffers.forEach((buffer=>{geometry.addAttribute(buffer.key,new GeometryAttribute(buffer.buffer,buffer.components))})),uniforms.forEach((uniform=>{geometry.addAttribute("a_"+uniform.key,new GeometryAttribute(uniform.buffer,uniform.components))})),obj._offset=_offset,obj._count=count,obj._uniforms=uniforms,obj._buffers=buffers,_objects.push(obj),_offset+=count}(obj,obj.mesh),_useWorldCoords){let getAlpha=obj.getAlpha;getAlpha&&(obj.getAlpha=()=>(_this.parent?_this.parent.getAlpha():1)*getAlpha.call(obj))}else _this.parent.add(obj);_geometry?_geometry.merge(obj.mesh.geometry):function initGeometry(mesh){(_shader=_this.initClass(Shader,_shaderName||"GLUIBatchText",_shaderName||mesh.shader.fsName,Object.assign({},{transparent:!0,depthWrite:!1,customCompile:`${mesh.shader.vsName}|${mesh.shader.fsName}|instance`},globalUniforms))).vertexShader||_shader.resetProgram();let vsSplit=_shader.vertexShader.split("__ACTIVE_THEORY_LIGHTS__"),fsSplit=_shader.fragmentShader.split("__ACTIVE_THEORY_LIGHTS__"),definitions=[],definitionSplit=[];fsSplit[1].split("\n").forEach((line=>{if(line.includes("uniform")){if(line.includes("sampler2D"))return;let data=line.split(" ");definitions.push(`${data[2].replace(";","")} = a_${data[2]}`),vsSplit[1]=`\nattribute ${data[1]} a_${data[2]}\nvarying ${data[1]} ${data[2]}`+vsSplit[1],vsSplit[1]=vsSplit[1].replace(line,""),fsSplit[1]=fsSplit[1].replace(line,`varying ${data[1]} ${data[2]}`)}})),definitions.forEach((def=>definitionSplit.push(def.split(" =")[0].trim())));let baseVS=Shaders.getShader(mesh.shader.vsName+".vs");if(baseVS.includes("//start batch main")){let main=baseVS.split("//start batch main")[1].split("//end batch main")[0];vsSplit[1]=vsSplit[1].replace("//custommain",main);let beforeMain=baseVS.split("void main() {")[0];beforeMain=beforeMain.replace("uniform sampler2D tMap;",""),beforeMain=beforeMain.replace("varying vec2 vUv;",""),beforeMain.split("\n").forEach((line=>{definitionSplit.forEach((def=>{line.includes(def)&&line.includes(["uniform","varying"])&&(beforeMain=beforeMain.replace(line,""))}))})),vsSplit[0]+=beforeMain}vsSplit[1]=vsSplit[1].replace("//vdefines","\n"+definitions.join("\n")),_shader.vertexShader=vsSplit.join("__ACTIVE_THEORY_LIGHTS__"),_shader.fragmentShader=fsSplit.join("__ACTIVE_THEORY_LIGHTS__"),mesh.shader.copyUniformsTo(_shader),_geometry=mesh.geometry.clone();for(let key in _geometry.attributes)_geometry.attributes[key].updateRange=[]}(obj.mesh),_this.flag("canLoad",!0),clearTimeout(_timer),_timer=_this.delayedCall(createMesh,50),obj.isDirty=!0},_this.forceUpdate=function(){_forceUpdate=!0},_this.onDestroy=function(){_this.mesh&&_this.mesh.destroy()}})),Class((function GLUIStageInteraction2D(_camera,_scene,_stage,_custom){Inherit(this,Component);const _this=this;var _ray,_over,_click,_customTest,_disabled,_blocked,_test=[],_objects=this.objects=[],_hold=new Vector2,_lastTestedPoint=(new Vector2,new Vector2),_plane=new Plane;function cacheTopScene(obj){let p=obj;for(;p;)p instanceof Scene&&(obj.interactionScene=p),p=p._parent}function testObjects(){let objects=GLUI.Stage.interaction.objects;_test.length=0;for(let i=objects.length-1;i>-1;i--){let obj=objects[i];obj.interactionScene||cacheTopScene(obj),(obj.forceGLUIInteraction||obj.determineVisible()&&_scene==obj.interactionScene)&&_test.push(obj)}return _test}function externalStart(){_this._invisible||start(_lastTestedPoint)}function externalRelease(){_this._invisible||end(_lastTestedPoint)}function move(e){if(GLUI.PREVENT_INTERACTION||_this._invisible||_disabled||_blocked)return;_ray||((_ray=new Raycaster(_camera)).testVisibility=!1);let objects=testObjects();if(!objects.length)return void(_over&&(_over._onOver({action:"out",object:_over}),_over=null,Stage.cursor("auto")));let hit=_ray.checkHit(objects,e,_stage);try{if(hit[0]){_customTest||(GLUI.HIT=!0);let obj=hit[0].object.glui;_over||((_over=obj)._onOver({action:"over",object:obj}),Stage.cursor("pointer")),_over!=obj&&(_over._onOver({action:"out",object:_over}),(_over=obj)._onOver({action:"over",object:obj}),Stage.cursor("pointer"))}else _customTest||(GLUI.HIT=!1),_over&&(_over._onOver({action:"out",object:_over}),_over=null,Stage.cursor("auto"))}catch(e){console.warn(e)}}function start(e){let handlingEvent=!(e instanceof Vector2),checkDefault=GLUI.PREVENT_DEFAULT_INTERACTION&&handlingEvent,checkPrevention=GLUI.PREVENT_INTERACTION||_this._invisible||_disabled||_blocked;checkDefault||checkPrevention||(_custom&&handlingEvent||!Device.mobile&&RenderManager.type!=RenderManager.WEBVR||move(e),_over&&!_click&&(_click=_over,_hold.copy(e),_hold.time=Date.now()))}function end(e){if(!(GLUI.PREVENT_INTERACTION||_this._invisible||_disabled||_blocked)){if(_customTest&&Device.mobile&&_click&&null==_over&&(_over=_click),GLUI.HIT=!1,_click){if(Date.now()-_hold.time>750)return _click=null;if(_click==_over)try{_blocked=!0,_this.delayedCall((_=>{_blocked=!1}),_this.preventDoubleClickTime),_click._onClick({action:"click",object:_click}),(Device.mobile||_custom)&&_over&&(_over._onOver({action:"out",object:_over}),_over=null,Stage.cursor("auto"))}catch(e){console.warn(e)}}_click=null}}function findCapture(object){let capture=object.__slc;return void 0===capture?object.__slc=UI3D.findStageLayoutCapture(object)||null:capture}this.preventDoubleClickTime=300,function addListeners(){_custom||_this.events.sub(Mouse.input,Interaction.MOVE,move),_this.events.sub(Mouse.input,Interaction.START,start),_this.events.sub(Mouse.input,Interaction.END,end),_this.events.sub(Interaction3D.EXTERNAL_PRESS,externalStart),_this.events.sub(Interaction3D.EXTERNAL_RELEASE,externalRelease)}(),_this.startRender((_=>{})),this.add=function(obj){obj&&_objects.push(obj.mesh||obj)},this.remove=function(obj){obj&&_objects.remove(obj.mesh||obj)},this.testWith=function(point,id){point.customTest=!0,_lastTestedPoint.copy(point),_lastTestedPoint.customTest=!0,_customTest=!0,move(point),Device.mobile&&RenderManager.type!=RenderManager.WEBVR&&_over&&start(point)},this.testWithFinger=function(point,distance,minDistance){_ray||((_ray=new Raycaster(_camera)).testVisibility=!1),_customTest=!0;let objects=testObjects();if(objects.length)if(distance<.02){let hit=_ray.checkHit(objects,point,_stage);try{if(hit[0]){let obj=hit[0].object.glui;(!obj._preventClickTime||Render.TIME-obj._preventClickTime>_this.preventDoubleClickTime)&&(obj._requiresClear||(_over=obj,obj._onOver({action:"over",object:obj}),obj._onClick({action:"click",object:obj}),obj._preventClickTime=Render.TIME,obj._requiresClear=!0))}else _over&&(_over._requiresClear=!1,_over._onOver({action:"out",object:_over}),_over=null)}catch(e){console.warn(e)}}else _over&&(_over._requiresClear=!1,_over._onOver({action:"out",object:_over}),_over=null)},this.checkObjectHit=function(object,mouse){let capture=findCapture(object);return capture?capture.checkObjectHit(object.mesh||object,mouse):(_ray||((_ray=new Raycaster(_camera)).testVisibility=!1),_ray.checkHit(object.mesh||object,mouse,_stage)[0])},this.checkObjectFromValues=function(object,origin,direction){let capture=findCapture(object);return capture?capture.checkObjectFromValues(object.mesh||object,origin,direction):(_ray||((_ray=new Raycaster(_camera)).testVisibility=!1),_ray.checkFromValues(object.mesh||object,origin,direction)[0])},this.getObjectHitLocalCoords=function(v,object,mouse){let capture=findCapture(object);if(capture)return capture.getObjectHitLocalCoords(v,object,mouse);let hit=_this.checkObjectHit(object,mouse);if(hit)return v.copy(hit.point),hit.object.worldToLocal(v);{let mesh=object.mesh||object;return _plane.normal.set(0,0,1).applyQuaternion(mesh.getWorldQuaternion()),_plane.constant=-mesh.getWorldPosition().dot(_plane.normal),_ray.ray.intersectPlane(_plane,v),mesh.worldToLocal(v)}},this.set("_disabled",(v=>{(_disabled=v)&&(_click=null,_over&&(_over._onOver({action:"out",object:_over}),_over=null,Stage.cursor("auto")))})),this.onInvisible=()=>{_click=null,_over&&(_over._onOver({action:"out",object:_over}),_over=null,Stage.cursor("auto"))}})),Class((function GLUIStageInteraction3D(){Inherit(this,Component);function onHover(e){e.mesh.glui._onOver({action:e.action,object:e.mesh.glui})}function onClick(e){e.mesh.glui._onClick({action:e.action,object:e.mesh.glui})}this.add=function(obj,camera=World.CAMERA){Interaction3D.find(camera).add(obj.mesh||obj,onHover,onClick)},this.remove=function(obj,camera=World.CAMERA){Interaction3D.find(camera).remove(obj.mesh||obj)},this.checkObjectHit=function(object,mouse,camera=World.CAMERA){return Interaction3D.find(camera).checkObjectHit(object.mesh,mouse)},this.checkObjectFromValues=function(object,origin,direction,camera=World.CAMERA){return Interaction3D.find(camera).checkObjectFromValues(object.mesh,origin,direction)},this.getObjectHitLocalCoords=function(v,object,mouse,camera=World.CAMERA){return Interaction3D.find(camera).getObjectHitLocalCoords(v,object.mesh,mouse)}})),Class((function GLUICornerPin($obj){Inherit(this,Component);const _this=this;var _geom,_vertices,_last;function loop(){_vertices[0]=_this.tl.x,_vertices[1]=-_this.tl.y,_vertices[3]=_vertices[9]=_this.bl.x,_vertices[4]=_vertices[10]=-_this.bl.y,_vertices[6]=_vertices[15]=_this.tr.x,_vertices[7]=_vertices[16]=-_this.tr.y,_vertices[12]=_this.br.x,_vertices[13]=-_this.br.y,function dirty(){let a=_vertices,b=_last;for(let i=a.length-1;i>-1;i--)if(a[i]!=b[i])return!0;return!1}()&&(_geom.attributes.position.needsUpdate=!0),_last.set(_vertices)}this.tl=new Vector2(0,0),this.tr=new Vector2($obj.width,0),this.bl=new Vector2(0,$obj.height),this.br=new Vector2($obj.width,$obj.height),function initGeometry(){_geom=$obj.mesh.geometry.toNonIndexed(),$obj.useGeometry(_geom),$obj.mesh.scale.set(1,1,1),_vertices=_geom.attributes.position.array,_last=new Float32Array(_vertices)}(),_this.startRender(loop),this.update=function(){this.tl.set(0,0),this.tr.set($obj.width,0),this.bl.set(0,$obj.height),this.br.set($obj.width,$obj.height)},this.tween=function(type,val,time,ease,delay){return val=val instanceof Vector2?val:new Vector2(val.x,val.y),tween(_this[type],val,time,ease,delay)}}));class GLUIObject{constructor(width,height,map,customCompile){let shader=this.textureShader=new Shader("GLUIObject",{tMap:{value:null},uAlpha:{type:"f",value:1},transparent:!0,depthTest:!1,customCompile:customCompile});shader.persists=!0,map||(shader.visible=!1),this.usingMap=null!=map&&"empty"!=map&&""!=map,this.tMap=shader.uniforms.tMap,this.group=new Group,this.alpha=1,this._x=0,this._y=0,this._z=0,this._scaleX=1,this._scaleY=1,this._scale=1,this._rotation=0,this.multiTween=!0,this.children=[],this.dimensions=new Vector3(width,height,1),this._shader=shader,this.mesh=new Mesh(GLUIObject.getGeometry("2d"),shader),this.mesh.glui=this,this.group.add(this.mesh),shader.mesh=this.mesh,window.GLSEO&&GLSEO.objectNode(this),this.bg("string"==typeof map?map.includes(["#","0x"])?map:"empty"===map||""===map?null:Utils3D.getTexture(map,{premultiplyAlpha:!1}):map);const _this=this;this.mesh.onBeforeRender=_=>{if(!_this.mesh.determineVisible()&&_this.firstRender)return;let alpha=_this.getAlpha();if(_this.mesh.shader.uniforms.uAlpha&&(_this.mesh.shader.uniforms.uAlpha.value=alpha),_this.usingMap)if(alpha<.001){if(_this.mesh.hidden=!0,_this.mesh.shader.visible=!1,!_this.isDirty&&_this.firstRender)return}else _this.mesh.hidden=!1,_this.mesh.shader.visible=!0;if(!_this.isDirty&&_this.firstRender)return;RenderStats.active&&RenderStats.update("GLUIObject",1,_this.mesh.shader.vsName+"|"+_this.mesh.shader.fsName,_this.mesh),_this.group.position.x=_this._x,_this.group.position.y=_this._3d?_this._y:-_this._y,_this.group.position.z=_this._z,1!=_this.scale&&(_this.group.position.x+=(_this.dimensions.x-_this.dimensions.x*_this.scale)/2,_this.group.position.y-=(_this.dimensions.y-_this.dimensions.y*_this.scale)/2);_this.mesh.shader;if(_this.calcMask){let v=_this.isMasked;v.copy(v.origin),_this.group.localToWorld(v),v.z=v.width,v.w=v.height}map?_this.corners||(_this.mesh.scale.set(1,1,1).multiply(_this.dimensions),_this.group.scale.x=_this._scaleX*_this._scale,_this.group.scale.y=_this._scaleY*_this._scale):_this.group.scale.set(_this._scaleX*_this._scale,_this._scaleY*_this._scale,1),_this._3d?_this.anchor&&_this.anchor._parent?(_this.anchor.position.copy(_this.group.position),_this.anchor.scale.copy(_this.group.scale),_this.anchor.quaternion.setFromEuler(_this._rotation),_this.anchor.isDirty=!0):(_this.group.quaternion.setFromEuler(_this._rotation),_this.group.matrixDirty=!0):_this.group.rotation.z=Math.radians(_this._rotation),_this.firstRender||(_this.group.updateMatrixWorld(!0),_this.firstRender=!0),_this.isDirty=!1},_this.isDirty=!0}get width(){return this.dimensions.x}set width(w){let dirty=Math.abs(this.dimensions.x-w)>Base3D.DIRTY_EPSILON;this.dimensions.x=w,dirty&&(this.isDirty=!0,this.__internalDirty&&this.__internalDirty())}get height(){return this.dimensions.y}set height(h){let dirty=Math.abs(this.dimensions.y-h)>Base3D.DIRTY_EPSILON;this.dimensions.y=h,dirty&&(this.isDirty=!0,this.__internalDirty&&this.__internalDirty())}get x(){return this._x}set x(v){let dirty=Math.abs(this._x-v)>Base3D.DIRTY_EPSILON;this._x=v,dirty&&(this.isDirty=!0,this.__internalDirty&&this.__internalDirty())}get y(){return this._y}set y(v){let dirty=Math.abs(this._y-v)>Base3D.DIRTY_EPSILON;this._y=v,dirty&&(this.isDirty=!0,this.__internalDirty&&this.__internalDirty())}get z(){return this._z}set z(v){let dirty=Math.abs(this._z-v)>Base3D.DIRTY_EPSILON;this._z=v,dirty&&(this.isDirty=!0,this.__internalDirty&&this.__internalDirty())}get scale(){return this._scale}set scale(v){let dirty=Math.abs(this._scale-v)>Base3D.DIRTY_EPSILON;this._scale=v,dirty&&(this.isDirty=!0,this.__internalDirty&&this.__internalDirty())}get scaleX(){return this._scaleX}set scaleX(v){let dirty=Math.abs(this._scaleX-v)>Base3D.DIRTY_EPSILON;this._scaleX=v,dirty&&(this.isDirty=!0,this.__internalDirty&&this.__internalDirty())}get scaleY(){return this._scaleY}set scaleY(v){let dirty=Math.abs(this._scaleY-v)>Base3D.DIRTY_EPSILON;this._scaleY=v,dirty&&(this.isDirty=!0,this.__internalDirty&&this.__internalDirty())}get rotation(){return this._rotation}set rotation(v){let dirty=Math.abs(this._rotation-v)>Base3D.DIRTY_EPSILON;this._rotation=v,dirty&&(this.isDirty=!0,this.__internalDirty&&this.__internalDirty())}style(props){for(let prop in props)void 0!==this[prop]&&(this[prop]=props[prop]);return this}size(w,h){return this.width=w,this.height=h,this.corners&&this.corners.update(),this}add($obj){return $obj?.parent?.children?.remove($obj),$obj.parent=this,this.group.add($obj.group),this.children.push($obj),this.isMasked&&$obj.mask(this.isMasked,this.maskShader),this._3d&&!$obj._3d&&$obj.enable3D(),this.deferred&&($obj.deferRender(!0),$obj.anchor&&this.anchor&&this.anchor.add($obj.anchor)),this}interact(over,click,camera=World.CAMERA,url,label,options){"string"==typeof camera&&(options=label,label=url,url=camera,camera=World.CAMERA);const bubble=(e,fn)=>{e.stopPropagation=function(){e._stopProp=!0};let parent=this._parent;for(;parent;){if(e._stopProp)return;parent[fn]?.(e),parent=parent.parent}};if(this._onOver=e=>{bubble(e,"_onChildHover"),over(e)},this._onClick=e=>{bubble(e,"_onChildClick"),click(e)},this._interactCamera=camera,over?this.interaction.add(this,camera):this.interaction.remove(this,camera),"string"==typeof url&&"string"==typeof label){const _this=this;defer((_=>{!_this.seo&&window.GLSEO&&GLSEO.objectNode(_this),_this.seo&&_this.seo.aLink&&_this.seo.aLink(url,label,options)}))}return this}clearInteract(){return this._onOver&&(this.interaction.remove(this,this._interactCamera),this._onClick=GLUIObject.noop,this._onOver=GLUIObject.noop),this.seo&&this.seo.unlink(),this}remove(param){param&&console.warn("GLUIObject.remove removes ITSELF from its parent. use removeChild instead"),this.children.slice().forEach((child=>{child.remove?child.remove():child.destroy&&child.destroy()})),this.clearInteract(),this.parent&&(this.parent.children?this.parent.children?.remove(this):GLUI.Stage.remove(this)),this.mesh._parent?this.group._parent?.remove(this.group):this._3d?GLUI.Scene.remove(this):GLUI.Stage.remove(this);let textureShader=this.textureShader;for(let key in textureShader.uniforms){let uniform=textureShader.uniforms[key];uniform&&uniform.value&&uniform.value.destroy&&uniform.value.destroy()}}create(width,height,map,customCompile){let $obj=$gl(width,height,map,customCompile);return this.add($obj),this._3d&&$obj.enable3D(),$obj}removeChild(obj){return this.group.remove(obj.group),this}tween(obj,time,ease,delay){return tween(this,obj,time,ease,delay)}enable3D(style2d){this._3d=!0,this.mesh.geometry=GLUIObject.getGeometry(style2d?"2d":"3d"),this.mesh.shader.depthTest=!0,this._rotation=new Euler,this.anchor||(this.anchor=new Group),this.anchor.onMatrixDirty=_=>{_this.isDirty=!0};const _this=this;return _this._rotation.onChange((_=>{_this.isDirty=!0})),this}loaded(){return!0}setZ(z){return this.mesh.renderOrder=z,this}bg(path){if(void 0!==path)return"string"==typeof path?path.length<=10&&(path.startsWith("0x")||path.startsWith("#"))?(this.colorShader||(this.colorShader=new Shader("GLUIColor",{transparent:!0,uAlpha:{type:"f",value:1},uColor:{value:new Color(path)}})),this.colorShader.set("uColor",new Color(path)),this._shader!=this.colorShader&&this.useShader(this.colorShader)):(this.textureShader.uniforms.tMap.value=Utils3D.getTexture(path,{premultiplyAlpha:!1}),this._shader!=this.textureShader&&this.useShader(this.textureShader)):this._shader.uniforms.tMap.value=path,this}show(){return this.group.matrixDirty=!0,this.mesh.matrixDirty=!0,this.group.visible=!0,this.anchor&&(this.anchor.visible=!0),this}hide(){return this.group.visible=!1,this.anchor&&(this.anchor.visible=!1),this}useShader(shader){return shader&&(shader!=this.textureShader&&shader!=this.colorShader&&(shader.uniforms.tMap=this.mesh.shader.uniforms.tMap,shader.uniforms.uAlpha=this.mesh.shader.uniforms.uAlpha),this._3d||(shader.depthTest=!1),shader.transparent=!0),this._shader=shader,this.mesh.shader=shader||this._shader,shader.mesh=this.mesh,this}depthTest(bool){this.mesh.shader.depthTest=bool}childInteract(hover,click){this._onChildHover=hover,this._onChildClick=click}useGeometry(geom){return this.mesh.geometry=geom,this}updateMap(src){this._shader.uniforms.tMap.value="string"==typeof src?Utils3D.getTexture(src):src}async mask(obj,shader){await defer();let dimensions={},p=this._parent;for(;p;)p.stageLayoutCapture&&(dimensions.width=p.stageLayoutCapture.width,dimensions.height=p.stageLayoutCapture.height),p=p._parent;dimensions.width||(dimensions.width=Stage.width,dimensions.height=Stage.height),obj.group.updateMatrixWorld(!0),obj.mesh.onBeforeRender();let box=(new Box3).setFromObject(obj.mesh),minX=box.min.x/dimensions.width,minY=box.max.y/dimensions.height,maxX=box.max.x/dimensions.width,maxY=-box.min.y/dimensions.height;this.shader&&(this.useShader(shader),this.shader.addUniforms({uMaskValues:{value:new Vector4(minX,minY,maxX,maxY)}})),obj.hide(),this.group.traverse((o=>{o.glui&&o.glui!=this&&o.glui.mask(obj,shader)}))}deferRender(parent){this.deferred=!0,parent||(this.anchor=new Group,GLUI.Scene.addDeferred(this))}clearTween(){return this._mathTweens&&this._mathTweens.forEach((t=>{t.tween.stop()})),this}createCorners(){this.corners=new GLUICornerPin(this)}getAlpha(){if(this._gluiParent){let alpha=this._gluiParent.getAlpha();return this.alpha=alpha,alpha}let alpha=this.alpha,$parent=this.parent;for(;$parent;)alpha*=$parent.alpha,$parent=$parent.parent;return alpha}get shader(){return this._shader}_divFocus(){this._onOver&&this._onOver({action:"over",object:this}),this.onDivFocus&&this.onDivFocus()}_divBlur(){this._onOver&&this._onOver({action:"out",object:this}),this.onDivBlur&&this.onDivBlur()}_divSelect(){this._onClick&&this._onClick({action:"click",object:this}),this.onDivSelect&&this.onDivSelect()}get _parent(){return this.parent}get interaction(){return(this._3d?GLUI.Scene:GLUI.Stage).interaction}forceUpdate(){this.firstRender=!1,this.mesh.onBeforeRender()}}!function(){var _geom2d,_geom3d;GLUIObject.getGeometry=function(type){return"2d"==type?(_geom2d||(_geom2d=new PlaneGeometry(1,1)).applyMatrix((new Matrix4).makeTranslation(.5,-.5,0)),_geom2d):(_geom3d||(_geom3d=World.PLANE),_geom3d)},GLUIObject.clear=function(){_geom2d=_geom3d=null},GLUIObject.noop=_=>{}}();class GLUIText{constructor(text,fontName,fontSize,options={},customCompile){options.font=fontName||options.font,options.text=text,options.width=options.width,options.align=options.align||"left",options.size=fontSize||options.size,options.lineHeight=options.lineHeight,options.letterSpacing=options.letterSpacing,options.wordSpacing=options.wordSpacing,options.wordBreak=options.wordBreak,options.langBreak=options.langBreak,options.color=new Color(options.color),options.customCompile=customCompile,this.text=new GLText(options),this.group=new Group,this.group.asyncPromise=this.text.text.fontLoaded,this.alpha=1,this._x=0,this._y=0,this._z=0,this._scaleX=1,this._scaleY=1,this._scale=1,this._rotation=0,this.multiTween=!0;const _this=this;text&&defer((_=>{_this.seo||_this.seoText(text)})),this.text.ready().then((_=>{let mesh=_this.text.mesh;mesh.glui=_this,mesh.shader.visible=!1,_this.mesh=mesh,_this.group.add(mesh),_this._3d&&!_this._style2d&&_this.text.centerY(),_this._3d||(_this.text.mesh.shader.depthTest=!1),mesh.shader.mesh=mesh,mesh.onBeforeRender=_=>{if(!mesh.determineVisible()&&_this.firstRender)return;let alpha=_this.getAlpha();if(mesh.shader.uniforms.uAlpha&&(mesh.shader.uniforms.uAlpha.value=alpha),alpha<.001){if(mesh.shader.visible=!1,mesh.hidden=!1,!_this.isDirty&&_this.firstRender)return}else mesh.hidden=!1,mesh.shader.visible=!0;!_this.isDirty&&_this.firstRender||(RenderStats.active&&RenderStats.update("GLUIText",1,mesh.shader.vsName+"|"+mesh.shader.fsName,mesh),_this.group.position.x=_this._x,_this.group.position.y=_this._3d?_this._y:-_this._y,_this.group.position.z=_this._z,_this.group.scale.set(_this._scaleX*_this._scale,_this._scaleY*_this._scale,1),_this._3d?_this.anchor&&_this.anchor._parent?(_this.anchor.position.copy(_this.group.position),_this.anchor.scale.copy(_this.group.scale),_this.anchor.quaternion.setFromEuler(_this._rotation)):_this.group.quaternion.setFromEuler(_this._rotation):_this.group.rotation.z=Math.radians(_this._rotation),_this.firstRender||(_this.group.updateMatrixWorld(!0),_this.firstRender=!0,mesh.shader.visible=!0),_this.onInternalUpdate&&_this.onInternalUpdate(),_this.isDirty=!1)}}))}get x(){return this._x}set x(v){Math.abs(this._x-v)>Base3D.DIRTY_EPSILON&&(this.isDirty=!0),this._x=v}get y(){return this._y}set y(v){Math.abs(this._y-v)>Base3D.DIRTY_EPSILON&&(this.isDirty=!0),this._y=v}get z(){return this._z}set z(v){Math.abs(this._z-v)>Base3D.DIRTY_EPSILON&&(this.isDirty=!0),this._z=v}get scale(){return this._scale}set scale(v){Math.abs(this._scale-v)>Base3D.DIRTY_EPSILON&&(this.isDirty=!0),this._scale=v}get scaleX(){return this._scaleX}set scaleX(v){Math.abs(this._scaleX-v)>Base3D.DIRTY_EPSILON&&(this.isDirty=!0),this._scaleX=v}get scaleY(){return this._scaleY}set scaleY(v){Math.abs(this._scaleY-v)>Base3D.DIRTY_EPSILON&&(this.isDirty=!0),this._scaleY=v}get rotation(){return this._rotation}set rotation(v){Math.abs(this._rotation-v)>Base3D.DIRTY_EPSILON&&(this.isDirty=!0),this._rotation=v}get dimensions(){return this._dimensions||(this._dimensions={}),this.text&&this.text.geometry&&!this._dimensions.max&&(this._dimensions=this.text.geometry.boundingBox,this._dimensions.width=Math.abs(this._dimensions.min.x-this._dimensions.max.x),this._dimensions.height=Math.abs(this._dimensions.min.y-this._dimensions.max.y)),this._dimensions}interact(over,click,camera=World.CAMERA,seoLink,options){"string"==typeof camera&&(options=seoLink,seoLink=camera,camera=World.CAMERA),this._onOver=over,this._onClick=click,this._interactCamera=camera;let stage=this._3d?GLUI.Scene:GLUI.Stage;const _this=this;return _this.text.ready().then((_=>{if(over){if(_this.text.geometry.boundingBox||_this.text.geometry.computeBoundingBox(),!_this.hitArea){let bb=_this.text.geometry.boundingBox,shader=Utils3D.getTestShader();if(shader.visible=!1,_this.hitArea=new Mesh(World.PLANE,shader),_this.hitArea.glui=_this,_this.hitArea.scale.set(Math.abs(bb.min.x)+Math.abs(bb.max.x),Math.abs(bb.min.y)+Math.abs(bb.max.y),1),_this._3d&&!_this._style2d||(_this.hitArea.position.x=(bb.max.x-bb.min.x)/2),_this.hitArea.position.y=(bb.min.y-bb.max.y)/2,_this._3d)switch(_this.text.getData().align){case"center":_this.hitArea.position.x=0;break;case"right":_this.hitArea.position.x=(bb.min.x-bb.max.x)/2}else switch(_this.text.getData().align){case"center":_this.hitArea.position.x=0;break;case"right":_this.hitArea.position.x=-(bb.max.x-bb.min.x)/2}_this.text.mesh.add(_this.hitArea)}stage.interaction.add(_this.hitArea,camera)}else stage.interaction.remove(_this.hitArea,camera)})),defer((_=>{seoLink&&_this.seo&&_this.seo.aLink&&_this.seo.aLink(seoLink,options)})),this}clearInteract(){if(this._onOver){(this._3d?GLUI.Scene:GLUI.Stage).interaction.remove(this.hitArea,this._interactCamera),this._onClick=GLUIObject.noop,this._onOver=GLUIObject.noop}return this}remove(param){param&&console.warn("GLUIObject.remove removes ITSELF from its parent. use removeChild instead");let stage=this._3d?GLUI.Scene:GLUI.Stage;this.mesh&&this.mesh.parent?this.group.parent.remove(this.group):stage.remove(this),this.hitArea&&stage.interaction.remove(this.hitArea,this._interactCamera),this.text&&this.text.destroy&&this.text.destroy(),Utils.nullObject(this.mesh),Utils.nullObject(this)}tween(obj,time,ease,delay){return tween(this,obj,time,ease,delay)}enable3D(style2d){this._3d=!0,this._style2d=style2d,this._rotation=new Euler;const _this=this;return _this._rotation.onChange((_=>{_this.isDirty=!0})),_this.text.ready().then((_=>{_this.text.mesh.shader.depthTest=!0})),this.anchor||(this.anchor=new Group),this.anchor.onMatrixDirty=_=>{_this.isDirty=!0},_this.isDirty=!0,this}depthTest(bool){const _this=this;return _this.text.ready().then((_=>{_this.text.mesh.shader.depthTest=bool})),this}setZ(z){const _this=this;return _this.text.ready().then((_=>{_this.text.mesh.renderOrder=z})),this}height(){return this.mesh?this.text.height:0}async setText(text,options){return text&&(text=text.toString(),this.seoText(text)),await this.text.ready(),await this.text.setText(text,options),this._dimensions=null,this}seoText(text){window.GLSEO&&GLSEO.textNode(this,text)}getTextString(){return this.text.string}setColor(color){const _this=this;return _this.text.ready().then((_=>_this.text.setColor(color))),this}tweenColor(color,time,ease,delay){const _this=this;return _this.text.ready().then((_=>_this.text.tweenColor(color,time,ease,delay))),this}async resize(options){await this.text.ready(),await this.text.resize(options),this._dimensions=null}show(){return this.text.ready().then((_=>{this.text.mesh.visible=!0,this.text.mesh.updateMatrixWorld(!0)})),this}async mask(obj,shader){await defer();let dimensions={},p=this._parent;for(;p;)p.stageLayoutCapture&&(dimensions.width=p.stageLayoutCapture.width,dimensions.height=p.stageLayoutCapture.height),p=p._parent;dimensions.width||(dimensions.width=Stage.width,dimensions.height=Stage.height),obj.group.updateMatrixWorld(!0),obj.mesh.onBeforeRender();let box=(new Box3).setFromObject(obj.mesh),minX=box.min.x/dimensions.width,minY=box.max.y/dimensions.height,maxX=box.max.x/dimensions.width,maxY=-box.min.y/dimensions.height;this.shader&&(this.useShader(shader),this.shader.addUniforms({uMaskValues:{value:new Vector4(minX,minY,maxX,maxY)}})),obj.hide(),this.group.traverse((o=>{o.glui&&o.glui!=this&&o.glui.mask(obj,shader)}))}hide(){const _this=this;return _this.text.ready().then((_=>_this.text.mesh.visible=!1)),this}loaded(){return this.text.ready()}length(){return this.text.charLength}deferRender(parent){this.deferred=!0,parent||(this.anchor||(this.anchor=new Group),GLUI.Scene.addDeferred(this))}getAlpha(){if(this._gluiParent){let alpha=this._gluiParent.getAlpha();return this.alpha=alpha,alpha}let alpha=this.alpha,$parent=this.parent;for(;$parent;)alpha*=$parent.alpha,$parent=$parent.parent;return alpha}size(){}upload(){const _this=this;return _this.text.ready().then((_=>_this.text.mesh.upload())),this}_divFocus(){this._onOver&&this._onOver({action:"over",object:this}),this.onDivFocus&&this.onDivFocus()}_divBlur(){this._onOver&&this._onOver({action:"out",object:this}),this.onDivBlur&&this.onDivBlur()}_divSelect(){this._onClick&&this._onClick({action:"click",object:this}),this.onDivBlurSelect&&this.onDivSelect()}get _parent(){return this.parent}async useShader(shader){await this.text.ready(),shader.uniforms.tMap=this.text.shader.uniforms.tMap,shader.uniforms.uAlpha=this.text.shader.uniforms.uAlpha,shader.uniforms.uColor=this.text.shader.uniforms.uColor,shader.transparent=!0,(!this._3d||this._3d||this.parent)&&(shader.depthTest=!1),this.text.mesh.shader=shader||this.text.shader,this.text.shader=shader,this.text.mesh.shader.mesh=this.text.mesh}}function DeferredPromise(){let resolve,reject;return{promise:new Promise(((res,rej)=>{resolve=res,reject=rej})),resolve:resolve,reject:reject}}Class((function GLUIStage(){Inherit(this,Component);const _this=this;var _scene=new Scene,_camera=new OrthographicCamera(1,1,1,1,.1,1);function resizeHandler(){_camera.left=Stage.width/-2,_camera.right=Stage.width/2,_camera.top=Stage.height/2,_camera.bottom=Stage.height/-2,_camera.near=.01,_camera.far=1e3,_camera.updateProjectionMatrix(),_camera.position.x=Stage.width/2,_camera.position.y=-Stage.height/2}this.interaction=new GLUIStageInteraction2D(_camera,_scene,Stage),this.alpha=1,this.scene=_scene,_scene.disableAutoSort=!0,_camera.position.z=1,function addListeners(){_this.events.sub(Events.RESIZE,resizeHandler)}(),resizeHandler(),this.add=function($obj){$obj.parent=_this,_scene.add($obj.group||$obj.mesh)},this.remove=function($obj){$obj.parent=null,_scene.remove($obj.group)},this.clear=function(){_scene.traverse((obj=>{obj.geometry&&obj.shader&&obj.destroy()})),_scene.children.length=_scene.childrenLength=0},this.renderToRT=function(scene,rt){let clearAlpha;rt.fxscene&&rt.fxscene.clearAlpha>-1&&(clearAlpha=World.RENDERER.getClearAlpha(),World.RENDERER.setClearAlpha(0));let autoClear=World.RENDERER.autoClear;World.RENDERER.autoClear=!1,World.RENDERER.render(scene,_camera,rt),World.RENDERER.autoClear=autoClear,clearAlpha&&World.RENDERER.setClearAlpha(clearAlpha)},this.resize=resizeHandler,this.render=function loop(){if(!_scene.children.length)return;let clear=World.RENDERER.autoClear;World.RENDERER.autoClear=!1,World.RENDERER.render(_scene,_camera,null,!0),World.RENDERER.autoClear=clear},this.renderDirect=callback=>{_scene.children.length&&(_scene.traverse((obj=>{obj.shader&&(obj.shader.depthTest=!1)})),callback(_scene,_camera))}})),Class((function GLUIStage3D(){Inherit(this,Object3D);const _this=this;var _camera,_externalRenders=[],_scene=new Scene,_list=new LinkedList;this.alpha=1,this.interaction=new GLUIStageInteraction3D,this.add=function(obj,parent){obj.parent=_this,obj._gluiParent=parent,obj.anchor&&(obj.anchor._gluiParent=parent),obj._3d||obj.enable3D(),obj.deferRender()},this.clear=function(){_scene.traverse((obj=>{obj.geometry&&obj.shader&&obj.destroy()})),_scene.children.length=_scene.childrenLength=0},this.addDeferred=function(obj){_list.push(obj),_scene.add(obj.group||obj.mesh)},this.remove=function(obj){_scene.remove(obj.group||obj.mesh),_list.remove(obj)},this.disableAutoSort=function(){_scene.disableAutoSort=!0},this.renderToRT=function(scene,camera){camera=camera.camera||camera,scene.traverse((mesh=>{let obj=mesh.glui||mesh;obj&&obj.anchor&&obj.anchor.determineVisible()&&Utils3D.decompose(obj.anchor,obj.group||obj)})),scene._textRenderCamera=camera,_externalRenders.push(scene)},this.renderToRT2=function(scene,rt,camera){let clearAlpha;rt.fxscene&&rt.fxscene.clearAlpha>-1&&(clearAlpha=World.RENDERER.getClearAlpha(),World.RENDERER.setClearAlpha(0));let autoClear=World.RENDERER.autoClear;World.RENDERER.autoClear=!1,World.RENDERER.render(scene,camera,rt),World.RENDERER.autoClear=autoClear,clearAlpha&&World.RENDERER.setClearAlpha(clearAlpha)},this.render=function loop(){if(!window.Metal){if(_list.length){let obj=_list.start();for(;obj;)obj._marked&&(obj._marked=!1,Utils3D.decompose(obj.anchor,obj.group)),obj=_list.next();let clear=World.RENDERER.autoClear;Renderer.context.clear(Renderer.context.DEPTH_BUFFER_BIT),World.RENDERER.autoClear=!1,World.RENDERER.render(_scene,_camera||World.CAMERA),World.RENDERER.autoClear=clear}if(_externalRenders.length)for(;_externalRenders.length;){let scene=_externalRenders.shift(),camera=scene._textRenderCamera,clear=World.RENDERER.autoClear;Renderer.context.clear(Renderer.context.DEPTH_BUFFER_BIT),World.RENDERER.autoClear=!1,World.RENDERER.render(scene,camera),World.RENDERER.autoClear=clear}}},this.mark=function mark(){let obj=_list.start();for(;obj;)obj.anchor._parent&&(obj.group.visible=obj.anchor.determineVisible()),obj.mesh&&obj.mesh.determineVisible()&&obj.anchor._parent&&(obj._marked=!0),obj=_list.next()},this.renderDirect=function(callback){if(_list.length){let obj=_list.start();for(;obj;)obj._marked&&(obj._marked=!1,Utils3D.decompose(obj.anchor,obj.group)),obj=_list.next();_scene.traverse((obj=>{obj.shader&&(obj.shader.depthTest=!1)})),callback(_scene,_camera||World.CAMERA)}},this.set("camera",(c=>{_camera=c.camera||c}))})),Module((function FirefoxGPUFixer(){this.exports=function(){GPU.detect("radeon r9 200")&&("mac"==Device.system.os||Device.pixelRatio>1)&&(Device.graphics.webgl.gpu="radeon pro 455")}})),Class((function GPU(){Inherit(this,Component);var _this=this,_split={};Hydra.ready((async()=>{for(var key in _this.detect=function(match){if(Device.graphics.gpu)return Device.graphics.gpu.detect(match)},_this.detectAll=function(){if(Device.graphics.gpu){for(var match=!0,i=0;i<arguments.length;i++)Device.graphics.gpu.detect(arguments[i])||(match=!1);return match}},_this.matchGPU=function(str,min,max=99999){let num=function splitGPU(string){if(_split[string])return _split[string];if(!_this.detect(string))return-1;try{var num=Number(_this.gpu.split(string)[1].split(" ")[0]);return _split[string]=num,num}catch(e){return-1}}(str);return num>=min&&num<max},_this.gpu=Device.graphics.gpu?Device.graphics.gpu.identifier:"","apple gpu"==_this.gpu&&(Device.mobile?await require("iOSGPUTest")():require("MacOSPerformanceTest")()),"firefox"===Device.system.browser&&require("FirefoxGPUFixer")(),_this.BLOCKLIST=require("GPUBlocklist").match(),_this.T0=!(Device.mobile||!_this.BLOCKLIST&&!_this.detect("radeon(tm) r5")&&!_this.detect("radeon r9 200")&&!_this.detect("hd graphics family")&&!_this.detect("intel(r) uhd graphics direct")&&!_this.matchGPU("hd graphics ",1e3,5001)&&!(_this.matchGPU("hd graphics ",0,618)&&Device.pixelRatio>1)&&!(_this.detect(["hd graphics","iris"])&&Math.max(Stage.width,Stage.height)>1800)&&!_this.detect(["intel iris opengl engine"])&&!_this.matchGPU("iris(tm) graphics ",1e3)),_this.T1=!(_this.BLOCKLIST||Device.mobile||_this.T0||!_this.matchGPU("iris(tm) graphics ",540,1e3)&&!_this.matchGPU("hd graphics ",514,1e3)&&!_this.matchGPU("intel(r) uhd graphics ",600,1e3)&&_this.detect(["nvidia","amd","radeon","geforce"])&&!_this.detect(["vega 8"])),_this.T2=!_this.BLOCKLIST&&!Device.mobile&&!(!_this.detect(["nvidia","amd","radeon","geforce"])||_this.T1||_this.T0),_this.T3=!(_this.BLOCKLIST||Device.mobile||!_this.detect(["titan","amd radeon pro","quadro"])&&!_this.matchGPU("gtx ",940)&&!_this.matchGPU("radeon (tm) rx ",400)&&!_this.detect("amd radeon(tm) graphics direct3d11 vs_5_0")&&!_this.matchGPU("radeon rx ",400)&&!_this.matchGPU("radeon pro ",420)),_this.T4=!(_this.BLOCKLIST||Device.mobile||!_this.detect(["titan","quadro","radeon vii","apple m"])&&!_this.matchGPU("gtx ",1060)&&!_this.matchGPU("rtx")&&!_this.matchGPU("radeon rx ",500)&&!_this.matchGPU("vega ",50)&&!_this.detect(["radeon pro 5300m","radeon pro 5500m","radeon pro 5600m","amd radeon unknown prototype"])),_this.T5=!(_this.BLOCKLIST||Device.mobile||!_this.detect(["titan","radeon vii"])&&!_this.matchGPU("gtx ",1080)&&!_this.matchGPU("rtx ",2060)&&!_this.matchGPU("radeon rx ",5500)&&(!_this.detect("apple m")||!_this.detect("max"))),_this.MT0=!!Device.mobile&&(!!_this.BLOCKLIST||!("ios"!=Device.system.os||!_this.detect("a7"))||!("android"!=Device.system.os||!_this.detect("sgx"))||(_this.detect("adreno")?_this.matchGPU("adreno (tm) ",0,415):_this.detect("mali")?_this.matchGPU("mali-t",0,628):!("ios"!=Device.system.os||!_this.detect(["a8","a9"]))||!!_this.detect("mali-g")||!!_this.matchGPU("adreno (tm) ",420))),_this.MT1=function(){if(!Device.mobile)return!1;if(_this.BLOCKLIST)return!1;if("ios"==Device.system.os&&_this.detect("a10"))return!0;if("android"==Device.system.os&&!_this.MT0)return!0;if(_this.detect("nvidia tegra")&&Device.detect("pixel c"))return!0;if(_this.detect("mali-g"))return _this.matchGPU("mali-g",73);if(_this.detect("adreno")){if(_this.matchGPU("adreno (tm) ",600,616))return!0;if(_this.matchGPU("adreno (tm) ",530,600))return!0}return!1}(),_this.MT2=!!Device.mobile&&!_this.BLOCKLIST&&(!("ios"!=Device.system.os||!_this.detect(["a11","a12"]))||(_this.detect("adreno")?_this.matchGPU("adreno (tm) ",630):_this.detect("mali-g")?_this.matchGPU("mali-g",74):!(!navigator.platform.toLowerCase().includes(["mac","windows"])||"chrome"!=Device.system.browser))),_this.MT3=!!Device.mobile&&!_this.BLOCKLIST&&(!("ios"!=Device.system.os||!_this.detect(["a12","a13","a14","a15","a16","a17","a18"]))||(_this.detect("adreno")?_this.matchGPU("adreno (tm) ",640):_this.detect("mali-g")?_this.matchGPU("mali-g",76):!(!navigator.platform.toLowerCase().includes(["mac","windows"])||"chrome"!=Device.system.browser))),_this.MT4=!!Device.mobile&&!_this.BLOCKLIST&&(!("ios"!=Device.system.os||!_this.detect(["a14","a15","a16","a17","a18","a19","a20","apple m"]))||(_this.detect("adreno")?_this.matchGPU("adreno (tm) ",650):_this.detect("mali-g")?_this.matchGPU("mali-g",78):!(!navigator.platform.toLowerCase().includes(["mac","windows"])||"chrome"!=Device.system.browser))),_this.lt=function(num){return _this.TIER>-1&&_this.TIER<=num},_this.gt=function(num){return _this.TIER>-1&&_this.TIER>=num},_this.eq=function(num){return _this.TIER>-1&&_this.TIER==num},_this.mobileEq=function(num){return _this.M_TIER>-1&&_this.M_TIER==num},_this.mobileLT=function(num){return _this.M_TIER>-1&&_this.M_TIER<=num},_this.mobileGT=function(num){return _this.M_TIER>-1&&_this.M_TIER>=num},_this)"T"==key.charAt(0)&&!0===_this[key]&&(_this.TIER=Number(key.charAt(1))),"MT"==key.slice(0,2)&&!0===_this[key]&&(_this.M_TIER=Number(key.charAt(2)));!1!==Utils.query("gpu")&&(Device.mobile||Utils.query("gpu").toString().includes("m")?(_this.TIER=-1,_this.M_TIER=Number(Utils.query("gpu").slice(1))):_this.TIER=Number(Utils.query("gpu"))),"ios"==Device.system.os&&Render.REFRESH_RATE<40&&(_this.M_TIER-=1),_this.OVERSIZED=!Device.mobile&&_this.TIER<=0&&Math.max(window.innerWidth,window.innerHeight)>1400||!Device.mobile&&_this.TIER<=1&&Math.max(window.innerWidth,window.innerHeight)>1600,"ie"==Device.system.browser&&(_this.OVERSIZED=!0),_this.initialized=!0})),this.ready=function(){return this.wait("initialized")}}),"static"),Module((function MacOSPerformanceTest(){function test(){let results=[];function getPrime(){return function largest_prime_factor(n){return factors(n).filter(primep).pop()}(1e12)}function factors(n){var i,out=[],sqrt_n=Math.sqrt(n);for(i=2;i<=sqrt_n;i++)n%i==0&&out.push(i);return out}function primep(n){return 0===factors(n).length}for(let i=0;i<3;i++){let time=performance.now();getPrime(),results.push(10*(performance.now()-time))}return results.sort(((a,b)=>a-b)),results[0]}this.exports=function(){let result=test();screen.width<=1440&&screen.height<=900?Device.graphics.webgl.gpu=result>540?"intel iris opengl engine":"safari tier 1":Device.graphics.webgl.gpu=result>475?result>540?"intel iris opengl engine":"safari tier 1":result<375?"amd radeon pro 455 opengl engine":"nvidia geforce 750m opengl engine"}})),Module((function iOSGPUTest(){function getRenderer(complete,takUrl){var nodes=[{x:"Unknown",m:function(n){return function family(){var segments=/iPhone|iPad|Macintosh/.exec(navigator.userAgent);if(segments&&segments.length>0)return segments[0];return""}()},n:[4,2,1,3]},{x:"Apple A7 GPU|Apple A8 GPU|Apple A9 GPU|Apple A10 GPU|Apple A11 GPU|Apple A12 GPU|Apple A13 GPU|Apple A14 GPU|Apple A15 GPU",m:function(n){return height()},n:[15,10,11,12,14,6,7,8,13,5,9],v:["iPhone"]},{x:"Apple A7 GPU|Apple A8 GPU|Apple A9X GPU|Apple A10X GPU|Apple A9 GPU|Apple A12X GPU|Apple A10 GPU|Apple A12 GPU|Apple A8X GPU|Apple M1 GPU|Apple A14 GPU|Apple A12Z GPU",m:function(n){return height()},n:[21,20,18,19,17,16],v:["iPad"]},{x:"Apple A9X GPU|Apple A10X GPU|Apple A9 GPU|Apple A10 GPU|Apple A11 GPU|Apple A12X GPU|Apple A12 GPU|Apple A8 GPU|Apple A8X GPU|Apple A13 GPU|Apple A14 GPU|Apple M1 GPU|Apple A12Z GPU|Apple A15 GPU",m:function(n){return height()},n:[20,18,27,10,11,12,14,19,23,26,24,17,25,13,9,22],v:["Macintosh"]},{x:"Apple A10 GPU",v:["iPod Touch"]},{x:"Apple A7 GPU|Apple A9 GPU|Apple A10 GPU|Apple A11 GPU|Apple A8 GPU|Apple A13 GPU",m:function(n){return mediacolorgamut()},n:[29,28],v:[1136]},{x:"Apple A8 GPU|Apple A10 GPU|Apple A11 GPU|Apple A9 GPU",m:function(n){return mediacolorgamut()},n:[30,31],v:[2001]},{x:"Apple A8 GPU|Apple A9 GPU|Apple A10 GPU|Apple A11 GPU",m:function(n){return mediacolorgamut()},n:[32,33],v:[2208]},{x:"Apple A8 GPU|Apple A9 GPU|Apple A10 GPU|Apple A11 GPU|Apple A13 GPU",m:function(n){return mediacolorgamut()},n:[34,35],v:[1334]},{x:"Apple A11 GPU|Apple A12 GPU|Apple A13 GPU|Apple A14 GPU|Apple A15 GPU",m:function(n){return hash3d()},n:[37,38,39,40,36,41],v:[2436]},{x:"Apple A12 GPU|Apple A13 GPU",m:function(n){return hash3d()},n:[42,36],v:[2688]},{x:"Apple A12 GPU|Apple A13 GPU",m:function(n){return hash3d()},n:[44,43],v:[1624]},{x:"Apple A12 GPU|Apple A13 GPU",m:function(n){return hash3d()},n:[44,36],v:[1792]},{x:"Apple A11 GPU|Apple A12 GPU|Apple A14 GPU|Apple A13 GPU|Apple A15 GPU",m:function(n){return hash3d()},n:[47,45,36,46,41],v:[2079]},{x:"Apple A14 GPU",v:[2532]},{x:"Apple A14 GPU",v:[2778]},{x:"Apple A7 GPU|Apple A8 GPU|Apple A9X GPU|Apple A10X GPU|Apple A9 GPU|Apple A12X GPU|Apple A10 GPU|Apple A12 GPU|Apple A8X GPU|Apple M1 GPU",m:function(n){return mediacolorgamut()},n:[49,48],v:[2048]},{x:"Apple A9X GPU|Apple A10X GPU|Apple A12X GPU|Apple M1 GPU|Apple A12Z GPU",m:function(n){return mediacolorgamut()},n:[50,51],v:[2732]},{x:"Apple A10X GPU|Apple A12 GPU",m:function(n){return hash()},n:[53,52],v:[2224]},{x:"Apple A12X GPU|Apple M1 GPU|Apple A12Z GPU",m:function(n){return hash3d()},n:[55,54],v:[2388]},{x:"Apple A10 GPU|Apple A12 GPU",m:function(n){return hash()},n:[56,57],v:[2160]},{x:"Apple A14 GPU",v:[2360]},{x:"Apple A9X GPU|Apple A10X GPU|Apple A9 GPU|Apple A12X GPU|Apple A10 GPU|Apple A12 GPU|Apple A8 GPU|Apple A8X GPU|Apple M1 GPU",m:function(n){return mediacolorgamut()},n:[58,49],v:[2048]},{x:"Apple A9 GPU|Apple A10 GPU|Apple A11 GPU",m:function(n){return mediacolorgamut()},n:[59,33],v:[2208]},{x:"Apple A9 GPU|Apple A10 GPU|Apple A11 GPU|Apple A13 GPU",m:function(n){return mediacolorgamut()},n:[59,35],v:[1334]},{x:"Apple A9 GPU|Apple A10 GPU|Apple A11 GPU|Apple A13 GPU",m:function(n){return mediacolorgamut()},n:[60,29],v:[1136]},{x:"Apple A10 GPU|Apple A11 GPU|Apple A9 GPU",m:function(n){return mediacolorgamut()},n:[59,31],v:[2001]},{x:"Apple A14 GPU",v:[2360,2778]},{x:"Apple A7 GPU|Apple A9 GPU|Apple A8 GPU",m:function(n){return hash()},n:[61,63,62,64,65],v:["srgb"]},{x:"Apple A10 GPU|Apple A11 GPU|Apple A13 GPU",m:function(n){return hash3d()},n:[66,37,67],v:["p3"]},{x:"Apple A8 GPU|Apple A9 GPU",m:function(n){return hash()},n:[68,69],v:["srgb"]},{x:"Apple A10 GPU|Apple A11 GPU",m:function(n){return hash()},n:[70,71],v:["p3"]},{x:"Apple A8 GPU|Apple A9 GPU",m:function(n){return hash()},n:[72,73],v:["srgb"]},{x:"Apple A10 GPU|Apple A11 GPU",m:function(n){return hash()},n:[70,74],v:["p3"]},{x:"Apple A8 GPU|Apple A9 GPU",m:function(n){return hash()},n:[75,76],v:["srgb"]},{x:"Apple A10 GPU|Apple A11 GPU|Apple A13 GPU",m:function(n){return hash3d()},n:[66,37,67],v:["p3"]},{x:"Apple A12 GPU",v:[958581112,2301174800,4085158452]},{x:"Apple A11 GPU",v:[367695777,411650080,1220644697]},{x:"Apple A13 GPU",v:[4193218782]},{x:"Apple A14 GPU",v:[105985484]},{x:"Apple A14 GPU",v:[3403189785]},{x:"Apple A14 GPU|Apple A15 GPU",v:[2364051618]},{x:"Apple A13 GPU",v:[352823931,4193218782]},{x:"Apple A12 GPU",v:[958581112,2301174800,3403189785,4085158452]},{x:"Apple A13 GPU",v:[352823931,3335845976,4193218782]},{x:"Apple A11 GPU",v:[367695777,411650080]},{x:"Apple A14 GPU",v:[105985484,679860869,3403189785]},{x:"Apple A13 GPU",v:[352823931]},{x:"Apple A7 GPU|Apple A8 GPU|Apple A9X GPU|Apple A9 GPU|Apple A10 GPU|Apple A8X GPU",m:function(n){return hash()},n:[80,77,81,82,83,85,78,79,84,61],v:["srgb"]},{x:"Apple A10X GPU|Apple A9X GPU|Apple A12X GPU|Apple A12 GPU|Apple M1 GPU",m:function(n){return hash3d()},n:[55,87,86,88,89],v:["p3"]},{x:"Apple A9X GPU",v:["srgb"]},{x:"Apple A10X GPU|Apple A12X GPU|Apple M1 GPU|Apple A12Z GPU",m:function(n){return hash3d()},n:[91,90,94,92,93],v:["p3"]},{x:"Apple A10X GPU",v:[63583436,2114570256,3129316290]},{x:"Apple A12 GPU",v:[1349146759,2917249763]},{x:"Apple A12X GPU|Apple A12Z GPU",v:[4085158452]},{x:"Apple M1 GPU",v:[105985484,3403189785]},{x:"Apple A10 GPU",v:[2114570256]},{x:"Apple A12 GPU",v:[1349146759,2206992415]},{x:"Apple A9X GPU|Apple A9 GPU|Apple A10 GPU|Apple A8 GPU|Apple A8X GPU",m:function(n){return hash3d()},n:[101,96,98,97,95,99,100],v:["srgb"]},{x:"Apple A9 GPU",v:["srgb"]},{x:"Apple A9 GPU|Apple A10 GPU",m:function(n){return hash()},n:[102,64,65],v:["srgb"]},{x:"Apple A7 GPU",v:[857422828,1915583345]},{x:"Apple A9 GPU",v:[46663968,3129316290]},{x:"Apple A8 GPU",v:[839732043,3816812018,4125234388]},{x:"Apple A9 GPU",v:[2114570256]},{x:"Apple A9 GPU",v:[63583436]},{x:"Apple A10 GPU",v:[583354101,3458129248,3928876783]},{x:"Apple A13 GPU",v:[352823931,3335845976,3403189785,4193218782]},{x:"Apple A8 GPU",v:[1411440593,1924197914,4125234388]},{x:"Apple A9 GPU",v:[2114570256,3129316290]},{x:"Apple A10 GPU",v:[63583436,2114570256,3129316290]},{x:"Apple A11 GPU",v:[1349146759,2917249763]},{x:"Apple A8 GPU",v:[1411440593,1913250432,3074367344,4125234388]},{x:"Apple A9 GPU",v:[46663968,2114570256,3129316290]},{x:"Apple A11 GPU",v:[2917249763,3237505312]},{x:"Apple A8 GPU",v:[3128296539,3816812018,4125234388]},{x:"Apple A9 GPU",v:[46663968,63583436,2114570256,3129316290]},{x:"Apple A8 GPU",v:[2656686317,3710391565]},{x:"Apple A9X GPU|Apple A9 GPU|Apple A10 GPU",v:[3129316290]},{x:"Apple A9 GPU|Apple A9X GPU|Apple A10 GPU",m:function(n){return hash3d()},n:[103,95,99],v:[2114570256]},{x:"Apple A10 GPU",v:[46663968]},{x:"Apple A8 GPU|Apple A8X GPU",m:function(n){return benchmarkcpuavg(n)},n:[105,104],v:[4125234388]},{x:"Apple A8 GPU|Apple A8X GPU",m:function(n){return hash3d()},n:[106,107,108],v:[4005673483]},{x:"Apple A8 GPU|Apple A8X GPU",v:[1350183384,1361285941,3816812018]},{x:"Apple A9X GPU|Apple A9 GPU|Apple A10 GPU",m:function(n){return hash3d()},n:[101,100],v:[63583436]},{x:"Apple A8 GPU|Apple A8X GPU",m:function(n){return hash3d()},n:[110,109],v:[2870741841]},{x:"Apple A10X GPU|Apple A9X GPU",v:[3458129248]},{x:"Apple A12X GPU|Apple A12 GPU",v:[4085158452]},{x:"Apple A10X GPU|Apple A9X GPU",m:function(n){return benchmarkcpuavg(n)},n:[111,112],v:[583354101]},{x:"Apple A10X GPU|Apple A9X GPU",m:function(n){return benchmarkcpuavg(n)},n:[113,114],v:[3928876783]},{x:"Apple A12X GPU",v:[4085158452]},{x:"Apple A10X GPU",v:[583354101,3458129248,3928876783]},{x:"Apple M1 GPU",v:[105985484]},{x:"Apple M1 GPU|Apple A10X GPU",m:function(n){return hash()},n:[116,115],v:[3403189785]},{x:"Apple A12Z GPU",v:[958581112]},{x:"Apple A9X GPU|Apple A10 GPU",v:[3458129248]},{x:"Apple A8X GPU",v:[1480368425,1783160115]},{x:"Apple A8X GPU|Apple A10 GPU",m:function(n){return hash()},n:[56,117],v:[3403189785]},{x:"Apple A8 GPU",v:[3312905059,3928382683]},{x:"Apple A9 GPU|Apple A9X GPU|Apple A10 GPU",m:function(n){return benchmarkcpuavg(n)},n:[118,119],v:[583354101]},{x:"Apple A9X GPU|Apple A9 GPU|Apple A10 GPU",m:function(n){return benchmarkcpuavg(n)},n:[120,122,121],v:[3928876783]},{x:"Apple A10 GPU",v:[1058363647,2015944978]},{x:"Apple A9 GPU",v:[46663968]},{x:"Apple A10 GPU",v:[3403189785]},{x:"Apple A8 GPU|Apple A8X GPU",m:function(n){return benchmarkcpustd(n)},n:[123,124],r:[{a:29.78,b:30.87}]},{x:"Apple A8 GPU",r:[{a:31.19,b:31.59}]},{x:"Apple A8X GPU",v:[1783160115]},{x:"Apple A8 GPU",v:[3928382683]},{x:"Apple A8 GPU|Apple A8X GPU",m:function(n){return benchmarkcpustd(n)},n:[125,126],v:[3403189785]},{x:"Apple A8 GPU",v:[3312905059]},{x:"Apple A8X GPU",v:[1480368425]},{x:"Apple A10X GPU",r:[{a:14.16,b:17.21}]},{x:"Apple A9X GPU",r:[{a:18.44,b:35.94}]},{x:"Apple A10X GPU",r:[{a:12.34,b:15.6}]},{x:"Apple A9X GPU",r:[{a:16.8,b:121.37}]},{x:"Apple M1 GPU",v:[1349146759]},{x:"Apple A10X GPU",v:[2114570256]},{x:"Apple A8X GPU",v:[4005673483]},{x:"Apple A9X GPU|Apple A9 GPU",r:[{a:24.38,b:31.67}]},{x:"Apple A10 GPU|Apple A9X GPU",r:[{a:16.82,b:22.52}]},{x:"Apple A9 GPU|Apple A9X GPU",r:[{a:19.79,b:21.64}]},{x:"Apple A10 GPU|Apple A9X GPU",m:function(n){return benchmarkcpustd(n)},n:[127],r:[{a:14.44,b:19.65}]},{x:"Apple A9 GPU|Apple A9X GPU",r:[{a:22.74,b:24.91}]},{x:"Apple A8X GPU",r:[{a:.26,b:5.62}]},{x:"Apple A8 GPU",r:[{a:6.32,b:161.36}]},{x:"Apple A8X GPU",r:[{a:.53,b:13.31}]},{x:"Apple A8 GPU",r:[{a:83.08,b:2952.42}]},{x:"Apple A9X GPU|Apple A10 GPU",r:[{a:29.8,b:228.33}]}];function hash3d(){var gl,program,canvas,mat4={create:function(){for(var result=new Array(16),i=0;i<16;i++)result[i]=i%5==0?1:0;return result},perspective:function(out,fovy,aspect,near,far){var nf,f=1/Math.tan(fovy/2);return out[0]=f/aspect,out[1]=0,out[2]=0,out[3]=0,out[4]=0,out[5]=f,out[6]=0,out[7]=0,out[8]=0,out[9]=0,out[11]=-1,out[12]=0,out[13]=0,out[15]=0,null!=far&&far!==1/0?(nf=1/(near-far),out[10]=(far+near)*nf,out[14]=2*far*near*nf):(out[10]=-1,out[14]=-2*near),out},lookAt:function(out,eye,center,up){var x0,x1,x2,y0,y1,y2,z0,z1,z2,len,eyex=eye[0],eyey=eye[1],eyez=eye[2],upx=up[0],upy=up[1],upz=up[2],centerx=center[0],centery=center[1],centerz=center[2];return Math.abs(eyex-centerx)<1e-6&&Math.abs(eyey-centery)<1e-6&&Math.abs(eyez-centerz)<1e-6?mat4.identity(out):(z0=eyex-centerx,z1=eyey-centery,z2=eyez-centerz,x0=upy*(z2*=len=1/Math.hypot(z0,z1,z2))-upz*(z1*=len),x1=upz*(z0*=len)-upx*z2,x2=upx*z1-upy*z0,(len=Math.hypot(x0,x1,x2))?(x0*=len=1/len,x1*=len,x2*=len):(x0=0,x1=0,x2=0),y0=z1*x2-z2*x1,y1=z2*x0-z0*x2,y2=z0*x1-z1*x0,(len=Math.hypot(y0,y1,y2))?(y0*=len=1/len,y1*=len,y2*=len):(y0=0,y1=0,y2=0),out[0]=x0,out[1]=y0,out[2]=z0,out[3]=0,out[4]=x1,out[5]=y1,out[6]=z1,out[7]=0,out[8]=x2,out[9]=y2,out[10]=z2,out[11]=0,out[12]=-(x0*eyex+x1*eyey+x2*eyez),out[13]=-(y0*eyex+y1*eyey+y2*eyez),out[14]=-(z0*eyex+z1*eyey+z2*eyez),out[15]=1,out)},multiply:function(out,a,b){var a00=a[0],a01=a[1],a02=a[2],a03=a[3],a10=a[4],a11=a[5],a12=a[6],a13=a[7],a20=a[8],a21=a[9],a22=a[10],a23=a[11],a30=a[12],a31=a[13],a32=a[14],a33=a[15],b0=b[0],b1=b[1],b2=b[2],b3=b[3];return out[0]=b0*a00+b1*a10+b2*a20+b3*a30,out[1]=b0*a01+b1*a11+b2*a21+b3*a31,out[2]=b0*a02+b1*a12+b2*a22+b3*a32,out[3]=b0*a03+b1*a13+b2*a23+b3*a33,b0=b[4],b1=b[5],b2=b[6],b3=b[7],out[4]=b0*a00+b1*a10+b2*a20+b3*a30,out[5]=b0*a01+b1*a11+b2*a21+b3*a31,out[6]=b0*a02+b1*a12+b2*a22+b3*a32,out[7]=b0*a03+b1*a13+b2*a23+b3*a33,b0=b[8],b1=b[9],b2=b[10],b3=b[11],out[8]=b0*a00+b1*a10+b2*a20+b3*a30,out[9]=b0*a01+b1*a11+b2*a21+b3*a31,out[10]=b0*a02+b1*a12+b2*a22+b3*a32,out[11]=b0*a03+b1*a13+b2*a23+b3*a33,b0=b[12],b1=b[13],b2=b[14],b3=b[15],out[12]=b0*a00+b1*a10+b2*a20+b3*a30,out[13]=b0*a01+b1*a11+b2*a21+b3*a31,out[14]=b0*a02+b1*a12+b2*a22+b3*a32,out[15]=b0*a03+b1*a13+b2*a23+b3*a33,out},identity:function(out){return out[0]=1,out[1]=0,out[2]=0,out[3]=0,out[4]=0,out[5]=1,out[6]=0,out[7]=0,out[8]=0,out[9]=0,out[10]=1,out[11]=0,out[12]=0,out[13]=0,out[14]=0,out[15]=1,out}};var imageHash=0;if(null!=(canvas=document.createElement("canvas"))){var imageData=function generate(){if(gl=function getRenderingContext(){canvas.width=67,canvas.height=67;var gl=canvas.getContext("webgl")||canvas.getContext("experimental-webgl");return gl&&(gl.viewport(0,0,67,67),gl.clearColor(0,0,0,1),gl.clear(gl.COLOR_BUFFER_BIT)),gl}()){var vertexShader=gl.createShader(gl.VERTEX_SHADER);gl.shaderSource(vertexShader,"attribute vec3 c,d; uniform vec4 e; uniform vec3 f,g;uniform mat4 h,i;varying vec3 j;void main(){vec3 a=normalize(d);vec4 b=h*vec4(c,1.);vec3 k=normalize(vec3(e-b));j=g*f*max(dot(k,a),0.),gl_Position=i*vec4(c,1.);}"),gl.compileShader(vertexShader);var fragmentShader=gl.createShader(gl.FRAGMENT_SHADER);gl.shaderSource(fragmentShader,"#ifdef GL_ES\nprecision mediump float;\n#endif\nvarying vec3 j;void main(){gl_FragColor = vec4(j, 1.0);}"),gl.compileShader(fragmentShader),program=gl.createProgram(),gl.attachShader(program,vertexShader),gl.attachShader(program,fragmentShader),gl.linkProgram(program),gl.detachShader(program,vertexShader),gl.detachShader(program,fragmentShader),gl.deleteShader(vertexShader),gl.deleteShader(fragmentShader),gl.useProgram(program);var n=function initVertexBuffers(gl){var latNumber,longNumber,vertexPositionData=[],normalData=[],textureCoordData=[],indexData=[];for(latNumber=0;latNumber<=50;++latNumber){var theta=latNumber*Math.PI/50,sinTheta=Math.sin(theta),cosTheta=Math.cos(theta);for(longNumber=0;longNumber<=50;++longNumber){var phi=2*longNumber*Math.PI/50,sinPhi=Math.sin(phi),x=Math.cos(phi)*sinTheta,y=cosTheta,z=sinPhi*sinTheta,u=1-longNumber/50,v=1-latNumber/50;vertexPositionData.push(2*x),vertexPositionData.push(2*y),vertexPositionData.push(2*z),normalData.push(x),normalData.push(y),normalData.push(z),textureCoordData.push(u),textureCoordData.push(v)}}for(latNumber=0;latNumber<50;++latNumber)for(longNumber=0;longNumber<50;++longNumber){var first=51*latNumber+longNumber,second=first+50+1;indexData.push(first),indexData.push(second),indexData.push(first+1),indexData.push(second),indexData.push(second+1),indexData.push(first+1)}vertexPositionData=new Float32Array(vertexPositionData),normalData=new Float32Array(normalData),textureCoordData=new Float32Array(textureCoordData),indexData=new Uint16Array(indexData);var vertexPositionBuffer=gl.createBuffer(),vertexNormalBuffer=gl.createBuffer(),indexBuffer=gl.createBuffer();gl.bindBuffer(gl.ARRAY_BUFFER,vertexPositionBuffer),gl.bufferData(gl.ARRAY_BUFFER,vertexPositionData,gl.STATIC_DRAW);var VertexPosition=gl.getAttribLocation(program,"c");gl.vertexAttribPointer(VertexPosition,3,gl.FLOAT,!1,0,0),gl.enableVertexAttribArray(VertexPosition),gl.bindBuffer(gl.ARRAY_BUFFER,vertexNormalBuffer),gl.bufferData(gl.ARRAY_BUFFER,normalData,gl.STATIC_DRAW);var VertexNormal=gl.getAttribLocation(program,"d");return gl.vertexAttribPointer(VertexNormal,3,gl.FLOAT,!1,0,0),gl.enableVertexAttribArray(VertexNormal),gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,indexBuffer),gl.bufferData(gl.ELEMENT_ARRAY_BUFFER,indexData,gl.STATIC_DRAW),indexData.length}(gl);gl.clearColor(0,0,0,1),gl.enable(gl.DEPTH_TEST);var projection=mat4.create();mat4.perspective(projection,Math.PI/6,1,.1,100);var modelView=mat4.create();mat4.lookAt(modelView,[0,0,10],[0,0,0],[0,1,0]);var mvpMatrix=mat4.create();mat4.multiply(mvpMatrix,projection,modelView);var ModelViewMatrix=gl.getUniformLocation(program,"h");gl.uniformMatrix4fv(ModelViewMatrix,!1,modelView);var MVP=gl.getUniformLocation(program,"i");gl.uniformMatrix4fv(MVP,!1,mvpMatrix);var LightPosition=gl.getUniformLocation(program,"e");gl.uniform4fv(LightPosition,[10,10,10,1]);var Kd=gl.getUniformLocation(program,"f");gl.uniform3fv(Kd,[.9,.5,.3]);var Ld=gl.getUniformLocation(program,"g");return gl.uniform3fv(Ld,[1,1,1]),gl.clear(gl.COLOR_BUFFER_BIT|gl.DEPTH_BUFFER_BIT),gl.drawElements(gl.TRIANGLES,n,gl.UNSIGNED_SHORT,0),function cleanup(){gl.useProgram(null),program&&gl.deleteProgram(program)}(),canvas.toDataURL()}}();imageData&&(imageHash=fnvHash(imageData))}return imageHash}var benchmarkValues=null;function benchmarkcpu(){function workerState(){this.samples=[],this.active=0}function timerComplete(worker){worker.terminate(),finished(worker.state)}function workerComplete(source){clearTimeout(source.currentTarget.timeout);var state=source.currentTarget.state;source.currentTarget.terminate(),state.samples=state.samples.concat(source.data),finished(state)}function finished(state){state.active--,0===state.active&&(benchmarkValues=state.samples,state.resolve(benchmarkValues))}function workerFetchUrl(resolve,reject,url){fetch(url,{mode:"same-origin"}).then((function(response){if(response.ok)!function workersStart(resolve,reject,url){var workers=[],state=new workerState;state.resolve=resolve,state.reject=reject;try{for(var i=0;i<2;i++){var worker=new Worker(url);worker.state=state,worker.onmessage=workerComplete,worker.onerror=function(error){reject(error)},workers.push(worker)}for(i=0;i<workers.length;i++)state.active++,workers[i].postMessage(80),workers[i].timeout=setTimeout(timerComplete,4e3,workers[i])}catch(ex){reject(new Error(ex))}}(resolve,reject,response.url);else{var error=new Error("Url could not be reached");error.response=response,reject(error)}})).catch((function(error){reject(error)}))}return new Promise((function(resolve,reject){null!=benchmarkValues?resolve(benchmarkValues):setTimeout((function(){workerFetchUrl(resolve,reject,takUrl)}),1e3)}))}function benchmarkcpuavg(node){return benchmarkcpu().then((function(values){var average=0;values.length>0&&(average=values.reduce((function(previous,current){return current+previous}))/values.length);resolveNode(node,average,0)})).catch((function(error){complete(node.x)}))}function benchmarkcpustd(node){return benchmarkcpu().then((function(values){var std=0;if(values.length>0){var sum=values.reduce((function(previous,current){return current+previous})),average=values.length>0?sum/values.length:0;std=values.reduce((function(sq,n){return sq+Math.pow(n-average,2)}),0)/(values.length-1)}resolveNode(node,std,0)})).catch((function(error){complete(node.x)}))}function fnvHash(str){for(var h=2166136261,i=0;i<str.length;++i)h^=str.charCodeAt(i),h+=(h<<1)+(h<<4)+(h<<7)+(h<<8)+(h<<24);return h>>>0}function hash(){var imageHash=0,canvas=document.createElement("canvas");if(null!=canvas){var imageData=function drawImage(canvas){canvas.width=67,canvas.height=67;var ctx=canvas.getContext("2d",{alpha:!0});if(null!=ctx)return ctx.imageSmoothingQuality="low",ctx.imageSmoothingEnabled=!0,ctx.globalCompositeOperation="source-over",ctx.globalAlpha=1,ctx.miterLimit=1/0,ctx.filter="none",ctx.lineCap="butt",ctx.lineDashOffset=0,ctx.lineJoin="miter",ctx.font="10pt Arial",ctx.lineWidth=2,void 0!==ctx.setLineDash&&ctx.setLineDash([10,20]),ctx.shadowColor="black",ctx.shadowOffsetX=-3,ctx.shadowOffsetY=-5,ctx.translate(canvas.width/2,canvas.height/2),ctx.rotate(.8901179),ctx.fillStyle="green",ctx.textAlign="center",ctx.textBaseline="middle",ctx.fillText("*51Degrees*",0,0),ctx.beginPath(),ctx.shadowColor="yellow",ctx.shadowBlur=1,ctx.shadowOffsetX=1,ctx.shadowOffsetY=1,ctx.strokeStyle="red",ctx.fillStyle="rgba(0, 0, 255, 0.6)",void 0===ctx.ellipse?ctx.arc(0,0,25,0,2*Math.PI):ctx.ellipse(0,0,25,15,Math.PI/4,0,2*Math.PI),ctx.fill(),ctx.stroke(),canvas.toDataURL()}(canvas);imageData&&(imageHash=fnvHash(imageData))}return imageHash}function height(){return window.screen.height*window.devicePixelRatio}function mediacolorgamut(){return function getMediaSingleValue(name,possibleValues){for(var i=0;i<possibleValues.length;i++)if(query="("+name+": "+possibleValues[i]+")",window.matchMedia(query).matches)return possibleValues[i];var query;return"n/a"}("color-gamut",["p3","srgb"])}function resolveNode(node,value,iterations){for(var i=0;i<node.n.length;i++){var child=nodes[node.n[i]];if(child.r)for(var c=0;c<child.r.length;c++){var range=child.r[c];if((null===range.a||value>=range.a)&&(null===range.b||value<=range.b))return void evaluateNode(child,0)}else if(child.v&&-1!=child.v.indexOf(value))return void evaluateNode(child,0)}node.n.length>0&&iterations<10&&setTimeout((function(){evaluateNode(node,iterations+1)}),10),complete(node.x)}function evaluateNode(node,iterations){if(node.m){var result=node.m(node);result||""===result?result.then||resolveNode(node,result,iterations):node.x&&complete(node.x)}else complete(node.x)}evaluateNode(nodes[0],0),complete("done")}function test(){let results=[];function getPrime(){return function largest_prime_factor(n){return factors(n).filter(primep).pop()}(1e11)}function factors(n){var i,out=[],sqrt_n=Math.sqrt(n);for(i=2;i<=sqrt_n;i++)n%i==0&&out.push(i);return out}function primep(n){return 0===factors(n).length}for(let i=0;i<3;i++){let time=performance.now();getPrime(),results.push(10*(performance.now()-time))}return results.sort(((a,b)=>a-b)),results[0]}function fallbackTest(){let res=Math.min(screen.width,screen.height)+"x"+Math.max(screen.width,screen.height),time=test();switch(res){case"320x480":Device.graphics.webgl.gpu="legacy";break;case"320x568":Device.graphics.webgl.gpu=time<=400?"apple a8":time<=500?"apple a7":"legacy";break;case"375x812":case"414x896":Device.graphics.webgl.gpu=time<=150?"apple a13":time<=180?"apple a12":"apple a11";break;case"414x736":case"375x667":Device.graphics.webgl.gpu=time<=220?"apple a11":time<=250?"apple a10":time<=360?"apple a9":time<=400?"apple a8":time<=600?"apple a7":"legacy";break;default:case"768x1024":Device.graphics.webgl.gpu=time<=140?"apple a14":time<=160?"apple a13":time<=180?"apple a12":time<=220?"apple a11":time<=250?"apple a10":time<=360?"apple a9":time<=400?"apple a8":time<=600?"apple a7":"legacy";break;case"834x1112":Device.graphics.webgl.gpu=time<=160?"apple a13":time<=180?"apple a12":time<=220?"apple a11":"apple a10";break;case"834x1194":time<=140?Device.graphics.webgl.gpu="apple m1 gpu":time<=160?Device.graphics.webgl.gpu="apple a13":time<=180&&(Device.graphics.webgl.gpu="apple a12");break;case"810x1080":time<=160?Device.graphics.webgl.gpu="apple a13":time<=220?Device.graphics.webgl.gpu="apple a11":time<=250&&(Device.graphics.webgl.gpu="apple a10");break;case"820x1180":Device.graphics.webgl.gpu="apple a14";break;case"428x926":case"390x844":Device.graphics.webgl.gpu="apple a15";break;case"1024x1366":Device.graphics.webgl.gpu=time<=140?"apple m1 gpu":time<=160?"apple a13":time<=180?"apple a12":time<=220?"apple a11":time<=250?"apple a10":"apple a9"}}this.exports=function(){let _value,promise=Promise.create();return getRenderer((value=>{if("done"==value){if(_value.includes("|"))try{let split=_value.split("|");if(1==split.length&&split[0].includes("Apple M"))Device.graphics.webgl.gpu="apple m1 gpu";else{let output=split.filter((v=>!v.includes("Apple M"))).map((v=>Number(v.replace("Apple","").replace("X","").replace("Z","").split("A")[1].split(" ")[0])));if(output.sort(((a,b)=>a-b)),output[output.length-1]-output[0]>2?fallbackTest():Device.graphics.webgl.gpu=split[0].toLowerCase(),"apple a14 gpu"==Device.graphics.webgl.gpu){let res=Math.min(screen.width,screen.height)+"x"+Math.max(screen.width,screen.height);"428x926"!=res&&"390x844"!=res||(Device.graphics.webgl.gpu="apple a15 gpu")}}}catch(e){fallbackTest()}else Device.graphics.webgl.gpu=_value.toLowerCase();promise.resolve()}else _value=value})),promise}})),Module((function GPUBlocklist(){this.exports={match:function(){return!Device.graphics.gpu||Device.graphics.gpu.detect(["radeon hd 6970m","radeon hd 6770m","radeon hd 6490m","radeon hd 6630m","radeon hd 6750m","radeon hd 5750","radeon hd 5670","radeon hd 4850","radeon hd 4870","radeon hd 4670","geforce 9400m","geforce 320m","geforce 330m","geforce gt 130","geforce gt 120","geforce gtx 285","geforce 8600","geforce 9600m","geforce 9400m","geforce 8800 gs","geforce 8800 gt","quadro fx 5","quadro fx 4","radeon hd 2600","radeon hd 2400","radeon hd 2600","mali-4","mali-3","mali-2","swiftshader","basic render driver","generic renderer","sgx543","legacy","sgx 543"])}}})),Class((function Initializer3D(){Inherit(this,Component);const _this=this;let _loader,_working,_promises=[],_queue=[];async function resolve(){await Promise.all(_promises),clearTimeout(_this.fire),_this.fire=_this.delayedCall((_=>{_this.events.fire(_this.READY),_this.resolved=!0,Utils3D.onTextureCreated=null,_loader&&_loader.trigger(50)}),100)}async function workQueue(){clearTimeout(_this.warningTimer),_working=!0;let promise=_queue.shift();if(!promise)return _working=!1;promise.resolve(workQueue),Hydra.LOCAL&&(_this.warningTimer=_this.delayedCall((_=>{console.warn("Long running queue has taken more than 5 seconds.")}),5e3))}function incCompleted(){_loader&&_loader.trigger(1)}this.READY="initializer_ready",this.bundle=function(){return new function PromiseBundler(){const promises=[],ready=Promise.create();let timer;function run(){clearTimeout(timer),timer=_this.delayedCall((_=>{Promise.all(promises).then((_=>ready.resolve()))}),100)}this.capture=function(promise){promises.push(promise),run()},this.ready=function(){return run(),ready}}},this.promise=this.capture=function(promise){return _loader&&_loader.add(1),promise.then(incCompleted),_promises.push(promise),clearTimeout(_this.timer),_this.timer=_this.delayedCall(resolve,100),promise},this.ready=this.loaded=function(){return _this.wait(_this,"resolved")},this.createWorld=async function(){await Promise.all([AssetLoader.waitForLib("zUtils3D"),Shaders.ready(),GPU.ready(),UILStorage.ready()]),World.instance()},this.linkSceneLayout=function(loader){_this.captureTextures(),SceneLayout.initializer=_this.capture,_loader=loader},this.queue=function(immediate){if(immediate)return Promise.resolve((_=>{}));let promise=Promise.create();return _queue.push(promise),_working||workQueue(),promise},this.captureTextures=function(){Utils3D.onTextureCreated=texture=>{_this.promise(texture.promise)}},this.uploadAll=async function(group){if(!group)throw"Undefined passed to uploadAll";let sceneLayout;if(group instanceof SceneLayout||window.StageLayout&&group instanceof StageLayout){if(sceneLayout=group,sceneLayout.uploaded)return;sceneLayout.uploaded=!0,await sceneLayout.loadedAllLayers(),group=group.group}let promises=[],layouts=[],textures=[];if(sceneLayout){sceneLayout.textures=textures;for(let key in sceneLayout.layers){let layer=sceneLayout.layers[key];layer.uploadSync&&layer.uploadSync()}}group.traverse((obj=>{if(obj.sceneLayout&&obj!=group&&layouts.push(obj.sceneLayout),obj.stageLayout&&obj!=group&&layouts.push(obj.stageLayout),!obj.uploadIgnore&&0!=obj.visible){if(obj.shader)for(let key in obj.shader.uniforms){let uniform=obj.shader.uniforms[key];uniform&&uniform.value&&uniform.value.promise&&(textures.push(uniform.value),promises.push(uniform.value.promise.then(uniform.value.upload.bind(uniform.value)).catch((e=>{}))))}obj.asyncPromise?promises.push(obj.asyncPromise.then(obj.upload.bind(obj))):obj.upload&&obj.upload()}})),await Promise.catchAll(promises),textures.forEach((t=>t.upload()));for(let i=0;i<layouts.length;i++)await _this.uploadAll(layouts[i]);sceneLayout&&sceneLayout._completeInitialization&&sceneLayout._completeInitialization(!0),sceneLayout&&delete sceneLayout.textures},this.uploadAllDistributed=this.uploadAllAsync=async function(group,releaseQueue){if(!group)throw"Undefined passed to uploadAllDistributed";let sceneLayout;if(releaseQueue||"boolean"==typeof releaseQueue||(releaseQueue=await _this.queue()),group instanceof SceneLayout||window.StageLayout&&group instanceof StageLayout){if(sceneLayout=group,sceneLayout.uploaded)return"function"==typeof releaseQueue?releaseQueue():void 0;sceneLayout.uploaded=!0,await sceneLayout.loadedAllLayers(),group=group.group}let uploads=[],_async=[],promises=[],layouts=[],textures=[];if(sceneLayout){sceneLayout.textures=textures;for(let key in sceneLayout.layers){let layer=sceneLayout.layers[key];layer.upload&&!layer.uploadIgnore&&layer.upload()}}group.traverse((obj=>{if(obj.sceneLayout&&obj!=group&&layouts.push(obj.sceneLayout),obj.stageLayout&&obj!=group&&layouts.push(obj.stageLayout),!obj.uploadIgnore&&0!=obj.visible){if(obj.shader)for(let key in obj.shader.uniforms){let uniform=obj.shader.uniforms[key];uniform&&uniform.value&&uniform.value.promise&&(textures.push(uniform.value),promises.push(uniform.value.promise.then((_=>uploads.push(uniform.value.upload.bind(uniform.value)))).catch((e=>{}))))}if(obj.asyncPromise)promises.push(obj.asyncPromise.then((_=>{obj.geometry&&(obj.geometry.distributeBufferData=!0),uploads.push(obj.upload.bind(obj)),obj.geometry&&_async.push(obj.geometry.uploadBuffersAsync.bind(obj.geometry))})));else if(obj.upload){if(obj.geometry){if(obj.geometry.uploaded)return;obj.geometry.distributeBufferData=!0}uploads.push(obj.upload.bind(obj)),obj.geometry&&_async.push(obj.geometry.uploadBuffersAsync.bind(obj.geometry))}}}));let canFinish=!1,promise=Promise.create(),worker=new Render.Worker((_=>{let upload=uploads.shift();upload?upload():canFinish?((async _=>{for(let i=0;i<_async.length;i++)await _async[i]();for(let i=0;i<layouts.length;i++)await _this.uploadAllAsync(layouts[i],!!releaseQueue);"function"==typeof releaseQueue&&releaseQueue(),promise.resolve()})(),worker.stop()):worker.pause()}),1);return Promise.catchAll(promises).then((_=>{worker.resume(),canFinish=!0})),sceneLayout&&sceneLayout._completeInitialization&&sceneLayout._completeInitialization(!1),sceneLayout&&promise.then((_=>{delete sceneLayout.textures})),promise},this.detectUploadAll=function(group,sync,releaseQueue){return sync?_this.uploadAll(group):_this.uploadAllDistributed(group,releaseQueue)},this.detectUploadNuke=function(nuke,sync){return sync?_this.uploadNukeAsync(nuke):_this.uploadNuke(nuke)},this.uploadNuke=async function(nuke){for(let i=0;i<nuke.passes.length;i++){let pass=nuke.passes[i],uniforms=pass.uniforms;for(let key in uniforms)uniforms[key].value&&uniforms[key].value.promise&&await uniforms[key].value.promise,uniforms[key].value&&uniforms[key].value.upload&&uniforms[key].value.upload();pass.upload()}Nuke.defaultPass.uploaded||Nuke.defaultPass.upload()},this.uploadNukeAsync=function(nuke){return this.uploadNuke(nuke)},this.destroyAll=function(scene){scene.traverse((obj=>{if(obj.geometry&&obj.shader){for(let key in obj.shader.uniforms){let uniform=obj.shader.uniforms[key];uniform&&uniform.value instanceof Texture&&uniform.value.destroy()}obj.destroy()}}))},this.set("loader",(loader=>{_loader=loader}))}),"static"),Class((function Webcam(_width,_height,_audio){Inherit(this,Component);var _this=this;let _stream,_cameras={},_config={},_back=!1,_attempts=0;function establishWebcam(){if(_attempts>=2||!navigator.mediaDevices)return error();(function lookupDevices(){let promise=Promise.create();return Device.mobile?(navigator.mediaDevices.enumerateDevices().then((devices=>{devices.forEach((device=>{device.label.includes("front")&&(_cameras.front={deviceId:{exact:device.deviceId}}),device.label.includes("back")&&(_cameras.back={deviceId:{exact:device.deviceId}},_back=!0)})),_cameras.front||(_cameras.front={facingMode:"user"}),_cameras.back||(_cameras.back={facingMode:"environment"},_back=!1),promise.resolve()})),promise):Promise.resolve()})().then((()=>{_stream&&_config.back&&_stream.getTracks()[0].stop(),Device.mobile.phone&&(_cameras&&_cameras.back&&(_cameras.back.frameRate={ideal:60}),_cameras&&_cameras.front&&(_cameras.front.frameRate={ideal:60})),navigator.mediaDevices.getUserMedia({video:_config.back?_cameras.back:_cameras.front||!0,audio:_audio}).then(success).catch(error)})),_attempts+=1}function success(stream){_this.denied=!1,_stream=stream,_config.back&&!_back?establishWebcam():(_this.div.srcObject=stream,_this.events.fire(Events.READY,null,!0))}function error(){_this.denied=!0,_this.events.fire(Events.ERROR,null,!0)}_this.facing="back",function createVideo(){_this.div=window.AURA?document.createElement():document.createElement("video"),_this.div.width=_width,_this.div.height=_height,_this.div.autoplay=!0,_this.div.controls=!0,_this.div.playsinline=!0,_this.div.setAttribute("playsinline",!0),_this.div.setAttribute("controls",!0),Stage.add(_this.div),_this.element=$(_this.div),_this.element.transformPoint(0,0).transform({scaleX:Device.mobile?1:-1,scale:.25}).setZ(-1)}(),function initNavigator(){navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia}(),this.createStream=function(config={}){_attempts=0,_config=config,establishWebcam()},this.flip=function(){if(!_back)return;let direction;"front"===_this.facing?(_this.facing="back",direction=_cameras.back):(_this.facing="front",direction=_cameras.front),_stream.getTracks()[0].stop(),navigator.getUserMedia({video:direction||!0,audio:_audio},success,error)},this.get("width",(function(){return _width})),this.get("height",(function(){return _height})),this.size=function(w,h){_this.div.width=_width=w,_this.div.height=_height=h,_this.element.size(w,h)},this.getPixels=function(width=_width,height=_height){return _this.canvas||(_this.canvas=document.createElement("canvas"),_this.canvas.width=width,_this.canvas.height=height,_this.canvas.context=_this.canvas.getContext("2d")),_this.canvas.context.drawImage(_this.div,0,0,width,height),_this.canvas.context.getImageData(0,0,width,height)},this.getCanvas=function(){return _this.canvas||(_this.canvas=document.createElement("canvas"),_this.canvas.width=_width,_this.canvas.height=_height,_this.canvas.context=_this.canvas.getContext("2d")),_this.canvas.context.drawImage(_this.div,0,0,_width,_height),_this.canvas},this.ready=function(){return _this.div.readyState>0},this.end=function(){_this.active=!1,_this.div.pause(),_stream&&(_stream.getTracks()[0].enabled=!1)},this.restart=function(){_this.div.play(),_stream&&(_stream.getTracks()[0].enabled=!0),_this.active=!0},this.deviceCount=async function(kind){if(!navigator.mediaDevices)return 0;let devices=await navigator.mediaDevices.enumerateDevices(),count=0;return devices.forEach((d=>{d.kind.includes(kind)&&count++})),count}})),Class((function Performance(){Inherit(this,Component);var _overrides=Storage.get("performance_override")||{};const PLATFORM_ALLOWED_KEYS=["desktopVRAvailable","enableWorldNukeMSAA","msaaSamples","forceWebGL1","blurFX"];function save(obj,key,value){_overrides[key]={obj:Utils.getConstructorName(obj),value:value},Storage.set("performance_override",_overrides)}function convert(tier){if(GPU.BLACKLIST)return"F";switch(tier){case 5:return"A++";case 4:return"A+";case 3:return"A";case 2:return"B";case 1:return"C";case 0:return"D"}}!async function(){if(Utils.query("performance")&&Utils.query("edit")||Utils.query("custom")){await Hydra.ready();for(let key in _overrides){let obj,value,override=_overrides[key];override?.obj?({obj:obj,value:value}=override):(obj="Tests",value=override),window[obj][key]=_=>value}}}(),this.displayResults=async function(){let editing=Utils.query("edit");await GPU.ready(),__body.bg("#000");let $results=__body.create("PerformanceResults");__body.css({overflowY:"scroll",background:"#000"}),$results.fontStyle("Arial",16,"#fff").css({marginLeft:50,marginRight:50,"user-select":"auto"}),Mobile.allowNativeScroll(),HydraCSS.style(".PerformanceResults *",{position:"relative","user-select":"auto"});Tests.constructor.toString();let tests="",keys=[],addTest=(obj,key)=>{let result=obj[key]();tests+=`<p><b>${key}:</b> `,tests+=editing?"number"==typeof result?`<input class="${key}" value="${result.toString()}" /></p>`:"boolean"==typeof result?`<input class="${key}" type="checkbox" ${result?"checked":""}/></p>`:`<input class="${key}" value="${result}" type="text"></p>`:result+"</p>",keys.push({obj:obj,key:key})};for(let key in Tests)addTest(Tests,key);if(window.Platform)for(let key in Platform)(key.startsWith("use")||key.startsWith("using")||PLATFORM_ALLOWED_KEYS.includes(key))&&addTest(Platform,key);let html=`<h1>Performance Results</h1>\n                    <p><b>GPU:</b> ${Device.graphics.webgl?Device.graphics.webgl.gpu:"WEBGL UNAVAILABLE"}</p>\n                    <p><b>WebGL Version:</b> ${Device.graphics.webgl?Device.graphics.webgl.version:"WEBGL UNAVAILABLE"}</p>\n                    <p><b>GPU Tier:</b> ${Device.mobile?convert(GPU.M_TIER):convert(GPU.TIER)} [${Device.mobile?GPU.M_TIER:GPU.TIER}]</p>\n                    <p><b>Mobile:</b> ${Device.mobile?Object.keys(Device.mobile).filter((key=>Device.mobile[key])):"false"} </p>\n                    <p><b>User Agent:</b> ${Device.agent}</p>\n                    <p><b>OS:</b> ${Device.system.os}</p>\n                    <p><b>DPR:</b> ${Device.pixelRatio}</p>\n                    <p><b>Screen Size:</b> ${screen.width} x ${screen.height}</p>\n                    <p><b>Stage Size:</b> ${Stage.width} x ${Stage.height}</p>\n                    \n                    <h2>Project-Specific Tests</h2>\n                    ${editing?'<button class="resetBtn">Reset All</button>':""}\n                    ${tests}\n        `;if($results.html(html),editing){await defer(),document.querySelector(".resetBtn").onclick=_=>{Storage.set("performance_override",null),location.reload()};for(let{obj:obj,key:key}of keys){let div=document.querySelector("."+key);div&&(div.onchange=_=>{let value=div.value;value=isNaN(value)?div.checked:Number(value),save(obj,key,value)})}}}}),"static"),Class((function UI3DPromptLayout(_name=Utils.query("name")||"base",_width=Utils.query("width")||2,_height=Utils.query("height")||.98){Inherit(this,Object3D);const _this=this,_target=new Group;let _offsetZ=-1;function updateOrientation(){if(!_this.flag("active"))return;const{camera:camera}=PlayerSettings.instance().state;if("1st"===camera){const offsetVector=(new Vector3).set(0,0,_offsetZ).applyQuaternion(World.CAMERA.quaternion);_target.position.copy(World.CAMERA.position),_target.position.add(offsetVector),_target.lookAt(World.CAMERA.position),_this.group.position.lerp(_target.position,.1),_this.group.quaternion.slerp(_target.quaternion,.1)}"3rd"===camera&&(_target.quaternion.copy(World.CAMERA.quaternion),_this.group.quaternion.slerp(_target.getWorldQuaternion(),.1))}function internalAnimateInDone(){_this.animateInDone?.()}function internalAnimateOutDone(){_this.group.visible=!1,_this.flag("active",!1),_this.animateOutDone()}function internalFaceAnimateInDone(){_this.faceAnimateInDone()}function internalFaceAnimateOutDone(){_this.group.visible=!1,_this.faceAnimateOutDone()}!function initLayout(){_this.layout=_this.initClass(StageLayout,_name+"_3d_prompt",{glui:!0,noGraph:Global.PLAYGROUND!==Utils.getConstructorName(_this)}),_this.capture=_this.initClass(StageLayoutCapture,_this.layout,1280,_height/_width*1280,!0),_this.root=_this.capture.root,_this.$gluiObject=$gl(_width,_height,_this.capture),_this.$gluiObject.enable3D(),_this.$gluiObject.mesh.shader.depthTest=!1,_this.$gluiObject.mesh.shader.depthWrite=!1,_this.$gluiObject.mesh.shader.transparent=!0,_this.capture.object3d=_this.$gluiObject,UI3DPromptLayout.FORCE_RETINA&&(_this.capture.object3d.mesh.shader.nullRender=!0,_this.startRender((_=>{_this.capture.object3d.mesh._drawing&&(World.RENDERER.autoClear=!1,World.RENDERER.renderSingle(_this.capture.object3d.mesh,World.CAMERA),World.RENDERER.autoClear=!0)}),RenderManager.POST_RENDER)),_this.group.add(_this.$gluiObject.group),_this.group.renderOrder=9999999,_this.group.scale.setScalar(0),_this.group.visible=Global.PLAYGROUND}(),async function validateBloomEffect(){let env=await _this.findParent("GroupEnvironment"),attr={};env?.view&&(attr.customCompile=Utils.getConstructorName(env.view));let shader=_this.initClass(Shader,"UI3DPromptLayoutShader",attr);_this.capture.useShader?.(shader)}(),_this.flag("initialized",!0),_this.startRender(updateOrientation),this.open=async function(){if(await _this.ready(),_this.flag("active",!0),_this.group)return _this.group.visible=!0,PlayerControlsPathfinding.DISABLED=!0,_this.animateIn(internalAnimateInDone)},this.animateIn=function(done){return _this.group.scale.setScalar(.5),_this.$gluiObject.alpha=0,_this.$gluiObject.tween({alpha:1},500,"easeOutBack"),tween(_this.group.scale,{x:1,y:1,z:1},500,"easeOutBack").onComplete(done).promise()},this.animateInDone=()=>{},this.close=async function(){if(await _this.ready(),_this.group)return _this.animateOut(internalAnimateOutDone)},this.animateOut=async function(done){return _this.$gluiObject.tween({alpha:0},200,"easeOutCubic"),tween(_this.group.scale,{x:.8,y:.8,z:.8},200,"easeOutCubic").onComplete((async()=>{done(),PlayerControlsPathfinding.DISABLED=!1})).promise()},this.animateOutDone=()=>{},this.faceAnimateIn=async function(done){return _this.group.scale.setScalar(0),tween(_this.group.scale,{x:1,y:1,z:1},400,"easeInOutCubic").onComplete(done).promise()},this.faceAnimateInDone=()=>{},this.faceAnimateOut=async function(done){return tween(_this.group.scale,{x:0,y:0,z:0},400,"easeInOutCubic").onComplete(done).promise()},this.faceAnimateOutDone=()=>{},this.ready=_=>_this.wait("initialized"),this.updateFace=async function(promptClass,params){if(!_this.parent.updateFace)return await async function internalFaceAnimateOut(){if(await _this.ready(),_this.group)return _this.faceAnimateOut(internalFaceAnimateOutDone)}(),this.setFace(promptClass,params),async function internalFaceAnimateIn(){if(await _this.ready(),_this.group)return _this.group.visible=!0,_this.faceAnimateIn(internalFaceAnimateInDone)}(),_this;_this.parent.updateFace(promptClass,params)},this.setFace=function(promptClass,params){_this.$gluiObject.remove();const prompt=_this.initClass(promptClass,params,null);return prompt.group.scale.setScalar(1),prompt.group.visible=!0,_this.$gluiObject=prompt.$gluiObject,_this.group.add(_this.$gluiObject.group),_this},this.setPosition=function(position){return _this.group.position.copy(position),_this},this.promptOffsetFirstPerson=function(value){return _offsetZ=value,_this}}),(_=>{UI3DPromptLayout.FORCE_RETINA=!1})),Class((function RenderManager(){Inherit(this,Component);const _this=this;var _hasGLUI,_hasMetal,_firingEvt,_dpr=null,_schedules=new Map,_needsDeletion=!1;function fire(evt,data){let array=_schedules.get(evt);if(array){_firingEvt=evt;let len=array.length;for(let i=0;i<len;i++){let cb=array[i];cb.markedForDeletion||(data?cb(data):cb(Render.TIME,Render.DELTA))}if(_firingEvt=void 0,_needsDeletion){for(let i=0;i<array.length;i++)array[i].markedForDeletion&&(delete array[i].markedForDeletion,array.splice(i,1),--i);_needsDeletion=!1}}}function startFrame(){fire(_this.FRAME_BEGIN)}function resizeHandler(){_this.renderer&&_this.renderer.setSize(Stage.width,Stage.height)}function getDPR(){return window.AURA?Device.pixelRatio:GPU.OVERSIZED?1:GPU.lt(0)?Math.min(1.3,Device.pixelRatio):GPU.lt(1)?Math.min(1.8,Device.pixelRatio):GPU.mobileLT(2)?Math.min(2,Device.pixelRatio):GPU.gt(4)?Math.max(1.5,Device.pixelRatio):Math.max(1.25,Device.pixelRatio)}function directRenderCallback(render){_hasGLUI&&_hasMetal&&GLUI.renderDirect(render)}this.NORMAL="normal",this.MAGIC_WINDOW="magic_window",this.VR=this.WEBVR="webvr",this.AR=this.WEBAR="webar",this.RENDER="RenderManager_render",this.BEFORE_RENDER="RenderManager_before_render",this.POST_RENDER=this.FRAME_END="RenderManager_post_render",this.EYE_RENDER="RenderManager_eye_render",this.FRAME_BEGIN="RenderManager_frame_begin",this.AFTER_LOOPS="RenderManager_after_loops",this.NATIVE_FRAMERATE="RenderManager_native_framerate",this.READY="render_gl_ready",this.initialized=Promise.create(),_this.events.sub(Events.RESIZE,resizeHandler),Render.startFrame=startFrame,Hydra.ready((_=>{_hasGLUI=!!window.GLUI,_hasMetal=!!window.Metal})),this.get("DPR",(v=>getDPR())),this.initialize=function(type,params={}){if(_this.camera&&_this.camera.destroy(),_this.renderer&&_this.renderer.destroy(),type!=_this.WEBVR&&type!=_this.WEBAR||(params.xrCompatible=!0,params.alpha=!1),!_this.gl){let camera=new PerspectiveCamera(45,Stage.width/Stage.height,.01,200);_this.gl=function(){"safari"==Device.system.browser&&Device.system.browserVersion<13&&delete params.powerPreference,Utils.query("compat")&&(params.forceWebGL1=!0);let renderer=new(window.Metal?MetalRenderer:Renderer)(params);return renderer.setSize(Stage.width,Stage.height),renderer.setPixelRatio(getDPR()),renderer}(),_this.scene=new Scene,_this.nuke=_this.initClass(Nuke,Stage,Object.assign({renderer:_this.gl,scene:_this.scene,camera:camera,dpr:World.DPR},params))}switch(_dpr=_dpr||World.DPR||1,type){case _this.WEBVR:_this.renderer=_this.initClass(VRRenderer,_this.gl,_this.nuke),_this.camera=_this.initClass(VRCamera);break;case _this.WEBAR:_this.renderer=_this.initClass(window.Metal?MetalARRenderer:ARRenderer,_this.gl,_this.nuke),_this.camera=_this.initClass(ARCamera);break;case _this.MAGIC_WINDOW:_this.renderer=_this.initClass(MagicWindowRenderer,_this.gl,_this.nuke),_this.camera=_this.initClass(VRCamera);break;case _this.NORMAL:_this.renderer=_this.initClass(RenderManagerRenderer,_this.gl,_this.nuke),_this.camera=_this.initClass(RenderManagerCamera)}_this.type=type,_this.nuke.camera=_this.camera.worldCamera,_this.initialized.resolve()},this.render=function(scene,camera,renderTarget,forceClear){fire(_this.AFTER_LOOPS),_this.type==_this.VR&&fire(World.NUKE),fire(_this.BEFORE_RENDER),_this.renderer.render(scene||_this.scene,_this.nuke.camera,renderTarget,forceClear,directRenderCallback),_this.events.fire(_this.POST_RENDER),fire(_this.POST_RENDER)},this.schedule=function(callback,slot){_schedules.has(slot)||_schedules.set(slot,[]);let array=_schedules.get(slot),index=array.indexOf(callback);index>=0&&!array[index].markedForDeletion||array.push(callback)},this.scheduleOne=function(callback,slot){let result;"function"!=typeof callback&&(slot=callback,result=Promise.create(),callback=result.resolve);let array=_schedules.get(slot);if(array){if(array.find((h=>h.scheduleOneCallback===callback)))return}let handler=function(){return _this.unschedule(handler,slot),callback.apply(this,arguments)};return handler.scheduleOneCallback=callback,_this.schedule(handler,slot),result},this.unschedule=function(callback,slot){_schedules.has(slot)||_schedules.set(slot,[]);const array=_schedules.get(slot);array.indexOf(callback)<0||(_firingEvt==slot?(callback.markedForDeletion=!0,_needsDeletion=!0):array.remove(callback))},this.setSize=function(width,height){_this.events.unsub(Events.RESIZE,resizeHandler),_this.renderer.setSize(width,height)},this.fire=fire}),"static"),Class((function RenderManagerCamera(){Inherit(this,Component);const _this=this;this.worldCamera=window.THREE?new THREE.PerspectiveCamera(30,Stage.width/Stage.height,.1,1e3):new PerspectiveCamera(30,Stage.width/Stage.height,.1,1e3),_this.events.sub(Events.RESIZE,(()=>{_this.worldCamera.aspect=Stage.width/Stage.height,_this.worldCamera.updateProjectionMatrix()}))})),Class((function RenderManagerRenderer(_renderer,_nuke){Inherit(this,Component);const _this=this;var _evt={};_nuke.onBeforeProcess=_=>{_evt.stage=Stage,_evt.camera=_nuke.camera,_this.events.fire(RenderManager.RENDER,_evt)},this.render=function(scene,camera,_1,_2,directRender){_nuke.camera=camera,_nuke?_nuke.render(directRender):_renderer.render(scene,camera,null,null,directRender)},this.setSize=function(width,height){_renderer.setSize(width,height)}})),Class((function Shaders(){Inherit(this,Component);var _this=this;function parseSingleShader(code,fileName){let uniforms=code.split("#!UNIFORMS")[1].split("#!")[0],varyings=code.split("#!VARYINGS")[1].split("#!")[0],attributes=code.split("#!ATTRIBUTES")[1].split("#!")[0];for(;code.includes("#!SHADER");){let split=(code=code.slice(code.indexOf("#!SHADER"))).split("#!SHADER")[1],br=split.indexOf("\n"),name=split.slice(0,br).split(": ")[1];name.slice(0,6).includes("Vertex")&&(name=fileName.split(".")[0]+".vs"),name.slice(0,8).includes("Fragment")&&(name=fileName.split(".")[0]+".fs");let glsl=split.slice(br);glsl=name.includes(".vs")?attributes+uniforms+varyings+glsl:uniforms+varyings+glsl;let splitName=name.split(".");_this[splitName[0]+(splitName[1].includes("vs")?".vs":".fs")]=glsl,code=code.replace("#!SHADER","$")}}function parseCompiled(shaders){var split=shaders.split("{@}");split.shift();for(var i=0;i<split.length;i+=2){var name=split[i],text=split[i+1];text.includes("#!UNIFORMS")?parseSingleShader(text,name):_this[name]=text}}function parseRequirements(){for(var key in _this){var obj=_this[key];"string"==typeof obj&&(_this[key]=require(obj))}}function require(shader){if(!shader.includes("require"))return shader;for(shader=shader.replace(/# require/g,"#require");shader.includes("#require");){var name=shader.split("#require(")[1].split(")")[0];if(name=name.replace(/ /g,""),!_this[name])throw"Shader required "+name+", but not found in compiled shaders.\n"+shader;shader=shader.replace("#require("+name+")",_this[name])}return shader}this.parse=function(code,file){code.includes("{@}")?(parseCompiled(code),parseRequirements()):(file=(file=file.split("/"))[file.length-1],_this[file]=code),_this.shadersParsed=!0},this.parseSingle=parseSingleShader,this.onReady=this.ready=function(callback){let promise=Promise.create();return callback&&promise.then(callback),_this.wait((()=>promise.resolve()),_this,"shadersParsed"),promise},this.getShader=function(string){_this.FALLBACKS&&_this.FALLBACKS[string]&&(string=_this.FALLBACKS[string]);var code=_this[string];if(!code)throw`No shader ${string} found`;for(;code.includes("#test ");)try{var test=code.split("#test ")[1],name=test.split("\n")[0],glsl=code.split("#test "+name+"\n")[1].split("#endtest")[0];eval(name)||(code=code.replace(glsl,"")),code=code.replace("#test "+name+"\n",""),code=code.replace("#endtest","")}catch(e){throw"Error parsing test :: "+string}return code}}),"static"),Class((function Sprite(_id,_css={},_title="",_viewBox=!1,_useChildren=!1){Inherit(this,Element,"svg","Sprite");const $this=this.element;!async function(){const symbol=$(Spritesheet.element.div).div.querySelector("#sprite-"+_id);if(symbol&&_viewBox){let viewBox=symbol.getAttribute("viewBox");$this.attr("viewBox",viewBox)}$this.attr("role","img"),$this.css(_css);let inner="";_title&&(inner+=`<title>${_title}</title>`),inner+=symbol&&_useChildren?""+symbol.innerHTML:`<use xlink:href="#sprite-${_id}">`,$this.html(inner)}()})),Class((function Spritesheet(){Inherit(this,Component);const _this=this;_this.url="assets/images/sprite.svg",async function(){await Hydra.ready();const request=await fetch(_this.url),response=await request.text();_this.element=Stage.create("Sprites"),_this.element.size(0,0).setZ(-1).html(response),Stage.add(_this.element),_this.flag("isReady",!0)}(),_this.ready=function(){return _this.wait("isReady")}}),"static"),Class((function StatusPage(){Inherit(this,Component);const _this=this;let $results,_HTML;function initUser(){_HTML+=`\n            <h2>User</h1>\n            <p><b>UID:</b> ${User.uid}</p>\n        `,User.profile&&(!function initUserProfile(){_HTML+=`\n            <h3>Profile</h3>\n            ${Object.keys(User.profile).reduce(((html,key)=>{if("claims"===key)return html;const value=User.profile[key];return Array.isArray(value)?html+`<p><b>${key}:</b> ${value.join(", ")}</p>`:html+`<p><b>${key}:</b> ${value}</p>`}),"")}\n        `}(),User.profile.claims&&function initUserProfileClaims(){_HTML+=`\n            <h3>Claims</h3>\n            ${Object.keys(User.profile.claims).reduce(((html,key)=>{const value=User.profile.claims[key];return Array.isArray(value)?html+`<p><b>${key}:</b> ${value.join(", ")}</p>`:"object"==typeof value?html+`<p><b>${key}:</b> ${JSON.stringify(value)}</p>`:html+`<p><b>${key}:</b> ${value}</p>`}),"")}\n        `}()),$results.html(_HTML)}!async function(){await Config.ready()}(),_this.displayResults=async function displayResults(){!function initStyles(){__body.css({overflowY:"auto",backgroundColor:"#000"}),$results=__body.create("StatusResults"),$results.fontStyle("Arial",16,"#FFF").css({margin:20}),Mobile.allowNativeScroll(),HydraCSS.style("#Stage",{display:"none"}),HydraCSS.style(".StatusResults *",{position:"relative",marginBottom:10}),_HTML="\n            <h1>API Status</h1>\n        "}(),Platform&&(User&&(await User.ready(),_this.events.sub(PlatformAuth.LOGGED_IN,initUser)),Config.SERVICES&&function initPlatformServices(){_HTML+=`\n            <h2>Platform Services</h1>\n            ${Object.keys(Config.SERVICES).reduce(((html,key)=>{const value=Config.SERVICES[key];return Array.isArray(value)?html+`<p><b>${key}:</b> ${value.join(", ")}</p>`:html+`<p><b>${key}:</b> ${value}</p>`}),"")}\n        `}()),$results.html(_HTML)},_this.addHTML=function addHTML(html){_HTML+=html,$results.html(_HTML)}}),"static"),Class((function UI3D(_name=""){Inherit(this,Component);const _this=this,_rtSize=new Vector2,_captureUnitSize=new Vector2;this.create=function(width=512,height=512,dpr,data){_rtSize.set(width,height),_captureUnitSize.set(width>height?1:width/height,width>height?height/width:1),"number"!=typeof dpr&&(data=dpr,dpr=void 0),data?(_this.layout=_this.initClass(StageLayout,Utils.getConstructorName(_this)+_name,{glui:!0,data:data,noGraph:!_this.isPlayground()}),_this.root=_this.layout.element,_this.capture=_this.initClass(StageLayoutCapture,_this.layout,width,height,UI3D.getRTPool(width,height,dpr))):(_this.capture=_this.initClass(StageLayoutCapture,width,height,UI3D.getRTPool(width,height,dpr)),_this.root=_this.capture.root),_this.root.capture=_this.capture,_this.$gluiObject=$gl(_captureUnitSize.x,_captureUnitSize.y,_this.capture),_this.capture.object3d=_this.$gluiObject},this.setSize=function(size){const fillRatio=(new Vector2).copy(size).divide(_rtSize);fillRatio.divideScalar(Math.max(fillRatio.x,fillRatio.y,1)),_captureUnitSize.set(size.x>size.y?1:size.x/size.y,size.x>size.y?size.y/size.x:1),_captureUnitSize.multiplyScalar(Math.max(fillRatio.x,fillRatio.y)),_this.capture.setSize(size.x,size.y),_this.$gluiObject.size(_captureUnitSize.x,_captureUnitSize.y)},this.useShader=function(shader){_this.$gluiObject.useShader(shader)},this.ready=function(){return _this.wait(_this,"isReady")},this.hide=function(){_this.capture.enabled=!1,_this.$gluiObject.hide()},this.show=function(){_this.capture.enabled=!0,_this.$gluiObject.show()}}),(_=>{var _pools={};UI3D.getRTPool=function(width,height,dpr=World.DPR){let key=width+" "+height;return _pools[key]||(_pools[key]=RTPool.instance().clone(Texture.UNSIGNED_BYTE,3,Texture.RGBAFormat),_pools[key].setSize(width*dpr,height*dpr)),_pools[key]},UI3D.findStageLayoutCapture=function(p){for(;p;){if(p.capture)return p.capture;p=p.parent}}})),Class((function UI3DLayer(_input,_group,_id){Inherit(this,Object3D);const _this=this;var _config,_obj;function completeShader(shader){let transparent=_input.get("transparent"),depthWrite=_input.get("depthWrite"),depthTest=_input.get("depthTest"),blending=_input.get("blending"),castShadow=_input.get("castShadow"),receiveShadow=_input.get("receiveShadow"),renderOrder=_input.getNumber("renderOrder");"boolean"==typeof depthWrite&&(shader.depthWrite=shader.mesh.depthWrite=depthWrite),"boolean"==typeof depthTest&&(shader.depthTest=shader.mesh.depthTest=depthTest),"boolean"==typeof transparent&&(shader.transparent=transparent),"boolean"==typeof castShadow&&(shader.mesh.castShadow=castShadow),"boolean"==typeof receiveShadow&&(shader.receiveShadow=receiveShadow),"number"==typeof renderOrder&&(shader.mesh.renderOrder=renderOrder),blending&&(shader.blending=blending)}(function(){_config=InputUIL.create(_input.prefix+"ui3d",_group),_config.add("class"),_config.add("visibilityTest"),_config.addToggle("retina"),_config.setLabel("Config");let testString=_config.get("visibilityTest");if(testString&&testString.length&&!eval(testString))return;let className=_config.get("class");if(!className||0==_input.get("visible"))return;let wildcard=_input.get("wildcard");if(!window[className])throw`UI3DLayer :: ${className} doesn't exist!`;let obj=_this.initClass(window[className],{data:wildcard,uil:{input:_input,group:_group,id:_id}});if(!obj.$gluiObject)throw`UI3DLayer :: ${className} not instance of UI3D (or create() hasn't been called)`;completeShader(obj.$gluiObject.shader),GLUIUtils.setRetinaMode(obj.$gluiObject,_config.get("retina")||UI3DLayer.overrideRetina,_this),GLUIUtils.isRetinaMode(obj.$gluiObject)?_this.flag("retina",!0):(obj.$gluiObject.enable3D(),obj.$gluiObject.depthTest(!1)),_obj=obj})(),_this.getObject=function(){return _obj},this.onDestroy=function(){_this.flag("retina")&&GLUI.Scene.remove(_obj.$gluiObject)},_this.get("renderOrder",(()=>_obj?.$gluiObject.shader.mesh.renderOrder)),_this.set("renderOrder",(renderOrder=>{_obj&&(_obj.$gluiObject.shader.mesh.renderOrder=renderOrder)}))})),Class((function UIL(){Inherit(this,Component);const _this=this;let _style,$el,_ui={};Hydra.ready((async _=>{if(!Utils.query("editMode")&&!(Hydra.LOCAL&&window.Platform&&window.Platform.isDreamPlatform&&Utils.query("uil"))&&(!Hydra.LOCAL||Device.mobile||window._BUILT_||!Utils.query("uil")&&!Device.detect("hydra")))return function doNotLoad(){Hydra.LOCAL&&Utils.query("remoteUIL")&&(_this.sidebar=_this.global=new UILPanel("null"))}();!function init(){(function initContainer(){$el=$("UIL"),$el.css({position:"fixed",contain:"strict"}).size("100%","100%").mouseEnabled(!1),document.body.insertAdjacentElement("beforeend",$el.div),$el.setZ(1e5)})(),function initStyle(){let initial="\n            .UIL ::-webkit-scrollbar { width:2px; }\n            .UIL ::-webkit-scrollbar-track { background:#161616; }\n            .UIL ::-webkit-scrollbar-thumb { background:#37A1EF; }\n        ",style=document.head.appendChild(document.createElement("style"));style.type="text/css",style.id="uil-style",style.appendChild(document.createTextNode(initial)),_style=style}(),function initSidebar(){_this.add(new UILPanel("sidebar")),_this.add(new UILPanel("global",{side:"left"}))}(),function initGraph(){if(!_this.sidebar)return;let parent=_ui.sidebar.element.div;parent.insertBefore(UILGraph.instance().element.div,parent.firstChild)}()}(),_this.loaded=!0})),this.ready=function(){return _this.wait(_this,"loaded")},this.add=function(panel){return _ui[panel.id]=panel,_this[panel.id]=panel,$el.add(panel),_this},this.remove=function(id){let $panel=_ui[id];return $panel.eliminate&&$panel.eliminate(),$panel.destroy(),delete _ui[id],delete _this[id],_this},this.find=function(id){return Object.values(_ui).reduce(((acc,el)=>acc.concat(el.find(id))),[])},this.enableSorting=function(id,enable){let el=_this.find(id)[0];return el&&el.enableSorting&&el.enableSorting(enable),_this},this.addCSS=function(control,style){if(control.styled)return;let node=document.createTextNode(style);return _style&&_style.appendChild(node),control.styled=!0,_this},this.REORDER="uil_reorder"}),"static"),Class((function CameraUIL(){this.UPDATE="camera_uil_update",this.add=function(light,group){return new CameraUILConfig(light,null===group?null:group||UIL.global)}}),"static"),Class((function CameraUILConfig(_camera,_uil){const _this=this;if(!_camera.prefix)throw"camera.prefix required when using MeshUIL";var prefix="CAMERA_"+_camera.prefix,_group=_uil?createFolder():null,_dynamicFOVCallback=null;function createFolder(){if(!UIL.sidebar)return null;let folder=new UILFolder(prefix,{label:_camera.prefix,closed:!0});return _uil.add(folder),folder}function initFOV(key){let initValue=UILStorage.get(`${prefix}${key}`)||_camera.camera.fov||9999;if(_group){let number=new UILControlNumber(`${prefix}${key}`,{label:key,value:initValue,step:.05});number.onFinishChange((e=>{_group&&(Events.emitter._fireEvent(CameraUIL.UPDATE,{prefix:prefix,key:key,val:e,fov:!0,group:_this}),_this["tweenUIL_"+key]?.(e)),_camera.setFOV(e),UILStorage.set(`${prefix}${key}`,e)})),_group.add(number)}defer((_=>{_camera.setFOV(initValue)}))}function initVec(key){let initValue=UILStorage.get(`${prefix}${key}`)||_camera[key]?.toArray();if(initValue){if(_group){let vector=new UILControlVector(`${prefix}${key}`,{label:key,value:initValue,step:.05});vector.onChange((e=>{_group&&(Events.emitter._fireEvent(CameraUIL.UPDATE,{prefix:prefix,key:key,val:e,vec:!0,group:_this}),_this["tweenUIL_"+key]?.(e)),_camera[key].fromArray(e)})),vector.onFinishChange((e=>UILStorage.set(`${prefix}${key}`,e))),_group.add(vector),_this["forceUpdate"+key.toUpperCase()]=_=>{let val=_camera[key].toArray();_this["tweenUIL_"+key]?_this["tweenUIL_"+key](val):vector.force(_camera[key].toArray(),!0)}}_camera[key].fromArray(initValue)}}function initNumber(key){let initValue=UILStorage.get(`${prefix}${key}`)||(void 0===_camera[key]?9999:_camera[key]);if(_group){let number=new UILControlNumber(`${prefix}${key}`,{label:key,value:initValue,step:.05});number.onChange((e=>{_camera[key]=e,_group&&(Events.emitter._fireEvent(CameraUIL.UPDATE,{prefix:prefix,key:key,val:e,number:!0,group:_this}),_this["tweenUIL_"+key]?.(e))})),number.onFinishChange((e=>UILStorage.set(`${prefix}${key}`,e))),_group.add(number)}_camera[key]=initValue}function initRotation(key,applyValue){let toRadians=array=>array?(array.length=3,array.map((x=>Math.radians(x)))):[0,0,0],initValue=toRadians(UILStorage.get(`${prefix}${key}`));if(_group){let vector=new UILControlVector(`${prefix}${key}`,{label:key,value:(array=initValue,array?(array.length=3,array.map((x=>Math.degrees(x)))):[0,0,0])});vector.onChange((e=>{_group&&(Events.emitter._fireEvent(CameraUIL.UPDATE,{prefix:prefix,key:key,val:toRadians(e),rotation:!0,group:_this}),_this["tweenUIL_"+key]?.(toRadians(e))),applyValue(toRadians(e),key)})),vector.onFinishChange((e=>UILStorage.set(`${prefix}${key}`,e))),_group.add(vector)}var array;applyValue(initValue,key)}function initDynamicFOV(key){let defaultCode="",code=UILStorage.get(`${prefix}${key}Code`)||defaultCode,evalCode=value=>{let method=value.includes("return")?`(function(){ return function getFOV() { ${value}}})()`:`(function(){ return function getFOV() { return ${value}}})()`;_camera._getDynamicFOV=eval(method)},editCode=_=>{let editor=new UILExternalEditor(`${prefix}${key}`,400,900);editor.setCode(code,"c"),editor.onSave=value=>{UILStorage.set(`${prefix}${key}Code`,value),evalCode(value),code=value,_camera.dynamicFOV()}},btn=new UILControlButton("btn",{actions:[{title:"Dynamic FOV",callback:editCode}],hideLabel:!0});_group&&_group.add(btn),defer((_=>{evalCode(code),_camera.dynamicFOV=_=>{if(_camera.camera.isOrthographicCamera)return;let fov=_camera._getDynamicFOV?.()||_camera.camera.fov;if(isNaN(fov))return console.warn(prefix+" Dynamic FOV requires a float value");_camera.setFOV(fov)},_camera.onResize((_=>_camera.dynamicFOV()))}))}function initType(){let initValue=UILStorage.get(prefix+"type")||"perspective";if(_group){let control=new UILControlSelect(prefix+"type",{label:"Type",value:initValue,options:[{label:"Perspective",value:"perspective"},{label:"Orthographic",value:"orthographic"}]});control.onChange((e=>{"orthographic"===e?_camera.useOrthographic():_camera.usePerspective(),_group&&Events.emitter._fireEvent(CameraUIL.UPDATE,{prefix:prefix,key:"type",val:e,type:!0,group:_this})})),control.onFinishChange((e=>UILStorage.set(prefix+"type",e))),_group.add(control)}"orthographic"===initValue&&_camera.useOrthographic()}function addListeners(){Events.emitter._addEvent(CameraUIL.UPDATE,update,_this)}function update(e){e.prefix==prefix&&e.group!=_this&&(e.fov&&_camera.setFOV(e.val),e.number&&(_camera[e.key]=e.val),e.rotation&&_camera.group[e.key].fromArray(e.val),e.vec&&_camera[e.key].fromArray(e.val))}initType(),_camera.position&&initVec("position"),_camera.group&&(_camera.groupPos=_camera.group.position,initVec("groupPos"),initRotation("rotation",((value,key)=>{_camera.group[key].fromArray(value)}))),initFOV("fov"),initNumber("zoom"),initNumber("near"),initNumber("far"),_camera.moveXY&&(initVec("moveXY"),initVec("lookAt"),initRotation("cameraRotation",((value,key)=>{_camera[key].fromArray(value)})),initVec("viewportFocus"),initNumber("lerpSpeed"),initNumber("lerpSpeed2"),initNumber("deltaRotate"),initNumber("deltaLerp"),initNumber("wobbleSpeed"),initNumber("wobbleStrength"),initNumber("wobbleZ")),initDynamicFOV("dynamicFOV"),_group&&addListeners(),this.setLabel=function(name){_group&&_group.setLabel(name)}})),Class((function InputUIL(){this.UPDATE="inputUil_Update",this.create=function(name,group,decoupled){return new InputUILConfig(name,null===group?null:group||UIL.global,decoupled)}}),"static"),Class((function InputUILConfig(_name,_uil,_decoupled,_slim){var _cache,_this=this;const prefix="INPUT_"+_name;var _group=_uil?function createFolder(){if(!UIL.sidebar)return null;let folder=new UILFolder(_name,{closed:!0});_decoupled||(_uil.add(folder),_uil==UIL.sidebar&&folder.hide());return folder}():null,_fields=_uil?{}:null;function externalUpdate(e){e.prefix==prefix&&e.group!=_this&&(UILStorage.set(`${prefix}_${e.key}`,e.value),_this.onUpdate&&_this.onUpdate(e.key))}_this.group=_group,_uil&&function addListeners(){Events.emitter._addEvent(InputUIL.UPDATE,externalUpdate,_this)}(),this.get=function(key){if(_cache&&void 0!==_cache[key])return _cache[key];let val=UILStorage.get(`${prefix}_${key}`);return"boolean"==typeof val?val:val&&""!=val?"true"===val||"false"!==val&&(val.charAt&&"["==val.charAt(0)?JSON.parse(val):(UIL.global||(_cache||(_cache={}),_cache[key]||(_cache[key]=val)),val)):void 0},this.getFilePath=function(key){let data=this.get(key);return"{"===data?.charAt(0)?(data=JSON.parse(data),data.relative.includes(".")?data.relative:data.src):data},this.getNumber=function(key){return Number(this.get(key))},_slim||(this.add=function(key,initValue,uil=window.UILControlText,options,params={}){if(!_group||"hidden"==initValue||!UIL.sidebar)return this;let value=UILStorage.get(`${prefix}_${key}`);if("true"===value&&(value=!0),"false"===value&&(value=!1),uil==UILControlVector&&"string"==typeof value&&(value=JSON.parse(value)),void 0===value&&(value=initValue),"string"==typeof value&&(uil==UILControlImage||uil==UILControlFile))try{value=JSON.parse(value)}catch(e){}let change=(val,fromInit)=>{val="string"==typeof val?val:JSON.stringify(val),UILStorage.set(`${prefix}_${key}`,val),_this.onUpdate&&_this.onUpdate(key,val),fromInit||Events.emitter._fireEvent(InputUIL.UPDATE,{prefix:prefix,key:key,value:val,group:_this})};"string"!=typeof initValue&&"number"!=typeof initValue&&uil!=UILControlVector||UILStorage.get(`${prefix}_${key}`)||change(initValue,!0);let opts=Utils.mergeObject(params,{label:key,value:value,options:options});uil==window.UILControlButton&&(opts=options);let config=new uil(`${prefix}_${key}`,opts);return config.onFinishChange(change),uil!=UILControlVector&&uil!=UILControlRange||config.onChange(change),_group.add(config),_fields[key]=config,this},this.addToggle=function(key,initValue){return UIL.sidebar?this.add(key,initValue,UILControlCheckbox):this},this.addSelect=function(key,options){return UIL.sidebar?this.add(key,null,UILControlSelect,options):this},this.addImage=function(key,options){return UIL.sidebar?this.add(key,null,UILControlImage,null,options):this},this.addFile=function(key,options){if(!UIL.sidebar)return this;let existing=this.get(key);return existing?.length>3&&!existing.includes("{")?this.add(key):this.add(key,null,UILControlFile,null,options)},this.addRange=function(key,initValue,options){return UIL.sidebar?this.add(key,initValue,UILControlRange,null,options):this},this.addNumber=function(key,initValue,step){return UIL.sidebar?this.add(key,initValue,UILControlNumber,null,{step:step}):this},this.addColor=function(key,initValue=new Color){return UIL.sidebar?this.add(key,initValue.getHexString(),UILControlColor):this},this.addTextarea=function(key,initValue){return UIL.sidebar?this.add(key,initValue,UILControlTextarea,null,{monospace:!0,rows:4}):this},this.addButton=function(key,options){return UIL.sidebar?this.add(key,null,UILControlButton,options):this},this.addVector=function(key,initValue,options){return UIL.sidebar?(options||(options={step:.05}),this.add(key,initValue,UILControlVector,null,options)):this},this.getImage=function(key){let data=this.get(key);if(data)return JSON.parse(data).src},this.setValue=function(key,value){if(UILStorage.set(`${prefix}_${key}`,value),_this.onUpdate&&_this.onUpdate(key),_fields){let field=_fields[key];field&&(field.value=value,field.update&&field.update())}return this},this.copyFrom=function(input,fields){fields.forEach((key=>{let val=input.get(key);void 0!==val&&("string"!=typeof val&&(val=JSON.stringify(val)),_this.setValue(key,val))}))},this.setLabel=function(name){_group&&_group.setLabel(name)},this.getField=function(key){if(_fields)return _fields[key]},this.setDescription=function(key,desc){_this.getField(key)?.setDescription(desc)})})),Class((function ListUIL(){Inherit(this,Component);const _this=this;var _panel,_created={};function removePanel(){_panel&&_panel.destroy&&(_this.events.unsub(_panel,Events.COMPLETE,removePanel),_panel=_panel.destroy())}this.create=function(id,version=1,group){"number"!=typeof version&&(group=version,version=1),group=null===group?null:group||UIL.global;let config=new ListUILConfig(id,version,UIL.global&&!_created[id]);return UIL.global&&(_created[id]||(_created[id]=config,null!=group&&config.appendUILGroup(group||UIL.global))),config},this.openPanel=function(id,name,template){return removePanel(),_panel=new ListUILEditor(id,name,template),_this.events.sub(_panel,Events.COMPLETE,removePanel),_panel},this.set=function(){},this.get=function(){},this.getPanel=function(){return _panel}}),"static"),Class((function ListUILConfig(_id,_version=1,_store){Inherit(this,Component);const _this=this;var _items,_folder,_config,_template={onSort:_=>{},onAdd:_=>{},onRemove:_=>{}},_name="";function name(){return`LIST_${_id}_config`}function updateConfig(){_config.version=_version,UILStorage.setWrite(name(),_config)}function edit(){let panel=ListUIL.openPanel(_id,_name,_this.template);_this.events.bubble(panel,Events.UPDATE),_this.events.fire(ListUIL.OPEN)}_store&&(_items=[]),function initConfig(){(_config=UILStorage.get(name()))?_config.version!=_version&&(updateConfig(),UILStorage.clearMatch(name().split("_config")[0])):(_config={},updateConfig())}(),this.add=function(item){return _items&&_items.push(item),item},this.template=function(config){return"function"==typeof config&&(_template=config),_template},this.appendUILGroup=function(uil){let folder=new UILFolder("LIST_"+_id,{closed:!0}),button=new UILControlButton("button",{actions:[{title:"Edit List",callback:edit}],hideLabel:!0});folder.add(button),uil.add(folder),_folder=folder},this.setLabel=function(name){_folder&&_folder.setLabel(name),_name=name},this.onAdd=function(cb){_template.onAdd=cb},this.onRemove=function(cb){_template.onRemove=cb},this.onSort=function(cb){_template.onSort=cb},this.internalAddItems=function(count){if(!count)return;let array=[];for(let i=0;i<count;i++){let id=`${_id}_${Utils.timestamp()}`;array.push(id)}UILStorage.set(_id+"_list_items",JSON.stringify(array))}}),(_=>{ListUIL.OPEN="list_uil_open"})),Class((function ListUILEditor(_id,_name,_template){Inherit(this,Component);const _this=this,PANEL_CONFIG={label:_name||"List",width:"400px",height:"auto",drag:!0};var _gui,_list,_add,_items,_tabs=[],_index=0;function initList(){!function read(){let data=UILStorage.get(_id+"_list_items");void 0===data&&(data="[]");_items=JSON.parse(data)}(),(_list=new UILFolder(_id+"_list",{hideTitle:!0})).enableSorting(_id),_gui.add(_list);for(let id of _items){let view=new ListUILItem(id,_list,_template,_index++);_this.events.sub(view,Events.UPDATE,reorder),_this.events.sub(view,Events.END,remove),_tabs.push(view)}}function initAdd(){!function initButton(title,callback){_add=new UILControlButton("button",{actions:[{title:title,callback:callback}],hideLabel:!0}),_gui.add(_add)}("Add Item",add)}function add(){let id=`${_id}_${Utils.timestamp()}`,view=new ListUILItem(id,_list,_template,_index++);_this.events.sub(view,Events.UPDATE,reorder),_this.events.sub(view,Events.END,remove),_tabs.push(view),_items.push(id),write()}function reorder(e){let order=[];for(let item of e.order)order.push(item.split("_folder")[0]);_items=order,_template().onSort(_items),write(),_this.events.fire(Events.UPDATE,{order:order})}function close(){_this.events.fire(Events.COMPLETE)}function remove(e){_items.remove(e.id),write(),refresh()}function write(){let data=JSON.stringify(_items);UILStorage.set(_id+"_list_items",data)}function refresh(){_index=0,_list&&_list.destroy&&(_list=_list.destroy()),_add&&_add.destroy&&(_add=_add.destroy()),initList(),initAdd()}!function initPanel(){_this.gui=_gui=new UILWindow(_id,PANEL_CONFIG),_this.gui.onClose=close,UIL.add(_gui)}(),refresh(),this.onDestroy=function(){_gui.destroy()},this.add=function(){add()}})),Class((function ListUILItem(_id,_parent,_template,_index){Inherit(this,Component);const _this=this;var _folder;function onDelete(){if(!confirm("You sure you want to delete this?"))return;let id=_id;_template().onRemove(id),_this.events.fire(Events.END,{id:id})}function onReorder(e){_this.events.fire(Events.UPDATE,e)}!async function initFolder(){(_folder=InputUIL.create(_id+"_folder",_parent)).setLabel("Item"),_folder.group.draggable(!0),_this.events.sub(_folder.group,UIL.REORDER,onReorder),_folder.listUILItem=_this}(),function initTemplate(){let id=_id;(0,_template().onAdd)(id,_folder,_index)}(),function initUI(){let actions=[{title:"Delete",callback:onDelete}],hideLabel=!0;_folder.addButton("delete",{actions:actions,hideLabel:hideLabel})}(),this.setLabel=function(label){_folder.setLabel(label)},this.forceSort=function(index){_folder.group.forceSort(index)},this.open=function(){_folder.group.open(),_folder.group.openChildren()},this.close=function(){_folder.group.close()}})),Class((function MeshUIL(){Inherit(this,Component);this.exists={},this.UPDATE="mesh_uil_update",this.add=function(mesh,group){return new MeshUILConfig(mesh,null===group?null:group||UIL.global)}}),"static"),Class((function MeshUILConfig(_mesh,_uil){const _this=this;if(!_mesh.prefix)throw"mesh.prefix required when using MeshUIL";var prefix="MESH_"+_mesh.prefix,_group=_uil&&!MeshUIL.exists[prefix]?function createFolder(){if(!UIL.sidebar)return null;let folder=new UILFolder(prefix,{label:_mesh.prefix,closed:!0});return _uil.add(folder),folder}():null,_controls=_group?{}:null;function initVec(key){let initValue=UILStorage.get(`${prefix}${key}`)||_mesh[key].toArray();if(_group){let vector=new UILControlVector(`${prefix}${key}`,{label:key,value:initValue,step:.05});vector.onChange((e=>{_mesh[key].fromArray(e),_group&&(Events.emitter._fireEvent(MeshUIL.UPDATE,{prefix:prefix,key:key,val:e,group:_this}),_this["tweenUIL_"+key]?.(e))})),vector.onFinishChange(save),_group.add(vector),_this["forceUpdate"+key.toUpperCase()]=_=>{let val=_mesh[key].toArray();_this["tweenUIL_"+key]?_this["tweenUIL_"+key](val):vector.force(_mesh[key].toArray(),!0)},_controls[key]=vector}_mesh[key].fromArray(initValue)}function save(){for(let key in _controls){let value=_controls[key].value;UILStorage.set(`${prefix}${key}`,value)}}function update(e){e.prefix==prefix&&e.group!=_this&&_mesh[e.key].fromArray(e.val)}this.group=_group,MeshUIL.exists[prefix]=!0,initVec("position"),initVec("scale"),function initRotation(){let key="rotation",toRadians=array=>array?(array.length=3,array.map((x=>Math.radians(x)))):[0,0,0],toDegrees=array=>array?(array.length=3,array.map((x=>Math.degrees(x)))):[0,0,0],initValue=toRadians(UILStorage.get(`${prefix}${key}`));if(_group){let vector=new UILControlVector(`${prefix}${key}`,{label:key,value:toDegrees(initValue)});vector.onChange((e=>{_mesh[key].fromArray(toRadians(e)),_group&&(Events.emitter._fireEvent(MeshUIL.UPDATE,{prefix:prefix,key:key,val:toRadians(e),group:_this}),_this["tweenUIL_"+key]?.(e))})),vector.onFinishChange(save),_group.add(vector),_controls[key]=vector}_mesh[key].fromArray(initValue);let rotationEuler=(new Euler).fromArray(initValue);_mesh.customRotation=(new Quaternion).setFromEuler(rotationEuler)}(),_group&&function addListeners(){Events.emitter._addEvent(MeshUIL.UPDATE,update,_this)}(),this.setLabel=function(name){_group&&_group.setLabel(name)}})),Class((function ShaderUIL(){this.exists={},this.UPDATE="shader_update",this.TEXTURE_UPDATE="shader_texture_update",this.SHADER_UPDATE="shader_shader_update",this.add=function(shader,group){return new ShaderUILConfig(shader.shader||shader,null===group?null:group||UIL.global)},this.createOverride=function(prefix,obj,group,shaderOnly){let uniforms={};Array.isArray(obj)?obj.forEach((o=>{o=o.uniforms||o;for(let key in o)o[key].ignoreUIL||(uniforms[key]=o[key])})):uniforms=obj.uniforms||obj;let shader=Utils3D.getTestShader();shader.vertexShader=shader.fragmentShader="";for(let key in uniforms)shader.uniforms[key]=uniforms[key];return shader.UILPrefix=prefix,null===shaderOnly?shader:this.add(shader,group)},this.createDecorator=function(shader,prefix,obj,group){let uniforms={};for(let key in obj)uniforms[key]=shader.uniforms[key];let nShader=Utils3D.getTestShader();return nShader.vertexShader=shader.fragmentShader="",nShader.uniforms=uniforms,nShader.UILPrefix=prefix,this.add(nShader,group)},this.createClone=function(prefix,obj){let uniforms=obj.uniforms||obj,shader=Utils3D.getTestShader();for(let key in uniforms){let value=uniforms[key].value,ignoreUIL=uniforms[key].ignoreUIL||null===value;!ignoreUIL&&value.clone&&(value=value.clone()),shader.uniforms[key]={value:value,ignoreUIL:ignoreUIL}}return shader.UILPrefix=prefix,shader},this.lerpShader=function(from,to,alpha,hz,uniformsFilter){from=from.uniforms||from,to=to.uniforms||to;for(let key in from){let f=from[key],t=to[key];f&&t&&(uniformsFilter&&-1===uniformsFilter.indexOf(key)||("number"==typeof t.value?f.value=Math.lerp(t.value,f.value,alpha,hz):"c"===f.type?(f.value.r=Math.lerp(t.value.r,f.value.r,alpha,hz),f.value.g=Math.lerp(t.value.g,f.value.g,alpha,hz),f.value.b=Math.lerp(t.value.b,f.value.b,alpha,hz)):"v3"===f.type&&(f.value.x=Math.lerp(t.value.x,f.value.x,alpha,hz),f.value.y=Math.lerp(t.value.y,f.value.y,alpha,hz),f.value.z=Math.lerp(t.value.z,f.value.z,alpha,hz))))}}}),"static"),Class((function ShaderUILConfig(_shader,_uil){var _textures,_this=this;const prefix=_shader.UILPrefix;var _group=_uil&&!ShaderUIL.exists[prefix]?function createFolder(){if(!UIL.sidebar)return null;let label=function getName(){let split=_shader.UILPrefix.split("/");return split.length>2?split[0]+"_"+split[2]:split[0]}();"_"==label.charAt(label.length-1)&&(label=label.slice(0,-1));let folder=new UILFolder(prefix+label,{label:label,closed:!0});return _uil.add(folder),folder}():null;function createVector(obj,key){let initValue=UILStorage.get(`${prefix}${key}`)||obj.value.toArray();if(_group){let vector=new UILControlVector(`${prefix}${key}`,{label:key,value:initValue,step:.05,description:obj.description});vector.onChange((val=>{obj.value.fromArray(val),_shader.ubo&&(_shader.ubo.needsUpdate=!0),Events.emitter._fireEvent(ShaderUIL.UPDATE,{prefix:prefix,key:key,val:val,group:_this,vector:!0})})),vector.onFinishChange((e=>UILStorage.set(`${prefix}${key}`,e))),_group.add(vector)}obj.value.fromArray(initValue)}function createTexture(obj,key){_group&&!_textures&&(_textures={});const getTexture=obj.getTexture||ShaderUIL.getTexture||Utils3D.getTexture,set=_shader.parent&&_shader.parent.setOverride?_shader.parent.setOverride:_shader.set||_shader.setUniform,get=_shader.get||_shader.getUniform;let prefix=_shader.UILPrefix+"_tx",data=UILStorage.get(`${prefix}_${key}`);data&&(data=JSON.parse(data));let value=data?data.src:null,change=data=>{let val=data.src,cleanPath=val.includes("?")&&!data.hotreload?val.split("?")[0]:val;data.compressed&&(val+="-compressedKtx"),_textures&&(_textures[cleanPath]=change),data.src=cleanPath,UILStorage.set(`${prefix}_${key}`,JSON.stringify(data)),set(key,getTexture(val,{premultiplyAlpha:obj.premultiplyAlpha,scale:obj.scale}),_shader),_group&&Events.emitter._fireEvent(ShaderUIL.UPDATE,{prefix:_shader.UILPrefix,key:key,val:val,texture:get(key,_shader),group:_this})};if(value&&value.length&&change(data),_group){let img=new UILControlImage(prefix+key,{label:key,value:data,description:obj.description});img.onFinishChange(change),_group.add(img)}}function createNumber(obj,key){let initValue=UILStorage.get(`${prefix}${key}`);if(void 0===initValue&&(initValue=obj.value),_group){let number=new UILControlNumber(`${prefix}${key}`,{label:key,value:initValue,step:.05,description:obj.description});number.onChange((val=>{_shader.ubo&&(_shader.ubo.needsUpdate=!0),Events.emitter._fireEvent(ShaderUIL.UPDATE,{prefix:prefix,key:key,val:val,group:_this}),obj.value=val})),number.onFinishChange((e=>UILStorage.set(`${prefix}${key}`,e))),_group.add(number)}obj.value=initValue}function createColor(obj,key){let initValue=UILStorage.get(`${prefix}${key}`)||obj.value.getHexString();if(_group){let color=new UILControlColor(`${prefix}${key}`,{label:key,value:initValue,description:obj.description});color.onChange((val=>{obj.value.set(val),_shader.ubo&&(_shader.ubo.needsUpdate=!0),_group&&Events.emitter._fireEvent(ShaderUIL.UPDATE,{prefix:prefix,key:key,val:val,color:!0,group:_this})})),color.onFinishChange((e=>UILStorage.set(`${prefix}${key}`,e))),_group.add(color)}initValue&&obj.value.set(initValue)}function createSelect(obj,key){let initValue=UILStorage.get(`${prefix}${key}`);if(_group){let{options:options,description:description}=obj,select=new UILControlSelect(`${prefix}${key}`,{label:key,value:initValue,options:options,description:description});select.onChange((val=>{_group&&Events.emitter._fireEvent(ShaderUIL.UPDATE,{prefix:prefix,key:key,val:val,group:_this}),obj.value=val,UILStorage.set(`${prefix}${key}`,val)})),_group.add(select)}initValue&&(obj.value=initValue)}function textureUpdate(e){if(!_textures)return;let cleanPath=e.file.split("?")[0];for(let key in _textures){cleanPath==(key.includes("?")?key.split("?")[0]:key)&&_textures[key]({src:e.file,hotreload:!0})}}function update(e){if(e.prefix==_shader.UILPrefix&&e.group!=_this)if(e.color){let val=e.val,obj=_shader.uniforms[e.key];Array.isArray(val)?obj.value.setRGB(val[0],val[1],val[2]):obj.value.set(val)}else e.texture?"remote"!=e.texture&&_shader.set(e.key,e.texture):e.vector?_shader.uniforms[e.key].value.fromArray(e.val):_shader.uniforms[e.key].value=e.val}this.group=_group,this.shader=_shader,ShaderUIL.exists[_shader.UILPrefix]=!0,function initItems(){for(var key in _shader.uniforms){let obj=_shader.uniforms[key];obj&&!obj.ignoreUIL&&(obj.options&&Array.isArray(obj.options)?createSelect(obj,key):("number"==typeof obj.value&&createNumber(obj,key),obj.value instanceof Color&&createColor(obj,key),(null===obj.value||obj.value instanceof Texture)&&createTexture(obj,key),obj.value instanceof Vector2&&createVector(obj,key),obj.value instanceof Vector3&&createVector(obj,key),obj.value instanceof Vector4&&createVector(obj,key)))}}(),_group&&function addListeners(){Events.emitter._addEvent(ShaderUIL.UPDATE,update,_this),Events.emitter._addEvent(ShaderUIL.TEXTURE_UPDATE,textureUpdate,_this)}(),this.setLabel=function(name){_group&&_group.setLabel(name)}})),Class((function ShadowUIL(){this.add=function(light,group){return new ShadowUILConfig(light,null===group?null:group||UIL.global)}}),"static"),Class((function ShadowUILConfig(_light,_uil){if(!_light.prefix)throw"light.prefix required when using MeshUIL";var prefix="SHADOW_"+_light.prefix,_group=_uil?function createFolder(){if(!UIL.sidebar)return null;let folder=new UILFolder(prefix,{label:_light.prefix,closed:!0});return _uil.add(folder),folder}():null;function initNumber(key){let initValue=UILStorage.get(`${prefix}${key}`)||_light.shadow[key];if(_group){let number=new UILControlNumber(`${prefix}${key}`,{label:key,value:initValue,step:.05});number.onFinishChange((e=>{_light.shadow[key]=e,UILStorage.set(`${prefix}${key}`,e)})),_group.add(number)}_light.shadow[key]=initValue}function initVec(key){let initValue=UILStorage.get(`${prefix}${key}`)||_light[key].toArray();if(_group){let vector=new UILControlVector(`${prefix}${key}`,{label:key,value:initValue,step:.05});vector.onChange((e=>{_light[key].fromArray(e),"target"==key&&_light.shadow.camera.lookAt(_light.target)})),vector.onFinishChange((e=>UILStorage.set(`${prefix}${key}`,e))),_group.add(vector)}_light[key].fromArray(initValue)}_light.target=_light.shadow.target,initVec("position"),initVec("target"),initNumber("fov"),initNumber("size"),initNumber("area"),initNumber("near"),initNumber("far"),function initTick(key){let initValue=UILStorage.get(`${prefix}${key}`);if(_group){let tick=new UILControlCheckbox(`${prefix}${key}`,{label:key,value:initValue});tick.onFinishChange((e=>{_light[key]=e,UILStorage.set(`${prefix}${key}`,e)})),_group.add(tick)}_light[key]=initValue}("static"),this.setLabel=function(name){_group&&_group.setLabel(name)}})),Class((function TimelineUIL(){Inherit(this,Component);const _this=this;var _panel,_created={};function removePanel(){_panel&&_panel.destroy&&(_this.events.unsub(_panel,Events.COMPLETE,removePanel),_panel=_panel.destroy())}this.create=function(id,version=1,group){"number"!=typeof version&&(group=version,version=1),group=null===group?null:group||UIL.global;let config=new TimelineUILConfig(id,version,UIL.global&&!_created[id]);return UIL.global&&(_created[id]||(_created[id]=config,null!=group&&config.appendUILGroup(group||UIL.global))),config},this.openPanel=function(id,name,template){return removePanel(),_panel=new TimelineUILEditor(id,name,template),_this.events.sub(_panel,Events.COMPLETE,removePanel),_panel},this.set=function(){},this.get=function(){}}),"static"),Class((function TimelineUILConfig(_id,_version=1,_store){Inherit(this,Component);const _this=this;var _items,_folder,_config,_template={onSort:_=>{},onAdd:_=>{},onRemove:_=>{}},_name="";function name(){return`TL_${_id}_config`}function updateConfig(){_config.version=_version,UILStorage.setWrite(name(),_config)}function edit(){let panel=TimelineUIL.openPanel(name(),_name,_this.template);_this.events.bubble(panel,Events.UPDATE),_this.events.fire(TimelineUIL.OPEN)}this.model=new TimelineUILModel(name()),_store&&(_items=[]),function initConfig(){(_config=UILStorage.get(name()))?_config.version!=_version&&(updateConfig(),UILStorage.clearMatch(name().split("_config")[0])):(_config={},updateConfig())}(),this.add=function(item){return _items&&_items.push(item),item},this.template=function(config){return"function"==typeof config&&(_template=config),_template},this.appendUILGroup=function(uil){let folder=new UILFolder("TL_"+_id,{closed:!0}),button=new UILControlButton("button",{actions:[{title:"Edit Timeline",callback:edit}],hideLabel:!0});folder.add(button),uil.add(folder),_folder=folder},this.setLabel=function(name){_folder&&_folder.setLabel(name),_name=name},this.onAdd=function(cb){_template.onAdd=cb},this.onRemove=function(cb){_template.onRemove=cb},this.onSort=function(cb){_template.onSort=cb},this.internalAddItems=function(count){if(!count)return;let array=[];for(let i=0;i<count;i++){let id=`${_id}_${Utils.timestamp()}`;array.push(id)}UILStorage.set(_id+"_list_items",JSON.stringify(array))}}),(_=>{TimelineUIL.OPEN="list_uil_open"})),Class((function TimelineUILEditor(_id,_name,_template){Inherit(this,Component);const _this=this,PANEL_CONFIG={label:"Timeline Editor",width:"800px",height:"auto",drag:!0};var _gui,_list,_add,_config,_items,_tabs=[],_index=0;function initList(){!function read(){let data=UILStorage.get(_id+"_list_items");void 0===data&&(data="[]");_items=JSON.parse(data)}(),_list=new UILFolder(_id+"_list",{hideTitle:!0}),_gui.add(_list);for(let id of _items){let view=_this.initClass(TimelineUILItem,id,_list,_template,_index++);_this.events.sub(view,Events.UPDATE,reorder),_this.events.sub(view,Events.END,remove),_tabs.push(view)}_config.rails&&function attachRails(){_tabs.forEach(((t,i)=>{t.onUpdate=v=>{_tabs.forEach(((t2,j)=>{t2!=t&&(j<i&&t.getValue()<t2.getValue()&&t2.setValue(t.getValue()),j>i&&t.getValue()>t2.getValue()&&t2.setValue(t.getValue()))}))}}))}()}function initButton(title,callback){let btn=new UILControlButton("button",{actions:[{title:title,callback:callback}],hideLabel:!0});return _gui.add(btn),btn}function spaceEvenly(){_tabs.forEach(((t,i)=>{let perc=Math.range(i,0,_tabs.length-1,0,1);t.setValue(perc)}))}function add(){let id=`${_id}_${Utils.timestamp()}`,view=new TimelineUILItem(id,_list,_template,_index++);_this.events.sub(view,Events.UPDATE,reorder),_this.events.sub(view,Events.END,remove),_tabs.push(view),_items.push(id),write()}function reorder(e){let order=[];for(let item of e.order)order.push(item.split("_folder")[0]);_items=order,_template().onSort(_items),write(),_this.events.fire(Events.UPDATE,{order:order})}function remove(e){_items.remove(e.id),write(),refresh()}function write(){let data=JSON.stringify(_items);UILStorage.set(_id+"_list_items",data)}function refresh(){_index=0,_list&&_list.destroy&&(_list=_list.destroy()),_add&&_add.destroy&&(_add=_add.destroy()),initList(),function initAdd(){_config.lock||(_add=initButton("Add Item",add)).element.css({width:"20%"}),initButton("Space Evenly",spaceEvenly).element.css({width:"20%"})}()}_this.config=_config=JSON.parse(UILStorage.get(_id+"_config")||"{}"),function initPanel(){_this.gui=_gui=new UILWindow(_id,PANEL_CONFIG),UIL.add(_gui)}(),refresh(),this.onDestroy=function(){_gui.destroy()}})),Class((function TimelineUILItem(_id,_parent,_template,_index){Inherit(this,Component);const _this=this;var _folder;function onDelete(){if(!confirm("You sure you want to delete this?"))return;let id=_id;_template().onRemove(id),_this.events.fire(Events.END,{id:id})}function onReorder(e){_this.events.fire(Events.UPDATE,e)}!async function initFolder(){(_folder=InputUIL.create(_id+"_folder",_parent)).setLabel("Item"),_this.parent&&_this.parent.config.lock||_folder.group.draggable(!0),_this.events.sub(_folder.group,UIL.REORDER,onReorder),_folder.group.open()}(),function initTemplate(){let id=_id;(0,_template().onAdd)(id,_folder,_index)}(),function initUI(){_folder.add("label",_this.parent&&_this.parent.config.lock?"hidden":void 0),_folder.addRange("keyframe"),_folder.add("percent","hidden"),_folder.getField("keyframe").force(Math.round(100*_folder.getNumber("percent"))||0),_folder.onUpdate=key=>{if("keyframe"==key){let val=_folder.getNumber(key)/100;_folder.setValue("percent",val),_this.onUpdate&&_this.onUpdate(val)}};let label=_folder.get("label");if(label&&_folder.setLabel(label),!_this.parent||!_this.parent.config.lock){let actions=[{title:"Delete",callback:onDelete}],hideLabel=!0,btn=(_folder.addButton("delete",{actions:actions,hideLabel:hideLabel}),_folder.getField("delete"));btn&&btn.$content.css({width:"20%"})}}(),this.setLabel=function(label){_folder.setLabel(label)},this.getValue=function(value){return _folder.getNumber("percent")},this.setValue=function(value){_folder.setValue("percent",value),_folder.getField("keyframe").force(Math.round(100*value)||0)}})),Class((function TimelineUILModel(_id){var _items,_config,_data=[],_map={};!function initItems(){_config=JSON.parse(UILStorage.get(_id+"_config")||"{}"),_items=JSON.parse(UILStorage.get(_id+"_list_items")||"[]")}(),function initData(){_items.forEach(((item,i)=>{let input=InputUIL.create(item+"_folder",null,null,!!UIL.global),data={};data.label=input.get("label")||"Item",data.value=input.getNumber("percent")||0,data.arbitrary=input.get("arbitrary"),_data.push(data),_map[data.label]=data,UIL.global&&Render.start((_=>{data.label=input.get("label")||"Item",data.value=input.getNumber("percent")||0}),10)}))}(),this.setState=function(array){for(let i=0;i<array.length;i++)_items[i]||_items.push(`${_id}_${Utils.timestamp()}`);_items.length>array.length&&(_items=_items.slice(0,array.length)),_items.forEach(((item,i)=>{let data=array[i],input=InputUIL.create(item+"_folder",null);input.setValue("label",data.label),data.percent&&input.setValue("percent",data.percent),data.arbitrary&&input.setValue("percent",data.arbitrary)})),UILStorage.set(_id+"_list_items",JSON.stringify(_items))},this.lock=function(){return _config.lock||(_config.lock=!0,UIL.global&&UILStorage.set(_id+"_config",JSON.stringify(_config))),this},this.rails=function(){return _config.rails||(_config.rails=!0,UIL.global&&UILStorage.set(_id+"_config",JSON.stringify(_config))),this},this.getData=function(){return _data},this.get=function(key){return _map[key]}})),Class((function CameraLookAtHelper(){Inherit(this,Component);const _this=this;let _camera,_object,_defaultLookAt,_tweener={alpha:0},_lookAt=new Vector3;function update(){_lookAt.copy(_defaultLookAt),_tweener.alpha>0&&_lookAt.lerp(_object.position,_tweener.alpha,!1)}_this.get("tweener",(()=>_tweener)),_this.create=async function(camera,object,tween){_camera=camera,_object=object,_defaultLookAt=_camera.lookAt,await tween.loaded(),_camera.lookAt=_lookAt,_this.events.sub(tween,TweenUIL.UPDATED,update)}})),Class((function TweenUIL(){var _folders={},_activeFolder="Tweens",_cache={};this.TOGGLE="tweenuil_toggle",Theatre.core.disableDefaultTicker(),this.create=function(name,config,group){"boolean"==typeof group&&(group=void 0);let noCache=!1;"nocache"==group&&(noCache=!0,group=void 0);let folderName=_activeFolder;return"string"==typeof group&&(folderName=group,group=null),_folders[folderName]||function initFolder(){if(UIL.global){let folder=new UILFolder(_activeFolder,{label:_activeFolder,closed:!0});_folders[_activeFolder]=folder,UIL.global.add(folder)}}(),_cache[name]&&!noCache||(_cache[name]=new TweenUILConfig(name,config,group||_folders[folderName])),_cache[name]},this.setFolder=function(name){_activeFolder=name}}),"static"),Class((function TweenUILAnchor(){Inherit(this,Object3D);this.isTweenAnchor=!0})),Class((function TweenUILConfig(_name,_config,_group){Inherit(this,Component);const _this=this;var _input,_editor,_promise,_project,_meshes,_keyframes,_pathVisualization,_objectsWithTracks,_savedState,_ticker,_layersWithWarnings={},_flatMap={},_sheets={},_duration=0,_manualRender=!1,_changedKeys={},_cameras=[];function loop(){_this.events.fire(TweenUIL.BEFORE_UPDATE),Object.keys(_flatMap).forEach((key=>_changedKeys[key]=!1)),_ticker.tick(Render.TIME),_this.events.fire(TweenUIL.UPDATED,{changed:_changedKeys}),_cameras.forEach((camera=>camera.update()))}function initObjectsWithTracks(state){_objectsWithTracks||(_objectsWithTracks={}),[state.staticOverrides?.byObject,state.sequence?.tracksByObject].filter(Boolean).forEach((table=>{Object.keys(table).forEach((key=>{let parts=key.split("  "),name=parts.length>1?parts.last():key,matches=/(.*)_(shader|behavior)$/.exec(name);matches&&(name=matches[1]),_objectsWithTracks[name]=!0}))}))}function ignoreObject(name,layoutName){return!!_objectsWithTracks&&!_objectsWithTracks[name]}function findTrueDuration(sequence){let duration=0,tracks=sequence.tracksByObject;for(let k1 in tracks){let obj=tracks[k1];"tween_anchor"==k1&&findAnchorKeyframes(obj);for(let k2 in obj.trackData){let trackData=obj.trackData[k2];for(let k3 in trackData.keyframes){let keyframe=trackData.keyframes[k3];keyframe.position&&(duration=Math.max(duration,keyframe.position))}}}return duration}function checkDuration(){if(0===_duration)for(let key in _sheets)_duration=Math.max(_duration,_sheets[key].length)}function findAnchorKeyframes(obj){for(let k1 in obj)for(let k2 in obj[k1]){let keyframes=obj[k1][k2].keyframes;keyframes&&(_keyframes=keyframes)}}async function play(options){_config.sheets||(await prepareConfig(),linkLocally()),checkDuration();for(let key in _sheets)_sheets[key].sequence.position="reverse"===options?.direction?_duration:0,_sheets[key].sequence.play(options);return _promise=_this.wait(1e3*_duration)}function linkLocally(){makeSendable().sheets.forEach((obj=>{let layoutName=Object.keys(obj)[0]?.split("&")[0];const sheet=_sheets[layoutName];if(sheet)for(let key in obj){for(let key2 in obj[key]){let finalObj=obj[key][key2];"number"==typeof finalObj.r&&"number"==typeof finalObj.g&&"number"==typeof finalObj.b&&Object.assign(finalObj,Theatre.core.types.rgba(finalObj))}sheet.object(getTrackNameFromKey(key),obj[key]).onValuesChange((newValue=>{_changedKeys[key]=!0,completeDataLink(newValue,_flatMap[key])}))}}))}function getTrackNameFromKey(key,disambiguate=!1){let name=key.split("&"),prefix=name[0];return name.shift(),name=name.join("_"),disambiguate&&(name=`${prefix}  ${name}`),name}async function prepareConfig(){let array=Array.isArray(_config)?_config:[_config];(_config={}).nudgeMultiplier=.05;let sheet={};_config.sheets=[sheet];for(let i=0;i<array.length;i++){let layoutName,objects=array[i],options={};if(objects instanceof SceneLayout)layoutName=objects.name,options.isSceneLayout=!0,objects=await getObjectsFromLayout(objects);else{if("object"!=typeof objects)throw"TweenUIL :: Type not supported";if(0===i){let obj0=objects[Object.keys(objects)[0]];obj0 instanceof Mesh?layoutName="Scene":obj0.uniforms?layoutName="Shader":isElement(obj0)&&(layoutName="Elements")}}layoutName||(layoutName="Scene"+(i+1)),mergeSheets(sheet,createSheetFromObjects(objects,layoutName,options))}_this.flag("isLoaded",!0)}function mergeSheets(sheet1,sheet2){let usedNames={};return Object.keys(sheet1).forEach((key=>{usedNames[getTrackNameFromKey(key)]=!0})),Object.keys(sheet2).forEach((key=>{let name=getTrackNameFromKey(key),newKey=key;usedNames[name]&&(name=getTrackNameFromKey(key,!0),newKey=`${key.split("&")[0]}&${name}`,_flatMap[newKey]=_flatMap[key],delete _flatMap[key]),usedNames[name]=!0,sheet1[newKey]=sheet2[key]})),sheet1}function makeEulerLink(layer,key){return{copy:obj=>{layer[key].set(Math.radians(obj.x),Math.radians(obj.y),Math.radians(obj.z))},get x(){return Math.degrees(layer[key].x)},get y(){return Math.degrees(layer[key].y)},get z(){return Math.degrees(layer[key].z)}}}function getMeshObject(layer,parent,layerName){if(parent?.isTweenAnchor){let obj={};return obj.anchor={anchor:0,link:{copy(){}}},obj}layer.rotationLink=makeEulerLink(layer,"rotation");let obj={position:{x:layer.position.x,y:layer.position.y,z:layer.position.z,link:layer.position},scale:{x:layer.scale.x,y:layer.scale.y,z:layer.scale.z,link:layer.scale},rotation:{x:Math.degrees(layer.rotation.x),y:Math.degrees(layer.rotation.y),z:Math.degrees(layer.rotation.z),link:layer.rotationLink}};if(layer._cameraUIL){obj.cameraPos={x:parent.position.x,y:parent.position.y,z:parent.position.z,link:{copy(from){parent.move(from)}}},obj.zoom={zoom:parent.zoom,link:{copy(from){parent.zoom=from.zoom}}},obj.lookAt={x:parent.lookAt.x,y:parent.lookAt.y,z:parent.lookAt.z,link:parent.lookAt},obj.cameraRotation={x:Math.degrees(parent.cameraRotation.x),y:Math.degrees(parent.cameraRotation.y),z:Math.degrees(parent.cameraRotation.z),link:makeEulerLink(parent,"cameraRotation")},obj.viewportFocus={x:parent.viewportFocus.x,y:parent.viewportFocus.y,link:parent.viewportFocus};let camera=layer.classRef;camera.manualRender=!0,_cameras.push(camera)}return UIL.global&&(_meshes||(_meshes=[]),layer._uilLayerName=layerName,_meshes.push(layer)),parent?.tweenToggle&&(obj.toggle={on:0,link:{copy:e=>{0==e.on&&parent.flag("tweenToggle")?(parent.flag("tweenToggle",!1),parent.events.fire(TweenUIL.TOGGLE,{on:!1})):1!=e.on||parent.flag("tweenToggle")||(parent.events.fire(TweenUIL.TOGGLE,{on:!0}),parent.flag("tweenToggle",!0))}}}),obj}function getShaderObject(shader){let obj={};for(let key in shader.uniforms){let uniform=shader.uniforms[key],value=uniform.value;void 0===value||uniform.ignoreUIL||"HZ"==key||("number"==typeof value?obj[key]={value:value,link:uniform}:value instanceof Vector2?obj[key]={x:value.x,y:value.y,link:value}:value instanceof Vector3?obj[key]={x:value.x,y:value.y,z:value.z,link:value}:value instanceof Vector4?obj[key]={x:value.x,y:value.y,z:value.z,w:value.w,link:value}:value instanceof Color&&(obj[key]={r:value.r,g:value.g,b:value.b,a:1,link:value}))}return obj}function isElement(object){return!!object?.div?.hydraObject||void 0!==GLUIObject&&(object instanceof GLUIObject||object instanceof GLUIText)}function getElementObject($element){let obj={_config:{nudgeMultiplier:1}};return void 0!==$element.x&&(obj.x={value:$element.x,link:$element}),void 0!==$element.y&&(obj.y={value:$element.y,link:$element}),void 0!==$element.z&&(obj.z={value:$element.z,link:$element}),void 0!==$element.scale&&(obj.scale={value:$element.scale,link:$element}),void 0!==$element.scaleX&&(obj.scaleX={value:$element.scaleX,link:$element}),void 0!==$element.scaleY&&(obj.scaleY={value:$element.scaleY,link:$element}),void 0!==$element.rotation&&(obj.rotation={value:$element.rotation,link:$element}),void 0!==$element.rotationX&&(obj.rotationX={value:$element.rotationX,link:$element}),void 0!==$element.rotationY&&(obj.rotationY={value:$element.rotationY,link:$element}),void 0!==$element.rotationZ&&(obj.rotationZ={value:$element.rotationZ,link:$element}),void 0!==$element.alpha&&(obj.alpha={value:$element.alpha,link:$element}),obj}function getPlainObject(object){let obj={};for(let key in object){let value=object[key];"number"==typeof value?obj[key]={value:value,link:object}:value instanceof Vector2?obj[key]={x:value.x,y:value.y,link:value}:value instanceof Vector3?obj[key]={x:value.x,y:value.y,z:value.z,link:value}:value instanceof Vector4?obj[key]={x:value.x,y:value.y,z:value.z,w:value.w,link:value}:value instanceof Color&&(obj[key]={r:value.r,g:value.g,b:value.b,a:1,link:value})}if(Object.keys(obj).length)return obj}async function getObjectsFromLayout(layout){let layers=await layout.getAllLayers(),objects={};for(let key in layers){let layer=layers[key];ignoreObject(key,layout.name)||(layer.ready&&!layer.disabled&&await layer.ready(),objects[key]=layer)}return objects}function createSheetFromObjects(objects,layoutName,{isSceneLayout:isSceneLayout}){let sheet={};for(let name in objects){let object=objects[name],key=`${layoutName}&${name}`;if(ignoreObject(name))continue;let matched=!1;if(object.uniforms)_flatMap[key]=sheet[key]=getShaderObject(object);else if(isElement(object))_flatMap[key]=sheet[key]=getElementObject(object);else if((object instanceof Mesh||object instanceof Group)&&(_flatMap[key]=sheet[key]=getMeshObject(object,null,key),matched=!0),object.shader&&(_flatMap[key+"&shader"]=sheet[key+"&shader"]=getShaderObject(object.shader),matched=!0),object.behavior&&(_flatMap[key+"&behavior"]=sheet[key+"&behavior"]=getShaderObject(object.behavior),matched=!0),object.group&&(_flatMap[key]=sheet[key]=getMeshObject(object.group,object,key),matched=!0),!matched&&!isSceneLayout){let obj=getPlainObject(object);obj?_flatMap[key]=sheet[key]=obj:console.warn("Unclear how to animate object "+key,object)}}return sheet}function makeSendable(){const cleanObject=obj=>{let newObj={};for(let key in obj)"link"!=key&&(newObj[key]=obj[key]);return newObj};let obj={sheets:[],nudgeMultiplier:_config.nudgeMultiplier};return obj.filePath=Assets.getPath(`assets/data/timeline-${_name}.json`),obj.filePath.includes("http")||(obj.filePath=Hydra.absolutePath(obj.filePath)),_config.sheets.forEach((sheet=>{let newSheet={};for(let key in sheet){let top=sheet[key];newSheet[key]={};for(let key2 in top)newSheet[key][key2]=cleanObject(top[key2])}obj.sheets.push(newSheet)})),obj}function completeDataLink(dataObj,realObj){let transform;for(let key2 in realObj){if("_config"===key2)continue;let valueObj=dataObj[key2],link=realObj[key2].link;void 0!==valueObj.value?(!Object.prototype.hasOwnProperty.call(link,key2)&&Object.prototype.hasOwnProperty.call(link,"value")?link.value=valueObj.value:link[key2]=valueObj.value,transform=link.transform,transform&&"alpha"==key2&&link.css("opacity",valueObj.value)):link.copy(valueObj)}transform&&transform()}function linkData(data){for(let key in data){let dataObj=data[key],realObj=_flatMap[key];_changedKeys[key]=!0,completeDataLink(dataObj,realObj)}}async function openEditor(){_config.sheets||await prepareConfig(),(_editor=new UILExternalTimeline(_name,800,1200,makeSendable())).onMessage=linkData,_editor.onVisualizePath=handleVisualizePath,_editor.onDestroy=_=>{_editor=null,handleVisualizePath({}),_meshes?.forEach((mesh=>{mesh._cameraUIL&&(mesh._cameraUIL.tweenUIL_groupPos=null,mesh._cameraUIL.tweenUIL_scale=null,mesh._cameraUIL.tweenUIL_rotation=null,mesh._cameraUIL.tweenUIL_position=null,mesh._cameraUIL.tweenUIL_zoom=null,mesh._cameraUIL.tweenUIL_lookAt=null,mesh._cameraUIL.tweenUIL_cameraRotation=null,mesh._cameraUIL.tweenUIL_viewportFocus=null),mesh._meshUIL&&(mesh._meshUIL.tweenUIL_scale=null,mesh._meshUIL.tweenUIL_position=null,mesh._meshUIL.tweenUIL_rotation=null)}))},_meshes?.forEach((mesh=>{mesh._cameraUIL?(mesh._cameraUIL.tweenUIL_groupPos=value=>_editor.sendUpdate(mesh._uilLayerName,value,"position"),mesh._cameraUIL.tweenUIL_scale=value=>_editor.sendUpdate(mesh._uilLayerName,value,"scale"),mesh._cameraUIL.tweenUIL_rotation=value=>_editor.sendUpdate(mesh._uilLayerName,value,"rotation"),mesh._cameraUIL.tweenUIL_position=value=>_editor.sendUpdate(mesh._uilLayerName,value,"cameraPos"),mesh._cameraUIL.tweenUIL_zoom=value=>_editor.sendUpdate(mesh._uilLayerName,value,"zoom"),mesh._cameraUIL.tweenUIL_lookAt=value=>_editor.sendUpdate(mesh._uilLayerName,value,"lookAt"),mesh._cameraUIL.tweenUIL_cameraRotation=value=>_editor.sendUpdate(mesh._uilLayerName,value,"cameraRotation"),mesh._cameraUIL.tweenUIL_viewportFocus=value=>_editor.sendUpdate(mesh._uilLayerName,value,"viewportFocus")):mesh._meshUIL&&(mesh._meshUIL.tweenUIL_position=value=>_editor.sendUpdate(mesh._uilLayerName,value,"position"),mesh._meshUIL.tweenUIL_scale=value=>_editor.sendUpdate(mesh._uilLayerName,value,"scale"),mesh._meshUIL.tweenUIL_rotation=value=>_editor.sendUpdate(mesh._uilLayerName,value,"rotation"))}))}function updateKeyframeData(){for(let key in _sheets)_this.keyframeTotalProgress=_keyframes.positionObject.position/_sheets[key].length;_this.keyframeIndex=_keyframes.current,_this.keyframeLocalProgress=Math.fract(_keyframes.positionObject.position)}function updateKeyframeLoop(hz){_keyframes.positionObject.position=Math.lerp(_keyframes.positionObject.target,_keyframes.positionObject.position,.07*hz,!1);for(let key in _sheets)_sheets[key].sequence.position=_keyframes.positionObject.position;updateKeyframeData()}function handleVisualizePath(data){if(!_pathVisualization&&!data.position)return;let object;if(_pathVisualization||(_pathVisualization=_this.initClass(TweenUILPathVisualization)),data.sheetId){let parts=data.objectKey.split("  "),key=`${parts.length>1?parts[0]:data.sheetId}&${parts.length>1?parts.last():data.objectKey}`;object=_meshes.find((({_uilLayerName:_uilLayerName})=>_uilLayerName===key)),object||_layersWithWarnings[key]||(console.warn(`Couldnt find mesh for object ${key}.`),_layersWithWarnings[key]=!0)}_pathVisualization.object=object,_pathVisualization.update(data)}!async function(){!function initTicker(){_ticker=Theatre.core.ticker,_this.startRender(loop)}(),(_input=InputUIL.create(_name+"_tween",_group)).setLabel(_name),_input.addButton("edit",{label:"Edit",actions:[{title:"Editor",callback:openEditor}]});try{_savedState=await get(Assets.getPath(`assets/data/timeline-${_name}.json`))}catch{Hydra.LOCAL&&console.warn(`No saved TweenUIL timeline timeline-${_name}.json, create one with the Editor`),_savedState={sheetsById:{},definitionVersion:"0.4.0",revisionHistory:[]}}_project=Theatre.core.getProject(_name,{state:_savedState}),await _project.ready;for(let key in _savedState.sheetsById){_sheets[key]=_project.sheet(key);let state=_savedState.sheetsById[key];_group||initObjectsWithTracks(state),_sheets[key].length=findTrueDuration(state.sequence)}_input.addButton("play",{label:"Play",actions:[{title:"Play",callback:play}]}),_input.addRange("Scrub",0,{min:0,max:1,step:5e-4}),_input.onUpdate=async key=>{if("Scrub"==key){_config.sheets||await play();let value=_input.getNumber("Scrub");_this.seek(value)}},_this.flag("ready",!0)}(),this.play=async function(options){return await _this.wait("ready"),play(options)},this.seek=function(value){if(_this.flag("ready")){checkDuration();for(let key in _sheets)_sheets[key].sequence.position=Math.min(_sheets[key].length,_duration*value)}},this.seekImmediate=function(value){_this.seek(value),loop()},this.promise=async function(){return await _this.wait("ready"),_promise},this.setLabel=function(label){_input&&_input.setLabel(label)},this.preload=async function(){if(await _this.wait("ready"),_config.sheets){if(!_this.flag("isLoaded"))return _this.wait("isLoaded")}else await prepareConfig(),linkLocally();_this.seek(0)},this.loaded=async function(){if(!_this.flag("isLoaded")&&_config.sheets)return _this.wait("isLoaded");await _this.preload()},this.seekToKeyframe=async function(index){if(_this.flag("isLoaded")||await _this.preload(),!_keyframes)return console.warn("TweenUILConfig :: Missing keyframes! Add tween_anchor layer");_keyframes.current=index,_keyframes.positionObject={position:_keyframes[index].position,target:_keyframes[index].position},_this.seek(_keyframes[index].position),updateKeyframeData(),_this.startRender(updateKeyframeLoop,RenderManager.NATIVE_FRAMERATE)},this.playToKeyframe=async function(index,time,ease="linear",delay){await _this.wait("ready"),_keyframes.positionObject||await _this.seekToKeyframe(0);let nextKeyframe=_keyframes[index],currentKeyframe=_keyframes[_keyframes.current];if(!nextKeyframe)return;let position=nextKeyframe.position;return time||(time=1e3*Math.abs(nextKeyframe.position-currentKeyframe.position)),_keyframes.tween&&(_keyframes.tween=clearTween(_keyframes.tween)),_keyframes.current=index,_this.flag("playingToKeyframe",!0,time+50),_keyframes.tween=tween(_keyframes.positionObject,{target:position},time,ease,delay),_keyframes.tween.promise()},this.peekInKeyframeDirection=function(dir,percent){if(!_keyframes||_this.flag("playingToKeyframe"))return;let currentKeyframe=_keyframes[_keyframes.current],nextKeyframe=_keyframes[_keyframes.current+dir];nextKeyframe&&(_keyframes.positionObject.target=Math.mix(currentKeyframe.position,nextKeyframe.position,percent))},this.playToNextKeyframe=async function(time,ease,delay){return this.playToKeyframe(_keyframes.current+1,time,ease,delay)},this.playToPrevKeyframe=async function(time,ease,delay){return this.playToKeyframe(_keyframes.current-1,time,ease,delay)},this.playToDirKeyframe=async function(dir,time,ease,delay){return this.playToKeyframe(_keyframes.current+dir,time,ease,delay)},this.get("position",(_=>{let position=0;for(let key in _sheets)position=Math.max(position,_sheets[key]?.sequence?.position||0);return position})),this.get("progress",(_=>(checkDuration(),_this.position/_duration))),_this.get("duration",(()=>_duration)),this.get("totalKeyframes",(_=>_keyframes?_keyframes.length:0)),this.get("currentKeyframe",(_=>_keyframes?_keyframes.current:0)),this.get("keyframeValue",(_=>{if(!_keyframes)return 0;let position=_this.position;for(let i=0;i<_keyframes.length;++i){let keyframe=_keyframes[i];if(position>=keyframe.position){let nextKeyframe=_keyframes[i+1];if(!nextKeyframe)return keyframe.value;if(position<nextKeyframe.position)return Math.range(position,keyframe.position,nextKeyframe.position,keyframe.value,nextKeyframe.value,!0)}}return _keyframes[0]?.value||0})),_this.get("keyframeSection",(_=>Math.fract(_this.keyframeValue))),_this.getPositionAtKeyframeValue=keyframeValue=>{let index=Math.floor(keyframeValue),position=_keyframes[index]?.position||0,progress=Math.fract(keyframeValue);if(progress){let nextPosition=_keyframes[index+1]?.position;nextPosition&&(position=Math.mix(position,nextPosition,progress))}return position},_this.getProgressAtKeyframeValue=keyframeValue=>(checkDuration(),_this.getPositionAtKeyframeValue(keyframeValue)/_duration),_this.getTrackData=function(objectName){for(let key in _savedState.sheetsById){let tracks=_savedState.sheetsById[key].sequence.tracksByObject;if(tracks[objectName])return tracks[objectName]}},this.get("manualRender",(()=>_manualRender)),this.set("manualRender",(value=>{(value=!!value)!==_manualRender&&((_manualRender=value)?_this.stopRender(loop):_this.startRender(loop))})),_this.update=()=>{_manualRender||!Hydra.LOCAL||_this.flag("manualRenderWarned")||(console.warn("Set manualRender to true if using TweenUIL.update()"),_this.flag("manualRenderWarned",!0)),loop()}}),(()=>{TweenUIL.BEFORE_UPDATE="TweenUIL.BEFORE_UPDATE",TweenUIL.UPDATED="TweenUIL.UPDATED"})),Class((function UILFile(_offline,_path){Inherit(this,Component);this.load=async function(){let path=window.UIL_STATIC_PATH||"assets/data/uil.json";try{let data=await get(path);return"string"==typeof data?Hydra.LOCAL?null:{}:data}catch(e){return{}}},this.save=async function(sessionData,data){if(Dev.writeFile(window.UIL_STATIC_PATH||"assets/data/uil.json",data),_offline){let partial={};try{partial=await get("assets/data/uil-partial.json",data);for(let key in sessionData)partial[key]=sessionData[key]}catch(e){partial=sessionData}Dev.writeFile("assets/data/uil-partial.json",partial),Storage.set("uil_update_partial",!0)}}})),Class((function UILStorage(){Inherit(this,Component);const _this=this;var _storage,_platform,_fs,_keys,_storeIds=[],_data={},_dataSession={},_id=window.UIL_ID||"default",_remote=window.UIL_REMOTE||!1;window.UIL_ID=_id=_id.replaceAll(/[^a-zA-Z0-9 _-]/g,""),this.SAVE="uil_save";const OFFLINE_FIREBASE=Utils.query("offlineFB");function clearOfflineData(){Storage.set("uil_update_partial",!1),Dev.writeFile("assets/data/uil-partial.json",{})}async function init(){_fs&&_fs.destroy(),_fs=_this.initClass(uilFile()?UILFile:UILRemote,OFFLINE_FIREBASE);let data=await _fs.load();if(null===data){let remoteFs=_this.initClass(UILRemote),remoteData=await remoteFs.load();confirm("Looks like the local uil.json has merge conflicts, do you want to sync from Firebase and resolve it?")?(_data[_id]=remoteData,await write(),window.location.reload()):data={}}if(_data[_id]=data,_this.loaded=!0,!OFFLINE_FIREBASE&&Storage.get("uil_update_partial")&&!uilFile()){if(!confirm("Looks like you have UIL data captured offline, do you want to sync it to Firebase?"))return clearOfflineData();let data=await get("assets/data/uil-partial.json");for(let key in data)_this.set(key,data[key]);write(!0,!0),clearOfflineData()}}async function write(direct,silent){let prevent=!1,e={prevent:_=>prevent=!0};_this.events.fire(_this.SAVE,e),!direct&&(e.wait&&await e.wait(),prevent)||(_fs.save(_dataSession,_data[_id]),_dataSession={},silent||(__body.css({display:"none"}),_this.delayedCall((()=>{__body.css({display:"block"})}),100)))}function uilFile(){return!Utils.query("editMode")&&(!Hydra.LOCAL||!(window.Config&&Config.PLATFORM_CONFIG&&Utils.query("uil"))&&(!!Device.mobile||(!!OFFLINE_FIREBASE||(!(!window._BUILT_||Hydra.LOCAL)||(!!window.AURA||(!!window._UIL_FILE_||(!window._FIREBASE_UIL_&&!window.UIL_ID||!Device.detect("hydra")&&!Utils.query("uil"))))))))}Hydra.ready((async _=>{window.Platform&&Platform.isDreamPlatform&&Config.PLATFORM_CONFIG?async function initLocalCached(){_fs=_this.initClass(UILFile),_data[_id]=await _fs.load(),_this.loaded=!0}():Hydra.LOCAL&&window.Platform&&window.Platform.isPlatform||init(),(Utils.query("editMode")||Hydra.LOCAL&&window.Platform&&window.Platform.isDreamPlatform&&Utils.query("uil")||Hydra.LOCAL&&!Device.mobile&&!window._BUILT_&&(Utils.query("uil")||Device.detect("hydra")))&&__window.bind("keydown",(e=>{(e.ctrlKey||e.metaKey)&&83==e.keyCode&&(e.preventDefault(),write())}))})),this.reload=function(id,path,persist){_this.loaded=!1,_platform||(_platform=_id),persist&&_storeIds.push(id),_id=id,window.UIL_ID=id,window.UIL_STATIC_PATH=path,init()},this.set=function(key,value){null===value?(delete _data[_id][key],_dataSession[key]=value):(_data[_id][key]=value,_dataSession[key]=value)},this.setWrite=function(key,value){this.set(key,value),write(!0)},this.clearMatch=function(string){for(let key in _data[_id])key.includes(string)&&delete _data[_id][key];write(!0)},this.write=function(silent){write(!0,silent)},this.get=function(key){let val=_data[_id]&&_data[_id][key];if(void 0===val&&_platform&&(val=_data[_platform][key]),void 0===val&&_storeIds)for(let i=0;i<_storeIds.length;i++)try{val=_data[_storeIds[i]][key]}catch(e){val=void 0}return val},this.ready=function(){return _this.wait(_this,"loaded")},this.getKeys=function(){return _keys||(_keys=Object.keys(_data[_id])),_keys},this.hasData=function(){return!!_data[_id]},_this.uploadFileToRemoteBucket=async function({file:file,progress:progress}){if(!_remote)return;_storage||(await Services.ready(),_storage=Services.app().storage());let filename=file.name.replace(/ /g,"_");const ref=_storage.ref("_tmp/"+filename),path=`https://storage.googleapis.com/${ref.bucket}/uploads/${_id}/${filename}`.toLowerCase(),metadata={customMetadata:{id:_id,path:path,contentType:file.type}},result=ref.put(file,metadata);let exists;for(progress&&result.on("state_changed",(snapshot=>{let _progress=snapshot.bytesTransferred/snapshot.totalBytes*95;progress.css({width:_progress+"%"})}),(error=>{err&&console.log(error),progress.css({width:0})}),(()=>{progress.css({width:0})}));!exists;)try{await fetch(path).then((r=>r.ok))&&(exists=!0)}catch(err){exists=!1}return metadata},this.parse=function(key,hint){let data=_data[_id][key];if(void 0===data)return null;if(Array.isArray(data)){if(hint instanceof Vector2)return{value:(new Vector2).fromArray(data)};if(hint instanceof Vector3)return{value:(new Vector3).fromArray(data)};if(hint instanceof Vector4)return{value:(new Vector4).fromArray(data)}}else if("string"==typeof data&&"#"===data.charAt(0))return{value:new Color(data)};return{value:data}}}),"static"),Class((function UILControl(){Inherit(this,Element);const _this=this;let $this,$label,$content,$view,_value,_previous,_label,_opts,_visible=!0,_onChange=()=>{},_onFinishChange=()=>{};function isEqual(a,b){return Array.isArray(a)||Array.isArray(b)?a+""==b+"":"object"==typeof a||"object"==typeof b?JSON.stringify(a)===JSON.stringify(b):a===b}function clone(value){return Array.isArray(value)?[...value]:"object"==typeof value?Object.assign({},value):value}!function initHTML(){$this=_this.element,$this.size("100%","auto"),$this.css({position:"relative",display:"inline-block",borderBottom:"1px solid #161616",padding:"2px 0",boxSizing:"border-box"}),$this.attr("data-type","UILControl"),$this.div._this=_this}(),function initLabel(){$label=$this.create("label"),$label.size("100px","auto").fontStyle("sans-serif",12,"#9B9C9B"),$label.css({paddingLeft:4,paddingTop:2,boxSizing:"border-box",verticalAlign:"top",float:"left",wordBreak:"break-all"}),_this.$label=$label}(),function initContent(){$content=$this.create("content"),$content.size("calc(100% - 100px)","auto").css({float:"left"}),_this.$content=$content}(),this.init=function(id,opts={}){_this.id=id,_opts=opts,_value=clone(opts.value),_previous=clone(_value),_this.setLabel(opts.label||id),$this.attr("data-id",id)},this.finish=function(history=!0){_onFinishChange(_value),isEqual(_value,_previous)||(history&&UILHistory.set(_this,_previous),UILLocalStorage.set(_this.id,_value),_previous=clone(_value))},this.force=function(value){_this.value=clone(value),_this.finish(!1)},this.debounce=function(callback,time=250){let interval;return(...args)=>{clearTimeout(interval),interval=setTimeout((()=>{interval=null,callback(...args)}),time)}},this.onChange=function(cb){return _onChange=cb,_this},this.onFinishChange=function(cb){return _onFinishChange=cb,_this},this.get("value",(()=>_value)),this.set("value",(value=>{isEqual(value,_value)||(_value=clone(value),_this.update&&_this.update(_value),_onChange(_value))})),this.get("view",(()=>$view)),this.set("view",(view=>{$view&&$view.destroy(),$view=view,$content.add($view)})),this.hide=function(){return _visible=!1,$this.css({display:"none"}),_this},this.show=function(){return _visible=!0,$this.css({display:"inline-block"}),_this},this.isVisible=function(){return _visible},this.setLabel=function(label){_label=label,_this.label=label;let title=label;if(_opts.description){title=title+"\n"+_opts.description;let $span=$("icon").css({verticalAlign:"middle",display:"inline-block",paddingTop:1});$span.html(UILControl.infoIcon),$label.text(label+" "),$label.add($span)}else $label.text(label);$label.attr("title",title)},this.setDescription=function(desc){$label.attr("title",desc)}}),(()=>{UILControl.infoIcon='<span><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><path d="M9 9a3 3 0 016 1c0 2-3 3-3 3M12 17h0"/></svg></span>'})),Class((function UILFolder(_id,_opts={drag:!0}){Inherit(this,Element);const _this=this;let $this,$header,$container,$toggle,$drag,$title,_children={},_open=!_opts.closed,_visible=!0,_order=[],_draggable=!1,_sortableChildren=!1,_headerDrag=!1;var _hasClipboard=!1;_this.id=_id,_this.label=""+(_opts.label||_id),_this.level=-1;function removeDragHandlers(){$this.div.removeEventListener("dragstart",dragStart,!1),$this.div.removeEventListener("dragover",dragOver,!1),$this.div.removeEventListener("drop",drop,!1)}function matchItem(str,item){return UILFuzzySearch.search(str,item.id.toLowerCase())||UILFuzzySearch.search(str,item.label.toLowerCase())}function dragStart(e){if(!UILFolder.DragLock){if(!_headerDrag)return e.preventDefault(),void e.stopPropagation();UILFolder.DragLock=_this.id,e.dataTransfer.setData("text/plain",_this.id),e.dataTransfer.effectAllowed="move",$this.css({opacity:.5})}}function dragOver(e){e.preventDefault(),e.dataTransfer.dropEffect="move"}function drop(e){if(!UILFolder.DragLock)return;if(e.dataTransfer.items)for(var i=0;i<e.dataTransfer.items.length;i++)if("file"===e.dataTransfer.items[i].kind)return;e.preventDefault(),_headerDrag=!1;let target=e.currentTarget._this,dragging=_this.parent.get(UILFolder.DragLock);UILFolder.DragLock=null,target&&target.parent&&dragging&&(dragging.element.css({opacity:1}),dragging.parent.get(target.id)&&(e.stopPropagation(),target.parent.container.insertBefore(dragging.element.div,target.element.div),_order=[...target.parent.container.childNodes].map((el=>el._this.id)),_this.events.fire(UIL.REORDER,{order:[..._order]}),function saveSort(){UILStorage.set(`UIL_${UIL.sortKey}_${_this.parent.id}_order`,JSON.stringify(_order))}()))}function getUrlID(){return`${Global.PLAYGROUND||"Global"}_folder_${_id}`}function saveFolderState(){sessionStorage.setItem(getUrlID(),JSON.stringify({open:_open}))}function open(keepClosed=!1){_open=!0,$container.css({display:"flex"}),$toggle&&$toggle.text(""),1!=keepClosed&&forEachFolder((f=>f.close())),saveFolderState(),_this.onOpen&&_this.onOpen()}function close(){_open=!1,$container.css({display:"none"}),$toggle&&$toggle.text(""),saveFolderState()}function onToggle(e){_open?close():open()}function onMouseDown(e){_headerDrag=!0,$header.div.addEventListener("mouseup",onMouseUp)}function onMouseUp(e){_headerDrag=!1,$header.div.removeEventListener("mouseup",onMouseUp)}function onKeydown(e){13===e.which&&(_open?close():open())}function onKeyup(e){_hasClipboard&&("c"==e.key&&e.metaKey?function onCopy(){UILClipboard.copy(_children)}():"v"==e.key&&e.metaKey&&function onPaste(){UILClipboard.paste(_children)}())}function onFocus(){$this.css({border:"1px solid #37a1ef"}),$this.div.classList.add("active"),_hasClipboard=!0}function onBlur(){$this.css({border:"none",border:"1px solid #161616"}),$this.div.classList.remove("active"),_hasClipboard=!1}function forEachFolder(cb){return Object.values(_children).forEach((el=>{el instanceof UILFolder&&(cb(el),el.forEachFolder(cb))})),_this}!function init(){$this=_this.element,$this.size("100%","auto").bg(_opts.background||"#272727"),$this.css({position:"relative",border:"1px solid #161616",boxSizing:"border-box",maxHeight:_opts.maxHeight||"none"}),$this.attr("data-id",_id),$this.attr("data-type","UILFolder"),$this.div._this=_this}(),function style(){UIL.addCSS(UILFolder,"\n            .UILFolder *:focus { outline: none; }\n            .UILFolder input:focus { border-color:#37a1ef!important; }\n            .UILFolder button:focus { border-color:#37a1ef!important; }\n            .UILFolder .UILFolder .UILFolder .toggle {margin-left:8px; }\n            .UILFolder .UILFolder .UILFolder .UILFolder .toggle {margin-left:16px; }\n            .UILFolder .UILFolder .UILFolder .UILFolder .UILFolder .toggle {margin-left:24px; }\n            .UILFolder .UILFolder .UILFolder .UILFolder .UILFolder .UILFolder .toggle {margin-left:32px; }\n            .UILFolder .UILFolder .UILFolder .UILFolder .UILFolder .UILFolder .UILFolder .toggle {margin-left:40px; }\n        ")}(),function initHeader(){_opts.hideTitle||($header=$this.create("title","a"),$header.attr("tabindex","0"),$header.size("100%","auto").bg("#272727"),$header.css({display:"block",padding:"4px 4px",boxSizing:"border-box",fontWeight:"bold",userSelect:"none",borderBottom:"1px solid #161616"}),$header.fontStyle("sans-serif",11,"#B1B1B1"),$header.div.addEventListener("keydown",onKeydown,!1),$header.div.addEventListener("click",onToggle,!1),$header.div.addEventListener("mousedown",onMouseDown),$header.div.addEventListener("focus",onFocus,!1),$header.div.addEventListener("blur",onBlur,!1),$header.div.addEventListener("keydown",onKeyup,!1),$toggle=$header.create("toggle"),$toggle.text(_open?"":"").css({fontSize:8,display:"inline-block",verticalAlign:"middle"}),$drag=$header.create("drag"),$drag.text("").css({position:"absolute",right:7,top:3,display:"inline-block",pointerEvents:"none"}),$drag.hide(),$title=$header.create("title"),$title.text(_this.label).css({display:"inline-block",marginLeft:4}))}(),function initContainer(){$container=$this.create("container"),$container.size("100%","100%").css({display:"flex",flexDirection:"column",position:"relative",overflowY:"auto"}),_open||$container.css({display:"none"}),_this.container=$container.div}(),function restoreFolderState(){let json=JSON.parse(sessionStorage.getItem(getUrlID()));json&&(json.open?open():close())}(),this.add=function(child){return child.draggable&&child.draggable(_sortableChildren),child.parent=_this,_children[child.id]=child,$container.add(child),_this},this.remove=function(x){let id="string"==typeof x?x:x.id,child=_children[id];if(!child)for(let key in _children)if(key.includes(x)){child=_children[key],delete _children[key];break}if(child)return child.eliminate&&child.eliminate(),child.destroy(),_order&&(_order=_order.filter((child=>child!==id))),delete _children[id],_this},this.get=function(id){return _children[id]},this.getAll=function(){return Object.values(_children)},this.getVisible=function(){return Object.values(_children).filter((x=>x.isVisible()))},this.find=function(id){return id===_id?_this:Object.values(_children).reduce(((acc,item)=>item.id===id?acc.concat(item):item instanceof UILFolder?acc.concat(item.find(id)):acc),[])},this.filter=function(str){return function filter(str,match=!1){str=str.toLowerCase();let result=[],haystack=Object.values(_children);for(let el of haystack)if(el instanceof UILFolder){let matches=el.filter(str,!0);matches.length?(result.concat(matches),el.show(),el.open()):matchItem(str,el)?(result.push(el),el.show(),el.showChildren(),el.close()):el.getVisible().length?el.show():el.hide()}else matchItem(str,el)?(result.push(el),el.show()):el.hide();return result}(str)},this.filterSingle=function filterSingle(str){str=str.toLowerCase();let haystack=Object.values(_children);for(let el of haystack)el instanceof UILFolder?(el.filterSingle(str),str==el.label.toLowerCase()||str==el.id.toLowerCase()?(el.show(),el.showChildren(),el.open(!0)):el.getVisible().length?el.show():el.hide()):matchItem(str,el)?(el.show(),el.open&&el.open(!0)):el.hide();return[]},this.open=function(keepClosed){return open(keepClosed),_this},this.close=function(){return close(),_this},this.setLabel=function(label){return _this.label=""+label,$title.text(label),_this},this.hide=function(){return _visible=!1,$this.css({display:"none"}),_this},this.show=function(){return _visible=!0,$this.css({display:"block"}),_this},this.showChildren=function(){return Object.values(_children).forEach((el=>el instanceof UILFolder?el.showChildren():el.show())),_this.show(),_this},this.isOpen=function(){return _open},this.isVisible=function(){return _visible},this.forEachFolder=function(cb){return forEachFolder(cb)},this.forEachControl=function(cb){return Object.values(_children).forEach((el=>{el instanceof UILFolder?el.forEachControl(cb):cb(el)})),_this},this.enableSorting=function(key){_sortableChildren=!0,UIL.sortKey=key,Object.values(_children).forEach((el=>{el instanceof UILFolder&&el.draggable(!0)}));let order=function getSort(){let sort=UILStorage.get(`UIL_${UIL.sortKey}_${_id}_order`);if(sort)return JSON.parse(sort)}();return order&&(_order=order,function restoreSort(){_order.forEach((id=>{_children[id]&&$container.add(_children[id])}))}()),_this},this.draggable=function(enable){_draggable=enable,$this.attr("draggable",enable),enable?(!function addDragHandlers(){$this.div.addEventListener("dragstart",dragStart,!1),$this.div.addEventListener("dragover",dragOver,!1),$this.div.addEventListener("drop",drop,!1)}(),$drag&&$drag.show()):(removeDragHandlers(),$drag&&$drag.hide())},this.toClipboard=function(){UILClipboard.copy(_children)},this.fromClipboard=function(){UILClipboard.paste(_children)},this.eliminate=function(){_opts.hideTitle||($header.div.removeEventListener("keydown",onToggle,!1),$header.div.removeEventListener("click",onToggle,!1),$header.div.removeEventListener("mousedown",onMouseDown),$header.div.removeEventListener("focus",onFocus,!1),$header.div.removeEventListener("blur",onBlur,!1)),_draggable&&removeDragHandlers()},this.forceSort=function(index){_this.parent.container.insertBefore(_this.element.div,_this.parent.container.children[index]),_order=[..._this.parent.container.childNodes].map((el=>el._this.id)),_this.events.fire(UIL.REORDER,{order:[..._order]})},this.openChildren=function(){Object.values(_children).forEach((el=>el instanceof UILFolder?el.open():null))}})),Class((function UILPanel(_title,_opts={}){Inherit(this,Element);const _this=this;let $this,_folder,_toolbar,_hidden=!1;function onKeydown(e){if(e.ctrlKey||e.metaKey){if(72==e.keyCode&&e.shiftKey){if((""+document.activeElement.type).includes(["textarea","input","number"]))return;e.preventDefault(),_hidden?function show(){$this.visible(),_hidden=!1}():function hide(){$this.invisible(),_hidden=!0}()}37==e.keyCode&&e.shiftKey&&(e.preventDefault(),$this.css({left:0,right:"auto"})),39==e.keyCode&&e.shiftKey&&(e.preventDefault(),$this.css({left:"auto",right:0})),67==e.which&&e.shiftKey&&(e.preventDefault(),_folder.forEachFolder((f=>f.close()))),79==e.which&&e.shiftKey&&(e.preventDefault(),_folder.forEachFolder((f=>f.open())))}}function undim(){$this.css({opacity:1})}function dim(){$this.css({opacity:.6})}"hide"in _opts||(_opts.hide=!0),_this.id=_title,function initHTML(){$this=_this.element,$this.size(_opts.width||"300px",_opts.height||"auto").bg("#161616").mouseEnabled(!0),"left"===_opts.side?$this.css({left:0}):$this.css({right:0}),$this.css({top:0,maxHeight:_opts.maxHeight||"100%",position:"absolute",userSelect:"none",padding:4,overflowY:"auto",borderRadius:4}),$this.hide(),$this.div.className+=" prevent_interaction3d"}(),function initToolbar(){_toolbar=_this.toolbar=_this.initClass(UILPanelToolbar)}(),function initGroup(){_folder=_this.initClass(UILFolder,_title,{hideTitle:!0,drag:!1,background:"#161616"}),_this.folder=_folder}(),function addHandlers(){document.addEventListener("keydown",onKeydown,!1),_opts.hide&&(dim(),$this.div.addEventListener("mouseover",undim,!1),$this.div.addEventListener("mouseleave",dim,!1))}(),this.add=function(child){return $this.show(),_folder.add(child),_this},this.remove=function(x){return _folder.remove(x.id),_this},this.get=function(id){return _folder.get(id)},this.find=function(id){return _folder.find(id)},this.filter=function(str){return _folder.filter(str)},this.enableSorting=function(key){return _folder.enableSorting&&_folder.enableSorting(key),_this},this.eliminate=function(){_toolbar.eliminate(),$this.div.removeEventListener("mouseover",undim,!1),$this.div.removeEventListener("mouseleave",dim,!1),document.removeEventListener("keydown",onKeydown,!1)}})),Class((function UILControlButton(_id,_opts={}){Inherit(this,UILControl);const _this=this;let $view,_buttons=[];!function init(){_this.init(_id,_opts),_opts.hideLabel&&(_this.$label.css({display:"none"}),_this.$content.css({width:"100%"}))}(),function initActions(){$view=$("inputs");let config=[].concat(_opts.actions);_buttons=[].concat(_opts.actions).map((({title:title,callback:callback})=>{let btn=$view.create("btn btn-"+title,"button");return btn.text(title).bg("#1d1d1d"),btn.css({width:"calc(100% / "+(config.length||1),border:"1px solid #2e2e2e",color:"#37a1ef",position:"relative"}),btn.interact((e=>function hover(btn,e){"over"===e.action?btn.css({border:"1px solid #9b9c9b"}):btn.css({border:"1px solid #2e2e2e"})}(btn,e))),btn.click((e=>function click(e,title,callback){_this.value=title,callback&&callback(title,e),_this.finish()}(e,title,callback))),btn})),_this.view=$view}(),this.setTitle=function(text){_buttons.forEach((btn=>{btn.text(text)}))}})),Class((function UILControlCheckbox(_id,_opts={}){Inherit(this,UILControl);const _this=this;let $view,$label,$checkbox,$slider;function toggle(){$checkbox.attr("checked",_this.value),$slider.css({right:_this.value?0:"auto"}),$label.bg(_this.value?"#37a1ef":"#1d1d1d")}function click(){_this.value=!_this.value,toggle(),_this.finish()}function focus(){$label.css({border:"1px solid #37a1ef"})}function blur(){$label.css({border:"1px solid #2e2e2e"})}!function init(){_opts.value=_opts.value||!1,_this.init(_id,_opts)}(),function initView(){$view=$("view"),$label=$view.create("label","label"),$label.size(30,15).css({position:"relative",display:"inline-block",borderRadius:15,border:"1px solid #2e2e2e"}).bg(_this.value?"#37a1ef":"#1d1d1d"),$checkbox=$label.create("checkbox","input"),$checkbox.attr("type","checkbox"),$checkbox.attr("checked",_this.value),$checkbox.css({opacity:0,width:"100%",position:"absolute"}),$slider=$label.create("slider"),$slider.size(15,15).css({borderRadius:15,position:"absolute",right:_this.value?0:"auto",boxSizing:"border-box"}).bg("#ffffff"),_this.view=$view}(),function addHandlers(){$checkbox.div.addEventListener("focus",focus,!1),$checkbox.div.addEventListener("blur",blur,!1),$checkbox.div.addEventListener("click",click,!1),$checkbox.div.addEventListener("keypress",click,!1)}(),this.update=function(){toggle()},this.onDestroy=function(){$checkbox.div.removeEventListener("focus",focus,!1),$checkbox.div.removeEventListener("blur",blur,!1),$checkbox.div.removeEventListener("click",click,!1),$checkbox.div.removeEventListener("keypress",click,!1)}})),Class((function UILControlColor(_id,_opts={}){Inherit(this,UILControl);const _this=this;let $hex,$colorPicker,$hexInput,$colorInput;function syncColorValue(frame,hexUpdate=!1){let needsUpdate=!0;hexUpdate?$hexInput.div.value!==_this.value&&(_this.value=$hexInput.div.value):$colorInput.div.value!==_this.value?_this.value=$colorInput.div.value:needsUpdate=!1,needsUpdate&&($hexInput.div.value=_this.value,$colorInput.div.value=_this.value,$colorPicker.bg(_this.value))}function onClick(){$colorInput.div.click(),$colorInput.div.focus(),_this.startRender(syncColorValue,24)}function onTextFocus(){$hexInput.div.select()}function onColorBlur(){_this.stopRender(syncColorValue),finishChange()}function onChange(v){syncColorValue(0,!0),finishChange()}function finishChange(){_this.finish()}!function init(){_opts.value=_opts.value||"#ffffff",_this.init(_id,_opts)}(),function initInput(){let $view=$("color");$view.css({position:"relative",display:"flex"}),$hex=$view.create("colorHex"),$hex.size("100%","100%"),$hex.css({boxSizing:"border-box",flex:"2",marginRight:4}),$hexInput=$hex.create("hex","input"),$hexInput.size("100%").css({fontSize:12,fontFamily:"sans-serif",padding:1,color:"#37A1EF",border:"1px solid #2E2E2E"}).bg("#1D1D1D"),$hexInput.attr("value",_this.value),$hexInput.attr("maxlength",7),$colorPicker=$view.create("colorPicker"),$colorPicker.size("100%","auto").bg(_this.value),$colorPicker.css({border:"1px solid #2E2E2E",position:"relative",flex:"3"}),$colorInput=$colorPicker.create("colorInput","input"),$colorInput.attr("type","color"),$colorInput.attr("value",_this.value),$colorInput.size(0,0).css({border:0,top:6,zIndex:-1,position:"absolute"}),_this.view=$view}(),function addHandlers(){$colorPicker.interact(null,onClick),finishChange=_this.debounce(finishChange,250),$hexInput.div.addEventListener("input",onChange,!1),$hexInput.div.addEventListener("focus",onTextFocus,!1),$hexInput.div.addEventListener("change",finishChange,!1),$colorInput.div.addEventListener("blur",onColorBlur,!1)}(),this.force=function(value){$hexInput.div.value=value,syncColorValue(0,!0)},this.update=function(){$hexInput.attr("value",_this.value),$colorPicker.bg(_this.value),$colorInput.attr("value",_this.value),finishChange()},this.onDestroy=function(){$hexInput.div.removeEventListener("input",onChange,!1),$hexInput.div.removeEventListener("focus",onTextFocus,!1),$hexInput.div.removeEventListener("change",finishChange,!1),$colorInput.div.removeEventListener("blur",onColorBlur,!1)}})),Class((function UILControlFile(_id,_opts={value:{}}){Inherit(this,UILControl);const _this=this;let $view,$picker,$preview,$img,$input,$$copy,$progress,_value,$filepicker;function filePickerSelected(value){window.UIL_REMOTE&&console.warn("UIL_REMOTE is not supported when using file picker!");const v={prefix:void 0,src:"assets/geometry/"+value,filename:value.split("/").last(),relative:"assets/geometry"};_this.force(v),_this.value=v,_this.finish()}async function change(e){let file=$picker.div.files[0];if(!file)return;let name=file.name;if(window.UIL_REMOTE){const{customMetadata:customMetadata}=await UILStorage.uploadFileToRemoteBucket({file:file,progress:$progress});name=customMetadata.path}_value.filename=name,_value.relative=function getRelative(){return _value.filename.includes("http")?"":_value.relative.includes(_value.prefix)?_value.relative.replace(""+_value.prefix,""):_value.relative}(),_value.src=function getSrc(){return _value.filename.includes("http")?_value.filename:`${_value.prefix?_value.prefix+"/":""}${_value.relative?_value.relative+"/":""}${_value.filename}`}(),await function fileExists(url){return!!url.includes("http")||fetch(Assets.getPath(url)).then((e=>404!=e.status)).catch((e=>console.warn("UILControlFile image url validation failed",e)))}(_value.src)?(_this.value=Object.assign({},_value),$img.attr("title",_value.src),$$copy.text(_value.filename),_this.finish()):($picker.div.value="",console.warn("UIL: Could not find file",_value),alert(`"${_value.src}" not found!\nMake sure "relative path" is correct.`))}function focus(){$img.css({border:"1px solid #37a1ef"})}function blur(){$img.css({border:"1px dotted #2e2e2e"})}function inputChange(){_value.relative=$input.div.value,_value.relative.includes(".")&&(_this.value=Object.assign({},_value),_this.finish())}!function init(){_opts.value=Object.assign({src:"",relative:_opts.relative||"",prefix:_opts.prefix,filename:""},_opts.value),_value=Object.assign({},_opts.value),_this.init(_id,_opts)}(),function initView(){$view=$("view"),$view.css({position:"relative",padding:5}),$input=$view.create("path","input"),$input.size("100%").bg("#1D1D1D"),$input.css({boxSizing:"border-box",border:"1px solid #2E2E2E",color:"#37A1EF",marginBottom:5}),_this.value.relative?$input.div.value=_this.value.relative:$input.attr("placeholder","Relative Path"),$preview=$view.create("preview"),$preview.size("100%",60),$preview.css({boxSizing:"border-box",position:"relative",display:"flex",alignItems:"center",justifyContent:"center",overflow:"hidden"}),$img=$preview.create("img"),$img.size("100%"),$img.css({position:"absolute",top:0,right:0,bottom:0,left:0,backgroundSize:"cover",backgroundRepeat:"no-repeat",backgroundPosition:"center",border:"1px dotted #2e2e2e",boxSizing:"border-box"}),$picker=$preview.create("picker","input"),$picker.attr("type","file"),$picker.css({opacity:0,position:"absolute",top:0,right:0,bottom:0,left:0}),$progress=$preview.create("progress"),$progress.css({position:"absolute",bottom:0,height:10,left:0,background:"#9B9C9B"}),$$copy=$preview.create("copy"),$$copy.html("Drag file here<br><small>or Click to Select</small>"),$$copy.fontStyle("sans-serif",11,"#9B9C9B").css({textAlign:"center"}),$filepicker=$view.create("filepicker","button"),$filepicker.text("Experimental: Browse"),$filepicker.div.onclick=()=>{new UILExternalFilePicker(filePickerSelected,"geometries")},_this.view=$view,_value.src&&($img.attr("title",_value.src),$$copy.text(_value.filename))}(),function addHandlers(){$picker.div.addEventListener("change",change,!1),$picker.div.addEventListener("focus",focus,!1),$picker.div.addEventListener("blur",blur,!1),$input.div.addEventListener("change",inputChange,!1)}(),this.force=function(value,isClipboard){_value=Object.assign({},value),!0===isClipboard&&(_this.value=_value),$input.div.value=_value.relative,$img.attr("title",_value.src),$$copy.text(_value.filename)},this.onDestroy=function(){$picker.div.removeEventListener("change",change,!1),$picker.div.removeEventListener("focus",focus,!1),$picker.div.removeEventListener("blur",blur,!1),$input.div.removeEventListener("change",inputChange,!1)}})),Class((function UILControlImage(_id,_opts={value:{}}){Inherit(this,UILControl);const _this=this;let $view,$picker,$preview,$img,$input,$check,$compress,$delete,$progress,_value,$filepicker;function filePickerSelected(value){window.UIL_REMOTE&&console.warn("UIL_REMOTE is not supported when using file picker!");const v={compressed:!1,filename:value.split("/").last(),prefix:"assets/images",relative:"assets/images",src:"assets/images/"+value};_this.force(v,!0),_this.finish()}async function compressClick(){if(_value.src&&!_this.flag("compressPending")){_this.flag("compressPending",!0),$compress.bg("#f4ee42").text("---");try{"Error"==await Dev.execUILScript("compressktx",{src:_value.src.split("?")[0]})?$compress.bg("#f44141").html("Failed"):$compress.bg("#46f441").html("Success")}catch(e){$compress.bg("#f44141").html("Failed"),console.error(e)}_this.flag("compressPending",!1)}}function checkChange(){_this.value.compressed=_value.compressed=!!$check.div.checked,_this.finish(!1)}async function change(e){let file=$picker.div.files[0];if(!file)return;let name=file.name;if(window.UIL_REMOTE){const{customMetadata:customMetadata}=await UILStorage.uploadFileToRemoteBucket({file:file,progress:$progress});name=customMetadata.path}_value.filename=name,_value.relative=function getRelative(){return _value.filename.includes("http")?"":_value.relative.includes(_value.prefix)?_value.relative.replace(""+_value.prefix,""):_value.relative}(),_value.src=function getSrc(){return _value.filename.includes("http")?_value.filename:`${_value.prefix?_value.prefix+"/":""}${_value.relative?_value.relative+"/":""}${_value.filename}`}(),_value.compressed=!!$check.div.checked,await function imageExists(url){return!!url.includes("http")||(url=Assets.getPath(url),fetch(url).then((e=>404!=e.status)).catch((e=>console.warn("UILControlImage image url validation failed",e))))}(_value.src)?(_this.value=Object.assign({},_value),$picker.div.value="",$picker.attr("title",_value.src),$img.css({backgroundImage:`url(${Assets.getPath(_value.src)})`}),$delete.show(),_this.finish()):($picker.div.value="",console.warn("UIL: Could not find image",_value),alert(`"${_value.src}" not found!\nMake sure "relative path" is correct.`))}function deleteImage(){_value={src:"",relative:"",prefix:"assets/images",filename:""},$input.div.value="",$picker.div.value="",$picker.attr("title",null),$img.css({backgroundImage:""}),$delete.hide(),_this.value=Object.assign({},_value),_this.finish()}function focus(){$img.css({border:"1px solid #37a1ef"})}function blur(){$img.css({border:"1px dotted #2e2e2e"})}function inputChange(){_value.relative=$input.div.value}!function init(){_opts.value=Object.assign({src:"",relative:_opts.relative||"",prefix:_opts.prefix||"assets/images",filename:""},_opts.value),_value=Object.assign({},_opts.value),_this.init(_id,_opts)}(),function initView(){$view=$("view"),$view.css({position:"relative",padding:5}),$input=$view.create("path","input"),$input.size("100%").bg("#1D1D1D"),$input.css({boxSizing:"border-box",border:"1px solid #2E2E2E",color:"#37A1EF",marginBottom:5}),_this.value.relative?$input.div.value=_this.value.relative:$input.attr("placeholder","Relative Path"),$compress=$view.create("compress"),$compress.text("Compress").bg("#fff").css({top:3,width:70,height:15,textAlign:"center",borderRadius:5,position:"relative",float:"left",paddingTop:2}).fontStyle("sans-serif",11,"#000"),$check=$view.create("#compressed","input"),$check.attr("type","checkbox"),$check.size(20,20),$check.css({boxSizing:"border-box",position:"relative"}),$check.div.checked=!!_this.value.compressed;let $label=$view.create("compressed-label","label");$label.attr("for","compressed"),$label.text("Use Compressed").fontStyle("sans-serif",9,"#9B9C9B").css({top:-6,position:"relative"}),$preview=$view.create("preview"),$preview.size("100%",60),$preview.css({boxSizing:"border-box",position:"relative",display:"flex",alignItems:"center",justifyContent:"center",overflow:"hidden"}),$img=$preview.create("img"),$img.size("100%"),$img.css({position:"absolute",top:0,right:0,bottom:0,left:0,backgroundSize:"cover",backgroundRepeat:"no-repeat",backgroundPosition:"center",border:"1px dotted #2e2e2e",boxSizing:"border-box"}),$picker=$preview.create("picker","input"),$picker.attr("type","file"),$picker.attr("accept","image/*"),$picker.css({opacity:0,position:"absolute",top:0,right:0,bottom:0,left:0}),$progress=$preview.create("progress"),$progress.css({position:"absolute",bottom:0,height:10,left:0,background:"#9B9C9B"}),$delete=$preview.create("delete","button"),$delete.size(18,18).css({border:"none",padding:0,position:"absolute",top:8,right:8,borderRadius:"50%",background:"#1D1D1D",color:"#9B9C9B",textAlign:"center"}).html('<svg width="10" height="10" viewBox="0 0 10 10" fill="none" stroke="currentColor" xmlns="http://www.w3.org/2000/svg"><path stroke-width="2" stroke-linecap="round" d="M2 2l6 6M2 8l6-6"/></svg>'),$delete.hide();let copy=$preview.create("copy");copy.html("Drag image here<br><small>or Click to Select</small>"),copy.fontStyle("sans-serif",11,"#9B9C9B").css({textAlign:"center"}),_this.value.src&&($img.css({backgroundImage:`url('${Assets.getPath(_this.value.src)}')`}),$picker.attr("title",_this.value.src),$delete.show()),$filepicker=$view.create("filepicker","button"),$filepicker.text("Experimental: Browse"),$filepicker.div.onclick=()=>{new UILExternalFilePicker(filePickerSelected,"textures")},_this.view=$view}(),function addHandlers(){$picker.div.addEventListener("change",change,!1),$picker.div.addEventListener("focus",focus,!1),$picker.div.addEventListener("blur",blur,!1),$input.div.addEventListener("change",inputChange,!1),$delete.div.onclick=deleteImage,$compress.div.onclick=compressClick,$check.div.onchange=checkChange}(),this.force=function(value,isClipboard){_value=Object.assign({},value),!0===isClipboard&&(_this.value=_value),$input.div.value=_value.relative,$picker.div.value="",$picker.attr("title",_value.src),$img.css({backgroundImage:`url('${Assets.getPath(_value.src)}')`}),$check.div.checked=_value.compressed},this.onDestroy=function(){$picker.div.removeEventListener("change",change,!1),$picker.div.removeEventListener("focus",focus,!1),$picker.div.removeEventListener("blur",blur,!1),$input.div.removeEventListener("change",inputChange,!1)}})),Class((function UILControlNumber(_id,_opts={}){Inherit(this,UILControl);const _this=this;let _input;!function init(){_opts.value=_opts.value||0,_this.init(_id,_opts)}(),function initInput(){_input=_this.initClass(UILInputNumber,Object.assign(_opts,{value:_this.value})),_input.onInput((v=>_this.value=v)),_input.onFinish((v=>_this.finish())),_this.view=_input.input}(),this.update=function(value){_input.value=_this.value||0}})),Class((function UILControlRange(_id,_opts={}){Inherit(this,UILControl);const _this=this;let $view,$slider,_max=_opts.max||100,_min=_opts.min||0,_step=_opts.step||1;function change(){_this.finish()}function input(e){_this.value=Number($slider.div.value)}function focus(){$slider.css({border:"1px solid #37a1ef"})}function blur(){$slider.css({border:"1px solid #2e2e2e"})}!function init(){_opts.value=_opts.value||0,_this.init(_id,_opts)}(),function style(){UIL.addCSS(UILControlRange,"\n            .UILControlRange input { -webkit-appearance:none; appearance:none; }\n            .UILControlRange input::-webkit-slider-thumb { -webkit-appearance: none; }\n            .UILControlRange input::-webkit-slider-thumb { \n                -webkit-appearance:none; appearance:none;\n                width:15px; height:15px;\n                background:#FFF;\n                border-radius:15px;\n            }\n            .UILControlRange input::-moz-slider-thumb { \n                -webkit-appearance:none; appearance:none;\n                width:15px; height:15px;\n                background:#FFF;\n                border-radius:15px;\n            }\n        ")}(),function initView(){$view=$("view"),$slider=$view.create("range","input"),$slider.attr("type","range"),$slider.attr("max",_max),$slider.attr("min",_min),$slider.attr("step",_step),$slider.div.value=_this.value,$slider.css({width:"100%",margin:0,padding:0,background:"#1d1d1d",height:4,borderRadius:15,border:"1px solid #2e2e2e",boxSizing:"border-box"}),_this.view=$view}(),function addHandlers(){$slider.div.addEventListener("change",change,!1),$slider.div.addEventListener("input",input,!1),$slider.div.addEventListener("focus",focus,!1),$slider.div.addEventListener("blur",blur,!1)}(),this.force=function(value){_this.value=value,$slider.div.value=value,_this.finish(!1)},this.onDestroy=function(){$slider.div.removeEventListener("change",change,!1),$slider.div.removeEventListener("input",input,!1),$slider.div.removeEventListener("focus",focus,!1),$slider.div.removeEventListener("blur",blur,!1)}})),Class((function UILControlSelect(_id,_opts={}){Inherit(this,UILControl);const _this=this;let $view,$select,_options;function change(){_this.finish()}function input(){let i=$select.div.selectedIndex;_this.value=_options[i].value}function focus(){$select.css({border:"1px solid #37a1ef"})}function blur(){$select.css({border:"1px solid #2e2e2e"})}!function init(){if(!_opts.options)throw"UILControlSelect is missing select options";_opts.value=_opts.value||_opts.options[0].value,_this.init(_id,_opts)}(),function style(){UIL.addCSS(UILControlSelect,"\n            .UILControlSelect select { -webkit-appearance:none; appearance:none; }\n        ")}(),function initView(){$view=$("view"),$view.css({position:"relative"}),$select=$view.create("dropdown","select"),$select.css({width:"100%",margin:0,padding:0,background:"#1d1d1d",height:15,border:"1px solid #2e2e2e",boxSizing:"border-box",color:"#37a1ef",borderRadius:0,height:17}),$view.create("arrow").text("").css({color:"#37a1ef",fontSize:6,position:"absolute",right:8,top:7,pointerEvents:"none"}),_this.view=$view}(),function initOptions(){_options=_opts.options.map((({value:value,label:label})=>{let el=document.createElement("option");return el.setAttribute("value",value),_this.value===value&&el.setAttribute("selected",!0),el.text=label||value,el.value=value,$select.add(el),el})),$select.div.value=_this.value}(),function addHandlers(){$select.div.addEventListener("change",change,!1),$select.div.addEventListener("input",input,!1),$select.div.addEventListener("focus",focus,!1),$select.div.addEventListener("blur",blur,!1)}(),this.force=function(value){$select.div.value=value,_this.value=value},this.onDestroy=function(){$select.div.removeEventListener("change",change,!1),$select.div.removeEventListener("input",input,!1),$select.div.removeEventListener("focus",focus,!1),$select.div.removeEventListener("blur",blur,!1)}})),Class((function UILControlText(_id,_opts={}){Inherit(this,UILControl);const _this=this;let $input,_timeout;function onChange(v){clearTimeout(_timeout),_timeout=setTimeout(onFinishChange,400),_this.value=$input.div.value}function onFinishChange(){null!==_timeout&&(clearTimeout(_timeout),_timeout=null,_this.finish())}_this.init(_id,_opts),function initInput(){$input=$("input","input"),$input.size("100%").bg("#1D1D1D"),$input.css({boxSizing:"border-box",border:"1px solid #2E2E2E",color:"#37A1EF"}),_this.value&&($input.div.value=_this.value||""),_this.view=$input}(),function addHandlers(){$input.div.addEventListener("input",onChange,!1),$input.div.addEventListener("change",onFinishChange,!1)}(),this.update=function(){$input.div.value=_this.value||""},this.onDestroy=function(){$input.div.removeEventListener("input",onChange,!1),$input.div.removeEventListener("change",onBlur,!1)}})),Class((function UILControlTextarea(_id,_opts={}){Inherit(this,UILControl);const _this=this;let $input,_timeout;function onChange(v){clearTimeout(_timeout),_timeout=setTimeout(onFinishChange,400),_this.value=$input.div.value}function onFinishChange(){null!==_timeout&&(clearTimeout(_timeout),_timeout=null,_this.finish())}_this.init(_id,_opts),function initInput(){$input=$("input","textarea"),$input.attr("maxlength",_opts.max||1/0),$input.attr("minlength",_opts.min||-1/0),$input.attr("rows",_opts.rows||2),$input.attr("readonly",_opts.readonly||!1),$input.size("100%").bg("#1D1D1D"),$input.css({boxSizing:"border-box",resize:_opts.resize||"vertical",minWidth:_opts.minWidth||0,border:"1px solid #2E2E2E",color:"#37A1EF"}),(_opts.monospace||_opts.editor)&&$input.css({fontFamily:"monospace"}),_this.value&&($input.div.value=_this.value||""),_this.view=$input}(),_opts.editor&&function enableTab(){$input.div.onkeydown=function(e){if(9===e.keyCode){let val=this.value,start=this.selectionStart,end=this.selectionEnd;this.value=val.substring(0,start)+"\t"+val.substring(end),this.selectionStart=this.selectionEnd=start+1,e.preventDefault()}}}(),function addHandlers(){$input.div.addEventListener("input",onChange,!1),$input.div.addEventListener("change",onFinishChange,!1)}(),this.update=function(){$input.div.value=_this.value||""},this.onDestroy=function(){$input.div.removeEventListener("input",onChange,!1),$input.div.removeEventListener("change",onBlur,!1)}})),Class((function UILControlVector(_id,_opts={}){Inherit(this,UILControl);const _this=this;let $view,_length,_inputs=[],_vector=[];function onInput(value,index,master){master?_vector=_vector.map((v=>value)):_vector[index]=value,_this.value=[..._vector]}function onFinish(value,index,master){_this.finish()}!function init(){if(_opts.value)_length=_vector.length;else{if(!_opts.components)throw'UILControlVector: Cannot detect vector type. Define "options.components" count or init with a initial value';_opts.value=new Array(_opts.components).fill(0)}_length=_opts.value.length,_this.init(_id,_opts),_vector=[..._this.value]}(),function initInputs(){$view=$("inputs");for(let i=0;i<_length;i++){let input=_this.initClass(UILInputNumber,_opts);input.value=_this.value[i],input.onInput(((v,m)=>onInput(v,i,m))),input.onFinish(((v,m)=>onFinish(v,i,m))),input.input.css({display:"inline-block",width:`calc(100% / ${_length})`}),_inputs.push(input),$view.add(input.input)}_this.view=$view}(),this.force=function(value,history=!1){_vector=[...value],_this.value=[..._vector],_inputs.forEach(((input,index)=>input.value=_this.value[index])),_this.finish(history)},this.update=function(){_inputs.forEach(((input,index)=>input.value=_this.value[index]))}})),Class((function UILInputNumber(_opts={}){Inherit(this,Component);const _this=this;let $input,_timeout,_distance,_onMouseDownValue,_editing=!1,_precision=_opts.precision||3,_step=_opts.step||1,_min=_opts.min||-1/0,_max=_opts.max||1/0,_value=_opts.value||0,_pointer=[0,0],_prevPointer=[0,0],_onInputCB=()=>{},_onFinishCB=()=>{};function setValue(value){(value=parseFloat(value)||0)<_min&&(value=_min),value>_max&&(value=_max),_value=value,_onInputCB(value,_this.master)}function onBlur(){onFinishChange(),$input.div.value=parseFloat(_value).toFixed(_precision)}function onKeyUp(e){13===e.keyCode&&e.altKey&&(_this.master=!0,onInput())}function onInput(e){_timeout=setTimeout(onFinishChange,400),_editing=!0,setValue(parseFloat($input.div.value))}function onFinishChange(){_editing&&(_editing=!1,clearTimeout(_timeout),_onFinishCB(_value,_this.master),_this.master=!1)}function onMouseDown(e){(1===e.button||0===e.button&&e.metaKey||e.ctrlKey)&&(e.preventDefault(),$input.css({cursor:"col-resize"}),_distance=0,_onMouseDownValue=_value,_prevPointer=[e.screenX,e.screenY],document.addEventListener("mousemove",onMouseMove,!1),document.addEventListener("mouseup",onMouseUp,!1))}function onMouseMove(e){clearTimeout(_timeout),_editing=!0;let currentValue=_value;_pointer=[e.screenX,e.screenY],_distance+=_pointer[0]-_prevPointer[0]-(_pointer[1]-_prevPointer[1]);let value=_onMouseDownValue+_distance/(e.shiftKey?5:50)*_step;value=Math.min(_max,Math.max(_min,value)),_this.master=e.altKey,currentValue!==value&&function setValueDrag(value){void 0===value&&value===$input.div.value||(setValue(value),$input.div.value=_value.toFixed(_precision))}(value),_prevPointer=[e.screenX,e.screenY]}function onMouseUp(e){onFinishChange(),$input.css({cursor:""}),document.removeEventListener("mousemove",onMouseMove,!1),document.removeEventListener("mouseup",onMouseUp,!1)}!function initInput(){$input=$("input","input"),$input.attr("type","number"),$input.attr("step",_step),$input.size("100%").bg("#1D1D1D"),$input.css({boxSizing:"border-box",border:"1px solid #2E2E2E",color:"#37A1EF",boxShadow:"none"}),$input.div.value=parseFloat(_value).toFixed(_precision),_this.input=$input}(),function addHandlers(){$input.div.addEventListener("mousedown",onMouseDown,!1),$input.div.addEventListener("keyup",onKeyUp,!1),$input.div.addEventListener("change",onFinishChange,!1),$input.div.addEventListener("blur",onBlur,!1),$input.div.addEventListener("input",onInput,!1)}(),this.set("value",(value=>{_value=value,_editing||($input.div.value=parseFloat(value).toFixed(_precision))})),this.get("value",(()=>_value)),this.onInput=cb=>_onInputCB=cb,this.onFinish=cb=>_onFinishCB=cb,this.onDestroy=function(){$input.div.removeEventListener("mousedown",onMouseDown,!1),$input.div.removeEventListener("change",onFinishChange,!1),$input.div.removeEventListener("blur",onBlur,!1),$input.div.removeEventListener("input",onInput,!1)}})),Class((function UILExternalColor(_title,_value){Inherit(this,Component);const _this=this;var _window;function onReload(){_this.onDestroy()}(_window=window.open(location.protocol+"//localhost/hydra/editor/color/index.html","hydra_color_"+_title,"width=480,height=220,left=200,top=100,location=no")).window.onload=_=>{_window.window.initPicker(_title,_value,_this)},window.addEventListener("beforeunload",onReload),this.update=function(value){_this.events.fire(Events.UPDATE,{value:value})},this.onDestroy=function(){window.removeEventListener("beforeunload",onReload),_window&&_window.window&&_window.window.close()}})),Class((function UILExternalEditor(_title,_height=500,_width=700){Inherit(this,Component);const _this=this;var _window,_code,_language;_window=window.open(location.protocol+"//localhost/hydra/editor/code/index.html","_blank",`width=${_width},height=${_height},left=200,top=100`),_this.events.sub(Events.UNLOAD,(_=>_window.close())),_window.window.onload=_=>{_window.window.initEditor(_title,_code,_language,_this)},this.setCode=function(code,language){_code=code,_language=language},this.saved=async function(code){_this.onSave&&_this.onSave(code),await defer(),UILStorage.write()}})),Class((function UILPanelToolbar(){Inherit(this,Element);const _this=this;let $this,$filter,_state=new Map;function restoreFolderState(){_this.parent.folder.forEachFolder((folder=>{_state.get(folder)?folder.open():folder.close()})),_state.clear()}function onInput(e){if(!$filter.div.value.length)return restoreFolderState(),_this.parent.folder.showChildren();_this.parent.folder.filter($filter.div.value)}function onFocus(){!function saveFolderState(){_this.parent.folder.forEachFolder((folder=>{_state.set(folder,folder.isOpen())}))}(),$filter.css({border:"1px solid #37a1ef"})}function onBlur(){$filter.css({border:"1px solid #2e2e2e"})}function onKeyPressed(e){if(27===e.keyCode)return $filter.div.value="",restoreFolderState(),_this.parent.folder.showChildren()}!function initHTML(){$this=_this.element,$this.size("100%","auto").bg("#272727"),$this.css({padding:4,boxSizing:"border-box",marginBottom:4})}(),function initFilter(){$filter=$this.create("filter","input"),$filter.div.addEventListener("input",onInput,!1),$filter.div.addEventListener("keydown",onKeyPressed,!1),$filter.div.addEventListener("focus",onFocus,!1),$filter.div.addEventListener("blur",onBlur,!1),$filter.size("100%","auto").bg("#161616"),$filter.css({color:"#B1B1B1",border:"1px solid #2e2e2e",outline:"none",padding:2,boxSizing:"border-box"})}(),this.eliminate=function(){$filter.div.removeEventListener("input",onInput,!1),$filter.div.removeEventListener("keydown",onKeyPressed,!1),$filter.div.removeEventListener("focus",onFocus,!1),$filter.div.removeEventListener("blur",onBlur,!1)},this.filter=function(text){$filter.div.value=text,onInput()},this.filterSingle=function(text){$filter.div.value=text,_this.parent.folder.filterSingle($filter.div.value)},this.hideAll=function(){_this.flag("init")||(_this.flag("init",!0),this.filterSingle("xxxxxx"))}})),Class((function Video(_params){Inherit(this,Component);const _this=this;let $video,_video,_loadingState,_handlers,_ready=Promise.create(),_loaded=Promise.create(),_initialPlay=!0;function startPreload(){return _loadingState=!0,_video.load(),_ready}async function startPlayback(){if(!_this.playing&&(_loadingState=!1,_video.readyState<2&&(_video.load(),await _ready),!_this.playing)){_initialPlay&&(_initialPlay=!1,_params.currentTime&&(_video.currentTime=_params.currentTime)),_this.playing=!0;try{return await _video.play()}catch(error){throw _this.playing=!1,error}}}function getSource(src=""){return src&&!src.includes(["webm","mp4","ogv","blob","?"])&&(src+="."+Device.media.video),src}function progress(e){_this.events.fire(Video.PROGRESS,e)}function timeupdate(e){_this.events.fire(Video.UPDATE,e)}function play(e){if(_loadingState)return _loadingState=!1;_this.events.fire(Video.PLAY,e)}function pause(e){_this.events.fire(Video.PAUSE,e)}function playing(e){_this.events.fire(Video.PLAYING,e)}function ended(e){_this.events.fire(Video.ENDED,e)}function waiting(e){_this.events.fire(Video.WAITING,e)}function canplay(e){loadeddata(),_this.events.fire(Video.CANPLAY,e)}function loadedmetadata(e){_this.dimensions.width=_video.videoWidth,_this.dimensions.height=_video.videoHeight,_this.events.fire(Video.LOADEDMETADATA,e)}function loadeddata(e){_video.readyState>=2&&_ready.resolve(),_video.readyState>=4&&_loaded.resolve()}function error(){_this.playing&&(_this.playing=!1),_this.events.fire(Video.ERROR,_video.error)}!function initParam(){let defaults={muted:!0,loop:!1,autoplay:!1,inline:!0,controls:!1,currentTime:0,playback:1,preload:!1,width:640,height:360,events:[],disableRemotePlayback:!0};_params=Object.assign(defaults,_params)}(),function init(){return _video=document.createElement("video"),_params.src&&(_video.src=getSource(_params.src)),_video.setAttribute("crossorigin","anonymous"),_video.disableRemotePlayback=_params.disableRemotePlayback,_video.autoplay=_params.autoplay,_video.loop=_params.loop,_video.controls=_params.controls,_video.height=_params.height,_video.width=_params.width,_video.defaultMuted=_params.muted,_video.defaultPlaybackRate=_params.playback,_video.preload="string"==typeof _params.preload?_params.preload:_params.preload?"auto":"none",_video.muted=_params.autoplay||_params.muted,_video.setAttribute("webkit-playsinline",_params.inline),_video.setAttribute("playsinline",_params.inline),_this.dimensions={width:_params.width,height:_params.height},_video.autoplay&&_video.setAttribute("autoplay",_params.autoplay),_video.setAttribute("muted",_params.muted),_params.loop&&_video.setAttribute("loop",_params.loop),_this.div=_video,$video=$(_video),_params.autoplay?startPlayback():_params.preload?startPreload():void 0}(),function addHandlers(){["loadedmetadata","loadeddata","error"].forEach((ev=>{_params.events.includes(ev)||_params.events.push(ev)})),_handlers={play:play,pause:pause,ended:ended,playing:playing,progress:progress,waiting:waiting,timeupdate:timeupdate,loadedmetadata:loadedmetadata,loadeddata:loadeddata,canplay:canplay,error:error},_params.events.forEach((ev=>_video.addEventListener(ev,_handlers[ev],!0))),_this.events.sub(Video.CHANGE_VOLUME,(_options=>{_this.div.volume=_options.volume}))}(),this.set("loop",(bool=>_video.loop=bool)),this.get("loop",(()=>_video.loop)),this.set("src",(src=>{(src=getSource(src))!==_video.src&&(_ready=Promise.create(),_loaded=Promise.create(),_video.src=src,_this.playing?(_this.playing=!1,startPlayback()):_params.preload&&startPreload())})),this.get("src",(()=>_video.currentSrc)),this.set("volume",(v=>{_video.muted=0===v,_video.volume=v})),this.get("volume",(()=>_video.volume)),this.set("muted",(bool=>_video.muted=bool)),this.get("muted",(()=>_video.muted)),this.set("controls",(bool=>_video.controls=bool)),this.get("controls",(()=>_video.controls)),this.get("duration",(()=>_video.duration)),this.get("ended",(()=>_video.ended)),this.get("playback",(()=>_video.playbackRate)),this.get("time",(()=>_video.currentTime)),this.get("error",(()=>_video.error)),this.get("canRender",(()=>_video.readyState>=2)),this.get("canPlayThrough",(()=>_video.readyState>=4)),this.get("paused",(()=>_video.paused)),this.get("element",(()=>$video)),this.get("object",(()=>$video)),this.get("video",(()=>_video)),this.get("bufferedSeconds",(_=>_video.readyState<2?0:_video.buffered.end(0)-_video.buffered.start(0))),this.load=async function(){return startPreload()},this.play=async function(){return startPlayback()},this.pause=function(){_this.playing=!1,_video.pause()},this.stop=function(){_this.playing=!1,_video.pause(),_this.seek(0)},this.seek=function(t){if(_video.fastSeek)return _video.fastSeek(t);_video.currentTime=t},this.seekExact=function(t){_video.currentTime=t},this.ready=function(){return _ready},this.loaded=function(){return _loaded},this.onDestroy=function(){_this.stop(),_video.src="",function removeListeners(){_params.events.forEach((ev=>_video.removeEventListener(ev,_handlers[ev],!0)))}(),_video=null},this.setSize=function(width,height){_video.width=width,_video.height=height,_this.dimensions.width=width,_this.dimensions.height=height}}),(()=>{Video.PLAY="hydra_video_play",Video.CANPLAY="hydra_video_can_play",Video.LOADEDMETADATA="hydra_video_loaded_metadata",Video.PAUSE="hydra_video_pause",Video.PROGRESS="hydra_video_progress",Video.UPDATE="hydra_video_update",Video.PLAYING="hydra_video_playing",Video.ENDED="hydra_video_ended",Video.WAITING="hydra_video_waiting",Video.ERROR="hydra_video_error",Video.CHANGE_VOLUME="hydra_video_change_volume"})),Class((function VideoTexture(_path,{loop:loop=!0,preload:preload=!0,autoplay:autoplay=!0,muted:muted=!0,firstFrame:firstFrame=!1,parseColor:parseColor=!1,events:events=[]}={}){Inherit(this,Component);const _this=this;let _video,_hasRequestCallback=!1;function update(){_video.canRender&&(_this.videoTexture&&(_this.texture.destroy(),_this.texture=_this.videoTexture,delete _this.videoTexture),_this.texture.image||(_this.texture.image=_video.video,_this.texture.upload()),_this.colorParser&&_this.colorParser.update(_video.time),_this.texture.loaded=_this.texture.needsUpdate=!0),_hasRequestCallback&&_video.element.div.requestVideoFrameCallback(update)}!function(){let src=_path.includes("blob")?_path:Assets.getPath(_path);if(_path.includes(["jpg","png"])){let noop=_=>{};_this.texture=Utils3D.getTexture(src),_this.video={play:noop,pause:noop},parseColor&&(_this.colorParser=_this.initClass(VideoTextureColorParser,src,!0))}else{let videoEvents=["timeupdate","playing","ended"];events.forEach((ev=>{videoEvents.includes(ev)||videoEvents.push(ev)})),_video=_this.initClass(Video,{src:src,loop:loop,preload:preload,autoplay:autoplay,muted:muted,events:videoEvents}),_this.texture=new Texture,_this.texture.format=Texture.RGBFormat,_this.texture.minFilter=_this.texture.magFilter=Texture.LINEAR,_this.texture.generateMipmaps=!1,_this.texture.loaded=!1,_this.video=_video,_this.dimensions=_video.dimensions,_this.texture.dimensions=_this.dimensions,_this.events.bubble(_video,Video.PLAYING),parseColor&&(_this.colorParser=_this.initClass(VideoTextureColorParser,src,!1)),firstFrame&&(_this.videoTexture=_this.texture,_this.texture=Utils3D.getTexture(firstFrame))}_hasRequestCallback="requestVideoFrameCallback"in HTMLVideoElement.prototype}(),this.set("loop",(loop=>_video.loop=loop)),this.set("muted",(muted=>_video.muted=muted)),this.set("src",(src=>{_video.src=src.includes("blob")?src:Assets.getPath(src),_hasRequestCallback&&_video.element.div.requestVideoFrameCallback(update)})),this.start=async function(){_video&&(_this.active=!0,await _video.play(),_hasRequestCallback?(_video.element.div.requestVideoFrameCallback(update),_this.startRender((_=>{}),30)):_this.startRender(update,30))},this.stop=function(){_video&&(_this.active=!1,_video.pause(),_hasRequestCallback?_video.element.div.cancelVideoFrameCallback(update):_this.stopRender(update))},this.seek=function(time){_video&&_video.seek(time)},this.onInvisible=function(){_this.active&&_video.pause(),VideoTexture.element().removeChild(_this.video.object,!0)},this.onVisible=function(){_this.active&&_video.play(),VideoTexture.element().add(_this.video.object)},this.onDestroy=function(){_this.texture.destroy(),VideoTexture.element().removeChild(_this.video.object,!0)}}),(_=>{var $element;VideoTexture.element=function(){return $element||(($element=Stage.create("VideoTextures")).size(0,0).setZ(-1),Stage.add($element)),$element}})),Class((function VideoTextureColorParser(_path,_static){Inherit(this,Component);const _this=this;var _colorData,_color=new Color;this.color=new Color,this.lerp=1,async function(){let path=_path.split(".")[0]+".json";_colorData=await get(path)}(),this.update=function(time){if(_colorData)for(let key in _colorData)if(time<=key){_color.set("#"+_colorData[key]),_this.color.lerp(_color,_this.lerp);break}}})),Class((function SocketConnection(_server,_channel){Inherit(this,Component);var _socket,_pingPong,_this=this,_fail=0,_binary={},_time=Render.TIME;function connect(){_this.pending=!1,(_socket=new WebSocket(_server,["permessage-deflate"])).binaryType="arraybuffer",_socket.onopen=open,_socket.onmessage=message,_socket.onclose=close,_socket.onerror=close}function sendPing(){_socket&&_socket.readyState==WebSocket.OPEN&&_socket.send("ping")}function checkIfConnected(){_this.blocked||_this.connected||(_this.blocked=!0,_this.events.fire(SocketConnection.BLOCKED))}function open(e){_fail=0,_this.connected=!0,_this.events.fire(SocketConnection.OPEN,{socket:_this},!0),_channel&&_this.send("register",{channel:_channel}),_pingPong=setInterval(sendPing,5e3)}function message(e){if("pong"!=e.data&&"ping"!=e.data)if("string"==typeof e.data)try{let data=JSON.parse(e.data),evt=data._evt;evt?(delete data._evt,_this.events.fire(evt,data,!0)):(_binary.data=data,_this.events.fire(SocketConnection.BINARY,_binary))}catch(er){}else _binary.data=e.data,_this.events.fire(SocketConnection.BINARY,_binary)}function close(e){if(Render.TIME-_time<50&&!_this.blocked)return _this.blocked=!0,_this.events.fire(SocketConnection.BLOCKED);_this.pending||_fail++>250||(_this.connected=!1,_this.pending=!0,_this.events.fire(SocketConnection.CLOSE,{socket:_this},!0),_this.timer=_this.delayedCall(connect,250),clearTimeout(_pingPong))}this.connected=!1,async function(){try{connect(),_this.flag("ready")||_this.delayedCall(checkIfConnected,2e4),_this.flag("ready",!0)}catch(e){await defer(),_this.events.fire(SocketConnection.ERROR,{socket:_this}),_this.timer=_this.delayedCall(connect,250)}}(),this.send=function(evt,data={}){if(!_this.connected)return _this.delayedCall((_=>_this.send(evt,data)),100);data._evt=evt,_socket&&_socket.readyState==WebSocket.OPEN&&_socket.send(null!=data.length?data:JSON.stringify(data))},this.sendBinary=function(data){_socket&&_socket.readyState==WebSocket.OPEN&&_socket.bufferedAmount<1024&&_socket.send("binary:"+(null!=data.length?data:JSON.stringify(data)))},this.close=function(){_socket.onclose=null,_socket.onerror=null,clearTimeout(_this.timer),_socket.close()}}),(_=>{SocketConnection.OPEN="socket_connection_open",SocketConnection.CLOSE="socket_connection_close",SocketConnection.ERROR="socket_connection_error",SocketConnection.BINARY="socket_connection_binary",SocketConnection.BLOCKED="socket_connection_blocked"})),Class((function AvatarProfileGrid(_config={count:256,resolution:2048}){Inherit(this,Component);const _this=this;var _capture,$root,$debug,_connectedUniform="uConnected",_statusUniform="uStatus",_grid=[];function loop(){for(let i=_grid.length-1;i>-1;i--){let obj=_grid[i];obj.needsUpdate&&(obj.needsUpdate=!1,obj.show(),defer((_=>obj.hide())))}}async function playerJoin({player:player}){if(_this._invisible)return;if(!player.view)return;if(await player.view.ready(),!player.view)return;if(player.gcPlayer&&!player.gcPlayer.me&&!_this.parent.multiplayerConfig?.roomKey)return;let mesh=player.view.mesh,index=mesh.batchIndex||0;$debug?.show();player.bindProfileImage=player.state.bind("image",(async _=>{(async player=>{if(!player||!player.state)return;let photo=player.state.get("image")||player.state.get("profileImage")||player.state.get("profile_photo")||"~assets/images/avatar/placeholder.png",obj=_grid[index];obj&&(obj.bg(photo),obj.show(),obj.staticTexture=obj.shader.get("tMap"),obj.staticTexture&&(await obj.staticTexture.promise,obj.needsUpdate=!0))})(player)})),player.bindSpeaking=player.state.bind("gcmedia_speaking",(speaking=>{const status=mesh.shader.get(_statusUniform);status&&(status.y=speaking?1:0)})),player.bindMuteAudio=player.state.bind("gcmedia_mute_audio",(speaking=>{const status=mesh.shader.get(_statusUniform);status&&(status.y=0)}))}function playerLeave({player:player}){if(_this._invisible)return;player.bindProfileImage?.destroy?.(),player.bindSpeaking?.destroy?.(),player.bindMuteAudio?.destroy?.();let mesh=player.view.mesh;if(!mesh)return;let index=mesh.batchIndex,obj=_grid[index];obj.usingVideo&&obj.hide()}!function initCapture(){_capture=_this.initClass(StageLayoutCapture,_config.resolution,_config.resolution,null,!0),$root=_capture.root,_capture.disableClear=!0,_capture.scene.disableAutoSort=!0,_this.rt=_capture.rt}(),function initGrid(){let x=0,y=0,size=_config.resolution/Math.sqrt(_config.count);for(let i=0;i<_config.count;i++){let $obj=$root.create(size,size,"#000000");$obj.x=x,$obj.y=y,$obj.hide(),_grid.push($obj),x+=size,x>=_config.resolution&&(x=0,y+=size)}}(),function addListeners(){_this.events.sub(Player.JOIN,playerJoin),_this.events.sub(Player.LEAVE,playerLeave)}(),Utils.query("debugAvatarGrid")&&($debug=$gl(512,512,_capture),GLUI.Stage.add($debug),$debug.setZ(9999)),_this.startRender(loop),this.addVideo=function(videoObj){let player=videoObj.player;if(!player.view)return;let mesh=player.view.mesh,index=mesh.batchIndex,obj=_grid[index];const status=mesh.shader.get(_statusUniform);videoObj.gcPlayer.me&&mesh.batch?.mesh.shader.set(_connectedUniform,1),status&&(status.x=1),videoObj.media&&_this.wait(videoObj.media,"videoTexture").then((_=>{obj.usingVideo=!0,obj.bg(videoObj.media.videoTexture),obj.show(),player.bindMuteVideo=player.state.bind("gcmedia_mute_video",(muted=>{muted?(obj.bg(obj.staticTexture.src),obj.staticTexture=obj.shader.get("tMap"),obj.usingVideo=!1,obj.needsUpdate=!0):(obj.usingVideo=!0,obj.bg(videoObj.media.videoTexture),obj.show())}))}))},this.removeVideo=function(videoObj){let player=videoObj.player;if(!player.view)return;let mesh=player.view.mesh;const status=mesh.shader.get(_statusUniform);status&&(status.x=0,mesh.shader.set(_statusUniform,status));let index=mesh.batchIndex,obj=_grid[index];videoObj.gcPlayer.me&&(status&&(status.y=0),_connectedUniform&&mesh.batch?.mesh.shader.set(_connectedUniform,0)),obj.usingVideo=!1,obj.bg(obj.staticTexture.src),obj.staticTexture=obj.shader.get("tMap"),obj.needsUpdate=!0,player.bindMuteVideo?.destroy?.()},this.removeAllVideo=function(){for(let i=0;i<_grid.length;i++){let obj=_grid[i];obj.usingVideo&&(obj.usingVideo=!1,obj.bg(obj.staticTexture),obj.needsUpdate=!0)}},this.setStatusUniform=function(key="uStatus"){return _statusUniform=key,this},this.setConnectedUniform=function(key="uConnected"){return _connectedUniform=key,this},this.reset=function(){_grid[0].bg(PlayerModel.get("image")||PlayerModel.get("profileImage")||PlayerModel.get("profile_image")||"assets/images/_scenelayout/uv.jpg"),_grid[0].show();for(let i=1;i<_grid.length;i++){let image=_grid[i].shader.get("tMap");image&&image.destroy?.(),_grid[i].hide()}$debug?.hide()},this.handleKickParticipant=function(playerId){},this.hide=function(){$debug?.hide()}})),Class((function GlobalConfig(){Inherit(this,Component);var _uil=this.isPlayground()?void 0:null,_map={};function create(name,obj){let uil=InputUIL.create(name,_uil);uil.cache={},_map[name]=uil.cache;for(let key in obj)"number"==typeof obj[key]?(uil.add(key,obj[key]),uil.cache[key]=uil.getNumber(key)):(uil.addVector(key,obj[key]),uil.cache[key]=uil.get(key))}Utils.query("noGlobalConfig")||(create("controls",{moveStep:1,playerLerp:1,wrapperLerp:1,jumpStrength:1,jumpReturnLerp:1,jumpGravity:.1}),create("1st_person",{position:[0,0,0],groupPos:[0,0,0],fov:40,moveXY:[-.8,.8]}),create("3rd_person",{position:[0,0,0],groupPos:[0,0,0],fov:40,moveXY:[.8,.8]})),this.getConfig=function(key){return _map[key]}}),"singleton"),Class((function Breakpoints(){Inherit(this,Component);Object.assign(this,{desktop:1500,tabLand:1200,tabPort:960,phone:600}),this.getSize=function(checkPhoneOrientation=!1,checkTabletOrientation=!1){const height=window.innerHeight,width=window.innerWidth;return checkPhoneOrientation&&Device.mobile.phone&&width<height?"phone-portrait":checkPhoneOrientation&&Device.mobile.phone&&width>height?"phone-landscape":checkTabletOrientation&&Device.mobile.tablet&&width<height?"tab-portrait":checkTabletOrientation&&Device.mobile.tablet&&width>height?"tab-landscape":width<=this.phone?"phone":width<=this.tabPort?"tab-port":width<=this.tabLand?"tab-land":width<=this.desktop?"desktop":"big-desktop"}}),"static"),Class((function Colors(){Inherit(this,Component);const _this=this;Object.assign(this,{white:"#ffffff",black:"#000000",on:"#55b750",off:"#D9310B",monochrome:["#EEEEEE","#e5e5e5","#d3d3d3","#aaaaaa","#838383","#747474","#5e5e5e","#e8e8e8","#2e2e2e"],primary:["#6D7278","#C2C0C0","#A7A7A7","#4E596D","#354253"],secondary:["#6D7278","#C2C0C0","#A7A7A7","#4E596D","#354253"],tertiary:["#6D7278","#C2C0C0","#A7A7A7","#4E596D","#354253"],red:["#FF3F02"],blue:["#1B81F9"],yellow:["#FFC539"]}),this.inverse=function(color){switch(color){case _this.white:return _this.black;case _this.black:return _this.white;case _this.blue:return _this.orange}}}),"static"),Class((function DateUtil(){Inherit(this,Component);const _this=this;var _token=/d{1,4}|m{1,4}|yy(?:yy)?|([HhMsTt])\1?|[LloSZ]|"[^"]*"|'[^']*'/g,_timezone=/\b(?:[PMCEA][SDP]T|(?:Pacific|Mountain|Central|Eastern|Atlantic) (?:Standard|Daylight|Prevailing) Time|(?:GMT|UTC)(?:[-+]\d{4})?)\b/g,_timezoneClip=/[^-+\dA-Z]/g;const MASKS={default:"ddd mmm dd yyyy HH:MM:ss",shortDate:"m/d/yy",mediumDate:"mmm d, yyyy",longDate:"mmmm d, yyyy",fullDate:"dddd, mmmm d, yyyy",shortTime:"h:MM TT",mediumTime:"h:MM:ss TT",longTime:"h:MM:ss TT Z",isoDate:"yyyy-mm-dd",isoTime:"HH:MM:ss",isoDateTime:"yyyy-mm-dd'T'HH:MM:ss",isoUtcDateTime:"UTC:yyyy-mm-dd'T'HH:MM:ss'Z'"},i18n={dayNames:["Sun","Mon","Tue","Wed","Thu","Fri","Sat","Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],monthNames:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec","January","February","March","April","May","June","July","August","September","October","November","December"]};function pad(val,len){for(val=String(val),len=len||2;val.length<len;)val="0"+val;return val}this.format=function(date,mask,utc,local=!1){if(1!=arguments.length||"[object String]"!=Object.prototype.toString.call(date)||/\d/.test(date)||(mask=date,date=void 0),date=date?new Date(date):new Date,local&&(date=new Date(_this.getLocalTime(date))),isNaN(date))throw SyntaxError("invalid date");"UTC:"==(mask=String(MASKS[mask]||mask||MASKS.default)).slice(0,4)&&(mask=mask.slice(4),utc=!0);var _=utc?"getUTC":"get",d=date[_+"Date"](),D=date[_+"Day"](),m=date[_+"Month"](),y=date[_+"FullYear"](),H=date[_+"Hours"](),M=date[_+"Minutes"](),s=date[_+"Seconds"](),L=date[_+"Milliseconds"](),o=utc?0:date.getTimezoneOffset(),flags={d:d,dd:pad(d),ddd:i18n.dayNames[D],dddd:i18n.dayNames[D+7],m:m+1,mm:pad(m+1),mmm:i18n.monthNames[m],mmmm:i18n.monthNames[m+12],yy:String(y).slice(2),yyyy:y,h:H%12||12,hh:pad(H%12||12),H:H,HH:pad(H),M:M,MM:pad(M),s:s,ss:pad(s),l:pad(L,3),L:pad(L>99?Math.round(L/10):L),t:H<12?"a":"p",tt:H<12?"am":"pm",T:H<12?"A":"P",TT:H<12?"AM":"PM",Z:utc?"UTC":(String(date).match(_timezone)||[""]).pop().replace(_timezoneClip,""),o:(o>0?"-":"+")+pad(100*Math.floor(Math.abs(o)/60)+Math.abs(o)%60,4),S:["th","st","nd","rd"][d%10>3?0:(d%100-d%10!=10)*d%10]};return mask.replace(_token,(function($0){return $0 in flags?flags[$0]:$0.slice(1,$0.length-1)}))},this.simpleFormat=function(date){return new Date(date).toLocaleTimeString(navigator.language,{hour:"2-digit",minute:"2-digit"})},this.convertToFullDate=function(time,options){let format=options||{weekday:"long",year:"numeric",month:"long",day:"numeric"};return("function"==typeof time.getMonth?time:new Date(time)).toLocaleDateString("en-us",format)},this.addMinutes=function(date,minutes){let time="function"==typeof date.getMonth?date:new Date(date);return new Date(time.getTime()+6e4*minutes)},this.differenceInMinutes=function(start,end,abs=!0){let value=abs?Math.abs(start-end):start-end;return Math.floor(value/1e3/60)},this.getLocalTime=function(date){let newDate=new Date(date),offset=date.getTimezoneOffset()/60,hours=date.getHours();return newDate.setHours(hours-offset),newDate}}),"static"),Class((function Fonts(){Inherit(this,Component);Object.assign(this,{css:{nimbus:"nimbus-sans, sans-serif"}})}),"static"),Class((function RWD(){Inherit(this,Component);const _this=this;var _androidSize={};function isMobile(){let width,height,isPhone=Device.mobile&&Device.mobile.phone,isTablet=Device.mobile&&Device.mobile.tablet;if(isPhone)return!0;if("undefined"==typeof Stage?(width=window.innerWidth,height=window.innerHeight):(width=Stage.width,height=Stage.height),isTablet){return!(90===window.orientation||-90===window.orientation)}return height>width||width<=900}function resize(){if(isMobile()?(document.body.classList.add("rwd-isMobile"),document.body.classList.remove("rwd-isDesktop")):(document.body.classList.add("rwd-isDesktop"),document.body.classList.remove("rwd-isMobile")),Device.mobile.phone&&"android"==Device.system.os)if(_androidSize.height)_this.isLandscape()?__body.size("100%"):__body.size(_androidSize.width,_androidSize.height);else if(!_this.isLandscape()){let viewport=document.querySelector("meta[name=viewport]"),content=viewport.getAttribute("content");content=content.replace("width=device-width",`width=${Stage.width}, height=${Stage.height}`),viewport.setAttribute("content",content),_androidSize.width=Stage.width,_androidSize.height=Stage.height,__body.size(Stage.width,Stage.height)}}!async function(){await Hydra.ready(),defer((()=>{_this.onResize(resize)}))}(),this.get("isMobile",(()=>isMobile())),this.isLandscape=function(){if("android"==Device.system.os)return 0!=window.orientation;return window.innerWidth>window.innerHeight}}),"static"),Class((function Styleguide(){Inherit(this,Component);const _this=this;function sg(fontName,fontSize,lineHeight,letterSpacing="0"){return{position:"relative",fontFamily:Fonts.css[fontName],fontSize:fontSize,lineHeight:lineHeight,letterSpacing:letterSpacing,fontStyle:"normal",fontWeight:"normal"}}$.fn.style=function(name,color="black"){let style=_this[name];return style.color=Colors[color],this.div.classList?this.div.classList.contains(name)||this.div.classList.add(name):this.div.className+=" "+name,this._styleName=name,this.css(style),this},$.fn.bold=function(){return this.css({fontWeight:"700"}),this},$.fn.black=function(){return this.css({fontWeight:"900"}),this},this.get("h1",(()=>{let style=sg("nimbus",53,"120%","-.5px");return RWD.isMobile&&Object.assign(style,{fontSize:46}),style})),this.get("h2",(()=>{let style=sg("nimbus",40,"120%","-.5px");return RWD.isMobile&&Object.assign(style,{fontSize:36}),style})),this.get("h3",(()=>{let style=sg("nimbus",34,"120%");return RWD.isMobile&&Object.assign(style,{fontSize:28}),style})),this.get("h4",(()=>sg("nimbus",24,"120%","-.5px"))),this.get("h5",(()=>sg("nimbus",20,"120%","-.3px"))),this.get("p1",(()=>sg("nimbus",16,"120%"))),this.get("p2",(()=>sg("nimbus",15,"120%","-.3px"))),this.get("label1",((isBold=!1)=>{let style=sg("nimbus",13,"120%",".5px");return isBold&&Object.assign(style,{fontWeight:"700"}),style})),this.get("label2",(()=>sg("nimbus",14,"120%"))),this.get("label3",((isBold=!1)=>{let style=sg("nimbus",15,"120%","-.1px");return isBold&&Object.assign(style,{fontWeight:"700"}),style})),this.get("label4",(()=>sg("nimbus",16,"120%"))),this.get("label5",(()=>sg("nimbus",18,"120%","-.2px"))),this.get("button",(()=>{let style=sg("nimbus",15,"120%",".5px");return Object.assign(style,{fontWeight:"700",textTransform:"uppercase"}),style})),this.get("icon",(()=>{let style={width:"2.5rem",height:"2.5rem",position:"relative"};return RWD.isMobile&&Object.assign(style,{width:"2rem",height:"2rem"}),style}))}),"static"),Class((function BroadcastListener(){const _this=this;var _pin;function completePin(){if(!_pin)return;let channel=_pin.channel;delete _pin.channel,_this.broadcasts.set(channel,_pin)}function handlePin(e){let msg=e.message.message||e.message;msg.channel&&(_pin=msg),Utils.debounce(completePin,250)}_this.broadcasts=AppState.createLocal(),function addListeners(){_this.events.sub(Multiplayer.PIN,handlePin)}()})),Class((function EnvironmentBVHCollider(_hit){Inherit(this,Component);const _this=this;var _raycaster=new RayManager,_obj={};let _mouse=new Vector2;var _v0=new Vector3,_v1=new Vector3,_v2=new Vector3,_v3=new Vector3,_l0=new Line3,_l1=new Line3,_b=new Box3;const DOWN=new Vector3(0,-1,0);var _shapecast={intersectsBounds:function intersectsBounds(box){return box.intersectsBox(_b)},intersectsTriangle:function intersectsTriangle(tri){let triPoint=_v0,capsulePoint=_v1,distance=tri.closestPointToSegment(_l0,triPoint,capsulePoint);if(distance<_this.capsule.radius){_this.hasCollided=!0;const isStartPoint=capsulePoint.equals(_l0.start),depth=_this.capsule.radius-distance,direction=capsulePoint.sub(triPoint).normalize();_l0.start.addScaledVector(direction,depth),_l0.end.addScaledVector(direction,depth),isStartPoint&&direction.y>0&&(_v2.copy(tri.b).sub(tri.a),_v3.copy(tri.c).sub(tri.a),_v2.cross(_v3).normalize(),_v2.y>.65&&(_shapecast.physics.isOnFloor=!0))}}};_this.hit=_hit,_this.movingHits=[],_this.hasCollided=!1,function(){_raycaster.firstHitOnly=!0;_this.capsule={radius:.425,segment:new Line3(new Vector3(0,0,0),new Vector3(0,.85,0))}}(),this.test=function(evt){if(!_hit||!_hit.collider)return _obj.success=!1,_obj;_raycaster.set(evt.pos,new Vector3(0,-1,0),0,Number.POSITIVE_INFINITY);let[hit]=_raycaster.intersectObject(_hit.collider),obj=_obj;return obj.success=!0,hit?(obj.normal=hit.face.normal,obj.point=hit.point,obj.uv=hit.uv,obj.miss=!1):obj.miss=!0,_obj},this.raycast=function(playerPos,cameraPos){if(!_hit)return!1;_v0.copy(cameraPos).sub(playerPos).normalize();let length=playerPos.distanceTo(cameraPos);_raycaster.set(playerPos,_v0,0,Number.POSITIVE_INFINITY);let[hit]=_raycaster.intersectObject(_hit.collider);return hit&&hit.distance>length?null:hit},this.test2D=function(){_mouse.x=Mouse.x/Stage.width*2-1,_mouse.y=-Mouse.y/Stage.height*2+1,_raycaster.setFromCamera(_mouse,World.CAMERA);let[hit]=_raycaster.intersectObject(_hit.collider);return hit},this.setup=function(player){if(!_hit||!_hit.collider)return;_raycaster.set(player.position.clone().add(new Vector3(0,10,0)),DOWN,0,Number.POSITIVE_INFINITY);let[hit]=_raycaster.intersectObject(_hit.collider);player.position.y=hit.point.y},this.update=function(delta,physics,player){if(!_hit||!_hit.collider)return;_v0.copy(physics.velocity).multiplyScalar(delta),_shapecast.physics=physics,player.position.add(_v0),_l0.copy(this.capsule.segment),_l0.start.y+=this.capsule.radius,_l0.end.y+=this.capsule.radius,_l0.start.add(player.position),_l0.end.add(player.position),_l1.copy(_l0),_b.makeEmpty(),_b.expandByPoint(_l0.start),_b.expandByPoint(_l0.end),_b.min.addScalar(-this.capsule.radius),_b.max.addScalar(this.capsule.radius),_this.movingHits.length>0&&_this.movingHits.forEach((m=>m.boundsTree?.shapecast(_shapecast))),_hit.geometry.boundsTree.shapecast(_shapecast);const deltaVector=_v0;deltaVector.subVectors(_l0.start,_l1.start);const offset=Math.max(0,deltaVector.length()-1e-5);deltaVector.normalize().multiplyScalar(offset),player.position.add(deltaVector),deltaVector.normalize(),physics.velocity.addScaledVector(deltaVector,-deltaVector.dot(physics.velocity))},this.checkIntersections=function(delta,physics,player){_hit&&_hit.collider&&(_v0.copy(player.position),_v0.y+=1.7,[_hit,..._this.movingHits].forEach(((h,i)=>{_raycaster.set(_v0,DOWN,0,Number.POSITIVE_INFINITY);let[hit]=_raycaster.intersectObject(h.collider);if(hit){const dist=hit.point.distanceTo(_v0);dist<1.615?(player.position.y+=dist,_v0.y+=dist):i>0&&physics.jumpRequested}})))}})),Class((function EnvironmentBVHDynamic(_input,_config){Inherit(this,Component);const _this=this;var _group,_thread,_env,_shader,_mergedMesh,_serverTime=0,_initialTime=0;const _m=new Matrix4,plane=new PlaneGeometry,box=new BoxGeometry,sphere=new SphereGeometry(.25),cylinder=new CylinderGeometry(.5,.5);class BVHHitMesh extends Mesh{}const internalTransform=new Group;function updateBVH(e,id){const geom=new Geometry;geom.addAttribute("position",new GeometryAttribute(e.position,3)),geom.index=e.index;let bvh=new MeshBVHLib.MeshBVH(geom),serialized=MeshBVHLib.MeshBVH.serialize(bvh,{cloneBuffers:!1});resolve({serialized:serialized,position:e.position},id,[serialized.index.buffer,e.position.buffer])}_this.isBVHDynamic=!0,_this.ready=Promise.create(),async function(){if(!1===_input.get("visible"))return;!function createGroup(){_group=new Group,_this.parent.group.add(_group);const positioning=InputUIL.create("ENV_BVH_DYN_positioning_"+_input.prefix,_config);positioning.setLabel("Mesh"),["Position","Scale"].forEach(((e,i)=>{positioning.addVector(e,1===i?[1,1,1]:[0,0,0]);const setVal=val=>{internalTransform[e.toLowerCase()].fromArray(val)};setVal(positioning.get(e));const field=positioning.getField(e);field&&field.onChange(setVal)}))}();let config=InputUIL.create(_input.prefix+"_envbvhdynamic",_config);config.setLabel("Hitmesh Dynamic"),config.addFile("json / bin"),_env=_this.parent.findParent("GroupEnvironment");try{let path=config.getFilePath("json / bin");if(path){await AssetLoader.loadAssets(["~assets/js/lib/bvh.min.js"]),BVHHitMesh.prototype.raycast=MeshBVHLib.acceleratedRaycast;const shapes=await function parseFile(path,input){return get(path).then((response=>{if("PhysicalShapes"!==response.metadata.type||"Dynamic"!==response.metadata.subtype)throw new Error("Wrong json format, expected metadata type PhysicalShapes, subtype Dynamic");const data=response.data.attributes,count=data.offset.array.length/3,shapes={planes:[],boxes:[],spheres:[],cylinders:[]};for(let i=0;i<count;i++){let arr;switch(data.shape.array[i]){case 0:arr="planes";break;case 1:arr="boxes";break;case 2:arr="spheres";break;case 3:arr="cylinders";break;default:arr="boxes"}const object=new Group;object.position.fromArray(data.offset.array,3*i),object.scale.fromArray(data.scale.array,3*i),object.quaternion.fromArray(data.rotation.array,4*i).normalize(),object.__animData={type:data.animType.array[i],info1:data.animInfo.array.slice(4*i,4*i+4),info2:data.animInfo2.array.slice(4*i,4*i+4)},shapes[arr].push(object)}return shapes})).catch((err=>{console.error(err)}))}(Assets.getPath(path));_thread=_this.initClass(Thread),Utils3D.loadEngineOnThread(_thread),_thread.importScript(Assets.getPath("~assets/js/lib/bvh.min.js")),_thread.loadFunction(updateBVH),await PlatformServices.wait("dataReady"),_serverTime=PlatformServices.serverTime,_initialTime=Date.now(),function createShader(){const shaderName=_input.get("shader")||"SceneLayout";_shader=new Shader(shaderName,{unique:`Element_${_input.prefix}_envbvhdynamic`}),"SceneLayout"!=shaderName&&window[shaderName]||_shader.addUniforms({tMap:{value:Utils3D.getTexture("assets/images/_scenelayout/uv.jpg")},uAlpha:{value:1}});window[shaderName]&&_this.initClass(window[shaderName],new Mesh,_shader,_input,_config);ShaderUIL.add(_shader,_config).setLabel("Shader")}(),function createBVH(shapes){const objects=[],indices=[],positions=[],normals=[],uvs=[];let indexOffset=0;Object.keys(shapes).forEach((shape=>{if(0===shapes[shape].length)return;let geo;switch(shape){case"planes":geo=plane;break;case"boxes":geo=box;break;case"spheres":geo=sphere;break;case"cylinders":geo=cylinder}shapes[shape].forEach((shape=>{shape.__originalposition=shape.position.clone(),shape.__originalquaternion=shape.quaternion.clone(),shape.__originalscale=shape.scale.clone(),shape.__originalgeo=geo,shape.__baseGeo=geo.clone(),shape.__movingFunction=null,shape.matrix.compose(shape.position,shape.quaternion,shape.scale),shape.__baseGeo.applyMatrix(shape.matrix);for(let i=0;i<shape.__baseGeo.index.length;i++)indices.push(indexOffset+shape.__baseGeo.index[i]);for(let i=0;i<shape.__baseGeo.attributes.position.array.length;i++)positions.push(shape.__baseGeo.attributes.position.array[i]);for(let i=0;i<shape.__baseGeo.attributes.normal.array.length;i++)normals.push(shape.__baseGeo.attributes.normal.array[i]);for(let i=0;i<shape.__baseGeo.attributes.uv.array.length;i++)uvs.push(shape.__baseGeo.attributes.uv.array[i]);indexOffset+=shape.__baseGeo.attributes.position.count,objects.push(shape);const animData=shape.__animData;if(0!==animData.type)if(1===animData.type){const axisAngle=(new Vector3).fromArray(animData.info1).normalize(),speed=animData.info1[3],q=new Quaternion,del=animData.info2[0],amplitude=animData.info2[1];shape.__movingFunction=time=>{const timeAmount=.0025*time*speed+1e3*del;q.setFromAxisAngle(axisAngle,0!==amplitude?Math.sin(timeAmount)*amplitude:timeAmount),shape.quaternion.premultiply(q)}}else if(2===animData.type){const axisAngle=(new Vector3).fromArray(animData.info1).normalize(),speed=animData.info1[3],amplitude=animData.info2[0],v=new Vector3,del=animData.info2[1];shape.__movingFunction=time=>{v.copy(axisAngle).multiplyScalar(Math.sin(.0025*time*speed+1e3*del)*amplitude),shape.position.add(v)}}}))}));const merged=new Geometry;merged.index=new(Geometry.arrayNeedsUint32(indices)?Uint32Array:Uint16Array)(indices),merged.addAttribute("position",new GeometryAttribute(new Float32Array(positions),3)),merged.addAttribute("normal",new GeometryAttribute(new Float32Array(normals),3)),merged.addAttribute("uv",new GeometryAttribute(new Float32Array(uvs),2)),_m.compose(internalTransform.position,internalTransform.quaternion,internalTransform.scale),merged.applyMatrix(_m),_mergedMesh=new Mesh(merged,_shader),_group.add(_mergedMesh);const bvhGeo=new Geometry;bvhGeo.index=new(Geometry.arrayNeedsUint32(indices)?Uint32Array:Uint16Array)(indices),bvhGeo.addAttribute("position",merged.attributes.position.clone());let lastUpdateReceived=!0;_this.startRender((_=>{const time=_serverTime+Date.now()-_initialTime;let offset=0;objects.forEach(((o,i)=>{["position","quaternion","scale"].forEach((v=>o[v].copy(o["__original"+v]))),o.__movingFunction&&o.__movingFunction(time),o.matrix.compose(o.position,o.quaternion,o.scale),o.__baseGeo.attributes.position.array.set(o.__originalgeo.attributes.position.array),o.__baseGeo.attributes.normal.array.set(o.__originalgeo.attributes.normal.array),o.__baseGeo.applyMatrix(o.matrix),merged.attributes.position.array.set(o.__baseGeo.attributes.position.array,offset),merged.attributes.normal.array.set(o.__baseGeo.attributes.normal.array,offset),offset+=o.__baseGeo.attributes.position.array.length})),_m.compose(internalTransform.position,internalTransform.quaternion,internalTransform.scale),merged.applyMatrix(_m),merged.attributes.position.needsUpdate=!0,merged.attributes.normal.needsUpdate=!0,_env&&_env.bvh&&lastUpdateReceived&&(lastUpdateReceived=!1,bvhGeo.attributes.position.array.set(merged.attributes.position.array),_thread.updateBVH({index:bvhGeo.index,position:bvhGeo.attributes.position.array}).then((e=>{bvhGeo.boundsTree=MeshBVHLib.MeshBVH.deserialize(e.serialized,bvhGeo),bvhGeo.collider=new BVHHitMesh(bvhGeo),lastUpdateReceived=!0,-1===_env?.bvh?.movingHits.indexOf(bvhGeo)&&_env.bvh.movingHits.push(bvhGeo)})))}))}(shapes)}}catch(e){console.log(e)}_this.ready.resolve()}(),this.setPosition=function(x,y,z){internalTransform.position.set(x,y,z)},this.setScale=function(x,y,z){internalTransform.scale.set(x,y,z)},this.getBoundingBox=async function(){await _this.ready,_mergedMesh.geometry.computeBoundingBox();return{min:(new Vector3).copy(_mergedMesh.geometry.boundingBox.min).sub(internalTransform.position).multiply(internalTransform.scale),max:(new Vector3).copy(_mergedMesh.geometry.boundingBox.max).sub(internalTransform.position).multiply(internalTransform.scale)}}})),Class((function EnvironmentBVHDynamicShuffle(_input,_config){Inherit(this,Component);const _this=this;var _direction=new Vector3,_UILSeed=0,_v=new Vector3,_pending=!1;async function shuffle(){if(_pending)return;_pending=!0,await _this.parent.loadedAllLayers();const layers=await _this.parent.getAllLayers(),bvhs=[];if(Object.keys(layers).forEach((name=>{layers[name].isBVHDynamic&&bvhs.push(layers[name])})),!bvhs.length)return;const seed=343.34536564564*_UILSeed,axis=0!==_direction.x?"x":0!==_direction.y?"y":"z",orderedBBoxes=[];for(;bvhs.length>0;){const index=Math.floor(seed%bvhs.length),bvh=bvhs.splice(index,1)[0],bbox=await bvh.getBoundingBox();orderedBBoxes.push(bbox);let offset=0;for(let i=0;i<orderedBBoxes.length;i++){let size=0;size=i===orderedBBoxes.length-1?Math.abs(orderedBBoxes[i][_direction[axis]<0?"min":"max"][axis]):Math.abs(orderedBBoxes[i].min[axis])+Math.abs(orderedBBoxes[i].max[axis]),offset+=size*(_direction[axis]<0?1:-1)}_v.setScalar(0),_v[axis]=offset,bvh.setPosition(..._v.toArray())}_pending=!1}!function(){if(!1===_input.get("visible"))return;const opts=InputUIL.create("ENV_BVH_DYN_shuffle_"+_input.prefix,_config);opts.setLabel("Shuffle Options"),opts.addVector("Direction",[0,0,1]);const setVal=val=>{_direction.fromArray(val),shuffle()};let value=opts.get("Direction");setVal(value);const field=opts.getField("Direction");field&&field.onChange(setVal),opts.addNumber("Seed",123);const setSeed=val=>{_UILSeed=val,shuffle()};value=opts.get("Seed"),setSeed(value);const field2=opts.getField("Seed");field2&&field2.onChange(setSeed)}()})),Class((function EnvironmentCollisionThread(){Inherit(this,Component);var _geom,_ray,_geomVR,_meshVR;function testHit(ignoreVR){let[hit]=_ray.intersectObject(undefined),obj={miss:!1,success:!0};if(_meshVR&&!ignoreVR){let[hitVR]=_ray.intersectObject(_meshVR);hitVR?obj.miss=!0:hit?(obj.normal=hit.face.normal,obj.point=hit.point,obj.uv=hit.uv):obj.miss=!0}else hit?(obj.normal=hit.face.normal,obj.point=hit.point,obj.uv=hit.uv):obj.miss=!0;return obj}this.mount=function(e,id){(_geom=new Geometry).addAttribute("position",new GeometryAttribute(e.position,3)),_geom.addAttribute("normal",new GeometryAttribute(e.normal,3)),_geom.addAttribute("uv",new GeometryAttribute(e.uv,2)),e.index&&(_geom.index=e.index),_geom.applyMatrix((new Matrix4).fromArray(e.matrix)),_geom.computeBoundingSphere(),_geom.computeBoundingBox();let bvh=new MeshBVHLib.MeshBVH(_geom),serialized=MeshBVHLib.MeshBVH.serialize(bvh,Utils.mergeObject(e.config,{cloneBuffers:!1})),result={serialized:serialized,geometry:{}},buffers=[serialized.index.buffer];!function serializeGeometry(geometry,data,buffers){data.position=geometry.attributes.position.array,data.normal=geometry.attributes.normal.array,data.uv=geometry.attributes.uv.array,data.boundingBox=geometry.boundingBox,data.boundingSphere=geometry.boundingSphere,buffers.push(data.position.buffer,data.normal.buffer,data.uv.buffer),geometry.index&&(data.index=geometry.index,buffers.includes(geometry.index.buffer)||buffers.push(geometry.index.buffer))}(_geom,result.geometry,buffers),resolve(result,id,buffers)},this.mountVR=function({position:position,normal:normal,scaleVR:scaleVR,uv:uv}){(_geomVR=new Geometry).addAttribute("position",new GeometryAttribute(position,3)),_geomVR.addAttribute("normal",new GeometryAttribute(normal,3)),_geom.addAttribute("uv",new GeometryAttribute(uv,2)),_geomVR.computeBoundingSphere(),_geomVR.computeBoundingBox(),(_meshVR=new Mesh(_geomVR,{side:Shader.FRONT_SIDE})).raycastLimit={position:new Vector3,radiuSq:Math.pow(.5,2)},_meshVR.scale.fromArray(scaleVR),_meshVR.updateMatrixWorld(!0)},this.test2D=function({pos:pos},id){if(!_geom)return resolve({success:!1},id);_ray.setFromCamera(pos,undefined),undefined.raycastLimit.position.copy(pos),_meshVR&&_meshVR.raycastLimit.position.copy(pos);let obj=testHit(!0);resolve(obj,id)},this.updateCamera=function({fov:fov,near:near,far:far,aspect:aspect,position:position,quaternion:quaternion}){undefined},this.test=function({pos:pos,data:data},id){if(!_geom)return resolve({success:!1},id);_ray.set(pos,undefined,0,Number.POSITIVE_INFINITY),undefined.raycastLimit.position.copy(pos),_meshVR&&_meshVR.raycastLimit.position.copy(pos);let obj=testHit();obj.data=data,resolve(obj,id)},this.testRay=function({pos:pos,dir:dir,data:data},id){if(!_geom)return resolve({success:!1},id);_ray.set(pos,dir,0,Number.POSITIVE_INFINITY),undefined.raycastLimit.position.copy(pos),_meshVR&&_meshVR.raycastLimit.position.copy(pos);let obj=testHit();obj.data=data,resolve(obj,id)},this.testBox=function({pos:pos,bounding:bounding},id){if(!_geom)return resolve({success:!1},id);_ray.set(pos,undefined,0,Number.POSITIVE_INFINITY),undefined.raycastLimit.position.copy(pos),_meshVR&&_meshVR.raycastLimit.position.copy(pos);let obj=testHit(),hits=[];obj.point&&hits.push(obj);for(let bound of bounding){_ray.set(bound,undefined,0,Number.POSITIVE_INFINITY);let result=testHit();result.point&&hits.push(result)}if(hits.length>0){let sorted=hits.sort(((a,b)=>b.point.y-a.point.y));obj.point=sorted[0].point}resolve(obj,id)},this.clear=function(){_geom=null,_geomVR=null}})),Class((function HitMeshConfig(_mesh,_shader,_group,_input){let config=InputUIL.create(_input.prefix+"hitmeshconfig",_group);config.setLabel("Config"),config.add("maxDepth",40).add("maxLeafTris",10),_mesh._hitMeshConfig={maxDepth:config.getNumber("maxDepth"),maxLeafTris:config.getNumber("maxLeafTris")}})),Class((function AvatarInteraction(_controller){Inherit(this,Component);const _this=this;var _thread,_geom,_over,_needsTest,_localPlayer,_vrDown,_hoverTime,_camera={projectionMatrix:[],p:[],q:[]},_players=[],_playerMap={},_transfer={camera:_camera,array:[],mouse:{},localPlayer:[]};const VR=Platform.usingVR();function loop(){if(_players.length&&_needsTest||_this.flag("proximity")){_needsTest=!1,_transfer.array.length=0;for(let i=_players.length-1;i>-1;i--){let obj=_players[i];obj.p.toArray(obj.transfer.p),obj.q.toArray(obj.transfer.q),_transfer.array.push(obj.transfer)}if(_camera.fov=World.CAMERA.fov,_camera.aspect=World.CAMERA.aspect,_camera.near=World.CAMERA.near,_camera.far=World.CAMERA.far,World.CAMERA.position.toArray(_camera.p),World.CAMERA.quaternion.toArray(_camera.q),World.CAMERA.projectionMatrix.toArray(_camera.projectionMatrix),_camera.width=Stage.width,_camera.height=Stage.height,_transfer.mouse.x=Mouse.x,_transfer.mouse.y=Mouse.y,VR){let input=Interaction3D.find(World.CAMERA).input;_transfer.vrControls||(_transfer.vrControls={pos:[],quat:[]}),input.obj&&input.obj.group&&(input.obj.group.getWorldPosition().toArray(_transfer.vrControls.pos),input.obj.group.getWorldQuaternion().toArray(_transfer.vrControls.quat))}_localPlayer&&_localPlayer.position.toArray(_transfer.localPlayer),_thread.hitTest(_transfer,hitTestResult)}}function hitTestResult({hit:hit}){if(!PlayerControlsOrbit.DRAGGING)try{if(hit){if(!_over&&_playerMap[hit]){let otherPlayer=_playerMap[hit].player;if(_localPlayer&&_localPlayer.position.distanceTo(otherPlayer.group.position)>30)return;Stage.cursor("pointer"),_over=otherPlayer,AvatarInteraction.intersecting=!0,_hoverTime=Render.TIME,_over.events.fire(AvatarInteraction.HOVER,{action:"over",object:_over}),_controller&&_controller.onOver&&_controller.onOver(_over)}}else _over&&(Stage.cursor("auto"),AvatarInteraction.intersecting=!1,_over.events.fire(AvatarInteraction.HOVER,{action:"out",object:_over}),_controller&&_controller.onOut&&_controller.onOut(_over),_over=null)}catch(e){_over=null,Hydra.LOCAL&&console.error(e)}}function vrInputButton(e){if(e.controller==Interaction3D.find(World.CAMERA).input.obj&&"trigger"==e.label)if(e.pressed)_vrDown=Render.TIME;else{Render.TIME-_vrDown<200&&click()}}function start(e){_needsTest=!0,loop()}function move(e){_needsTest=!0}async function click(e){if(!e?.isLeaveEvent&&_over)try{Render.TIME-_hoverTime>100&&(_controller&&_controller.onClick&&_controller.onClick(_over),_over.events?.fire(AvatarInteraction.CLICK,{action:"click",object:_over}))}catch(e){_over=null,Hydra.LOCAL&&console.error(e)}}function onProximity({player:player}){_playerMap[player]&&_this.onProximityEvent&&_this.onProximityEvent(_playerMap[player].player)}!function initThread(){if(!AvatarInteraction.THREAD){let thread=new Thread(AvatarInteractionThread);Utils3D.loadEngineOnThread(thread),thread.importClass(Raycaster),AvatarInteraction.THREAD=thread}_thread=AvatarInteraction.THREAD}(),function addListeners(){Device.mobile?_this.events.sub(Mouse.input,Interaction.START,start):_this.events.sub(Mouse.input,Interaction.MOVE,move),_this.events.sub(Mouse.input,Interaction.CLICK,click),VR&&VRInput.controllers.forEach((c=>{_this.events.sub(c,VRInput.BUTTON,vrInputButton)}))}(),this.activate=function(){_thread.activate(),_geom=null,_this.startRender(loop,24)},this.addLocalPlayer=function(player){player&&(_localPlayer=_this.localPlayer=player.group,_controller?.interactWithUserAvatar&&_this.wait(player,"gcPlayer").then((_=>{_this.addPlayer(player,!0)})))},this.addPlayer=async function(player,me){if(!_geom){if(await defer(),player.boundingBox)_geom=!0,_thread.uploadBoundingBox({boundingBox:player.boundingBox});else{if(!player.group)return;player.group.traverse((m=>{m.geometry&&!_geom&&(m.geometry.boundingBox||(m.geometry.computeBoundingSphere(),m.geometry.computeBoundingBox()),_geom=!0,_thread.uploadBoundingBox({boundingBox:m.geometry.boundingBox}))}))}return void _this.delayedCall((_=>{_this.addPlayer(player)}),100)}let obj={player:player,p:player.group.position,q:player.group.quaternion,transfer:{p:[],q:[],id:player.gcPlayer.id}};_players.push(obj),_playerMap[player.gcPlayer.id]=obj,_thread.addPlayer({player:player.gcPlayer.id})},this.removePlayer=function(player){let obj=_playerMap[player.gcPlayer.id];obj&&(_this.onRemovePlayer?.(player),_thread.removePlayer({player:player.gcPlayer.id}),_players.remove(obj),delete _playerMap[player.gcPlayer.id])},this.bindPlayerProximity=function(distance=1){_thread.bindPlayerProximity({distance:distance}),_thread.on("proximity",onProximity),_this.flag("proximity",!0)},this.isPlayerInside=function(pos,radius){let radiusSq=radius*radius;for(let i=_players.length-1;i>-1;i--){if(_players[i].p.distanceToSquared(pos)<radiusSq)return!0}return _localPlayer.position.distanceToSquared(pos)<radiusSq}}),(_=>{AvatarInteraction.HOVER="avatar_hover",AvatarInteraction.CLICK="avatar_click"})),Class((function AvatarInteractionThread(){Inherit(this,Component);var _players,_playerMap,_mesh,_camera,_ray,_stage,_playerProximity,_v3,_v32,_q;this.activate=function(){_players=[],_playerMap={},_camera=new PerspectiveCamera,_stage={},_ray=new Raycaster(_camera),_mesh=null},this.addPlayer=function({player:player}){if(!_mesh)return;let mesh=_mesh.clone();mesh.playerId=player,_players.push(mesh),_playerMap[player]=mesh},this.removePlayer=function({player:player}){let mesh=_playerMap[player];delete _playerMap[player],_players.remove(mesh)},this.uploadBoundingBox=function({boundingBox:boundingBox}){let geom=new BoxGeometry(1,1,1);geom.applyMatrix((new Matrix4).makeTranslation(0,.5,0));let mesh=new Mesh(geom,{});mesh.scale.x=2*boundingBox.max.x,mesh.scale.z=2*boundingBox.max.z,mesh.scale.y=1*boundingBox.max.y,_mesh=mesh},this.hitTest=function({camera:camera,array:array,mouse:mouse,localPlayer:localPlayer,vrControls:vrControls},id){_camera.aspect=camera.aspect,_camera.fov=camera.fov,_camera.near=camera.near,_camera.far=camera.far,_camera.position.fromArray(camera.p),_camera.quaternion.fromArray(camera.q),_camera.projectionMatrix.fromArray(camera.projectionMatrix),_camera.updateProjectionMatrix(),_camera.updateMatrixWorld(!0),_v3||(_v3=new Vector3),_v32||(_v32=new Vector3),_q||(_q=new Quaternion),_v3.fromArray(localPlayer),_stage.width=camera.width,_stage.height=camera.height;for(let i=array.length-1;i>-1;i--){let obj=array[i],player=_playerMap[obj.id];if(player&&(player.position.fromArray(obj.p),player.quaternion.fromArray(obj.q),player.updateMatrixWorld(!0),_playerProximity)){let dist=player.position.distanceTo(_v3);dist>.001&&dist<_playerProximity&&emit("proximity",{player:obj.id})}}let hit;vrControls?(_v3.fromArray(vrControls.pos),_q.fromArray(vrControls.quat),_v32.set(0,0,-1).applyQuaternion(_q),[hit]=_ray.checkFromValues(_players,_v3,_v32)):[hit]=_ray.checkHit(_players,mouse,_stage),hit?resolve({hit:hit.object.playerId},id):resolve({hit:!1},id)},this.bindPlayerProximity=function({distance:distance}){_playerProximity=distance}})),Class((function ClickZone(_input,_group){Inherit(this,Object3D);const _this=this;var _mesh,_id=_input.get("wildcard");function hover(e){_this.events.fire(ClickZone.HOVER,{action:e.action,hit:e.hit,id:_id})}function click(e){_this.events.fire(ClickZone.CLICK,{id:_id,hit:e.hit})}function move(e){_this.events.fire(ClickZone.MOVE,{action:e.action,hit:e.hit,id:_id})}_mesh=new Mesh(World.BOX,Utils3D.getTestShader()),Utils.query("clickZone")||(_mesh.shader.neverRender=!0),_this.add(_mesh),Interaction3D.find(World.CAMERA).add(_mesh,hover,click,move),this.onDestroy=function(){Interaction3D.find(World.CAMERA).remove(_mesh,hover,click)}}),(_=>{ClickZone.HOVER="clickzone_hover",ClickZone.CLICK="clickzone_click",ClickZone.MOVE="clickzone_move"})),Class((function DistanceTrigger(_mesh,_shader,_group,_input){Inherit(this,Component);const _this=this;function loop(){if(!_player||!_player.group)return;_player.group.distanceTo(_mesh.getWorldPosition())<_config.getNumber("distance")?_this.flag("needs_reset")||(_mesh.onDistanceTrigger?.(_mesh),_this.flag("needs_reset",!0)):_this.flag("needs_reset",!1)}_config=InputUIL.create(_input.prefix+"distancetrigger",_group),_config.setLabel("Config"),_config.add("distance",1),_this.startRender(loop,24),this.onVisible=async function(){let env=await DreamWorld.getActiveEnvironment();_player=await env.awaitPlayerController()}})),Class((function PortalZone(_input,_group){Inherit(this,Object3D);const _this=this;var _layout,_config,_player,_layers,_env,_box;function loop(){_player&&_player.group&&(_box.containsPoint(_player.group.position)?_this.flag("prevent")||(_this.flag("prevent",!0),DreamWorld.active.setRoute(_config.get("route"))):_this.flag("prevent",!1))}!async function(){_layout=_this.initClass(SceneLayout,"portalZone",{noGraph:!location.pathname.toLowerCase().includes("dream/platform")}),_layers=await _layout.getAllLayers(),_this.startRender((_=>{})),defer((_=>{!function initBox(zone){_box=new Box3,_this.group.updateMatrixWorld(!0),_box.setFromObject(zone),zone.visible=!1}(_layers.zone)})),_input&&((_config=InputUIL.create(_input.prefix+"PortalZone",_group)).setLabel("Config"),_config.add("environment").add("route").addImage("imposter").addVector("offset",[0,0,0]).addVector("orientation",[0,0,0]),_config.onUpdate=key=>{try{_env?.scene.scene.position.fromArray(_config.get("offset")),_env?.scene.scene.rotation.fromArray(_config.get("orientation").map((v=>Math.radians(v))))}catch(e){}})}(),this.onVisible=async function(){if(!Global.PLAYGROUND){_player=await _this.parent.parent.awaitPlayerController(),_this.startRender(loop);let env=_config.get("environment");env&&_this.parent.parent.name!=env&&(await _this.parent.parent.wait("isActive"),await _this.wait(1e3),(_env=await DreamWorld.active.setupPortalScene(env)).visible=_env.scene.visible=_env.obj.group.visible=!0,_layers.texture.shader.set("tMap",_env.scene),DreamWorldPortalTransition.instance().setNextTexture(_env.scene))}_config.onUpdate("offset"),_config.onUpdate("orientation")}})),Class((function TriggerZone(_input,_group){Inherit(this,Object3D);const _this=this;var _mesh,_box,_dialog,_id,_confirm,_radius,_env=_this.findParent("GroupEnvironment"),_wrapper=new Group,_target=new Group;new Vector3;Platform.usingVR();function collideLoop(){let player=_env.player;if(player&&player.group){if(_box.containsPoint(player.group.position)){if(!_this.flag("on")){TriggerZone.IS_INSIDE=!0,_this.flag("on",!0);let test=TriggerZone.lookupTest(_id);if(test&&!test(_id))return;_dialog.setPosition(_this.group.position.clone().add(new Vector3(0,1,0))),_this.events.fire(TriggerZone.INSIDE,{dialog:_dialog,id:_id})}}else if(_this.flag("on")){TriggerZone.IS_INSIDE=!1,_this.flag("on",!1);let test=TriggerZone.lookupTest(_id);if(test&&!test(_id))return;_this.events.fire(TriggerZone.OUTSIDE,{dialog:_dialog,id:_id})}TriggerZone.reportNearby(player.group.position.distanceTo(_this.group.position)<2*_radius)}}async function onChoice({shouldStart:shouldStart}){await function hideDialog(){_dialog.close?.()}(),shouldStart&&_this.events.fire(TriggerZone.TRIGGERED,{dialog:_dialog,id:_id})}_id=_input.get("wildcard")||"",function initConfig(){let config=InputUIL.create(_input.prefix+"triggerzone",_group);config.setLabel("Zone"),config.addToggle("visible",!0),_confirm=!0,config.onUpdate=_=>{let visible=!0===config.get("visible");_this.group.visible=visible},config.onUpdate()}(),_wrapper.rotation.x=Math.radians(-60),_wrapper.add(_target),function initMesh(){_mesh=new Mesh(World.BOX,Utils3D.getTestShader()),_this.add(_mesh),_box=new Box3,Utils.query("orbit")||(_mesh.visible=!1)}(),function initDialog(){if(!_confirm)return;let view=TriggerZone.getDialogClass(_id.split("/")[0]);if(void 0===view)throw"TriggerZone view class is undefined";_dialog=_this.initClass(view.class,{game:_id,...view.extras}),Global.PLAYGROUND?_dialog.group.visible=!1:_this.findParent("GroupEnvironment").add(_dialog.group)}(),function addListeners(){_env&&_this.startRender(collideLoop,24),_dialog&&_this.events.sub(_dialog,Events.COMPLETE,onChoice)}(),_dialog.target=new Group,defer((_=>{_this.group.updateMatrixWorld(!0),_box.setFromObject(_mesh),_radius=_box.getBoundingSphere().radius})),this.set("id",(id=>_id=id)),this.get("dialog",(_=>_dialog)),this.get("mesh",(_=>_mesh)),this.onInvisible=this.onDestroy=this.onVisible=function(){TriggerZone.IS_INSIDE=!1,TriggerZone.IS_NEARBY=!1,_dialog.close?.()}}),(_=>{TriggerZone.TRIGGERED="triggerzone_triggered",TriggerZone.INSIDE="triggerzone_inside",TriggerZone.OUTSIDE="triggerzone_outside",Render.start((_=>{TriggerZone.IS_NEARBY=!1}),24);var _map={},_tests={};TriggerZone.registerDialogClass=function(key,DialogClass,extras,test){"function"==typeof extras&&(test=extras,extras=null),_map[key]={class:DialogClass,extras:extras},test&&(_tests[key]=test)},TriggerZone.lookupTest=function(key){return _tests[key]},TriggerZone.getDialogClass=function(key){return _map[key]||{class:UI3DPrompt}},TriggerZone.reportNearby=function(bool){!0===bool&&(TriggerZone.IS_NEARBY=!0)}})),Class((function ProfileSnapshot(_key=""){Inherit(this,Object3D);const _this=this;let _mesh,cache={};const consoleSecurity=require("ConsoleSecurity");!async function(){await User.ready(),_mesh=new Mesh(World.BOX,Utils3D.getTestShader()),_this.add(_mesh),_mesh.prefix="profile_snapshot"+_key,MeshUIL.add(_mesh).setLabel("Profile Snapshot"),Utils.query("snapshotBox")||(_mesh.visible=!1)}(),_this.capture=async function(){let bb=new Box3;bb.setFromObject(_mesh);let points=[new Vector3(bb.min.x,bb.max.y,bb.min.z),new Vector3(bb.min.x,bb.max.y,bb.max.z),new Vector3(bb.min.x,bb.min.y,bb.min.z),new Vector3(bb.min.x,bb.min.y,bb.max.z),new Vector3(bb.max.x,bb.max.y,bb.min.z),new Vector3(bb.max.x,bb.max.y,bb.max.z),new Vector3(bb.max.x,bb.min.y,bb.min.z),new Vector3(bb.max.x,bb.min.y,bb.max.z)];points=points.map((p=>(new Vector2).copy(ScreenProjection.find(World.CAMERA).project(p))));let minX=9999,minY=9999,maxX=0,maxY=0;points.forEach((p=>{minX=Math.min(minX,p.x),minY=Math.min(minY,p.y),maxX=Math.max(maxX,p.x),maxY=Math.max(maxY,p.y)}));let x=Math.round(minX),y=Math.round(minY),width=Math.round(maxX-minX),height=Math.round(maxY-minY),canvas=DreamWorld.active.capturePixels(x,y,width,height);return Utils.query("debugProfile")&&Stage.add(canvas),_this.events.fire(ProfileSnapshot.UPDATE,{canvas:canvas}),await _this.upload(canvas.toDataURL("image/jpeg"))},_this.upload=async function(base64profile){if(!Hydra.LOCAL&&consoleSecurity())return!1;if(cache.upload&&cache.upload===base64profile)return;cache.upload||(cache.upload=base64profile);let token=await User.getIdToken();return token?(Track.event("profile","upload"),await post(Config.API+"-upload",{profile:base64profile,token:token})):void 0}}),(_=>{ProfileSnapshot.UPDATE="profile_snap_update"})),Class((function UIChatZonePrompt(){Inherit(this,UI3DPromptLayout,"UIChatZonePrompt");const _this=this;function handleHover({action:action,object:object}){switch(action){case"over":object.tween({alpha:.5},400,"easeOutCubic");break;case"out":object.tween({alpha:1},400,"easeOutCubic")}}!async function(){await async function initLayers(){_this.layers=await _this.layout.getAllLayers(),_this.bindState(UICopy.state,"chatzoneTitle",(value=>{_this.layers.title?.setText(value)})),_this.bindState(UICopy.state,"chatzoneCancel",(value=>{_this.layers.cancelButtonText?.setText(value)})),_this.bindState(UICopy.state,"chatzoneAccept",(value=>{_this.layers.acceptButtonText?.setText(value)}))}(),function initHandlers(){_this.layers.acceptButton&&_this.layers.acceptButton.mesh.interact(handleHover,(_=>{_this.events.fire(Events.COMPLETE,{shouldStart:!0})}));_this.layers.cancelButton&&_this.layers.cancelButton.mesh.interact(handleHover,(_=>{_this.events.fire(Events.COMPLETE,{shouldStart:!1})}))}()}()})),Class((function UIMintNFTPrompt(){Inherit(this,UI3DPromptLayout,"UIMintNFTPrompt");const _this=this;function handleHover({action:action,object:object}){switch(action){case"over":object.tween({alpha:.5},400,"easeOutCubic");break;case"out":object.tween({alpha:1},400,"easeOutCubic")}}!async function(){await async function initLayers(){_this.layers=await _this.layout.getAllLayers()}(),function initHandlers(){_this.layers.acceptButton&&_this.layers.acceptButton.mesh.interact(handleHover,(_=>{_this.events.fire(Events.COMPLETE,{shouldStart:!0})}));_this.layers.cancelButton&&_this.layers.cancelButton.mesh.interact(handleHover,(_=>{_this.events.fire(Events.COMPLETE,{shouldStart:!1})}))}()}()})),Class((function UIProfileBlockPrompt(){Inherit(this,UI3DPromptLayout,"UIProfileBlockPrompt");const _this=this;let _model=!Global.PLAYGROUND&&(Config.AUTH?DreamDirectory:AnonymousModeration);async function handleAccept(){_model&&_model.isBlocked(UIProfilePrompt.player.uid)?await _model.unblock(UIProfilePrompt.player.uid):(UIProfilePrompt.player.gcPlayer?.sever(),_model&&await _model.block(UIProfilePrompt.player.uid)),_this.updateFace(UIProfileBlockSuccessPrompt,{playerId:UIProfilePrompt.player?.get("uid")})}function handleCancel(){_this.updateFace(UIProfilePrompt,{playerId:UIProfilePrompt.player?.get("uid")})}function handleHover({action:action,object:object}){switch(action){case"over":object.tween({alpha:.5},400,"easeOutCubic");break;case"out":object.tween({alpha:1},400,"easeOutCubic")}}!async function(){await async function initLayers(){_this.layers=await _this.layout.getAllLayers(),_model&&_model.isBlocked(UIProfilePrompt.player.uid)?_this.bindState(UICopy.state,"profilePromptUnblockTitle",(value=>{_this.layers.title?.setText(value)})):_this.bindState(UICopy.state,"profilePromptBlockTitle",(value=>{_this.layers.title?.setText(value)}));_this.bindState(UICopy.state,"profilePromptNo",(value=>{_this.layers.cancelButtonText?.setText(value)})),_this.bindState(UICopy.state,"profilePromptYes",(value=>{_this.layers.acceptButtonText?.setText(value)}))}(),function initHandlers(){_this.layers.acceptButton&&_this.layers.acceptButton.mesh.interact(handleHover,handleAccept);_this.layers.cancelButton&&_this.layers.cancelButton.mesh.interact(handleHover,handleCancel)}()}()})),Class((function UIProfileBlockSuccessPrompt(){Inherit(this,UI3DPromptLayout,"UIProfileBlockSuccessPrompt");const _this=this;let _model=!Global.PLAYGROUND&&(Config.AUTH?DreamDirectory:AnonymousModeration);function handleAccept(){_this.updateFace(UIProfilePrompt,{playerId:UIProfilePrompt.player?.get("uid")})}function handleHover({action:action,object:object}){switch(action){case"over":object.tween({alpha:.5},400,"easeOutCubic");break;case"out":object.tween({alpha:1},400,"easeOutCubic")}}!async function(){await async function initLayers(){_this.layers=await _this.layout.getAllLayers(),_model&&_model.isBlocked(UIProfilePrompt.player.uid)?_this.bindState(UICopy.state,"profilePromptBlocked",(value=>{_this.layers.title?.setText(value)})):_this.bindState(UICopy.state,"profilePromptUnblocked",(value=>{_this.layers.title?.setText(value)}));_this.bindState(UICopy.state,"profilePromptConfirm",(value=>{_this.layers.acceptButtonText?.setText(value)}))}(),function initHandlers(){_this.layers.acceptButton&&_this.layers.acceptButton.mesh.interact(handleHover,handleAccept)}()}()})),Class((function UIProfilePrompt(_player){Inherit(this,UI3DPromptLayout,"UIProfilePrompt");const _this=this;let _model=!Global.PLAYGROUND&&(Config.AUTH?DreamDirectory:AnonymousModeration);async function initLayers(){_this.layers=await _this.layout.getAllLayers(),_this.layers.title.setText(function initName(){let name=UIProfilePrompt.player?.get("name");name?.indexOf("Player uid_")>-1&&(name=name.replace("Player uid_",""));return name}()),_this.bindState(UICopy.state,"profilePromptTitle",(value=>{_this.layers.description?.setText(value)}));let uid=UIProfilePrompt.player?.get("uid")||_player?.uid;uid&&_model&&_model.isBlocked(uid)?_this.bindState(UICopy.state,"profilePromptUnblock",(value=>{_this.layers.blockButtonText?.setText(value)})):_this.bindState(UICopy.state,"profilePromptBlock",(value=>{_this.layers.blockButtonText?.setText(value)})),_this.bindState(UICopy.state,"profilePromptReport",(value=>{_this.layers.reportButtonText?.setText(value)}))}function handleHover({action:action,object:object}){switch(action){case"over":object.tween({alpha:.5},400,"easeOutCubic");break;case"out":object.tween({alpha:1},400,"easeOutCubic")}}!async function(){await initLayers(),function initHandlers(){_this.layers.blockButton&&_this.layers.blockButton.mesh.interact(handleHover,(_=>{_this.updateFace(UIProfileBlockPrompt,{playerId:UIProfilePrompt.player?.get("uid")})}));_this.layers.reportButton&&_this.layers.reportButton.mesh.interact(handleHover,(_=>{_this.updateFace(UIProfileReportPrompt,{playerId:UIProfilePrompt.player?.get("uid")})}));_this.layers.closeButton&&_this.layers.closeButton.mesh.interact(handleHover,(_=>{_this.parent.events.fire(Events.END)}))}()}(),this.updateInfo=function(player){UIProfilePrompt.player=player.state,_this.setFace(UIProfilePrompt),initLayers()},this.onAnimateOutComplete=function(){_this.setFace(UIProfilePrompt)}}),(_=>{UIProfilePrompt.player=null})),Class((function UIProfileReportPrompt(){Inherit(this,UI3DPromptLayout,"UIProfileReportPrompt");const _this=this;let _model=!Global.PLAYGROUND&&(Config.AUTH?DreamDirectory:AnonymousModeration);async function handleAccept(){_model&&await _model.report(UIProfilePrompt.player.uid,Router.getState().join("/")),_this.updateFace(UIProfileReportSuccessPrompt,{playerId:UIProfilePrompt.player?.get("uid")})}function handleCancel(){_this.updateFace(UIProfilePrompt,{playerId:UIProfilePrompt.player?.get("uid")})}function handleHover({action:action,object:object}){switch(action){case"over":object.tween({alpha:.5},400,"easeOutCubic");break;case"out":object.tween({alpha:1},400,"easeOutCubic")}}!async function(){await async function initLayers(){_this.layers=await _this.layout.getAllLayers(),_this.bindState(UICopy.state,"profilePromptReportTitle",(value=>{_this.layers.title?.setText(value)})),_this.bindState(UICopy.state,"profilePromptNo",(value=>{_this.layers.cancelButtonText?.setText(value)})),_this.bindState(UICopy.state,"profilePromptYes",(value=>{_this.layers.acceptButtonText?.setText(value)}))}(),function initHandlers(){_this.layers.acceptButton&&_this.layers.acceptButton.mesh.interact(handleHover,handleAccept);_this.layers.cancelButton&&_this.layers.cancelButton.mesh.interact(handleHover,handleCancel)}()}()})),Class((function UIProfileReportSuccessPrompt(){Inherit(this,UI3DPromptLayout,"UIProfileReportSuccessPrompt");const _this=this;function handleAccept(){_this.updateFace(UIProfilePrompt,{playerId:UIProfilePrompt.player?.get("uid")})}function handleHover({action:action,object:object}){switch(action){case"over":object.tween({alpha:.5},400,"easeOutCubic");break;case"out":object.tween({alpha:1},400,"easeOutCubic")}}!async function(){await async function initLayers(){_this.layers=await _this.layout.getAllLayers(),_this.bindState(UICopy.state,"profilePromptReported",(value=>{_this.layers.title?.setText(value)})),_this.bindState(UICopy.state,"profilePromptConfirm",(value=>{_this.layers.acceptButtonText?.setText(value)}))}(),function initHandlers(){_this.layers.acceptButton&&_this.layers.acceptButton.mesh.interact(handleHover,handleAccept)}()}()})),Class((function UIPromptBackground(_mesh,_shader,_group,_input){Inherit(this,Component);const _this=this;!function(){let shader=_this.initClass(Shader,"UIPromptBackground",{uBackground:{value:new Color("#000000")},uRadius:{value:50},uOpacity:{value:.9},uSizes:{value:new Vector2(1e3,500)},transparent:!0});Global.PLAYGROUND&&Global.PLAYGROUND.indexOf("Prompt")>-1&&ShaderUIL.add(shader).setLabel("Background Shader"),_mesh.useShader(shader)}()})),Class((function UIPromptButton(_mesh,_shader,_group,_input){Inherit(this,Component);const _this=this;!function(){let shader=_this.initClass(Shader,"UIPromptButton",{uBackground:{value:new Color("#ffffff")},uRadius:{value:50},uOpacity:{value:.9},uSizes:{value:new Vector2(320,100)},transparent:!0});Global.PLAYGROUND&&Global.PLAYGROUND.indexOf("Prompt")>-1&&ShaderUIL.add(shader).setLabel("Button Shader"),_mesh.useShader(shader),_this.group=_group,_this.shader=_shader,_this.mesh=_mesh}()})),Class((function UIPromptClose(_mesh,_shader,_group,_input){Inherit(this,Component);const _this=this;!function(){let shader=_this.initClass(Shader,"UIPromptClose",{uColor:{value:new Color("#ffffff")},transparent:!0});Global.PLAYGROUND&&Global.PLAYGROUND.indexOf("Prompt")>-1&&ShaderUIL.add(shader).setLabel("Close Shader"),_mesh.useShader(shader),_this.group=_group,_this.shader=_shader,_this.mesh=_mesh}()})),Class((function PlatformSounds(){Inherit(this,Component);const _this=this;var _sounds={};function initSound(key){_sounds[key]=_this.initClass(Audio3D,{src:Assets.getPath(`~assets/sounds/${key}.mp3`)})}this.play=function(key,volume){_sounds[key]||initSound(key),volume&&(_sounds[key].volume=volume),_sounds[key].play()},this.startLoop=function(key,volume){_sounds[key]||initSound(key),volume&&(_sounds[key].volume=volume),_sounds[key].loop=!0,_sounds[key].play()},this.stopLoop=function(key){_sounds[key].stop()},this.setVolume=function(key,volume){_sounds[key]&&(_sounds[key].volume=volume)}}),"static"),Class((function CSSAppState(){var _map=new Map,_bindings=new Map;function StateBinding(_keys,_obj,_propertyName,_values,_flipVariable){var _oldValue;this.update=function(key,value){let newValue=value;if(newValue==_oldValue)return;let newStyle={};_values.length>1?(newStyle[_propertyName]=_flipVariable?_values[0]+" "+value:_values[1],_obj.css(newStyle)):1==_values.length?(newStyle[_propertyName]=_values[0]+" "+value,_obj.css(newStyle)):(newStyle[_propertyName]=value,_obj.css(newStyle)),_oldValue=newValue}}this.set=function(key,value){_map.set(key,value);let array=_bindings.get(key);array&&array.forEach((b=>b.update(key,value)))},this.get=function(key){return _map.get(key)},this.bind=function(keys,obj,propertyName,values=[],flipVariable=null){Array.isArray(keys)||(keys=[keys]);let binding=new StateBinding(keys,obj,propertyName,values,flipVariable);keys.forEach((key=>{_bindings.has(key)?_bindings.get(key).push(binding):_bindings.set(key,[binding]);let value=_map.get(key);value&&binding.update(value)}))},this.createLocal=function(){return new CSSAppState}}),"static"),Class((function StreamVideoTexture(_video){Inherit(this,Component);const _this=this;async function playVideo(){try{await _video.play()}catch(e){_this.delayedCall?.(playVideo,100)}}function loop(){_this.texture.needsUpdate=!0}this.texture=new Texture(_video),_video&&(_video.autoplay=!0),_this.texture.format=Texture.RGBFormat,_this.texture.minFilter=_this.texture.magFilter=Texture.LINEAR,_this.texture.generateMipmaps=!1,playVideo(),_this.startRender(loop,30),this.onDestroy=function(){_this.texture.destroy()},this.updateStream=function(video){_video=video,_this.texture.image=_video,playVideo()}})),Class((function Tests(){this.getDPR=function(){return GPU.OVERSIZED?.9:GPU.lt(0)?1:GPU.lt(1)?Math.min(Device.pixelRatio,1.15):GPU.lt(2)?Math.min(Device.pixelRatio,1.3):GPU.lt(3)?Math.min(Device.pixelRatio,1.4):GPU.lt(4)?Math.min(Device.pixelRatio,1.5):GPU.lt(5)?Math.max(Device.pixelRatio,1.5):GPU.mobileLT(0)?1:GPU.mobileLT(1)?Math.min(Device.pixelRatio,1.2):GPU.mobileLT(2)?Math.min(Device.pixelRatio,1.35):GPU.mobileLT(3)?Math.min(Device.pixelRatio,1.5):GPU.mobileLT(4)?Math.min(Device.pixelRatio,2):1},this.renderShadows=function(){return GPU.gt(2)},this.mobilePhone=function(){return Device.mobile&&Device.mobile.phone}}),"static"),Class((function PlayerModel(){Inherit(this,Model);const _this=this,consoleSecurity=require("ConsoleSecurity");var _data={};let _room,_timeout,_pending={};_this.UPDATE="playermodel_update",_this.state=AppState.createLocal(),_this.state._set=_this.state.set,_this.state.set=_this.set;const DEFAULT_UID="uid_"+Date.now().toString(),DEFAULT_NAME="Player "+DEFAULT_UID,DEFAULT_IMAGE="assets/images/avatar/placeholder.png",DB_EXCLUDE=["gcmedia_speaking","gcmedia_mute_audio","gcmedia_mute_video","isVR"];function updatedImage(image){_this.data.image=image,_room&&_room.updateUserData&&_room.updateUserData(_this.data),_this.events.fire(_this.UPDATE)}function updatedProfile(){_this.data.name=User.profile&&User.profile.displayName,_room&&_room.updateUserData&&_room.updateUserData(_this.data),_this.events.fire(_this.UPDATE)}function loggedIn(){_this.data.uid=User.uid,_this.data.name=User.profile&&User.profile.displayName||"Player",_this.data.image=User.state.get(User.PROFILE_IMAGE)||DEFAULT_IMAGE,_room&&_room.updateUserData&&_room.updateUserData(_this.data),_this.events.fire(_this.UPDATE)}function loggedOut(){let data={name:DEFAULT_NAME,uid:DEFAULT_UID,image:DEFAULT_IMAGE};for(let key in data)_this.data[key]=data[key];_room&&_room.updateUserData&&_room.updateUserData(_this.data),_this.events.fire(_this.UPDATE)}function saveToDB(){User.uid?(PlatformFirestore.collection("players").doc(User.uid).set(_pending,{merge:!0}),_pending={}):Config.ANONYMOUS_CHAT&&Config.API&&(post(Config.API.replace("/dream","/anon-users")+"/updateUser",{uid:_this.get("uid"),data:_pending}),_pending={})}!async function(){if(await Hydra.ready(),await Config.ready(),AssetLoader.waitForLib("GameCenter").then((_=>{GameCenter.userData=_this.data})),Config.SERVICES?.auth&&!Device.detect("aura desktop")){await User.ready();if(await User.checkLoginStatusOnce()){let _player=await async function getFromDB(){if(User.uid){let player=await PlatformFirestore.collection("players").doc(User.uid).get();return player.exists?player.data():{}}return{}}(),data={name:User.profile&&User.profile.displayName||"Player",image:User.state.get(User.PROFILE_IMAGE)||DEFAULT_IMAGE,uid:User.uid,..._player};for(let key in data)_this.data[key]=data[key]}else{let data={name:DEFAULT_NAME,image:DEFAULT_IMAGE,uid:DEFAULT_UID};for(let key in data)_this.data[key]=data[key];_this.dataReady=!0}!function addAuthHandlers(){User.loggedIn(loggedIn),User.loggedOut(loggedOut),User.state.bind(User.PROFILE_IMAGE,updatedImage),User.state.bind(User.PROFILE,updatedProfile)}()}else{let data=Storage.get("playerModel")||{};for(let key in data)_this.data[key]=data[key];if(!_this.get("name"))if("undefined"!=typeof DreamName&&DreamName.generate){const newName=await DreamName.generate();_this.set("name",newName)}else _this.set("name","Attendee");_this.get("uid")||_this.set("uid",DEFAULT_UID,!0),_this.get("image")||_this.set("image",DEFAULT_IMAGE)}for(let key in _this.data)_this.state._set(key,_this.data[key]);_room&&_room.updateUserData&&_room.updateUserData(_this.data),_this.dataReady=!0}(),_this.get("data",(()=>!(!Hydra.LOCAL&&consoleSecurity())&&_data)),_this.get=function(key){return _this.data[key]},_this.set=function(key,value,bypassDatabase=!1){if("data"===key)throw"PlayerModel :: Do NOT set a key called data";if(!Hydra.LOCAL&&consoleSecurity())return!1;Array.isArray(value)&&(value=value.slice()),_this.data&&_this.data[key]&&_this.data[key]===value||(_this.data[key]=value,_this.state._set(key,value),Config.SERVICES?.auth||Config.ANONYMOUS_CHAT?(_timeout&&clearTimeout(_timeout),bypassDatabase||DB_EXCLUDE.includes(key)||(_pending[key]=value,_timeout=_this.delayedCall(saveToDB,100))):Storage.set("playerModel",_this.data),_room&&_room.updateUserData&&_room.updateUserData(_this.data),_this.events.fire(_this.UPDATE))},_this.useRoom=function(room){_room=room}}),"static"),Class((function Router(){Inherit(this,Component),Inherit(this,PushState);const _this=this;var _data={};async function onUpdate(e){let guards=[];_this.events.fire(_this.BEFORE_UPDATE,{addGuard:function(promise){guards.push(promise)}}),await Promise.all(guards),_this.events.fire(_this.UPDATE,e)}_this.BEFORE_UPDATE="router_before_update",_this.UPDATE="router_update",function(){_this.fireChangeWhenSet=!0,Hydra.LOCAL||_this.setRoot(function getBasePath(){var bases=document.getElementsByTagName("base");if(bases.length>0){return new URL(bases[0].href).pathname}return"/"}());let state=(_this.getState()||"").split("/"),end=state[state.length-1];end.includes("?")&&(_this.virtualQuery=!0,end=end.substring(end.indexOf("?")+1),end.split("&").forEach((pair=>{let[key,value]=pair.split("=");void 0===value&&(value=!0),Utils.query(key,value)}))),_this.events.sub(_this,Events.UPDATE,onUpdate)}(),this.getState=function(){return(this._getState()||"").split("?")[0].split("/").filter(Boolean)},this.getStateString=function(){return this.getState().join("/")},this.getData=function(){return _data},this.setData=function(data){_data=data},this.setState=function(state,forced){Transition.instance().flag("animating")||_this._setState(state,forced)}}),"static"),Class((function User(){Inherit(this,Model);const _this=this,prototype=User.prototype;let _uid,_user,_claims,_profile,_unsubscribe,_statusPromise,_loggedInPromise,_loggedOutPromise,_isLoggedIn,_isNew,_wait,_waitForLoggedInEvent,_initialState=!0;_this.LOGGED_IN_EVENT="dream_fire_login",_this.INIT_STATE="dream_init_state",_this.LOGGED_IN="dream_user_logged_in",_this.LOGGED_OUT="dream_user_logged_out",_this.PROFILE="dream_user_profile",_this.PROFILE_IMAGE="dream_user_profile_image",_this.CLAIMS="dream_user_claims",_this.STATUS="dream_user_status",_this.DEFAULT_IMAGE="assets/images/avatar/placeholder.png",_this.state=AppState.createLocal(),async function(){await Hydra.ready(),await Config.ready(),Config.SERVICES&&Config.SERVICES.database&&Config.SERVICES.auth?(await PlatformServices.ready(),await PlatformDB.ready(),await PlatformAuth.ready(),function addHandlers(){PlatformAuth.AUTH.onAuthStateChanged((user=>{if(!_wait||user)return user?void(_waitForLoggedInEvent?_this.state.bind(_this.LOGGED_IN_EVENT,onLoggedIn(user)):onLoggedIn(user)):function onLoggedOut(){_uid=null,_profile=null,_claims=null,_user=null,_isLoggedIn=!1,_unsubscribe&&_unsubscribe(),_initialState?(_this.events.fire(PlatformAuth.INIT_STATE),_this.state.set(_this.STATUS,_this.INIT_STATE),_initialState=!1):(_this.events.fire(PlatformAuth.LOGGED_OUT),_this.state.set(_this.STATUS,_this.LOGGED_OUT),Track.event("auth","loggedOut"))}();_wait=!1}))}()):Config.PROD||console.warn("User::constructor  Config.SERVICES.database and Config.SERVICES.auth are not enabled"),_this.dataReady=!0}();function setProfile(data){data&&(_profile=data,_profile?.claims||(_profile.claims={}),_claims=Object.freeze(_profile.claims),Object.defineProperty(_profile,"claims",{writable:!1,configurable:!1}),_this.state.set(_this.CLAIMS,_claims),_this.state.set(_this.PROFILE,_profile),_this.state.set(_this.PROFILE_IMAGE,_profile?.image||_this.DEFAULT_IMAGE))}function onLoggedIn(firebaseUser){if(_user=firebaseUser,_uid=firebaseUser&&firebaseUser.uid,!_uid)return null;_waitForLoggedInEvent&&(_waitForLoggedInEvent=!1),PlatformFirestore.collection("users").doc(_uid).get().then((snapshot=>{snapshot.exists?(_isNew=!1,setProfile(snapshot.data())):_isNew=!0,function onProfileUpdated(user){_unsubscribe&&_unsubscribe(),_unsubscribe=PlatformFirestore.collection("users").doc(user.uid).onSnapshot((function(snapshot){if(_initialState)return _initialState=!1;setProfile(snapshot.data())}),(error=>{console.log("FIRESTORE UPDATED ERROR",error)}))}(firebaseUser),_isLoggedIn=!0,_initialState?(_this.events.fire(PlatformAuth.INIT_STATE),_this.state.set(_this.STATUS,_this.INIT_STATE),_initialState=!1):_this.state.set(_this.STATUS,_this.LOGGED_IN),_this.events.fire(PlatformAuth.LOGGED_IN,firebaseUser),Track.event("auth","loggedIn")})).catch((err=>{PlatformAuth.loginError(err)}))}prototype.getIdToken=function(){return _user.getIdToken()},prototype.getTokenClaims=async function(){return await _user.getIdTokenResult(!0).then((idTokenResults=>idTokenResults.claims))},prototype.updateProfile=async function(data){if(_uid)return delete data.email,delete data.claims,data=(obj=>{const stringified=JSON.stringify(obj);return JSON.parse(stringified)})(data),await PlatformFirestore.collection("users").doc(_uid).set(data,{merge:!0}),await _user.updateProfile(data),_profile={..._profile,...data},_profile},prototype.uploadProfileImage=async function(base64,filenameOverride){if(!_uid)return;if(!base64)return;let token=await _user.getIdToken();if(!token)return;let response=await post(Config.API+"-users/upload",{profileImage:base64,filenameOverride:filenameOverride},{headers:{token:token,"Content-Type":"application/json"}});return _this.state.set(_this.PROFILE_IMAGE,response.permalink),response},prototype.deleteProfile=function(){return _uid?PlatformFirestore.collection("users").doc(_uid).delete():null},prototype.isAdmin=function(){return _claims&&_claims.admin},prototype.loggedIn=function(callback){_loggedInPromise||(_loggedInPromise=Promise.create());let binding=_this.state.bind(_this.STATUS,(info=>{switch(info){case _this.LOGGED_IN:_loggedInPromise.resolve(_profile),callback&&callback(_profile)}})),results=[_loggedInPromise,binding];return _loggedInPromise[Symbol.iterator]=results[Symbol.iterator].bind(results),_loggedInPromise},prototype.loggedOut=function(callback){_loggedOutPromise||(_loggedOutPromise=Promise.create());let binding=_this.state.bind(_this.STATUS,(info=>{switch(info){case _this.LOGGED_OUT:_loggedOutPromise.resolve(),callback&&callback()}})),results=[_loggedOutPromise,binding];return _loggedOutPromise[Symbol.iterator]=results[Symbol.iterator].bind(results),_loggedOutPromise},prototype.checkLoginStatusOnce=function(){if(_statusPromise||(_statusPromise=Promise.create()),!Config.SERVICES||!Config.SERVICES.database||!Config.SERVICES.auth)return Config.PROD||console.warn("User::checkLoginStatusOnce  Config.SERVICES.database and Config.SERVICES.auth are not enabled"),_statusPromise.resolve(!1),_statusPromise;let binding=_this.state.bind(_this.STATUS,(info=>{switch(info){case _this.INIT_STATE:_isLoggedIn?_statusPromise.resolve(_isLoggedIn):_statusPromise.resolve(!1)}})),results=[_statusPromise,binding];return _statusPromise[Symbol.iterator]=results[Symbol.iterator].bind(results),_statusPromise},prototype.logout=async function(){if(PlatformAuth.AUTH)return Track.event("auth","logout"),await(window.DreamPresence?.beforeLogout()),PlatformAuth.signOut();console.error("Auth not ready")},_this.get("uid",(()=>_uid)),_this.get("profile",(()=>_profile)),_this.get("claims",(()=>_claims)),_this.get("email",(()=>_user&&_user.email)),_this.get("isDataEmpty",(()=>_isNew)),_this.set("waitForQuery",(val=>{_wait=val})),_this.set("waitForLoggedInEvent",(val=>{_waitForLoggedInEvent=val}))}),"static"),User.Class((function Storage(){Inherit(this,Model);const _this=this;var _data={},_isLoggedIn=!1;async function loggedIn(){_isLoggedIn=!0;let snapshot=await PlatformFirestore.collection("storage").doc(User.uid).get();_data=snapshot.data()||{},_this.dataReady=!0}function loggedOut(){_data={},_isLoggedIn=!1,_this.dataReady=!1}!async function(){await Hydra.ready(),await User.ready(),function addHandlers(){User.loggedIn(loggedIn),User.loggedOut(loggedOut)}(),await User.checkLoginStatusOnce()&&await loggedIn()}(),_this.set=function(key,value){_isLoggedIn?(_data[key]=value,PlatformFirestore.collection("storage").doc(User.uid).set({[key]:value},{merge:!0})):Hydra.LOCAL&&console.log("data not yet available. must be logged in.")},_this.get=function(key){if(_isLoggedIn)return _data[key];Hydra.LOCAL&&console.log("data not yet available. must be logged in.")},_this.clear=function(){_isLoggedIn?(_data={},PlatformFirestore.collection("storage").doc(User.uid).set({})):Hydra.LOCAL&&console.log("data not yet available. must be logged in.")},_this.data=function(){if(Hydra.LOCAL)return _data}}),"static"),Class((function RoutesController(){Inherit(this,Model);const _this=this;let routesData=null;_this.state=AppState.createLocal(),_this.onRouteChange=async function onRouteChange({path:path}){let nextPath=path,matchedRouteData=routesData.find((({regex:regex})=>new RegExp(regex).test(nextPath)));if(!matchedRouteData)return{world:nextPath.split("/")[0]};let world=matchedRouteData.world;"function"==typeof matchedRouteData.world&&(world=matchedRouteData.world(),world?.then&&(world=await world),matchedRouteData.world=world);if(matchedRouteData.guard){let guardResult=matchedRouteData.guard({world:world,path:nextPath});if(guardResult?.then&&(guardResult=await guardResult),!("path"in guardResult)||!("world"in guardResult))throw Hydra.LOCAL&&console.warn("Guard result ",guardResult),new Error("Route guards must return a world and path");if(guardResult.path!==nextPath&&(nextPath=guardResult.path,Router.replaceState(nextPath)),matchedRouteData=routesData.find((({regex:regex})=>new RegExp(regex).test(nextPath))),!matchedRouteData)return{world:nextPath.split("/")[0]}}return _this.state.set(_this.ROUTE_CONTROLLER_CHANGE,{path:nextPath,matchedRouteData:matchedRouteData}),matchedRouteData},_this.ROUTE_CONTROLLER_CHANGE="ROUTE_CONTROLLER_CHANGE",async function(){await Hydra.ready(),await _this.wait((()=>routesData&&routesData.length)),_this.dataReady=!0}(),_this.registerRoutes=async function(routes){routesData=routes.map((({path:path,...rest})=>{if(void 0===path)throw new Error("RoutesController: route requires a path");if(!("world"in rest))throw new Error(`RoutesController: ${path} requires a world`);if("global"===rest.world)throw new Error('"global" world is not allowed https://bit.ly/3KWGGPP');return Hydra.LOCAL&&!("view"in rest)&&console.warn(`RoutesController: ${path} registered without a UI view!`),{regex:"object"==typeof path?new RegExp(path):`^${path}/?$`,...rest}}))}}),"static"),Class((function Container(){Inherit(this,Element);const _this=this,$this=this.element,USING_XR=Platform.usingVR();!async function(){Config.MOUNTS?.includes("loader")&&await Platform.initCustomLoader(),Global.PLAYGROUND=!!Hydra.LOCAL&&((Router.virtualQuery||location.search.indexOf("p=")>0)&&Utils.query("p")),function initHTML(){Stage.add($this),$this.css({width:"100%",height:"100%"})}(),async function loadView(){if("undefined"!=typeof LoaderConfig){let errorViewClass=LoaderConfig.errorView?.();if(errorViewClass)return _this.initClass(errorViewClass)}let loader=_this.initClass(AssetLoader,Assets.list().filter(["shaders","uil"])),loaderView=_this.initClass(LoaderView,{loader:loader});loaderView.element.setZ(99999),_this.events.sub(loader,Events.PROGRESS,loaderView.progress),_this.events.sub(loader,Events.COMPLETE,(async()=>{Global.PLAYGROUND?loaderView.destroy():loaderView.animateOut(((selfDestructs=!1)=>{selfDestructs||(loaderView=loaderView.destroy()),_this.events.fire(Container.LOADED)}))})),loader.add(3),await loader.loadModules(),loader.trigger(1),await Initializer3D.createWorld(),await async function loadComplete(){USING_XR?async function waitForInteraction(){if(Platform.vrEntryOverride)return;let click=async e=>{Platform.vrEntryOverride||(await World.instance().initXR(RenderManager.WEBVR),Worlds.instance()),_this.events.unsub(Mouse.input,Interaction.CLICK,click)};window.AURA?click():_this.events.sub(Mouse.input,Interaction.CLICK,click)}():(await World.instance().init(),Worlds.instance(),$this.add(World.ELEMENT))}(),Platform.usingVR()?await Platform.prefetchVRWorld():await Worlds.instance().canDisplayFirstWorld();loader.trigger(2)}()}()}),"singleton",(_=>{Container.LOADED="Container.LOADED"})),Class((function ActivityEnvironment(){this.instance=function(){}}),"static"),Class((function BaseEnvironment(){Inherit(this,Object3D);var _activeName;this.mount=function(ref,scene){_activeName=ref.name,Lighting.createScene(_activeName,scene.scene||scene).useScene(_activeName)},this.unmount=function(){Lighting.destroyScene(_activeName)},this.activate=function(){},this.deactivate=function(){}})),Class((function GlobalEnvironment(){Inherit(this,BaseEnvironment);const _this=this;var _view,PlayerClass;this.mount=async function(ref,scene,params){this._mount(ref,scene.scene);let view=_this.initClass(ref,scene,params);return view._type="global",scene.scene.add(_this.group),await view.loaded(),view},this.unmount=function(){_this.group._parent&&_this.group._parent.remove(_this.group),_view&&_this.group.remove(_view.group),this._unmount()},this.activate=function(view){_view=view,_this.group.add(_view.group),this._activate(),GroupEnvironment.instance().deactivate(),defer((()=>{_view._playerReady.resolve()}))},this.deactivate=function(){this._deactivate()},this.registerPlayerClass=function(ref){return PlayerClass=ref,this},this.getPlayerClass=function(){return PlayerClass||DefaultCrowdAvatar},this.get("view",(_=>_view))}),"singleton"),Class((function GroupEnvironment(_clone){Inherit(this,BaseEnvironment);const _this=this;var _view,_thread,_camera,PlayerClass,_player,_bvhCollider,_chairs;class BVHHitMesh extends Mesh{}function loop(){_camera.fov=World.CAMERA.fov,_camera.near=World.CAMERA.near,_camera.far=World.CAMERA.far,_camera.aspect=World.CAMERA.aspect,World.CAMERA.getWorldPosition().toArray(_camera.position),World.CAMERA.getWorldQuaternion().toArray(_camera.quaternion),_thread.updateCamera(_camera)}function onConnection(e){let player=_this.initClass(Player,PlayerClass,_view,e.id,e.player);_view.group.add(player.group)}function onRoomConnected({room:room}){}!async function(){!function initThread(){_thread=_this.initClass(Thread,EnvironmentCollisionThread),Utils3D.loadEngineOnThread(_thread),_thread.importScript(Assets.getPath("~assets/js/lib/bvh.min.js"))}(),_this.startRender(loop),_camera={position:[],quaternion:[]},await AssetLoader.loadAssets(["~assets/js/lib/bvh.min.js"]),BVHHitMesh.prototype.raycast=MeshBVHLib.acceleratedRaycast}(),this.mount=async function(ref,scene,params,portal){Lighting.createScene(ref.name,scene.scene||scene).useScene(ref.name);let view=_this.initClass(ref,scene,params);return view._type="activity",portal?(_this.group.remove(view.group),scene.scene.add(view.group)):scene.scene.add(_this.group),await view.loaded(),view},this.unmount=function(){_player&&_player.destroy&&_player.destroy(),_this.group._parent&&_this.group._parent.remove(_this.group),_view&&_this.group.remove(_view.group),this._unmount()},this.activate=function(view,scene){if(view==_view)return;GlobalEnvironment.instance().deactivate(),_view&&_view.isActive&&_view.deactivate(),async function(){let chairs=await view.getChairs();chairs&&(_chairs=chairs,console.log(_chairs)),await AssetLoader.waitForLib("MeshBVHLib");let hit=await view.getHitMesh();if(hit){let{position:position,normal:normal,uv:uv}=hit.geometry.attributes,pos=new Float32Array(position.array),n=new Float32Array(normal.array),v=new Float32Array(uv.array),i=hit.geometry.index?new(Geometry.arrayNeedsUint32(hit.geometry.index)?Uint32Array:Uint16Array)(hit.geometry.index):void 0;hit.matrix.compose(hit.position,hit.quaternion,hit.scale),hit.matrixWorld.copy(hit.matrix);let matrix=hit.matrixWorld.toArray(),config=hit._hitMeshConfig||{},bvh=await _thread.mount({position:pos,normal:n,matrix:matrix,uv:v,index:i,config:config},[pos.buffer,n.buffer,v.buffer]);const _hit={geometry:new Geometry};_hit.geometry.addAttribute("position",new GeometryAttribute(bvh.geometry.position,3)),_hit.geometry.addAttribute("normal",new GeometryAttribute(bvh.geometry.normal,3)),_hit.geometry.addAttribute("uv",new GeometryAttribute(bvh.geometry.uv,2)),_hit.geometry.boundingBox=new Box3((new Vector3).set(bvh.geometry.boundingBox.min.x,bvh.geometry.boundingBox.min.y,bvh.geometry.boundingBox.min.z),(new Vector3).set(bvh.geometry.boundingBox.max.x,bvh.geometry.boundingBox.max.y,bvh.geometry.boundingBox.max.z)),_hit.geometry.boundingSphere=new Sphere((new Vector3).set(bvh.geometry.boundingSphere.center.x,bvh.geometry.boundingSphere.center.y,bvh.geometry.boundingSphere.center.z),bvh.geometry.boundingSphere.radius),_hit.geometry.boundsTree=MeshBVHLib.MeshBVH.deserialize(bvh.serialized,_hit.geometry),_hit.collider=new BVHHitMesh(_hit.geometry),_bvhCollider=_this.initClass(EnvironmentBVHCollider,_hit);let hitVR=await view.getHitMeshVR();if(hitVR){hitVR.geometry.index&&(hitVR.geometry=hitVR.geometry.toNonIndexed());let{position:position,normal:normal,uv:uv}=hitVR.geometry.attributes,posVR=new Float32Array(position.array),nVR=new Float32Array(normal.array),scaleVR=hitVR.scale.toArray(),v=new Float32Array(uv.array);_thread.mountVR({position:posVR,normal:nVR,scaleVR:scaleVR,uv:v},[posVR.buffer,nVR.buffer,v.buffer])}}else _bvhCollider=_this.initClass(EnvironmentBVHCollider,null),_thread.clear()}(),scene?.scene?.add?.(_this.group),_view=view,this._activate(),function addListeners(){_view.events.sub(PhysicalSync.CONNECTION,onConnection),_view.events.sub(Multiplayer.ROOM,onRoomConnected)}(),_this.group.add(_view.group);let player=_this.initClass(Player,PlayerClass,_view);_view.group.add(player.group),_player=player},this.deactivate=function(){_bvhCollider=_bvhCollider?.destroy();try{_player&&(_view.group&&_view.group.remove(_player.group),_player&&_player.destroy&&_player.destroy())}catch(e){}!function removeListeners(){_view&&_view.events&&(_view.events.unsub(PhysicalSync.CONNECTION,onConnection),_view.events.unsub(Multiplayer.ROOM,onRoomConnected))}(),this._deactivate(),_view&&(_view.deactivate&&_view.deactivate(),_this.group.remove(_view.group),_view=null)},this.registerPlayerClass=function(ref){return PlayerClass=ref,this},this.clone=function(){return new GroupEnvironment(!0)},this.get("collision",(_=>_thread)),this.get("chairs",(_=>_chairs)),this.get("bvh",(_=>_bvhCollider)),this.get("player",(_=>_player)),this.get("view",(_=>_view))}),"singleton"),Class((function VideoChatZones(_config,_interaction){Inherit(this,Object3D);const _this=this;var _connect,_disconnect,_prompt,_promptPromise,_block,_pendingUser,_view,_autoJoinId,_speakingUniform,_joinedZone,_zones=[],_zoneMap={},_debounce={},_offset=-1;const VR=Platform.usingVR(),USER_MODEL=!!window.User?.profile,DREAM_DND=!!window.DreamDND,DreamModeration=window.DreamModeration;function prune(){if(_this.popAllZones){try{let uid=PlayerModel.get("uid")||Multiplayer.room.me.id;for(let i=_zones.length-1;i>-1;i--){let zone=_zones[i];zone.users.includes(uid)&&(_joinedZone!=zone||distanceTo2D(zone.position,_interaction.localPlayer.position)>1.01*zone.radius)&&zone.forceLeave()}}catch(e){}setTimeout(prune,1e3)}}async function createZone(pos,radius=_config.radius,custom){if(_this.flag("pendingZone"))return;if(_this.flag("pendingZone",!0,1e3),_this.flag("inZone"))return;for(let i=0;i<_zones.length;i++){if(_zones[i].position.distanceTo(_interaction.localPlayer.position)<.5*radius)return void 0}let unique=Utils.uuid();return custom&&(unique+="forced"),Multiplayer.room.pin({chatZone:!0,unique:unique,pos:pos.toArray(),radius:radius},10800),unique}function joinZone(zone){zone.canJoin()&&!_this.flag("inZone")&&zone.join&&(zone.join(),_this.flag("inZone",!0),Multiplayer.room.mediaId=zone.id,_joinedZone&&_joinedZone.leave?.(),_joinedZone=zone,async function connect(){if(window.VideoModel?.setVolume?.(1,.3),_this.flag("connecting"))return;_this.flag("connecting",!0),false;await _connect,await _disconnect,_connect=await GameCenterMedia.useRoom(Multiplayer.room),_view?.connect(),VideoChatZones.localVideoMuted&&GameCenterMedia.userStream.disableVideo();VideoChatZones.localAudioMuted&&GameCenterMedia.userStream.disableAudio();AVSettingsController.instance().audioEnabled=!VideoChatZones.localAudioMuted,AVSettingsController.instance().videoEnabled=!VideoChatZones.localVideoMuted,_this.flag("connecting",!1),_this.flag("connected",!0),false;_this.events.fire(VideoChatZones.CONNECTED,{id:_joinedZone.id}),_joinedZone||disconnect()}())}function canUseZones(){return!!GameCenterMedia.hasMediaAccess&&((!USER_MODEL||!(User.profile&&User.profile.dnd||DreamModeration?.isBanned()))&&((!DREAM_DND||!DreamDND.state.get("dnd"))&&(!PlayerModel.get("localDND")&&!_this.disabled)))}function distanceTo2D(a,b){let dx=a.x-b.x,dy=a.z-b.z;return Math.sqrt(dx*dx+dy*dy)}function loop(){if(_prompt.zone&&null==_prompt.zone.events&&(_prompt.zone=null),_joinedZone&&null==_joinedZone.events&&(_joinedZone=null),!_joinedZone&&_this.flag("connected")&&disconnect(),canUseZones()){if(_this.interacting=_prompt.capture.isHitting,_block){if(_interaction.localPlayer.position.distanceTo(_block)<=1.05*_config.radius)return;_this.flag("blockPrompts",!1),_block=null}if(_pendingUser&&(_interaction.localPlayer.position.distanceTo(_pendingUser)>1.2*_config.playerDistance||!_debounce.player.parent))return _pendingUser=null,clearPrompt(),void _this.flag("swapPrompt",!0,100);for(let i=_zones.length-1;i>-1;i--){let zone=_zones[i];distanceTo2D(zone.position,_interaction.localPlayer.position)<zone.radius?(!zone.canJoin()&&_this.flag("openPrompt")&&clearPrompt(),_this.flag("inZone")||_this.flag("openPrompt")||(_this.flag("granted")?joinZone(zone):zone.canJoin()?(UICopy.state.chatzoneTitle=UICopy.state.chatzoneJoin,prompt(zone.position,zone.users).then((confirm=>{"disappear"!=confirm&&void 0!==confirm?confirm?(Track.event("chatzone","accepted_to_join","Joined a chat zone"),joinZone(zone)):block(zone.position):Track.event("chatzone","declined_to_join","Declined to join chat zone")})),_prompt.zone=zone):zone.toggleFullZoneAlert(!0))):(_this.flag("inZone")&&_joinedZone==zone&&!_this.flag("forceStayInZone")&&(zone.leave(),_joinedZone=null,_this.flag("inZone",!1),disconnect()),_prompt.showing&&_prompt.zone&&_prompt.zone==zone&&_this.flag("openPrompt")&&clearPrompt(),zone.toggleFullZoneAlert(!1))}}}async function disconnect({reason:reason=null}={}){window.VideoModel?.setVolume?.(1,1),_joinedZone=null,_this.flag("inZone",!1),_this.flag("connected",!1),_this.parent.avatarProfileGrid?.removeAllVideo(),await _connect,await _disconnect,_this.flag("disconnecting",!0),_disconnect=await GameCenterMedia.useRoom(!1),_view?.disconnect(),_this.flag("disconnecting",!1),PlayerModel.set("gcmedia_speaking",!1),_this.events.fire(VideoChatZones.DISCONNECTED,{reason:reason})}function block(pos){_block=pos,_this.flag("blockPrompts",!0)}function clearPrompt(){_promptPromise&&(_promptPromise.resolve("disappear"),_prompt.close(),_this.flag("openPrompt",!1),_this.flag("debouncePrompt",!0,1e3),_prompt.showing=!1)}function proximityEvent(player){if(!_this._invisible&&player.group&&!player.gcPlayer.me&&(_this.flag("swapPrompt")||!(_this.flag("inZone")||_this.flag("openPrompt")||_this.flag("blockPrompts")||_this.flag("debouncePrompt")))&&canUseZones()&&!(_joinedZone||TriggerZone.IS_INSIDE||TriggerZone.IS_NEARBY||_interaction.localPlayer.position.distanceTo(player.group.position)>_config.radius||player.hidden||_config.blockSpawnArea&&_interaction.localPlayer.position.distanceTo(_config.blockSpawnArea.pos)<_config.blockSpawnArea.radius)){if(_config.blockMoreArea)for(let i=_config.blockMoreArea.length-1;i>-1;i--){let area=_config.blockMoreArea[i];if(area&&area.pos&&area.radius&&_interaction.localPlayer.position.distanceTo(area.pos)<area.radius)return}for(let i=_zones.length-1;i>-1;i--){if(_zones[i].position.distanceTo(player.group.position)<1.85*_config.radius)return}if(_pendingUser=player.group.position,_debounce.player!=player)return _debounce.player=player,void(_debounce.count=0);_debounce.count++<10||(_prompt.zone=null,UICopy.state.chatzoneTitle=UICopy.state.chatzoneCreate,prompt(player.group.position.clone(),[player.state.get("uid")]).then((confirm=>{"disappear"!=confirm&&void 0!==confirm?confirm?(Track.event("chatzone","accepted_to_join","Joined a chat zone"),createZone(_pendingUser)):block(_pendingUser):Track.event("chatzone","declined_to_join","Declined to join chat zone")})))}}function visibilityEvent(e){_this.flag("visibility","focus"==e.type)}function playerDisconnect(player){}async function playerJoin({player:player}){if(_this._invisible)return;if(!player.view)return;if(await player.view.ready(),!player.view)return;if(player.gcPlayer&&!player.gcPlayer.me&&!_this.parent.multiplayerConfig?.roomKey)return;let mesh=player.view.mesh;player.bindSpeakingVZ=player.state.bind("gcmedia_speaking",(speaking=>{_speakingUniform&&mesh.shader?.set(_speakingUniform,speaking?1:0)})),player.bindMuteAudioVZ=player.state.bind("gcmedia_mute_audio",(speaking=>{_speakingUniform&&mesh.shader?.set(_speakingUniform,0)}))}function playerLeave({player:player}){_this._invisible||(player.bindSpeakingVZ?.destroy?.(),player.bindMuteAudioVZ?.destroy?.())}function onBeforeStateChange(e){_this.flag("connected")&&(_this.flag("blockPromptsDisconnecting",!0,2e3),e.addGuard(disconnect()))}function localMuteVideo(muted){_this.flag("disconnecting")||(VideoChatZones.localVideoMuted=muted)}function localMuteAudio(muted){_this.flag("disconnecting")||(VideoChatZones.localAudioMuted=muted)}function handleSwitchView(){clearPrompt()}function handlePin({message:message}){if(!_this._invisible&&message.chatZone){let id=message.unique;if(_zoneMap[id])return void _zoneMap[id].update(message);if(_this.disabled)return;if(Array.isArray(message.users)&&(!message.users.length||function isInvalid(array){let a=[];for(let i=0;i<array.length;i++){let id=array[i];if(a.includes(id))return!0;a.push(id)}return!1}(message.users))&&!id.includes("forced"))return;let testPos=(new Vector3).fromArray(message.pos);for(let i=0;i<_zones.length;i++)if(id!=_zones[i].id&&_zones[i].position.distanceTo(testPos)<.8*_config.radius){if(!_this.flag("kill_zone_"+id)){_this.flag("kill_zone_"+id,!0,5e3);let pushArray={key:"users",value:"0"},popArray={key:"users",value:"0"};Multiplayer.room.pin({chatZone:!0,unique:id,pushArray:pushArray,popArray:popArray},99999)}return}false;let config={..._config};config.radius=message.radius;let zone=_this.initClass(VideoChatZone,message.pos,id,config,message.users);_this.events.sub(zone,Events.END,(_=>{_zones.remove(zone),_this.state.set("zones",[..._zones]),_this.group.remove(zone.group),delete _zoneMap[id],_prompt.zone==zone&&clearPrompt(),zone.destroy()})),_zones.push(zone),_zoneMap[id]=zone,_this.state.set("zones",[..._zones]),_autoJoinId==message.unique&&(joinZone(zone),_autoJoinId=null,_joinedZone=zone),zone.position.distanceTo(_interaction.localPlayer.position)<config.radius&&(_prompt.zone=zone)}}async function prompt(pos,otherUserIds){if((!window.WatchPartyManager||!WatchPartyManager.instance().state.active)&&!_this.flag("blockPromptsDisconnecting")&&(!_this.flag("debouncePrompt")||_this.flag("swapPrompt"))){if(window.AnonymousModeration){if(AnonymousModeration.isShadowBanned()&&!Config.PROD)return console.log("SHADOW BANNED, dont show prompt"),!1}if(window.User&&DreamModeration?.isBlockedByUsers?.(otherUserIds))return Config.PROD||console.log("BLOCKED! blocked by one of the other users, dont show prompt"),!1;if(1==otherUserIds.length){if(window.User&&DreamModeration?.isBlocked?.(otherUserIds[0]))return Config.PROD||console.log("BLOCKED! i have blocked this other user, dont show prompt"),_this.flag("openPrompt",!1),!1}else if(otherUserIds.length>1)for(let i=0;i<otherUserIds.length;i++)if(window.User&&DreamModeration?.isBlocked?.(otherUserIds[i]))return Config.PROD||console.log("BLOCKED! i have blocked one of the users in this chat zone, dont show prompt"),_this.flag("openPrompt",!1),!1;return _this.flag("openPrompt",!0),_prompt.promptOffsetFirstPerson(_offset),_prompt.setPosition(pos.clone().add(new Vector3(0,1,0))),_this.events.fire(VideoChatZones.PROMPT),_prompt.open(),_prompt.showing=!0,_promptPromise=Promise.create(),await _promptPromise,_prompt.close(),_this.flag("openPrompt",!1),_this.flag("debouncePrompt",!0,1e3),_prompt.showing=!1,_promptPromise}}async function handlePromptEnd(e){if(_prompt.close(),e.shouldStart){if("success"!==GameCenterMedia.state.get("hasMediaAccess")){if("no"===await GameCenterMedia.requestAudioVideoPermissionsRecursively(_config.audioOnly))return _promptPromise.resolve(!1)}_this.flag("granted",!0,1e3)}_promptPromise.resolve(e.shouldStart)}_config.radius||(_config.radius=5),_config.maxUsers||(_config.maxUsers=10),_config.playerDistance||(_config.playerDistance=1),_config.ui||(_config.ui=DreamUI.VideoChatZones),this.state=AppState.createLocal(),function(){if(_config.playerDistance*=VR?1.5:1,(_prompt=_config.customPrompt?_this.initClass(_config.customPrompt,_config.prompt||{}):_this.initClass(UIChatZonePrompt,_config.prompt||{})).group.scale.setScalar(0),_prompt.scale=1.25,_this.events.sub(_prompt,Events.COMPLETE,handlePromptEnd),_interaction.bindPlayerProximity(_config.playerDistance),_interaction.onProximityEvent=proximityEvent,_interaction.onRemovePlayer=playerDisconnect,_this.events.sub(Multiplayer.PIN,handlePin),_this.bindState(PlayerSettings.instance().state,"camera",handleSwitchView),_this.events.sub(Router.BEFORE_UPDATE,onBeforeStateChange),_this.events.sub(Player.JOIN,playerJoin),_this.events.sub(Player.LEAVE,playerLeave),_this.events.sub(Events.VISIBILITY,visibilityEvent),_this.startRender(loop,24),_this.parent.player&&(_this.bindState(_this.parent.player.state,"gcmedia_mute_video",localMuteVideo),_this.bindState(_this.parent.player.state,"gcmedia_mute_audio",localMuteAudio)),_this.flag("visibility",!0),Dev.expose("zones",_zones),Dev.expose("zoneMap",_zoneMap),Dev.expose("joinedZone",(_=>_joinedZone)),setTimeout(prune,1e3),!VR){if(void 0===_config.ui)throw Error("VideoChatZones.js Error:: You need to include DreamUI.VideoChatZones module in project.json OR create a custom UI.");_view=_this.initClass(_config.ui,_config,[_this.parent.getDOMElement()])}_this.tracking=_this.initClass(VideoChatZonesTracking)}(),this.get("dialog",(_=>_prompt)),this.promptOffsetFirstPerson=function(value){_offset=value},this.onDestroy=function(){_this.parent.group.remove(_this.group)},this.onVisible=function(){Render.TIME},this.onInvisible=this.disconnect=function(){return disconnect({reason:"onInvisible"})},this.popAllZones=function(){_this.disabled||(_this.disabled=!0,_this.flag("connected")&&(_joinedZone?.leave(),disconnect()))},this.setSpeakingUniform=function(key){return _speakingUniform=key,this},this.popJoinedZone=function(){_joinedZone?.forceEnd()},this.addBlockedArea=function(obj){if(_config.blockMoreArea||(_config.blockMoreArea=[]),Array.isArray(obj))obj.forEach((o=>{if(!o.pos||!o.radius)throw"addBlockedArea requires .pos && .radius";_config.blockMoreArea.push(o)}));else{if(!obj.pos||!obj.radius)throw"addBlockedArea requires .pos && .radius";_config.blockMoreArea.push(obj)}},this.createAndJoinZone=async function(pos,radius){let existing;_zones.forEach((zone=>{zone.id.includes("forced")&&(existing=zone)})),existing?joinZone(existing):_autoJoinId=await createZone(pos,radius,!0),_this.flag("forceStayInZone",!0)}}),(_=>{VideoChatZones.PROMPT="video_chat_zones_prompt",VideoChatZones.CONNECTED="video_chat_zones_connected",VideoChatZones.DISCONNECTED="video_chat_zones_disconnected"})),Class((function VideoChatZonesTracking(){Inherit(this,Component);const _this=this,DEBUG=Utils.query("debugVideoChatZones");new Map;let _players=[];function handleConnected({id:id}){_this.joinedTime=Date.now(),_this.id=id,_this.id?.includes("forced")&&Track.event("dream_portal","join",null)}function handleDisconnected(){if(!_this.id)return;const duration=Date.now()-_this.joinedTime,minutes=Math.floor(duration/6e4),seconds=(duration%6e4/1e3).toFixed(0),msToMinutes=`${minutes}:${seconds<10?"0":""}${seconds}`;_this.id?.includes("forced")?Track.event("dream_portal","leave",null,msToMinutes):Track.event("chatzone","leave",null,msToMinutes)}!function initHandlers(){DEBUG&&console.log("VideoChatZonesTracking::initHandlers"),_this.playerIds=new StateArray([]),_this.events.sub(VideoChatZones.CONNECTED,handleConnected),_this.events.sub(VideoChatZones.DISCONNECTED,handleDisconnected)}(),_this.get("players",(()=>_players))})),Class((function GlobalViewCamera(_env){Inherit(this,Component);const _this=this;var _input,_config,_camera,_scroll,_disabled,_useMobileBounds,_v2=new Vector2,_holdPos=new Vector3,_target=new Vector3,_move=new Vector3,_bounding=new Vector2,_zoomIn=new Vector3,_zoomOut=new Vector3,_dragScale=1,_v3=new Vector3,_targetZoom=(new Vector3,0),_zoom=0;const PROHIBITED_ELEMENTS=["hit","prevent_interaction3d"];function checkIfProhibited(e){let element=document.elementFromPoint(Math.clamp(e.x||0,0,Stage.width),Math.clamp(e.y||0,0,Stage.height));if(element){let el=element;for(;el;){for(let i=0;i<PROHIBITED_ELEMENTS.length;i++)if(el.classList&&el.classList.contains(PROHIBITED_ELEMENTS[i]))return"auto"!=_this.flag("cursor")&&(Stage.cursor("auto",_this),_this.flag("cursor","auto")),!0;el=el.parentNode}}else"grab"!=_this.flag("cursor")&&(Stage.cursor("grab",_this),_this.flag("cursor","grab"));return!1}function loop(){_targetZoom-=.008*_scroll.delta.y,_targetZoom=Math.clamp(_targetZoom,0,1),_zoom=Math.lerp(_targetZoom,_zoom,.1),_v3.copy(_zoomOut).lerp(_zoomIn,_zoom),_camera.position.set(_v3.x,_v3.y,_v3.z,!0),_camera.group.position.lerp(_target,.07)}function handleResize(){_useMobileBounds=Stage.width<Stage.height,updateBounding()}function updateBounding(){_bounding.fromArray((_useMobileBounds?_config.get("mobileBounding"):_config.get("bounding"))||[15,15])}function touchStart(e){checkIfProhibited(e)||_disabled||(_this.flag("dragging",!0),_holdPos.copy(_camera.group.position),Stage.cursor("grabbing",_this))}function touchMove(e){checkIfProhibited(e)||_disabled||_this.flag("dragging")&&(_v2.copy(e).sub(_input.hold),_move.x=_holdPos.x+.03*-_v2.x*_dragScale,_move.z=_holdPos.z+.03*-_v2.y*_dragScale,_move.applyQuaternion(_camera.group.quaternion),_target.copy(_move),_target.x>_bounding.x&&(_target.x=_bounding.x),_target.x<-_bounding.x&&(_target.x=-_bounding.x),_target.z>_bounding.y&&(_target.z=_bounding.y),_target.z<-_bounding.y&&(_target.z=-_bounding.y),_target.y=0)}function touchEnd(e){checkIfProhibited(e)||_disabled||(_this.flag("dragging",!1),Stage.cursor("grab",_this))}!async function(){(_camera=new GazeCamera).prefix="global_cam",function initScroll(){(_scroll=_this.initClass(Scroll,{limit:!1,lockMouseX:!0})).enabled=!Global.PLAYGROUND&&!_env.disableScroll}(),function initInput(){(_config=InputUIL.create("camera_"+Utils.getConstructorName(_env))).setLabel("Global Camera"),_config.addVector("positionIn",[0,13,16]),_config.addVector("positionOut",[0,13,16]),_config.addVector("rotation",[0,0,0]),_config.addVector("lookAt",[0,0,0]),_config.addVector("bounding",[15,15]),_config.addVector("mobileBounding",[5,2]),_config.addNumber("dragScale",1),_config.addNumber("orbitAmount",1),_config.addNumber("startZoom",.1),_config.onUpdate=_=>{_zoomIn.fromArray(_config.get("positionIn")||[]),_zoomOut.fromArray(_config.get("positionOut")||[]),_camera.position.fromArray(_config.get("positionOut")||[]),_camera.lookAt.fromArray(_config.get("lookAt")||[0,0,0]),_camera.group.rotation.fromArray(function radians(array){return[...array.map((v=>Math.radians(v)))]}(_config.get("rotation")||[0,0,0])),updateBounding(),_dragScale=_config.getNumber("dragScale")||1,_camera.moveXY.setScalar(_config.getNumber("orbitAmount")||1),_targetZoom=_zoom=_config.getNumber("startZoom")}}(),function addListeners(){(_input=_this.initClass(Interaction,Stage)).ignoreLeave=!0,_this.events.sub(_input,Interaction.START,touchStart),_this.events.sub(_input,Interaction.MOVE,touchMove),_this.events.sub(_input,Interaction.END,touchEnd),_this.onResize(handleResize)}(),_this.startRender(loop),CameraUIL.add(_camera),_config.onUpdate(),Stage.cursor("grab",_this),_this.flag("cursor","grab")}(),this.setFOV=function(fov){_camera.setFOV(fov)},this.onVisible=function(){_camera.lock()},this.onDestroy=function(){Stage.cursor("auto",_this)},this.disable=function(){Stage.cursor("auto",_this),_disabled=!0},this.enable=function(){Stage.cursor("grab",_this),_disabled=!1}})),Class((function Multiplayer(){Inherit(this,Component);const _this=this;var _room,_leaving,_joining;Utils.query("localsocket");const consoleSecurity=require("ConsoleSecurity");var PREVENT_CONNECTION=!1;let GameCenterRootClass,GameCenterRoomClass;async function leave(){_this.leaving=!0,_joining&&await _joining,_leaving&&await _leaving,_room&&(_leaving=Promise.create(),PhysicalSync.useRoom(null),_room&&_room.leave&&_room.leave(),_room=null,PlayerModel.useRoom(null),await GameCenterMedia.useRoom(null),_leaving.resolve(),_leaving=null,_this.leaving=!1)}function handlePin(e){_this.events.fire(_this.PIN,e)}function handleUnpin(e){_this.events.fire(_this.UNPIN,e)}function gameCenterBlocked(){}function handleError(){_room&&(_this.events.fire(_this.ERROR),leave())}function blocked(){if(Config.SETTINGS?.disableAdblockWarning)return;let timer=_this.delayedCall((_=>{alert("It appears you are using an ad blocker which is preventing you from interacting with other attendees. Please disable the ad blocker and refresh the page.")}),1e3);_this.events.sub(Worlds.LOADED,(_=>clearTimeout(timer)))}this.ROOM="multiplayer_room",this.PIN="multiplayer_pin",this.UNPIN="multiplayer_unpin",this.ERROR="multiplayer_error",async function(){await Hydra.ready(),await Config.ready(),await AssetLoader.waitForLib(Config.MULTIPLAYER_IS_FIREBASE?"GameCenterFirebase":"GameCenter"),GameCenterRootClass=Config.MULTIPLAYER_IS_FIREBASE?GameCenterFirebase:GameCenter,GameCenterRoomClass=Config.MULTIPLAYER_IS_FIREBASE?GameCenterRoomFirebase:GameCenterRoom,PREVENT_CONNECTION=Platform.preventFullAccess(),function addListeners(){_this.events.sub(GameCenter.LOST_CONNECTION,leave),AppState.bind(GameCenter.BLOCKED_ERROR,blocked)}(),await async function connect(){if(!0===Config.DISABLE_SOCKET)return;GameCenterRootClass.ports=Config.GAMECENTER_PORTS,GameCenterRootClass.connect(Config.GAMECENTER_SOCKET),Config.MAX_BITRATE&&(GameCenterMedia.maxBitrate=Config.MAX_BITRATE);Config.AGORA_APP_ID&&GameCenterMedia.connect(Config.AGORA_APP_ID,Config.AGORA_TOKEN_SERVER);_this.events.sub(GameCenter.BLOCKED_ERROR,gameCenterBlocked)}()}(),this.establish=async function(obj){if(!PREVENT_CONNECTION){_room&&leave(),_leaving&&await _leaving,_joining&&await _joining,_joining=Promise.create(),await _this.wait(100),PartyManager.JUMP_TO_LOCATION&&await GameCenter.connect(Config.GAMECENTER_SOCKET);try{let namespace=Config.MULTIPLAYER_NAMESPACE||"";if(obj.roomId){let fn=obj.watcher?GameCenterRootClass.watchRoom:GameCenterRootClass.joinRoom;obj.type=`${namespace+obj.roomKey}/${obj.roomId}`,_room=await fn(`${obj.community?"community_":""}${obj.type}${obj.silent?"_silent":""}`,obj)}else _room=await GameCenterRootClass.findRoom(`${obj.community?"community_":""}${namespace+obj.roomKey}${obj.silent?"_silent":""}`,obj)}catch(e){if(obj.roomId)return delete obj.roomId,this.establish(obj)}return Dev.expose("room",_room),_this.events.sub(_room,GameCenterRoom.PIN,handlePin),_this.events.sub(_room,GameCenterRoom.ERROR,handleError),_this.events.sub(_room,GameCenterRoom.UNPIN,handleUnpin),_this.events.fire(_this.ROOM,{room:_room}),PhysicalSync.useRoom(_room),PlayerModel.useRoom(_room),obj.chatZones||await GameCenterMedia.useRoom(_room),_this.delayedCall((_=>_joining.resolve()),100),_room}},this.failed=function(){_joining?.resolve(),_leaving?.resolve()},this.reset=function(){return leave()},this.pin=function(data,timeInSeconds){_room&&_room.pin(data,timeInSeconds)},this.unpin=function(data){_room&&_room.unpin(data)},this.get("room",(_=>!(!Hydra.LOCAL&&consoleSecurity())&&_room)),this.getRoomCount=async function(roomId){return roomId="community_"+roomId,(await GameCenterRootClass.getRoomCount(roomId)).count},this.bindGlobalEvent=function(evt,callback){Config.MULTIPLAYER_IS_FIREBASE?console.warn("bindGlobalEvent is not hooked up for Firebase"):PhysicalSync.createGlobalEvent(evt,callback)},this.unbindGlobalEvent=function(evt,callback){Config.MULTIPLAYER_IS_FIREBASE?console.warn("unbindGlobalEvent is not hooked up for Firebase"):PhysicalSync.deleteGlobalEvent(evt,callback)},this.fireGlobalEvent=function(evt,data){Config.MULTIPLAYER_IS_FIREBASE?console.warn("fireGlobalEvent is not hooked up for Firebase"):PhysicalSync.fireLocalEvent(evt,data)}}),"static"),Class((function PartyManager(){}),"singleton"),Class((function DreamColors(){Inherit(this,Component);const _this=this;function hexToRgba(hex,opacity){let c;if(/^#([A-Fa-f0-9]{3}){1,2}$/.test(hex))return c=hex.substring(1).split(""),3===c.length&&(c=[c[0],c[0],c[1],c[1],c[2],c[2]]),c="0x"+c.join(""),`rgba(${[c>>16&255,c>>8&255,255&c].join(",")},${opacity})`;throw new Error("Bad Hex")}_this.black="#000",_this.primary="#9b66d3",_this.gray="#ccc",_this.red="#f00",_this.yellow="#ffcf00",_this.steel="#6d7278",_this.white="#fff",_this.green="#55b750",_this.blue="#1B81F9",_this.accessibility=hexToRgba(_this.primary,.8),_this.online="#00E532",_this.gray800="#3C4043",_this.gray600="#80868B",_this.gray500="#959CA5",_this.gray300="#DADCE0",_this.gray200="#F1F3F4",_this.gray50="#FAFAFA",_this.blue600="#1A73E8",_this.blue500="#4285F4",_this.blue200="#72ABF1",_this.blue100="#E7F5F7",_this.blue50="#F6F9FE",_this.yellow600="#F9AB00",_this.yellow500="#FBBC04",_this.yellow200="#F5C64B",_this.yellow100="#F4EDE6",_this.green600="#1E8E3E",_this.green500="#34A853",_this.green200="#73C16B",_this.green100="#E4EFE6",_this.red600="#D93025",_this.red500="#EA4335",_this.red200="#F7BBBE",_this.red100="#F9EDED",this.hexToRgba=hexToRgba,this.setColors=colors=>{colors&&Object.keys(colors).forEach((key=>{_this[key]=colors[key]})),_this.flag("isReady",!0)},this.init=function(colors){_this.setColors(colors)},this.ready=function(){return _this.wait("isReady")}}),"singleton"),Class((function DreamComponentConfig(){Inherit(this,Component);const _this=this;this.setComponents=component=>{component&&Object.keys(component).forEach((key=>{_this[key]=component[key]})),_this.flag("isReady",!0)},this.ready=function(){return _this.wait("isReady")}}),"singleton"),Class((function DreamStyleguide(){Inherit(this,Component);const _this=this;this.setStyles=styles=>{styles&&Object.keys(styles).forEach((key=>{_this[key]=styles[key]}))},this.init=({fonts:fonts={primary:"Manrope"},styles:styles}={})=>{_this.fonts=fonts,_this.h1={font:"400 5.6rem/120% "+_this.fonts.primary},_this.h2={font:"400 4rem/135% "+_this.fonts.primary},_this.h3={font:"400 3.4rem/140% "+_this.fonts.primary},_this.h4={font:"400 2.8rem/140% "+_this.fonts.primary},_this.h5={font:"400 2.4rem/130% "+_this.fonts.primary},_this.bodyLarge={font:"400 1.6rem/150% "+_this.fonts.primary},_this.bodyMedium={font:"400 1.5rem/150% "+_this.fonts.primary},_this.bodySmall={font:"400 1.3rem/140% "+_this.fonts.primary},_this.label0={font:"500 1.2rem/110% "+_this.fonts.primary},_this.label1={font:"500 1.3rem/120% "+_this.fonts.primary},_this.label2={font:"500 1.4rem/130% "+_this.fonts.primary},_this.label3={font:"500 1.5rem/130% "+_this.fonts.primary},_this.label4={font:"500 1.7rem/150% "+_this.fonts.primary},_this.label5={font:"500 2rem/145% "+_this.fonts.primary},_this.buttonSmall={font:"400 1.35rem/100% "+_this.fonts.primary},_this.buttonMedium={font:"400 1.4rem/100% "+_this.fonts.primary},_this.buttonLarge={font:"400 1.7rem/100% "+_this.fonts.primary},_this.p1={fontFamily:_this.fonts.primary,fontSize:"1.6rem",lineHeight:"1.4"},_this.p2={fontFamily:_this.fonts.primary,fontSize:"1.5rem",lineHeight:"1.4"},_this.p3={fontFamily:_this.fonts.primary,fontSize:"1.4rem",lineHeight:"1.3"},_this.button={fontFamily:_this.fonts.primary,fontSize:"1.5rem"},_this.l1={fontFamily:_this.fonts.primary,fontSize:"1rem"},_this.withAccessibility={boxShadow:"0 0 0 0.25rem "+DreamColors.instance().accessibility},_this.withoutAccessibility={boxShadow:"none"},_this.visuallyHidden={border:0,clip:"rect(0 0 0 0)",height:"1px",margin:"-1px",overflow:"hidden",padding:0,position:"absolute",width:"1px"},styles&&this.setStyles(styles),_this.flag("isReady",!0)},this.ready=function(){return _this.wait("isReady")}}),"singleton"),Class((function Platform(){Inherit(this,Component);var _focusPromise,_awaitInteractions,_this=this,_required={},_proxies=[];this.isDreamPlatform=!0,this.PATH=Hydra.LOCAL?`${location.protocol}//${location.host}${location.pathname}`.toLowerCase():`${location.protocol}//${location.host}/`;var bases=document.getElementsByTagName("base");function onVisibility(e){"focus"==e.type?(_this.visibility="visible",_focusPromise&&_focusPromise.resolve()):(_this.visibility="blur",_focusPromise=null)}function warnRouting(){Hydra.LOCAL&&(console.warn("!!! You are using deprecated routing !!!"),console.warn("You should upgrade to RoutesController!"))}bases.length>0&&(this.PATH=bases[0].href),this.visibility="visible","//"==_this.PATH.slice(-2)&&(_this.PATH=_this.PATH.slice(0,-2)+"/"),Assets.BASE_PATH=_this.PATH,Assets.registerPath(_this.PATH,window.ASSETS),function addListeners(){_this.events.sub(Events.VISIBILITY,onVisibility)}(),Hydra.ready().then((_=>_this.hasInteracted())),this.initCustomLoader=function(){return Config.MOUNTS.remove("loader"),_this.require("loader")},this.waitForFocus=function(){return _focusPromise||(_focusPromise=Promise.create()),_focusPromise},this.mount=function(){if(window.Config&&Config.MOUNTS)return Promise.all(Config.MOUNTS.map((name=>_this.require(name,!0,!0))))},this.usingVR=function(){return!(!Hydra.LOCAL&&Config.PROD&&window.CustomWebXRPolyfill)&&(Device.system.xr.vr?!!window.CustomWebXRPolyfill||(!(!Device.mobile&&!Device.detect("oculus"))||Storage.get("using_desktop_vr")):!(!Hydra.LOCAL||!Device.detect("oculus")))},this.desktopVRAvailable=function(){return!Device.mobile&&!Device.detect("oculus")&&Device.system.xr.vr},this.toggleDesktopVR=function(bool){Storage.set("using_desktop_vr",bool),location.reload()},this.useFXAA=function(){return!1===this.msaaSamples()&&(!GPU.OVERSIZED&&(!GPU.lt(0)&&!GPU.mobileLT(2)))},this.enableWorldNukeMSAA=function(){return!!Hydra.LOCAL&&Utils.query("msaa")},this.msaaSamples=function(){return!(!Device.graphics.webgl.webgl2||this.forceWebGL1())&&(!GPU.OVERSIZED&&(!Device.system.xr.vr&&(!GPU.lt(2)&&(!GPU.mobileLT(2)&&(GPU.lt(3)||GPU.mobileLT(3)?2:4)))))},this.forceWebGL1=function(){return!!Utils.query("compat")||"chrome"==Device.system.browser&&"mac"==Device.system.os&&GPU.detect("amd radeon pro")&&3==GPU.TIER},this.blurFX=function(){return GPU.gt(2)},this.getPath=function(path){return path.includes("http")?path:_this.PATH+path},this.require=async function(perma,forceReload,assets){if(!forceReload&&_required[perma])return;_required[perma]=!0;let env=new WorldEnvironment(perma,!0);assets?await env.evaluateWithAssets():await env.evaluate()},this.prefetchVRWorld=async function(){if(Config.PLATFORM_CONFIG&&Config.VRMOUNTS)return Promise.all(Config.VRMOUNTS.map((name=>_this.require(name,!0,!0))));let key=await _this.getRoute(Router.getState()[0]||Config.DEFAULT_ROUTE);Worlds.stash[key]=await _this.require(key,!0,!0)},this.preloadWorldAndLayout=function(world,layout){new PreloadWorldLayout(world,layout)},this.overrideVREntry=function(){_this.vrEntryOverride=!0},this.enterVR=async function(){_this.flag("enterVR")||(_this.flag("enterVR",!0,2e3),await World.instance().initXR(RenderManager.WEBVR),Worlds.instance(),Stage.hide())},this.get("namespace",(_=>window)),this.runtimeES5=function(submodule){let promise=Promise.create(),modulePath=window.location.href.split("#!")[0].replace("platform/",`sections/${submodule}/`);var xhr=new XMLHttpRequest;return xhr.open("GET",`http://${window.location.hostname}/runtime/?${modulePath}`,!0),xhr.send(),xhr.onreadystatechange=function(){4==xhr.readyState&&promise.resolve()},promise},this.registerRoutes=function(routes){Config.DEPRECATED_ROUTING?function deprecatedRegisterRoutes(routes){warnRouting(),_proxies=routes.map((({guard:guard,path:path,world:world})=>({guard:guard,regex:"object"==typeof path?new RegExp(path):`^${path}/?$`,world:world})))}(routes):(Hydra.LOCAL&&console.warn("Platform.registerRoutes is deprecated, upgrade to RoutesController.registerRoutes()"),RoutesController.registerRoutes(routes))},this.getWorld=async function(perma){if(Config.DEPRECATED_ROUTING)return async function deprecatedGetRoute(perma){if(warnRouting(),!Global.PLAYGROUND){await _this.wait((()=>_proxies.length));let proxy=_proxies.find((({regex:regex,world:world})=>new RegExp(regex).test(perma)));if(proxy){let route=proxy.world;return proxy.guard?await proxy.guard(route):("function"==typeof proxy.world&&(route=proxy.world(),route?.then&&(route=await route)),route)}}return perma.split("/")[0]}(perma);if(Global.PLAYGROUND)return perma.split("/")[0];await RoutesController.ready();const{world:world}=await RoutesController.onRouteChange({path:perma});return world},this.getRoute=this.getWorld,this.hasInteracted=function(){if(_this.usingVR())return!0;if(_this.flag("interacted"))return!0;if(_this.flag("pendingInteraction"))return!1;_this.flag("pendingInteraction",!0);const touched=_=>{"ios"!=Device.system.os&&_this.flag("interacted",!0),_this.flag("pendingInteraction",!1),_this.events.unsub(Mouse.input,Interaction.START,touched),_this.events.unsub(Keyboard.DOWN,touched),_awaitInteractions?.forEach((cb=>cb())),_awaitInteractions=null};return _this.events.sub(Mouse.input,Interaction.START,touched),_this.events.sub(Keyboard.DOWN,touched),!1},this.awaitInteraction=function(callback){let promise=Promise.create();return callback||(callback=promise.resolve),_awaitInteractions||(_awaitInteractions=[]),_awaitInteractions.push(callback),promise},this.blockFirstLoad=function(){_this.usingVR()||Worlds.instance().blockFirstLoad()},this.unblockFirstLoad=function(){_this.usingVR()||Worlds.instance().unblockFirstLoad()},this.preventFullAccess=function(){return!!Utils.query("broadcastStudio")},this.renderShadowsAllInstances=function(){return!!GPU.gt(4)||!!GPU.mobileGT(4)}}),"static"),Class((function AppStyleController(){Inherit(this,Component);const _this=this;var _styleguide,_colors;_this.STYLEGUIDE_CHANGE="app_style_controller_styleguide_change",_this.COLORS_CHANGE="app_style_controller_colors_change",_styleguide=Styleguide,_colors=Colors,this.get("styleguide",(()=>_styleguide)),this.get("colors",(()=>_colors)),this.set("styleguide",(styleguide=>{_styleguide=styleguide,_this.events.fire(_this.STYLEGUIDE_CHANGE,{styleguide:_styleguide})})),this.set("colors",(colors=>{_colors=colors,_this.events.fire(_this.COLORS_CHANGE,{colors:_colors})}))}),"static"),Class((function Player(PlayerClass,_env,_id,_player){Inherit(this,PhysicalLink,_id),Inherit(this,Object3D);const _this=this;var _view,_vrL,_vrR,_forceHidden,_isLocal=!1,_isLocalVR=!1;const ENV_KEY=Utils.getConstructorName(_env);this.gcPlayer=_player,this.state=AppState.createLocal();var _scale={value:1};function loop(){let isZero=0==_this.group.position.x&&0==_this.group.position.y&&0==_this.group.position.z,hidden=!_isLocal&&isZero;_isLocalVR&&(hidden=!0),_forceHidden&&(hidden=!0),hidden?_this.flag("hidden")||_this.flag("hidden",!0):_this.flag("hidden")&&(_this.flag("hidden",!1),_scale.value=0,tween(_scale,{value:1},300,"easeOutCubic",1e3));let scale=_scale.value*(hidden?0:1);if(!isZero&&_isLocal&&(_this.controls.hidingMesh||_this.controls.hideMesh)&&(scale=_this.controls&&_this.controls?.hideMesh?0:.1),hidden&&(scale=0),DreamWorld.active){let frustum=DreamWorld.active.frustum,sphere=DreamWorld.active.testSphere;frustum&&sphere&&(sphere.center.copy(_this.group.position),frustum.intersectsSphere(sphere)||(scale=0))}_this.group.scale.setScalar(scale),_this.hidden=hidden}function initVRObjects(){_vrL=new Group,_vrR=new Group,_vrL.posTarget=new Vector4,_vrL.pos4=new Vector4,_vrR.posTarget=new Vector4,_vrR.pos4=new Vector4,_this.isVR=!0,_this.vrHandL=_vrL,_this.vrHandR=_vrR,_this.vrHeadPos=new Vector3}function updateLocation(){if(!_this.group)return Render.stop(updateLocation);Player.setLocation(ENV_KEY,_this.group)}function updateState(data){for(let key in data)_this.state.set(key,data[key]);_this.state.get("user_hidden")&&(_forceHidden=!0)}function handleData(){if(!_this.group)return Render.stop(handleData);let data=_this.group.eD;_this.extraData=_this.group.eD,data&&data.l&&4==data.l.length&&data.r&&4==data.r.length&&(_vrL||initVRObjects(),_vrL.posTarget.fromArray(data.l),_vrR.posTarget.fromArray(data.r),_vrL.pos4.lerp(_vrL.posTarget,PhysicalSync.baseLerp),_vrR.pos4.lerp(_vrR.posTarget,PhysicalSync.baseLerp),_vrL.position.copy(_vrL.pos4),_vrR.position.copy(_vrR.pos4),_this.vrHeadPos.copy(_this.group.position),_this.vrHeadPos.y=_vrL.pos4.w,data.lq&&(_vrL.targetQ||(_vrL.targetQ=(new Quaternion).fromArray(data.lq),_vrR.targetQ=(new Quaternion).fromArray(data.rq)),_vrL.quaternion.slerp(_vrL.targetQ,PhysicalSync.baseLerp),_vrR.quaternion.slerp(_vrR.targetQ,PhysicalSync.baseLerp)))}!async function(){!function setupData(){if(_id){let data=_player.data;data.data&&(data=data.data),updateState(data),_this.isVR=data.isVR,_this.isVR&&initVRObjects()}else updateState(PlayerModel.data)}(),_this.group.doNotProject=!0,_player&&(_player.dreamPlayer=_this),_this.view=_view=_this.initClass(PlayerClass),_id?function initRemote(){let data=_player.data;data.data&&(data=data.data);_view.setUserData(data,_player),_this.events.sub(_player,GameCenterPlayer.UPDATE_DATA,(({data:data})=>{data.data&&(data=data.data),_view.setUserData(data,_player),updateState(data)})),_scale.value=0,tween(_scale,{value:1},300,"easeOutCubic",1e3),_env.onConnectPlayer(_this),_env._onPlayerConnect(_this),_this.bindLink(_this.group,"player"),Render.start(handleData)}():async function initLocal(){let spawn;if(_isLocal=!0,_isLocalVR=!!Platform.usingVR(),PlayerModel.set("isVR",_isLocalVR),_view.setUserData(PlayerModel.data),updateState(PlayerModel.data),_this.events.sub(PlayerModel,PlayerModel.UPDATE,(_=>{_view.setUserData?.(PlayerModel.data),updateState(PlayerModel.data)})),!_env.config?.customSpawnCode){if(spawn=await _env.getSpawn(),spawn){spawn.visible=!1,spawn.origin=new Vector3;let bb=(new Box3).setFromObject(spawn);spawn.origin.x=Math.random(bb.min.x,bb.max.x,4),spawn.origin.y=spawn.position.y,spawn.origin.z=Math.random(bb.min.z,bb.max.z,4),_this.group.position.copy(spawn.origin)}}else{spawn=await _env.config.customSpawnCode(),_this.group.position.copy(spawn.position);let spawnArea=await _env.getSpawn();spawnArea&&(spawnArea.visible=!1)}try{let storedLocation=Player.getLocation(ENV_KEY);storedLocation&&(_env.config?.persistAvatarLocation||PartyManager.JUMP_TO_LOCATION)&&(Player.PERSIST_LOCATION_SCALAR&&storedLocation.position.multiplyScalar(Player.PERSIST_LOCATION_SCALAR),_this.group.position.copy(storedLocation.position),spawn.position.copy(storedLocation.position),spawn.origin=spawn.position.clone())}catch(e){}if(_this.group.initialPlayerPosition=_this.group.position.clone(),defer((_=>{_env.onConnectLocalPlayer&&_env.onConnectLocalPlayer(_this),_env._connectLocalPlayer&&_env._connectLocalPlayer(_this),_this.delayedCall((_=>{_env._playerReady?.resolve?.()}),500)})),!_this.bindLink)return;if(Platform.usingVR()){let nullGroup=new Group;nullGroup.eD=_this.extraData={l:[],r:[],a:0},_env.vrHandRotation&&(nullGroup.eD.lq=[],nullGroup.eD.rq=[]),_this.disableQuaternionData&&(nullGroup.noPSQuaternion=!0),_this.bindLink(nullGroup,"player"),_this.controls=_this.initClass(PlayerControlsVR,_this.group,_view,spawn,nullGroup)}else _this.disableQuaternionData&&(_this.group.noPSQuaternion=!0),_this.group.eD=_this.extraData={a:0},_this.bindLink(_this.group,"player"),_this.controls=_this.initClass(PlayerControls,_this.group,_view,spawn);_this.delayedCall((_=>{_this.startRender(updateLocation,5)}),3e3),Player.CURRENT_ENV_KEY=ENV_KEY}(),_this.startRender(loop,World.NUKE),loop(),defer((_=>{_this.events?.fire?.(Player.JOIN,{player:_this})}))}(),this.onDisconnect=function(){_view.setUserData(_player.data,{videoTexture:Utils3D.getEmptyTexture()}),_this.events.fire(Player.LEAVE,{player:_this});try{_env.onDisconnectPlayer(_this)}catch(e){}try{_env._onPlayerDisconnect(_this)}catch(e){}tween(_scale,{value:0},300,"easeOutCubic").onComplete((_=>{_this.parent.group.remove(_this.group),_this.group.traverse((mesh=>{mesh.batch&&mesh.batch.remove&&mesh.batch.remove(mesh)})),_this.destroy()}))},this.get("isLocal",(_=>_isLocal)),this.setPosition=function(pos,euler){_this.destroyLink(),_this.group.position.copy(pos),euler&&_this.group.rotation.copy(euler)},this.snapTo2dPoint=function(point2D){_this.group.position.x=point2D.x,_this.group.position.z=point2D.y,_isLocalVR||(_this.group.target.x=point2D.x,_this.group.target.z=point2D.y)},this.teleport=function(){_this.fireEvent("teleport")},this.onLocalActivate=async function(){_this.gcPlayer=null,await Multiplayer.wait("room");try{_this.gcPlayer=_player=Multiplayer.room.me,_player.dreamPlayer=_this}catch(e){await(_this.wait?.(100)),_this.onLocalActivate()}}}),(_=>{Player.JOIN="player_join",Player.LEAVE="player_leave",Player.TELEPORT="player_teleport",Player.OUT_OF_BOUNDS="player_out_of_bounds";var _locations={};Player.clearLocation=function(key){delete _locations[key]},Player.clearAllLocations=function(){for(let key in _locations)delete _locations[key]},Player.setLocation=function(key,inst){_locations[key]||(_locations[key]=new Group),_locations[key].position.copy(inst.position),_locations[key].quaternion.copy(inst.quaternion)},Player.getLocation=function(key){return _locations[key]}})),Class((function PlayerControls(_player,_view,_spawn){Inherit(this,Component);const _this=this;var _camera,_3rdP,_3rdP2,_physics,_1stP,_orbit,_hideMeshTimer,_hidingMeshTimer,_init,_wrapper=new Group,_rotation=new Group,_rotation2=new Group,_uv=(new Vector3,new Vector3,new Vector2),_currView="3rd";this.offset=new Vector3,this.lerpScale=1,this.lerpCameraOffset=.07,this.offsetX=0;var _collision,_offsetXlerp=0;function applyCameraConfig(camera,key){let config=GlobalConfig.instance().getConfig(key);camera.moveXY.fromArray(config.moveXY),Device.mobile&&(camera.moveXY.x=camera.moveXY.y=0),camera.setFOV(config.fov*(PlayerControls.FOV||1)),camera.position.copy((new Vector3).fromArray(config.position).multiplyScalar("3rd_person"==key&&PlayerControls.ZOOM_MULTIPLIER||1)),camera.group.position.fromArray(config.groupPos),camera.deltaRotate=1e-4,PlayerControls.FOV_RESIZE_LOGIC&&_this.onResize((_=>{camera.setFOV(config.fov*PlayerControls.FOV_RESIZE_LOGIC())}))}function loop(){if(!_wrapper.target)return;if(_collision||(_collision=_this.findParent("GroupEnvironment").bvh),!_collision)return;_init||(_init=Render.TIME),_offsetXlerp=Math.lerp(_this.offsetX,_offsetXlerp,_this.lerpCameraOffset),_3rdP.group.position.x=_offsetXlerp,_1stP.group.position.x=_offsetXlerp,_this._offsetX=_offsetXlerp;let initialFrames=_this.flag("initialFrames");_wrapper.target.copy(_player.position),_wrapper.updateMatrixWorld(),_wrapper.position.lerp(_wrapper.target,initialFrames?1:.125*_this.lerpScale),_player.rotation.y=Math.lerp(_orbit.rotationY,_player.rotation.y,.2),_orbit.firstP="1st"==_currView}function disableTeleport(){}function resize(){if(Device.mobile){let multiplier=PlayerControls.FOV||1;Stage.width>Stage.height?_3rdP.setFOV(35*multiplier):_3rdP.setFOV(65*multiplier)}}function handleSwitchView(view){if(view!==_currView){switch(view){case"1st":_view.visible=!1,_this.hidingMesh=!0,_this.hideMesh=!1,_hideMeshTimer=_this.delayedCall((_=>{_this.hideMesh=!0}),600),_1stP.transition(600,"easeOutCubic",_camera),_currView="1st",clearTimeout(_hidingMeshTimer),_orbit.enableInverseX(),_orbit.enableInverseY();break;case"3rd":_this.hideMesh=!1,_this.hidingMesh=!0,_view.visible=!0,clearTimeout(_hideMeshTimer),_3rdP.transition(600,"easeOutCubic",_camera),_hidingMeshTimer=_this.delayedCall((_=>{_this.hidingMesh=!1}),300),_currView="3rd",_orbit.disableInverseX(),_orbit.disableInverseY()}_this.viewState=view}}function handleEnableChange(e){e.isEnabled||e.enabled?_this.enable():_this.disable()}!async function(){_wrapper.target=new Vector3,function initCameras(){_3rdP=_this.initClass(GazeCamera),(_3rdP2=_this.initClass(GazeCamera)).still(),_1stP=_this.initClass(GazeCamera),_wrapper.add(_rotation),_rotation.add(_rotation2),_rotation2.add(_3rdP.group),_rotation2.add(_3rdP2.group),_rotation2.add(_1stP.group),_camera=Camera.instance().createLocal(),_3rdP.lock(_camera),Camera.instance().lock(_camera.worldCamera)}(),_player.target=(new Vector3).copy(_player.matrixAutoUpdate?_player.getWorldPosition():_player.position),_physics=_this.physics=_this.initClass(PlayerControls.REAL_PHYSICS?PlayerPhysics:PlayerPhysicsBasic,_player),function initConfig(){applyCameraConfig(_3rdP,"3rd_person"),applyCameraConfig(_3rdP2,"3rd_person"),applyCameraConfig(_1stP,"1st_person"),_this.config=GlobalConfig.instance().getConfig("controls")}(),function initOrbit(){let orbitConfig=PlayerControls.ORBIT_CONFIG;if(PlayerControls.CUSTOM_CONFIG){orbitConfig=Utils.cloneObject(PlayerControls.ORBIT_CONFIG);for(let key in PlayerControls.CUSTOM_CONFIG)orbitConfig[key]=PlayerControls.CUSTOM_CONFIG[key]}_orbit=_this.initClass(PlayerControlsOrbit,_rotation,_rotation2,orbitConfig)}(),_this.startRender(loop),_this.orbit=_orbit,_spawn&&await async function updateFromSpawn(){if(_spawn){let groupEnv=_this.findParent("GroupEnvironment");await groupEnv.wait("bvh"),_orbit.rotationY=_spawn.rotation.y,_player.target.copy(_spawn.origin||_spawn.position),_player.position.copy(_spawn.origin||_spawn.position),groupEnv.bvh.setup(_player),_wrapper.target.copy(_player.position),_wrapper.position.copy(_player.position),PlayerControls.FREE_MOVE&&(_wrapper.target.x=_player.target.x,_wrapper.target.y=_player.target.y,_wrapper.target.z=_player.target.z)}}(),_this.cameraFitment=_this.initClass(PlayerControlsCameraFitment,_3rdP,_3rdP2),function addListeners(){_this.bindState(PlayerSettings.instance().state,"camera",handleSwitchView),_this.events.sub(Events.RESIZE,resize),resize(),_this.events.sub(PlayerControls.ENABLE_STATE_CHANGE,handleEnableChange),_this.events.sub(PlayerControls.DISABLE_TELEPORT,disableTeleport)}(),Device.mobile?_this.initClass(PlayerControlsMobileJoystick,_physics.direction,_physics):_this.initClass(PlayerControlsKeyboard,_physics.direction,_physics),PlayerControls.CLICK_PATHFINDING&&_this.initClass(PlayerControlsPathfinding,_player.position,_physics),_this.flag("initialized",!0)}(),this.disable=async function(){_this.visible=!1,!0,_physics.direction.x=0,_physics.direction.z=0,await _this.wait("initialized"),_orbit.disabled=!0,PlayerControls.ENABLED=!1,_this.disableTeleport()},this.resetTarget=()=>{_player.target=_player.position.clone()},this.enableTeleport=async function(){await _this.wait("initialized")},this.disableTeleport=async function(){await _this.wait("initialized")},this.enable=async function(){_this.visible=!0,!1,await _this.wait("initialized"),_orbit.disabled=!1,PlayerControls.ENABLED=!0,_this.enableTeleport()},this.setCameraView=async function(view){await _this.ready(),PlayerSettings.instance().state.camera=view},this.ready=function(){return _this.wait("initialized")},this.offsetZ=function(z){_3rdP.group.position.z+=z},this.cameraVerticalOffset=function(offset){_rotation.position.y=offset},this.blockOrbit=function(){_this.flag("still")||(_this.flag("still",!0),_3rdP.still(1e3))},this.allowOrbit=function(){_this.flag("still")&&(_this.flag("still",!1),_3rdP.orbit(1e3))},this.enableInverseX=function(){_orbit.enableInverseX()},this.disableInverseX=function(){_orbit.disableInverseX()},this.enableInverseY=function(){_orbit.enableInverseY()},this.disableInverseY=function(){_orbit.disableInverseY()},this.onVisible=function(){_this.flag("initialFrames",!0,500),_3rdP&&(applyCameraConfig(_3rdP,"3rd_person"),applyCameraConfig(_1stP,"1st_person"))},this.onDestroy=function(){_camera?.destroy?.()},this.teleport=function(position){_init=Render.TIME,_player.target.copy(position),_player.position.copy(position)},this.clearDirection=function(){_physics.direction.setScalar(0)},this.get("third",(()=>_3rdP)),this.get("first",(()=>_1stP)),this.get("cameraView",(()=>_currView)),this.get("terrainUV",(()=>_uv)),this.get("camera",(()=>_camera))}),(()=>{PlayerControls.SWITCH_VIEW="playercontrols_switchview",PlayerControls.DISABLE_TELEPORT="playercontrols_teleport",PlayerControls.MOBILE_JOYSTICK="playercontrols_mobile_joystick",PlayerControls.ENABLE_STATE_CHANGE="playercontrols_enable_state_change",PlayerControls.ORBIT_CONFIG={screenRotation:180,xLimit:20,zOrigin:2,xMin:-30,xMax:10,xAngle:0},PlayerControls.FREE_MOVE=!1,PlayerControls.GUIDED_MOUSE=!0,PlayerControls.ENABLED=!0,PlayerControls.BLOCK_TELEPORT=!1,PlayerControls.MOVE_MULTIPLIER=1,PlayerControls.ZOOM_MULTIPLIER=1,PlayerControls.ON_FLOOR="player_controls_on_floor",PlayerControls.DRAGGING="player_controls_dragging",PlayerControls.ENABLE_AERIAL="PlayerControls.ENABLE_AERIAL",PlayerControls.DISABLE_AERIAL="PlayerControls.DISABLE_AERIAL",PlayerControls.shouldPrevent=function(el){return el||(el=document.elementFromPoint(Mouse.x,Mouse.y)),function checkIfProhibited(element){let el=element;for(;el;){if(el.classList)for(let i=0;i<PROHIBITED_ELEMENTS.length;i++)if(el.classList.contains(PROHIBITED_ELEMENTS[i]))return!0;el=el.parentNode}return!1}(el)};const PROHIBITED_ELEMENTS=["hit","prevent_interaction3d"]})),Class((function PlayerControlsKeyboard(_outputDirection,_physics){Inherit(this,Component);const _this=this;Render.TIME;var _euler=new Euler,_direction=new Vector3,_pressing=[],_jumpLocked=!1,_jumpTimeout=null;const FWD=new Vector3(0,0,-1),BACK=new Vector3(0,0,1),LEFT=new Vector3(-1,0,0),RIGHT=new Vector3(1,0,0);function loop(){_euler.set(0,Math.radians(Math.range(_this.parent._offsetX,0,1.07,0,5)),0),_outputDirection.copy(_direction),_outputDirection.applyEuler(_euler)}function touchStart(){_this.flag("needsMouseReset")||_this.flag("pressing")||(_this.parent.gesture="reset",Render.TIME)}function touchEnd(){}function keyPress(e){if(_this.parent.disabled)return;if(_pressing.includes(e.key)||_pressing.push(e.key),document.activeElement&&PlayerControls.shouldPrevent(document.activeElement))return;let key=e.key;if(!Keyboard.pressing.includes("Meta"))switch(" "!=key&&(_this.parent.gesture="wasd",_this.flag("pressing",!0)),PlayerControls.ALTERNATE_ARROWS&&("ArrowLeft"==key&&(key="a"),"ArrowRight"==key&&(key="d")),key){case"w":case"W":case"ArrowUp":_this.parent.cameraFitment.move(),"drag"!=_this.parent.gesture&&(_direction.z=FWD.z);break;case"a":case"A":_this.parent.cameraFitment.move(),"drag"!=_this.parent.gesture&&(_direction.x=LEFT.x);break;case"s":case"S":case"ArrowDown":_this.parent.cameraFitment.move(),"drag"!=_this.parent.gesture&&(_direction.z=BACK.z);break;case"d":case"D":_this.parent.cameraFitment.move(),"drag"!=_this.parent.gesture&&(_direction.x=RIGHT.x);break;case" ":PlayerControls.NO_JUMP||_jumpLocked||(_this.parent.cameraFitment.move(),_jumpLocked=!0,_physics.jumpRequested=!0,clearTimeout(_jumpTimeout),_jumpTimeout=setTimeout((()=>{_physics.jumpRequested=!1}),100))}}function keyUp(e){let key=e.key;if(!_this.parent.disabled&&!(document.activeElement&&PlayerControls.shouldPrevent(document.activeElement)||Keyboard.pressing.includes("Meta")))switch(_pressing.remove(e.key),_pressing.length||_direction.set(0,0,0),"ArrowLeft"==key&&(key="a"),"ArrowRght"==key&&(key="d")," "!=key&&(_this.flag("pressing",!1),_this.flag("needsMouseReset")&&(_this.flag("needsMouseReset",!1),_this.parent.gesture="reset")),key){case"w":case"W":case"z":case"Z":case"ArrowUp":"drag"!=_this.parent.gesture&&(_direction.z=0);break;case"a":case"A":"drag"!=_this.parent.gesture&&(_direction.x=0);break;case"s":case"S":case"ArrowDown":"drag"!=_this.parent.gesture&&(_direction.z=0);break;case"d":case"D":"drag"!=_this.parent.gesture&&(_direction.x=0);break;case" ":PlayerControls.NO_JUMP||(_jumpLocked=!1)}}!function addListeners(){_this.events.sub(Keyboard.DOWN,keyPress),_this.events.sub(Keyboard.UP,keyUp),_this.events.sub(Mouse.input,Interaction.START,touchStart),_this.events.sub(Mouse.input,Interaction.END,touchEnd)}(),_this.startRender(loop)})),Class((function PlayerControlsMobileJoystick(_direction,_physics){Inherit(this,Component);const _this=this;var $wrapper,$hit,_time=performance.now(),_jumpTimeout=null;const FWD=new Vector3(0,0,-1);var _euler=new Euler;function loop(){if($hit){$hit.move.x=Math.clamp($hit.interaction.move.x,-50,50),$hit.move.y=Math.clamp($hit.interaction.move.y,-50,50),_this.touching||($hit.move.x=$hit.move.y=0),$hit.position.lerp($hit.move,.25),$hit.mover.x=$hit.position.x,$hit.mover.y=$hit.position.y,$hit.mover.transform();const vis=PlayerControls.ENABLED?"visible":"hidden";$hit.inner.css({visibility:vis}),$hit.behind.css({visibility:vis})}}function touchStart(){PlayerControls.ENABLED&&(_this.events.fire(PlayerControls.MOBILE_JOYSTICK),$hit.inner.tween({opacity:1,scale:1.2,y:0},300,"easeOutCubic"),$hit.behind.tween({opacity:.6,scale:1,y:0},300,"easeOutCubic"),_this.touching=!0,_this.parent.gesture="wasd")}function inputStart(){PlayerControls.ENABLED&&(_this.parent.cameraFitment.move(),_this.events.fire(PlayerControls.DRAGGING,{type:"start"}))}function inputEnd(){PlayerControls.ENABLED&&(_this.events.fire(PlayerControls.DRAGGING,{type:"end"}),_this.parent.gesture="reset")}function touchMove(e){if(!PlayerControls.ENABLED)return;let moved=$hit.interaction.move.length(),angle=Math.atan2($hit.interaction.move.y,$hit.interaction.move.x)+Math.radians(90);_direction.copy(FWD),_euler.y=-angle,_direction.applyEuler(_euler).multiplyScalar(Math.range(moved,0,50,0,1,!0))}function touchEnd(e){PlayerControls.ENABLED&&(_this.events.fire(PlayerControlsMobileJoystick.RELEASED),$hit.inner.tween({opacity:.8,scale:1,y:0},500,"easeOutCubic"),$hit.behind.tween({opacity:.2,scale:.8,y:0},500,"easeOutCubic"),_this.touching=!1,_direction.set(0,0,0))}!function initMobileControls(){let offset=60;($wrapper=Stage.create("wrapper")).size("100%","100%").mouseEnabled(!1),$hit=$wrapper.create("joystick");let bottom=PlayerControls.MOBILE_CONTROLS_OFFSET?PlayerControls.MOBILE_CONTROLS_OFFSET.y:offset,left=PlayerControls.MOBILE_CONTROLS_OFFSET?PlayerControls.MOBILE_CONTROLS_OFFSET.x:offset;$hit.size(50,50).css({bottom:60,position:"fixed",marginTop:-bottom-60,left:left}).setZ(2e3).mouseEnabled(!0),Global.MOBILE_CONTROLS_ELEMENT=$hit,$hit.behind=$hit.create(".behind"),$hit.behind.size(120,120).css({left:-35,borderRadius:"50%",bottom:-35,border:"2px solid #fff",opacity:.2}).transform({scale:.8}),$hit.move=new Vector2,$hit.position=new Vector2,$hit.mover=$hit.create(".wrapper"),$hit.mover.size(50,50),$hit.top=$hit.behind.create(".top"),$hit.top.size(2,6).center(1,0).css({top:-4}).bg("#fff"),$hit.left=$hit.behind.create(".top"),$hit.left.size(6,2).center(0,1).css({left:-4}).bg("#fff"),$hit.bottom=$hit.behind.create(".top"),$hit.bottom.size(2,6).center(1,0).css({bottom:-4}).bg("#fff"),$hit.right=$hit.behind.create(".top"),$hit.right.size(6,2).center(0,1).css({right:-4}).bg("#fff"),$hit.inner=$hit.mover.create(".inner"),$hit.inner.size(52,52).css({border:"5px solid #fff",background:"rgba(255,255,255,0.25)",opacity:.8,borderRadius:"50%"}),$hit.inner.css({visibility:"hidden"}),$hit.behind.css({visibility:"hidden"}),$hit.interaction=_this.initClass(Interaction,$hit),_this.events.sub($hit.interaction,Interaction.START,touchStart),_this.events.sub($hit.interaction,Interaction.MOVE,touchMove),_this.events.sub($hit.interaction,Interaction.END,touchEnd),PlayerControls.NO_JUMP||_this.events.sub(Mouse.input,Interaction.START,(_=>{let now=performance.now(),delta=now-_time;_time=now,delta<200&&(_physics.jumpRequested=!0,clearTimeout(_jumpTimeout),_jumpTimeout=setTimeout((()=>{_physics.jumpRequested=!1}),100))}))}(),function addListeners(){let input=_this.initClass(Interaction,Stage);_this.events.sub(input,Interaction.START,inputStart),_this.events.sub(input,Interaction.END,inputEnd)}(),_this.startRender(loop),_this.onDestroy=function(){console.log("destroy"),$hit.destroy()}}),(()=>{PlayerControlsMobileJoystick.RELEASED="PlayerControlsMobileJoystick.RELEASED"})),Class((function PlayerControlsPathfinding(_playerPos,_physics){Inherit(this,Component);const _this=this;var _bvh,_collision,_seek,_touchTime=Render.TIME,_point=new Vector3;const UP=new Vector3(0,1,0);var $ui;const PROHIBITED_ELEMENTS=["hit","prevent_interaction3d"];async function mouseMove(e){if("wasd"==_this.parent.gesture||!PlayerControls.ENABLED)return _point.setScalar(9999);if(_collision||(_collision=_this.findParent("GroupEnvironment").collision),_bvh||(_bvh=_this.findParent("GroupEnvironment").bvh),!_collision)return;if(PlayerControlsPathfinding.DISABLED)return;if("grab"!=Stage.css("cursor")&&$ui)return $ui.targetScale=0;let hit=_bvh.test2D();if(hit){UP.dot(hit.face.normal)>.9&&_playerPos.distanceTo(hit.point)<10?_point.copy(hit.point):_point.setScalar(9999)}else _point.setScalar(9999)}function touchStart(e){return PlayerControlsPathfinding.DISABLED||PlayerControlsPathfinding.DISABLE_CLICK||AvatarInteraction.intersecting?_point.setScalar(9999):e.button>0?void 0:"wasd"!=_this.parent.gesture&&PlayerControls.ENABLED?void(_touchTime=Render.TIME):_point.setScalar(9999)}function loop(){if(PlayerControlsPathfinding.DISABLED)return void(_seek=null);if($ui&&($ui.x=Mouse.x,$ui.y=Mouse.y,$ui.scale=Math.lerp($ui.targetScale,$ui.scale,.1),$ui.rotation=.6*Render.TIME%360,$ui.transform()),"wasd"!=_this.parent.gesture&&PlayerControls.ENABLED||(_seek=null),!_seek)return;let direction=_seek.clone().sub(_playerPos),dirLength=Math.min(direction.length(),1.5);dirLength>.05?(_physics.velocity.x=0,_physics.velocity.z=0,direction.y=0,direction.normalize(),direction.multiplyScalar(.13*dirLength*Render.HZ_MULTIPLIER*Math.clamp(Render.DELTA/(1e3/Render.REFRESH_RATE),1,1.5)),_physics.velocity.add(direction)):_seek=null}async function touchEnd(e){if(e.button>0)return;if(PlayerControlsPathfinding.DISABLED)return;Render.TIME-_touchTime>250||!_point||Mouse.velocity.length()>.5||function checkIfProhibited(e){let element=document.elementFromPoint(Math.clamp(e.x||0,0,Stage.width),Math.clamp(e.y||0,0,Stage.height));if(element){let el=element;for(;el;){for(let i=0;i<PROHIBITED_ELEMENTS.length;i++)if(el.classList&&el.classList.contains(PROHIBITED_ELEMENTS[i]))return!0;el=el.parentNode}}return!1}(e)||(Device.mobile&&mouseMove(),_point.x<9999&&(_seek=(new Vector3).copy(_point)),_point.setScalar(9999))}!function addListeners(){_this.events.sub(Mouse.input,Interaction.MOVE,mouseMove),_this.events.sub(Mouse.input,Interaction.START,touchStart),_this.events.sub(Mouse.input,Interaction.END,touchEnd)}(),_this.startRender(loop),PlayerControlsPathfinding.RETICLE_UNIFORM.value=_point,this.onDestroy=function(){$ui?.remove()}}),(_=>{PlayerControlsPathfinding.RETICLE_UNIFORM={value:{x:-9999,y:-9999,z:-9999},type:"v3"},PlayerControlsPathfinding.DISABLED=!1})),Class((function PlayerControlsVR(_group,_view,_spawn,_nullGroup){Inherit(this,Object3D);const _this=this;var _time,_controller,_cyl,_wristMenu,_line,_collision,_canMove=!0,_castPos=new Vector3,_hitPos=new Vector3,_joyMoveDir=new Vector2,_joyMoveAbsolute=new Vector3,_v1=new Vector3,_v2=new Vector3,_v3=new Vector3,_qBlend={value:1},_runningLerp=new Group,_threadEvent={},_targetY=0;new Vector3(0,-1,0);const UP=new Vector3(0,3,0),FWD=new Vector3(0,0,-1);function optimize(array){for(let i=0;i<array.length;i++)array[i]=Number(array[i].toFixed(3))}function loop(){if(_collision||(_collision=_this.findParent("GroupEnvironment").bvh),!_collision)return;if(_controller){_controller.group.getWorldQuaternion(_controller.group.worldQuat),_v1.set(0,0,-1).applyQuaternion(_controller.group.worldQuat),FWD.copy(_v1).projectOnPlane(UP).normalize();let axis=_v2.set(1,0,0).applyQuaternion(_controller.group.worldQuat),dot=_v1.dot(FWD),det=axis.dot(_v1.crossVectors(FWD,_v1)),angle=Math.degrees(Math.atan2(det,dot)),ranged=Math.range(angle,-45,45,.1,1,!0);FWD.multiplyScalar(8*PlayerControlsVR.TELEPORT_SCALAR*ranged),_castPos.copy(_controller.group.getWorldPosition()).add(FWD),_cyl.position.x=_castPos.x,_cyl.position.z=_castPos.z}_cyl.visible&&(_hitPos.copy(_cyl.position).add(UP),_threadEvent.pos=_hitPos,_threadEvent.cylinder=!0,function hitTestCylinder(e){if(_cyl.shader.set("uVis",1),e.miss)_canMove=!1,_cyl.shader.set("uMiss",1),_line.group.visible=!1;else if(_cyl.shader.set("uMiss",0),e.point&&(_cyl.position.y=e.point.y),_canMove=!0,TweenManager.clearTween(_qBlend),_qBlend.value=.04,_controller){_line.group.visible=!0;let subdivisions=30;_line.clear(),_controller.group.getWorldPosition(_line.catmull.points[0]),_line.catmull.points[1].copy(_line.catmull.points[0]).lerp(_cyl.position,.5,!0),_line.catmull.points[1].y=Math.max(_line.catmull.points[0].y,_cyl.position.y),_line.catmull.points[2].copy(_cyl.position);for(let i=0;i<subdivisions;i++)_line.catmull.getPoint((i+1)/subdivisions,_v3),_line.draw(_v3)}else _line.group.visible=!1}(_collision.test(_threadEvent))),_runningLerp.position.lerp(_cyl.visible?_cyl.position:_group.position,_qBlend.value),_runningLerp.quaternion.slerp(World.CAMERA.getWorldQuaternion(),_qBlend.value),_hitPos.copy(_runningLerp.position).add(UP),_threadEvent.pos=_hitPos,_threadEvent.cylinder=!1,function hitTestRunning(e){e.miss||(e.success?_nullGroup.position.copy(e.point):_nullGroup.position.copy(_cyl.position),_nullGroup.position.x+=RenderManager.camera.inset.x,_nullGroup.position.z+=RenderManager.camera.inset.z)}(_collision.test(_threadEvent)),_group.position.y=Math.lerp(_targetY,_group.position.y,.2),RenderManager.camera.offset.copy(_group.position),_hitPos.copy(World.CAMERA.getWorldPosition()),_threadEvent.pos=_hitPos,_threadEvent.cylinder=!1,_collision.test(_threadEvent,hitTestPlayer),_nullGroup.quaternion.copy(_runningLerp.quaternion);let l=VRInput.controllers[0],r=VRInput.controllers[1];if(l&&r){if("left"!=l.handedness){let r2=r;r=l,l=r2}l.group.getWorldPosition().sub(_hitPos).toArray(_nullGroup.eD.l),r.group.getWorldPosition().sub(_hitPos).toArray(_nullGroup.eD.r),_nullGroup.eD.l[3]=_hitPos.y,_nullGroup.eD.r[3]=_hitPos.y,_nullGroup.eD.lq&&(l.group.getWorldQuaternion().toArray(_nullGroup.eD.lq),r.group.getWorldQuaternion().toArray(_nullGroup.eD.rq)),optimize(_nullGroup.eD.l),optimize(_nullGroup.eD.r)}_joyMoveDir.lengthSq()>0&&(_joyMoveAbsolute.set(_joyMoveDir.x,0,_joyMoveDir.y).applyQuaternion(World.CAMERA.getWorldQuaternion()).multiplyScalar(.02*PlayerControlsVR.JOYSTICK_SPEED*Render.HZ_MULTIPLIER),_v3.copy(_group.position).add(_joyMoveAbsolute).add(UP),_threadEvent.pos=_v3,_threadEvent.cylinder=!0,function hitTestJoystick(e){e.miss||(_group.position.add(_joyMoveAbsolute),_group.position.y=_targetY=e.point.y)}(_collision.test(_threadEvent)))}function hitTestPlayer(e){e.point&&(_targetY=e.point.y)}function vrButton(e){Interaction3D.useInput(e.controller),"trigger"==e.label&&(e.pressed?function start(e){if(Interaction3D.find(World.CAMERA).intersecting||AvatarInteraction.intersecting)return;if("left"==e.controller.handedness)return;_time=Date.now(),_cyl.shader.set("uVis",0),_cyl.visible=!0,_controller=e.controller}(e):function end(e){if("left"==e.controller.handedness||!_cyl.visible)return;if(_controller=null,_cyl.visible=!1,_line.group.visible=!1,Interaction3D.find(World.CAMERA).intersecting||AvatarInteraction.intersecting)return;tween(_qBlend,{value:1},500,"linear"),Date.now()-_time>100&&_canMove&&(_group.position.x=_cyl.position.x,_group.position.y=_targetY=_cyl.position.y,_group.position.z=_cyl.position.z,_this.events.fire(Player.TELEPORT),_group.position.x-=RenderManager.camera.inset.x,_group.position.z-=RenderManager.camera.inset.z)}(e)),_wristMenu&&("a"!=e.label&&"b"!=e.label&&"side_trigger"!=e.label&&"touch_pad"!=e.label||(e.pressed?(VRInput.controllers.forEach((c=>{c!=e.controller&&Interaction3D.useInput(c)})),PlayerControlsVR.wristMenuObject?.onOpen?.(),_wristMenu.visible=!0,_wristMenu.scale.setScalar(0),e.controller.group.add(_wristMenu),_wristMenu.position.z=-.3,tween(_wristMenu.scale,{x:1,y:1,z:1},300,"easeOutCubic")):_wristMenu.visible&&(VRInput.controllers.forEach((c=>{c.hideBeam()})),PlayerControlsVR.wristMenuObject?.onClose?.(),tween(_wristMenu.scale,{x:0,y:0,z:0},300,"easeOutCubic").onComplete((_=>{_wristMenu.visible=!1})))))}function restoreCyl(){_cyl.shader.tween("uVis2",1,300,"easeOutSine")}function vrJoystick(e){"right"==e.controller.handedness?(e.x>.5&&(_this.flag("blockPosX")||(_cyl.visible&&(_cyl.shader.set("uVis2",0),Utils.debounce(restoreCyl,100)),RenderManager.camera.wrapper.rotation.y+=Math.radians(-45),_this.flag("blockPosX",!0))),e.x<-.5&&(_this.flag("blockNegX")||(_cyl.visible&&(_cyl.shader.set("uVis2",0),Utils.debounce(restoreCyl,100)),RenderManager.camera.wrapper.rotation.y+=Math.radians(45),_this.flag("blockNegX",!0))),e.x<=0&&_this.flag("blockPosX",!1),e.x>=0&&_this.flag("blockNegX",!1)):_joyMoveDir.set(e.x,e.y)}this.offset=new Vector3,async function(){if(_spawn){let groupEnv=await _this.findParent("GroupEnvironment");await groupEnv.wait("bvh"),groupEnv.bvh.setup(_spawn),RenderManager.camera.offset.copy(_spawn.position),RenderManager.camera.wrapper.rotation.y=_spawn.rotation.y,_targetY=_spawn.position.y}PlayerControlsVR.wristMenuObject&&function initWristMenu(){(_wristMenu=new Group).add(PlayerControlsVR.wristMenuObject.group)}(),[_line,_cyl]=PlayerControlsVR.getTeleportStructure(),_cyl.position.y=_spawn?_spawn.position.y:0,_this.startRender(loop),async function captureControllers(){await VRInput.ready(),VRInput.controllers.forEach(((c,i)=>{_this.events.sub(c,VRInput.BUTTON,vrButton),_this.events.sub(c,VRInput.JOYSTICK,vrJoystick)}))}(),_view.visible=!1}(),this.disable=function(){!0},this.enable=function(){!1},this.setDebugPosition=function(pos){Hydra.LOCAL&&(_group.position.x=pos.x,_group.position.y=_targetY=pos.y,_group.position.z=pos.z,_this.events.fire(Player.TELEPORT),_group.position.x-=RenderManager.camera.inset.x,_group.position.z-=RenderManager.camera.inset.z)},this.setPosition=function(pos){_group.position.x=pos.x,_group.position.y=_targetY=pos.y,_group.position.z=pos.z,_this.events.fire(Player.TELEPORT),_group.position.x-=RenderManager.camera.inset.x,_group.position.z-=RenderManager.camera.inset.z}}),(_=>{var _line,_cyl,_lineColor,_color,_missColor;function initColors(){_color||(_color=new Color("#ffffff"),_lineColor=new Color("#ffffff"),_missColor=new Color("#D90E0E"))}PlayerControlsVR.TELEPORT_SCALAR=1,PlayerControlsVR.JOYSTICK_SPEED=1,PlayerControlsVR.getTeleportStructure=function(){return _line||(initColors(),function initCylinder(){let geom=new CylinderGeometry(1,1,1,50);geom.applyMatrix((new Matrix4).makeTranslation(0,.5,0));let shader=new Shader("TeleportCylinderShader",{uColor:{value:_color},uAlpha:{value:.5},uVis:{value:0},uVis2:{value:1},uMiss:{value:0},uMissColor:{value:_missColor},transparent:!0});(_cyl=new Mesh(geom,shader)).depthWrite=!1,_cyl.renderOrder=99999,_cyl.scale.set(.2,4,.2),World.SCENE.add(_cyl),_cyl.shader.depthWrite=!1,_cyl.visible=!1}(),function initLine(){_line=new Line3D({width:7,color:"#0e76c5"});let shader=new Shader("TeleportLineShader",{uLColor:{value:_lineColor},uLAlpha:{value:.35},uVis:_cyl.shader.uniforms.uVis,uVis2:_cyl.shader.uniforms.uVis2,transparent:!0});_line.useShader(shader),_line.color=new Color,_line.catmull=new CatmullRomCurve([new Vector3,new Vector3,new Vector3]),World.SCENE.add(_line.group),_line.group.visible=!1,_line.wait("mesh").then((_=>_line.mesh.renderOrder=99999))}()),[_line,_cyl]},PlayerControlsVR.setTeleportColor=function(color){initColors(),_color.set(color)},PlayerControlsVR.setLineColor=function(color){initColors(),_lineColor.set(color)},PlayerControlsVR.setMissColor=function(color){initColors(),_missColor.set(color)},PlayerControlsVR.registerWristMenu=function(Class){if(Platform.usingVR()&&(PlayerControlsVR.wristMenuObject=new Class,!PlayerControlsVR.wristMenuObject.group))throw"PlayerControlsVR::registerWristMenu Class is missing .group"}})),Class((function PlayerPhysics(_player){Inherit(this,Component);const _this=this;var _collision,_chairs,_direction=new Vector3,_move=new Vector3,_acceleration=new Vector3,_velocity=new Vector3,_v=new Vector3,_airStateFloor=!0,_airStateFrames=0;new Vector2;const DAMP=new Vector3(.93,.95,.93);function normalizeFriction(t){return Math.exp(Math.log(t)*Render.HZ_MULTIPLIER)}function swapFloorState(){_airStateFloor=_this.isOnFloor,_airStateFrames=0,_this.events.fire(PlayerControls.ON_FLOOR,{onFloor:_airStateFloor}),_airStateFloor&&PlatformSounds.play("jump_end")}async function loop(){if(_this.parent.disabled)return;if(_collision||(_collision=_this.findParent("GroupEnvironment").bvh),!_collision)return;_move.copy(_direction).normalize().applyQuaternion(_player.quaternion),_move.length()>1e-5&&(_move.copy(_direction).applyQuaternion(_player.quaternion),_move.multiplyScalar(.004*PlayerControls.MOVE_MULTIPLIER),_acceleration.add(_move)),_this.isOnFloor||(_acceleration.y+=-.01),_acceleration.multiplyScalar(Render.HZ_MULTIPLIER*Math.clamp(Render.DELTA/(1e3/Render.REFRESH_RATE),1,3)),_velocity.add(_acceleration),_velocity.clampLength(0,.9*_collision.capsule.radius),_this.isOnFloor=!1,_collision.hasCollided=!1;let delta=Render.HZ_MULTIPLIER/3;for(let i=0;i<3;i++)_collision.update(delta,_this,_player);_collision.movingHits.length>0&&_collision.checkIntersections(delta,_this,_player),_this.isOnFloor!==_airStateFloor?_airStateFloor?(_collision.hasCollided?_airStateFrames=0:_airStateFrames++,_airStateFrames>5/Render.HZ_MULTIPLIER&&swapFloorState()):swapFloorState():_airStateFrames=0,_v.set(normalizeFriction(DAMP.x),normalizeFriction(DAMP.y),normalizeFriction(DAMP.z)),_velocity.multiply(_v),_acceleration.setScalar(0),_this.jumpRequested&&_this.isOnFloor&&(_this.jumpRequested=!1,_velocity.y+=.2,_this.flag("jump_sound",!0,500),PlatformSounds.play("jump_start")),_collision.hit&&(_collision.hit.geometry.boundingBox||_collision.hit.geometry.computeBoundingBox(),_player.position.y+15<_collision.hit.geometry.boundingBox.min.y&&(_player.position.copy(_player.initialPlayerPosition),_velocity.setScalar(0),_this.events.fire(Player.OUT_OF_BOUNDS))),_chairs||(_chairs=_this.findParent("GroupEnvironment").chairs),_chairs&&_chairs.data&&PlayerSitdown.checkChairPosition(_player,_chairs.data.positions,_chairs.data.orientations);let velocityLen=_velocity.length();velocityLen>.01?_this.flag("run_sound")||_this.flag("jump_sound")||(_this.flag("run_sound",!0),PlatformSounds.startLoop("footsteps_loop")):_this.flag("run_sound")&&(_this.flag("run_sound",!1),PlatformSounds.stopLoop("footsteps_loop")),PlatformSounds.setVolume("footsteps_loop",Math.range(velocityLen,.01,.1,0,1,!0))}this.isOnFloor=!0,this.velocity=_velocity,this.direction=_direction,_this.startRender(loop),this.applyImpulse=function(v){_velocity.add(v)}})),Class((function PlayerPhysicsBasic(_player){Inherit(this,Component);const _this=this;var _collision,_move=new Vector3,_temp=new Vector3,_lastPos=new Vector3,_v31=new Vector3,_direction=new Vector3,_evt={},_extraY=0,_jumpBlocked=!1;function loop(){if(_collision||(_collision=_this.findParent("GroupEnvironment").bvh),!_collision)return;let deltaMultiplier=Math.max(1,Render.DELTA/(1e3/Render.REFRESH_RATE));_move.copy(_direction).normalize().multiplyScalar(_this.parent.config.moveStep*(PlayerControls.MOVE_MULTIPLIER||1)*.1*Render.HZ_MULTIPLIER*deltaMultiplier).applyQuaternion(_player.quaternion),_temp.copy(_player.target).add(_v31.copy(_move).multiplyScalar(4)),_temp.y+=2,_evt.pos=_temp;let result=_collision.test(_evt);result.success?result.miss?_player.target.copy(_lastPos):(_player.target.add(_move),_player.target.y=result.point.y,_lastPos.copy(_player.target),_player.target.y+=_extraY):_player.target.copy(_player.position),_player.position.lerp(_player.target,.07),_this.jumpRequested&&!_jumpBlocked&&(_this.jumpRequested=!1,_jumpBlocked=!0,_extraY+=3,_this.events.fire(PlayerControls.ON_FLOOR,{onFloor:!1}),defer((async()=>{await _this.wait(500),_this.events.fire(PlayerControls.ON_FLOOR,{onFloor:!0}),await _this.wait(300),_jumpBlocked=!1}))),_extraY-=.1*Render.HZ_MULTIPLIER,_extraY=Math.max(_extraY,0)}this.direction=_direction,_this.startRender(loop)})),Class((function PlayerSitdown(){Inherit(this,Component);const _this=this;let _playerPrevPosition;_this.flag("sitting",!1),this.checkChairPosition=(_player,positions,orientations,threshold=1)=>{_playerPrevPosition||(_playerPrevPosition=new Vector3);let pos=_player.position.clone(),still=pos.distanceTo(_playerPrevPosition)<.1;_playerPrevPosition=pos.clone();let chairOrientation,chairPosition=pos,distance=1e7,planePosition=new Vector2(pos.x,pos.z);positions.map(((position,index)=>{let p=new Vector2(position.x,position.z),d=planePosition.distanceTo(p);d<distance&&(distance=d,chairPosition=position.clone(),chairOrientation=orientations[index])})),distance<threshold?still&&(this.flag("sitting")||(console.log("sit down"),_player.position.copy(new Vector3(chairPosition.x,0,chairPosition.z)),_this.events.fire(SkinnedAvatar.TRIGGER_ANIMATION,5)),_this.flag("sitting",!0)):_this.flag("sitting")&&(console.log("stand up"),_this.flag("sitting",!1))}}),"static"),Class((function PlayerSitdownUIL(_input,_group){Inherit(this,Component);const _this=this;var _config;_this.data;let positions=[],orientations=[];!function(){(_config=InputUIL.create("im_"+_input,_group)).addFile("json",{relative:"assets/geometry"}),_config.setLabel("chairs Data");let file=_config.getFilePath("json");file.includes("assets/geometry")||(file="assets/geometry/"+file),get(Assets.getPath(file)).then((e=>{let orientationBuffer=e.data.attributes.orientation.array;for(let i=0;i<orientationBuffer.length;i+=4){let orientation=new Vector4(orientationBuffer[i],orientationBuffer[i+1],orientationBuffer[i+2],orientationBuffer[i+3]);orientations.push(orientation)}let positionBuffer=e.data.attributes.offset.array;for(let i=0;i<positionBuffer.length;i+=3){let position=new Vector3(positionBuffer[i],positionBuffer[i+1],positionBuffer[i+2]);positions.push(position)}_this.data={positions:positions,orientations:orientations}}))}()})),Class((function PlayerControlsBounding(_hitbox,_group){Inherit(this,Component);const _this=this;var _nulls=[];function loop(){for(let i=0;i<4;i++)_nulls[i].getWorldPosition(_this.vectors[i])}this.vectors=[],function(){if(!_hitbox)return;_this.active=!0,_hitbox.geometry.computeBoundingSphere(),_hitbox.geometry.computeBoundingBox();let bb=_hitbox.geometry.boundingBox.clone();bb.setFromObject(_hitbox);for(let i=0;i<4;i++){let group=new Group;_nulls.push(group),_group.add(group),_this.vectors.push(new Vector3)}_nulls[0].position.set(bb.max.x,.5,bb.max.z),_nulls[1].position.set(bb.min.x,.5,bb.max.z),_nulls[2].position.set(bb.max.x,.5,bb.min.z),_nulls[3].position.set(bb.min.x,.5,bb.min.z),_this.startRender(loop)}()})),Class((function PlayerControlsCameraFitment(_camera,_originCamera){Inherit(this,Component);const _this=this;var _player,_collision,_avatarEditMode,_v3=new Vector3,_v31=new Vector3,_offset=(new Vector3,0),_y=0,_lookAt=0;function raycast(){if(_collision||(_collision=_this.findParent("GroupEnvironment").bvh),!_collision)return;if(!_player||_avatarEditMode)return;_v3.copy(_player.group.position),_v3.y+=.5,_v31.copy(_originCamera.camera.getWorldPosition()),_v31.y-=.5;let originalDist=_v3.distanceTo(_v31),ray=_collision.raycast(_v3,_v31);if(ray){let delta=ray.distance-originalDist;_offset=Math.max(delta,-2),_lookAt=Math.range(_offset,0,-2,0,1.2),_y=_camera.OY+Math.range(_offset,0,-2,0,-1)}else _offset=0,_lookAt=0,_y=_camera.OY}function loop(){_camera.zoomOffset=Math.lerp(_offset,_camera.zoomOffset,.07),_camera.lookAt.y=Math.lerp(_lookAt,_camera.lookAt.y,.07),_camera.group.position.y=Math.lerp(_y,_camera.group.position.y,.07)}!async function(){_player=(await DreamWorld.getActiveEnvironment()).getPlayerController?.(),_camera.OY=_camera.group.position.y,_this.startRender(raycast,10),_this.startRender(loop)}(),this.avatarEditMode=function(){if(_avatarEditMode||"1st"==_this.parent.cameraView)return;_avatarEditMode=!0,_offset=-2,tween(_this.parent.orbit,{rotationX:30},1e3,"linear"),_this.parent.blockOrbit();let vel=(new Vector3).copy(_player.group.position).sub(_camera.camera.getWorldPosition()).normalize().multiplyScalar(-10);vel.applyEuler(new Euler(0,-_this.parent.orbit.rotationY,0)),vel.y=0,_this.parent.physics.direction.add(vel),defer((_=>{_this.parent.physics.direction.set(0,0,0)}))},this.move=function(){_avatarEditMode&&(_avatarEditMode=!1,tween(_this.parent.orbit,{rotationX:15},500,"linear"))}})),Class((function PlayerControlsOrbit(_root,_wrap,_config=PlayerControls.ORBIT_CONFIG){Inherit(this,Component);var _input,_prevent,_moving,_this=this,_move=new Vector2,_hold=new Vector3,_target=new Vector3,_rotation=new Vector3,_velocity=new Vector3,_enabled=!0;function initInput(){_this&&_this.initClass&&((_input=_this.initClass(Interaction,Stage)).ignoreLeave=!0,_this.events.sub(_input,Interaction.START,touchStart),_this.events.sub(_input,Interaction.MOVE,touchMove),_this.events.sub(_input,Interaction.END,touchEnd),_this.events.sub(Keyboard.DOWN,keyPress),_this.events.sub(Keyboard.UP,keyUp),(_target.x>10||_target.x<-20)&&_this.parent.blockOrbit())}function loop(){_enabled&&(_this.keyLeft&&(_velocity.y+=1.5*Render.HZ_MULTIPLIER),_this.keyRight&&(_velocity.y-=1.5*Render.HZ_MULTIPLIER),_target.lerp(_velocity,.1*_this.lerp),!_this.firstP||Device.mobile||_moving||_enabled||(_target.y-=2*Mouse.tilt.x*Render.HZ_MULTIPLIER),_rotation.lerp(_target,.4*_this.lerp),_root.rotation.y=Math.radians(_rotation.y),_wrap.rotation.x=Math.radians(_rotation.x),Mouse.x>Stage.width?_this.flag("cursorSet")&&(_this.flag("cursorSet",!1),Stage.cursor("auto",_this)):_this.flag("cursorSet")||(_this.flag("cursorSet",!0),Stage.cursor("grab",_this)))}function touchStart(e){if(!(_prevent||e.x>Stage.width)){if("hit"==e.target.className)return _moving=!1;_moving=!0,_velocity.y=_target.y,_hold.y=_target.y,_hold.x=_target.x,.07,Date.now(),PlayerControlsOrbit.DRAGGING=!0,Stage.cursor("grabbing",_this)}}function touchMove(e){if(!_moving||_prevent||!_enabled)return;e.x,e.y;_target.y=_hold.y+-_input.move.x/Stage.width*_config.screenRotation*_this.direction.y,_target.x=_hold.x+-_input.move.y/Stage.height*(_config.screenRotation*Math.radians(_config.xLimit)*_this.direction.x),_target.x<_config.xMin&&(_target.x=_config.xMin),_target.x>_config.xMax&&(_target.x=_config.xMax),_target.x>10||_target.x<-20?_this.parent.blockOrbit():_this.parent.allowOrbit(),_velocity.y=_target.y,_velocity.x=_target.x,_move.copy(_input.move),Math.range(Math.abs(_input.velocity.x),0,7,0,.5*_config.zOrigin)}function touchEnd(e){if(_moving&&!_prevent){var moveX=200*-Math.abs(_input.velocity.x)/Stage.width*_config.screenRotation*Math.sign(_move.x)*_this.direction.x;Math.abs(_input.velocity.y),Stage.height,_config.screenRotation,Math.radians(_config.xLimit),Math.sign(_move.y),_this.direction.y;PlayerControlsOrbit.DRAGGING=!1,_move&&_move.length()>8&&(_velocity.y=_target.y+Math.clamp(moveX,-360,360)),Stage.cursor("grab",_this),0,.02,_moving=!1,_move&&(_move.x=0,_move.y=0)}}function keyPress(e){if(document.activeElement&&("INPUT"==document.activeElement.tagName||"TEXTAREA"==document.activeElement.tagName))return;let key=e.key;if(!Keyboard.pressing.includes("Meta"))switch(PlayerControls.ALTERNATE_ARROWS||("ArrowLeft"==key&&(key="q"),"ArrowRight"==key&&(key="e")),key){case"q":case"Q":_this.keyLeft=!0,PlayerControlsOrbit.DRAGGING=!0;break;case"e":case"E":_this.keyRight=!0,PlayerControlsOrbit.DRAGGING=!0}}function keyUp(e){if(PlayerControlsOrbit.DRAGGING=!1,Keyboard.pressing.includes("Meta"))return;let key=e.key;switch("ArrowLeft"==key&&(key="q"),"ArrowRight"==key&&(key="e"),key){case"q":case"Q":_this.keyLeft=!1;break;case"e":case"E":_this.keyRight=!1}}this.lerp=1,_this.direction=new Vector2(1,1),_this.firstP=!1,_velocity.x=_target.x=_config.xAngle,defer(initInput),_this.startRender(loop),this.enableInverseX=_=>{_this.direction.y=-1},this.disableInverseX=_=>{_this.direction.y=1},this.enableInverseY=_=>{_this.direction.x=-1,tween(_target,{x:0},600,"easeOutCubic"),tween(_velocity,{x:0},600,"easeOutCubic")},this.disableInverseY=_=>{_this.direction.x=1,tween(_target,{x:17},600,"easeOutCubic"),tween(_velocity,{x:17},600,"easeOutCubic")},this.center=function(x,y,snap){_velocity.x=Math.degrees(x),_velocity.y=Math.degrees(y),snap&&(_target.x=_velocity.x,_target.y=_velocity.y,_wrap.rotation.x=x,_wrap.rotation.y=y)},this.set("rotationY",(y=>{_target.y=Math.degrees(y),_velocity.y=_target.y,_rotation.y=_target.y})),this.get("rotationY",(()=>_root.rotation.y)),this.set("rotationX",(x=>{_velocity.x=x,_target.x=x})),this.get("rotationX",(()=>_target.x)),this.set("xMax",(v=>_config.xMax=v)),this.set("xMin",(v=>_config.xMin=v)),this.set("xAngle",(v=>_velocity.x=_target.x=v)),this.set("disabled",(bool=>{_prevent=bool,(_enabled=!bool)?Stage.cursor("grab",_this):Stage.cursor("auto",_this)})),this.onDestroy=function(){Stage.cursor("auto",_this)}}),(()=>{PlayerControlsOrbit.DRAGGING=!1})),Class((function PlayerTeleportMouse(_playerPosition,_playerTarget){Inherit(this,Component);const _this=this;var _input,_mouse=new Vector2,_threadEvent={},_time=Date.now(),_collision=_this.findParent("GroupEnvironment").collision,_move=new Vector3,_enabled=!0;function touchStart(){if(!_enabled)return;if(PlayerControls.BLOCK_TELEPORT)return;if(PlayerControls.shouldPrevent())return;let delta=Date.now()-_time;_time=Date.now(),delta<200&&async function teleport(){_mouse.x=Mouse.x/Stage.width*2-1,_mouse.y=-Mouse.y/Stage.height*2+1,_threadEvent.pos=_mouse;let result=await _collision.test2D(_threadEvent);if(!result||!result.point)return!1;if(_playerPosition.distanceTo(result.point)>PlayerTeleportMouse.MAX_MOVE)return;_move.copy(result.point);Math.abs(_playerPosition.length()-_move.length());let time=800;result.point&&(tween(_playerPosition,result.point,time,"easeOutCubic"),tween(_playerTarget,result.point,time,"easeOutCubic"),_this.findParent("Player").teleport(),_this.events.fire(Player.TELEPORT))}()}!function addListeners(){_input=_this.initClass(Interaction,Stage),_this.events.sub(_input,Interaction.START,touchStart)}(),this.disable=function(){_enabled=!1},this.enable=function(){_enabled=!0}}),(_=>{PlayerTeleportMouse.MAX_MOVE=PlayerTeleportMouse.MAX_MOVE_DEFAULT=50})),Class((function AVSettingsController(){Inherit(this,Component);const _this=this;var _videoEnabled,_audioEnabled,_videoAllowed,_audioAllowed;_videoEnabled=!0,_audioEnabled=!0,_videoAllowed=!0,_audioAllowed=!0,this.get("audioEnabled",(()=>_audioEnabled)),this.get("videoEnabled",(()=>_videoEnabled)),this.get("audioAllowed",(()=>_audioAllowed)),this.get("videoAllowed",(()=>_videoAllowed)),this.set("audioEnabled",(isEnabled=>{_this.events.fire(AVSettingsController.AUDIO_STATE_CHANGE,{isEnabled:isEnabled}),_audioEnabled=isEnabled})),this.set("videoEnabled",(isEnabled=>{_this.events.fire(AVSettingsController.VIDEO_STATE_CHANGE,{isEnabled:isEnabled}),_videoEnabled=isEnabled})),this.set("audioAllowed",(isAllowed=>{_this.events.fire(AVSettingsController.AUDIO_ALLOW_CHANGE,{isAllowed:isAllowed}),_audioAllowed=isAllowed})),this.set("videoAllowed",(isAllowed=>{_this.events.fire(AVSettingsController.VIDEO_ALLOW_CHANGE,{isAllowed:isAllowed}),_videoAllowed=isAllowed}))}),"singleton",(()=>{AVSettingsController.AUDIO_STATE_CHANGE="event_audioenable_change",AVSettingsController.VIDEO_STATE_CHANGE="event_videoenable_change",AVSettingsController.AUDIO_ALLOW_CHANGE="event_audioallow_change",AVSettingsController.VIDEO_ALLOW_CHANGE="event_videoallow_change"})),Class((function PlayerSettings({theme:theme="auto",camera:camera="3rd",color:color="#ffffff",doNotDisturb:doNotDisturb=!1,emote:emote=0,motion:motion=!0,notifications:notifications=!0,videovolume:videovolume=!0,sfx:sfx=!0,options:options=[]}={}){Inherit(this,Component);const _this=this;_this.state=AppState.createLocal({options:[{id:"theme",label:"settingsTheme",type:"toggle",values:[{label:"settingsAutoTheme",value:"auto"},{label:"settingsLightTheme",value:"light"},{label:"settingsDarkTheme",value:"dark"}]},{id:"camera",label:"settingsCamera",type:"toggle",values:[{icon:"core-pov-3rd",label:"settingsCamera3rd",value:"3rd"},{icon:"core-pov-1st",label:"settingsCamera1st",value:"1st"}]},{id:"color",label:"settingsColor",type:"color",values:[{value:"#ffffff"},{value:"#7265DD"},{value:"#1820E0"},{value:"#E8B915"},{value:"#F44AA6"},{value:"#FF9C87"},{value:"#0ED522"}]},{id:"doNotDisturb",label:"settingsDisturb",type:"boolean",values:[{label:"settingsDisturbOn",value:!0},{label:"settingsDisturbOff",value:!1}]},{id:"notifications",label:"settingsNotifications",type:"boolean",values:[{label:"settingsNotificationsOn",value:!0},{label:"settingsNotificationsOff",value:!1}]},{id:"motion",label:"settingsMotion",type:"boolean",values:[{label:"settingsMotionOn",value:!0},{label:"settingsMotionOff",value:!1}]},{id:"videovolume",label:"settingsVideoVolume",type:"boolean",values:[{label:"settingsVideoVolumeOn",value:!0},{label:"settingsVideoVolumeOff",value:!1}]},{id:"sfx",label:"settingsSFX",type:"boolean",values:[{label:"settingsSFXOn",value:!0},{label:"settingsSFXOff",value:!1}]},...options],theme:Storage.get("player-theme")||theme,camera:Storage.get("player-camera")||camera,color:Storage.get("player-color")||color,emote:Storage.get("player-emote")||emote,doNotDisturb:void 0!==Storage.get("player-doNotDisturb")?Storage.get("player-doNotDisturb"):doNotDisturb,motion:void 0!==Storage.get("player-motion")?Storage.get("player-motion"):motion,notifications:void 0!==Storage.get("player-notifications")?Storage.get("player-notifications"):notifications,videovolume:void 0!==Storage.get("player-videovolume")?Storage.get("player-videovolume"):videovolume,sfx:void 0!==Storage.get("player-sfx")?Storage.get("player-sfx"):sfx}),function(){let json=_this.state.toJSON();for(const key in json)_this.bindState(_this.state,key,(value=>{Hydra.LOCAL&&Utils.query("debugPlayerSettings")&&console.log("Player Settings","player-"+key,value),Storage.set("player-"+key,value)}))}(),_this.add=function({id:id,label:label,type:type,values:values,defaultValue:defaultValue}={}){_this.state.options=[..._this.state.options,{id:id,label:label,type:type,values:values}],_this.state[id]=Storage.get("player-"+id)||defaultValue,_this.bindState(_this.state,id,(value=>{Hydra.LOCAL&&Utils.query("debugPlayerSettings")&&console.log("Player Settings","player-"+id,value),Storage.set("player-"+id,value)}))}}),"singleton"),Class((function Playground(){Inherit(this,Component);const _this=this;let _view,_isRT;const USING_XR=Platform.usingVR();async function addUIToWorldScene(uiGroup){USING_XR?await RenderManager.scheduleOne(RenderManager.EYE_RENDER):await defer();let group=new Group,v3=new Vector3,distance=USING_XR?1.5:2;return v3.set(0,0,-distance).applyQuaternion(World.CAMERA.quaternion),group.position.copy(World.CAMERA.position).add(v3),group.lookAt(World.CAMERA.position),group.add(uiGroup),World.SCENE.add(group),group}async function initGLUIView(element){if(USING_XR){(await addUIToWorldScene(element.group)).scale.setScalar(1/1024)}else GLUI.Stage.add(element)}async function initView(){let request=Global.PLAYGROUND.split("/")[0],view=window["Playground"+request]||window[request]||null;if(!view)throw`No Playground class ${request} found.`;if(_view=view.instance?view.instance():_this.initClass(view),_view.element?_view.element.mesh?await initGLUIView(_view.element):Stage.add(_view.element):_view.root&&_view.$gluiObject&&await async function initUI3DView(ui3d){USING_XR?(await addUIToWorldScene(ui3d.$gluiObject.group),ui3d.$gluiObject.depthTest=!1):Device.mobile?initGLUIView(ui3d.root):(GLUI.Scene.add(ui3d.$gluiObject),await addUIToWorldScene(ui3d.$gluiObject.anchor))}(_view),_view.rt&&_view.scene&&_view.nuke&&!_view.isVrWorldMode&&!_view.isVrSceneMode)if(request.includes("Figma")){let dimensions=_view.dimensions,$obj=$gl(dimensions[0],dimensions[1],_view.rt.texture);$obj.x=40,$obj.y=40,"portrait"===Utils.query("orientation")&&($obj.scale=.5,$obj.y=-300),GLUI.Stage.add($obj)}else{let shader=_this.initClass(Shader,"ScreenQuad",{tMap:{value:_view}}),mesh=new Mesh(World.QUAD,shader);mesh.frustumCulled=!1,World.SCENE.add(mesh),_isRT=!0}else World.SCENE.add(_view.group||_view.mesh||_view.object3D||new Group);!function initCameraHelper(nuke){let orbitCamera=new PerspectiveCamera(30,Stage.width/Stage.height,.1,1e3);orbitCamera.position.z=6;let lastCamera,timer0,timer1,timer2,wasdCamera=orbitCamera.clone();_this.onResize((_=>{orbitCamera.aspect=wasdCamera.aspect=Stage.width/Stage.height,orbitCamera.updateProjectionMatrix(),wasdCamera.updateProjectionMatrix()}));let orbit=new DebugControls(orbitCamera,World.ELEMENT.div),wasd=new WASDControls(wasdCamera,World.ELEMENT.div);orbit.enabled=!1,wasd.enabled=!1,_this.startRender((_=>{orbit.update(),wasd.update()})),_this.orbitControls=orbit,_this.wasdControls=wasd;const clearTimers=_=>{clearTimeout(timer0),clearTimeout(timer1),clearTimeout(timer2)},goToMain=_=>{orbit.enabled=!1,wasd.enabled=!1,lastCamera&&(nuke.camera=lastCamera),AppState.set("playground_camera_active",!1),clearTimers()},goToOrbit=_=>{orbit.enabled=!0,wasd.enabled=!1,nuke.camera!=wasdCamera&&nuke.camera!=orbitCamera&&(lastCamera=nuke.camera),nuke.camera=orbitCamera,AppState.set("playground_camera_active",nuke.camera),_this.activeControls=orbit,clearTimers()},goToWASD=_=>{wasd.enabled=!0,orbit.enabled=!1,nuke.camera!=wasdCamera&&nuke.camera!=orbitCamera&&(lastCamera=nuke.camera),nuke.camera=wasdCamera,AppState.set("playground_camera_active",nuke.camera),_this.activeControls=wasd,clearTimers()};Utils.query("orbit")&&(goToOrbit(),timer0=_this.delayedCall(goToOrbit,500),timer1=_this.delayedCall(goToOrbit,1e3),timer2=_this.delayedCall(goToOrbit,3e3));_this.events.sub(Keyboard.DOWN,(_=>{document.activeElement.tagName.toLowerCase().includes(["textarea","input"])||(Keyboard.pressing.includes("!")&&goToMain(),Keyboard.pressing.includes("@")&&goToOrbit(),Keyboard.pressing.includes("#")&&goToWASD())}))}(_view.nuke||World.NUKE),Global.DEBUG_CAMERA_POS&&World.CAMERA.position.fromArray(Global.DEBUG_CAMERA_POS),Dev.expose("view",_view)}!async function(){await UILStorage.ready(),Global.PLAYGROUND=!!Hydra.LOCAL&&((Router.virtualQuery||location.search.indexOf("p=")>0)&&Utils.query("p")),async function initXR(){USING_XR?async function waitForInteraction(){let click=async e=>{e&&e.isLeaveEvent||(_this.events.unsub(Mouse.input,Interaction.END,click),await World.instance().initXR(RenderManager.WEBVR),initView())};window.AURA?click():_this.events.sub(Mouse.input,Interaction.END,click)}():(await World.instance().init(),initView(),Stage.add(World.ELEMENT),function initDoubleClick(){_this.lastClick=performance.now();const speed=180;Stage.bind("click",(function(){performance.now()-_this.lastClick<speed&&function onDoubleClick(){let camera=_isRT?_view.nuke.camera:World.NUKE.camera,scene=_isRT?_view.scene:World.SCENE,raycaster=Raycaster.find(camera),objs=[];scene.traverse((obj=>{objs.push(obj)}));let intersects=raycaster.checkHit(objs,Mouse),found=!1;intersects.forEach((element=>{if(found)return;const uilGraph=element?.object?.uilGraph;uilGraph&&(found=!0,uilGraph?.find?.(element?.object?.uilName)?.focus?.())}))}(),_this.lastClick=performance.now()}))}())}()}()}),"singleton"),Class((function PlatformAnalytics(){Inherit(this,Model);const _this=this;var _analytics;this.init=async function(app){await FirebaseAnalytics.ready(),_analytics=app.analytics(),_this.dataReady=!0},this.event=function(key,params){if(!_analytics)return console.log("analytics not ready: ",key,params);_analytics.logEvent(key,params)},this.setUserProperties=function(data){if(!_analytics)return console.log("analytics not ready: ",data);_analytics&&_analytics.setUserProperties(data)}}),"Static"),Class((function PlatformAppCheck(){Inherit(this,Model);const _this=this;let _appcheck,_isActive=!1;this.init=async function(app){await FirebaseAppCheck.ready(),_appcheck=app.appCheck(),_this.dataReady=!0},_this.activate=function(recaptcha,autorefresh=!0){if(!_isActive)return _isActive=!0,_appcheck.activate(recaptcha,autorefresh)},_this.get("isActive",(()=>_isActive))}),"Static"),Class((function PlatformAuth(){Inherit(this,Model);const _this=this;let _providers={},_href=window.location.href;_this.USER_STATE="dream_user_state",_this.INIT_STATE="dream_init_state",_this.LOGGED_IN="dream_logged_in",_this.LOGGED_OUT="dream_logged_out",_this.LOGIN_ERROR="dream_login_error",_this.CLAIMS_CHANGED="dream_claims_changed",_this.init=async function(app){await Hydra.ready(),await FirebaseAuth.ready(),await PlatformDB.ready(),function initProviders(){Config.SERVICES&&Config.SERVICES.auth&&(Config.SERVICES.auth.google&&(_providers.google=new firebase.auth.GoogleAuthProvider),Config.SERVICES.auth.saml&&(_providers.saml=new firebase.auth.SAMLAuthProvider(Config.SERVICES.auth.saml)))}(),_this.AUTH=app.auth(),_this.dataReady=!0},_this.loginError=function(error){!function loginError(error){let code=error.code,message="Error logging in. Try logging in again later.";"auth/invalid-action-code"===code&&(message="Access link may have already been used or expired. Please try logging in again.");"auth/invalid-user-token"===code&&(message="Invalid token. Try logging in again.");"auth/invalid-user-code"===code&&(message="Invalid access code. Try logging in again.");"auth/user-token-expired"===code&&(message="Token expired. Try logging in again.");"auth/web-storage-unsupported"===code&&(message="Your web browser does not support web storage.");"auth/too-many-requests"===code&&(message="Too many requests. Try logging in again later.");"auth/user-disabled"===code&&(message="User has been disabled.");"auth/custom"===code&&(message=error.message);_this.events.fire(_this.LOGIN_ERROR,{code:code,message:message}),Track.event("auth","loginError",code),console.log(error)}(error)},_this.logout=async function(){Hydra.LOCAL&&console.warn("[deprecated] use User.logout()"),window.User?.logout()},_this.signOut=async function(){_this.AUTH.signOut(),Config.SERVICES.fireworker&&Fireworker.auth({method:"signOut"})},_this.loginGoogle=function(){if(_this.AUTH&&_providers.google)return _this.AUTH.signInWithPopup(_providers.google);console.log("Google login error")},_this.loginSaml=function(popup=!0){if(_this.AUTH&&_providers.saml)return popup?_this.AUTH.signInWithPopup(_providers.saml):_this.AUTH.signInWithRedirect(_providers.saml);console.log("SAML sign-in error")},_this.login=function(){return{with(name,metadata){if(_this.AUTH)return"saml"===name?_this.loginSaml():"google"===name?_this.loginGoogle():"email/password"===name?function loginEmailPassword({email:email,password:password}){return _this.AUTH.signInWithEmailAndPassword(email,password)}(metadata):"email"===name?function loginEmail({email:email,options:options={}}){return email||(email=window.prompt("Please provide your email address to login.")),Storage.set("emailForSignIn",email),options.url||(options.url=_href),options.handleCodeInApp||(options.handleCodeInApp=!0),Config.SERVICES.fireworker?Fireworker.auth({method:"sendSignInLinkToEmail",metadata:{email:email,options:options}}):_this.AUTH.sendSignInLinkToEmail(email,options)}(metadata):"emailLink"===name?function loginEmailLink({email:email,href:href}){Config.SERVICES.fireworker&&Fireworker.auth({method:"signInWithEmailLink",metadata:{email:email,href:href}}),_this.AUTH.signInWithEmailLink(email,href)}(metadata):"customToken"===name?function loginCustomToken(token){Config.SERVICES.fireworker&&Fireworker.auth({method:"signInWithCustomToken",metadata:{token:token}}),_this.AUTH.signInWithCustomToken(token)}(metadata):void 0}}}}),"static"),Class((function PlatformDB(){Inherit(this,Model);const _this=this;let _database;this.init=async function(app){await FirebaseDB.ready(),_database=app.database(),_this.dataReady=!0},this.ref=function(path){return _database?_database.ref(path):null},this.get("DATABASE",(()=>_database)),this.serverTime=function(){let offsetRef=this.ref(".info/serverTimeOffset");return new Promise(((resolve,reject)=>{offsetRef.on("value",(snap=>{resolve((new Date).getTime()+snap.val())}))}))}}),"Static"),Class((function PlatformFirestore(){Inherit(this,Model);const _this=this;require("ConsoleSecurity");let _firestore;this.init=async function(app){await Firestore.ready(),_firestore=app.firestore(),_this.dataReady=!0},this.get("FIRESTORE",(()=>_firestore)),this.doc=function(doc){return _firestore?_firestore.doc(doc):null},this.collection=function(collection){return _firestore?_firestore.collection(collection):null},this.timestamp=function(){return firebase.firestore.FieldValue.serverTimestamp()}}),"Static"),Class((function PlatformFunctions(){Inherit(this,Model);const _this=this;let _functions;this.init=async function(app){await FirebaseFunctions.ready(),_functions=app.functions(),Utils.query("localServer")&&_functions.useEmulator("localhost",5e3),_this.FUNCTIONS=_functions,_this.dataReady=!0},this.httpsCallable=function(endpoint){return _functions?_functions.httpsCallable(endpoint):console.log("functions not ready: ",endpoint)}}),"Static"),Class((function PlatformServices(){Inherit(this,Model);const _this=this;let _app,_serverTime=Date.now();function updateServerTime(){_serverTime+=Render.DELTA}!async function(){await Hydra.ready(),await Config.ready(),Config.SERVICES?(Config.SERVICES.firebase&&Firebase.init(),await Firebase.ready(),Config.SERVICES.database&&FirebaseDB.init(),Config.SERVICES.firestore&&Firestore.init(),Config.SERVICES.auth&&FirebaseAuth.init(),Config.SERVICES.analytics&&FirebaseAnalytics.init(),Config.SERVICES.functions&&FirebaseFunctions.init(),Config.SERVICES.appcheck&&FirebaseAppCheck.init(),!0===Config.SERVICES.init&&_this.init()):Hydra.LOCAL&&console.warn("Config.SERVICES Missing")}(),_this.init=async function(){if(!Config.PLATFORM_CONFIG&&Hydra.LOCAL)return console.warn("Platform Config Missing");_app||(_app=firebase.initializeApp(Config.PLATFORM_CONFIG,"platform")),Config.SERVICES.fireworker&&(await Fireworker.init(Config.PLATFORM_CONFIG),await Fireworker.ready()),Config.SERVICES.database&&(await FirebaseDB.ready(),await PlatformDB.init(_app),await PlatformDB.ready(),Config.SERVICES.emulate?.active&&Config.SERVICES.emulate.database&&Hydra.LOCAL&&PlatformDB.DATABASE.useEmulator(Config.SERVICES.emulate.database.host,Config.SERVICES.emulate.database.port)),Config.SERVICES.firestore&&(await Firestore.ready(),await PlatformFirestore.init(_app),await PlatformFirestore.ready(),Config.SERVICES.emulate?.active&&Config.SERVICES.emulate.firestore&&Hydra.LOCAL&&PlatformFirestore.FIRESTORE.useEmulator(Config.SERVICES.emulate.firestore.host,Config.SERVICES.emulate.firestore.port)),!Config.SERVICES.auth||Global.PLAYGROUND&&!Utils.query("login")||(await PlatformAuth.init(_app),await PlatformAuth.ready(),Config.SERVICES.emulate?.active&&Config.SERVICES.emulate.auth&&Hydra.LOCAL&&PlatformAuth.AUTH.useEmulator(Config.SERVICES.emulate.auth)),Config.SERVICES.analytics&&(await FirebaseAnalytics.ready(),await PlatformAnalytics.init(_app)),Config.SERVICES.appcheck&&(await FirebaseAppCheck.ready(),await PlatformAppCheck.init(_app)),Config.SERVICES.functions&&(await FirebaseFunctions.ready(),await PlatformFunctions.init(_app),await PlatformFunctions.ready(),Config.SERVICES.emulate?.active&&Config.SERVICES.emulate.functions&&Hydra.LOCAL&&PlatformFunctions.FUNCTIONS.useEmulator(Config.SERVICES.emulate.functions.host,Config.SERVICES.emulate.functions.port)),await async function setServerTime(){let localTime=Date.now(),data=await get("https://us-central1-dreamwave-services.cloudfunctions.net/timestamp");!data.timestamp&&Hydra.LOCAL&&console.warn("PlatformServices::setServerTime  Failed to get timestamp",data),_serverTime=data.timestamp+(Date.now()-localTime)/2}(),_this.startRender(updateServerTime),_this.dataReady=!0},_this.get("serverTime",(()=>_serverTime))}),"static"),Class((function SoundFX(){Inherit(this,Component);const _this=this;var _audio={};this.load=function(key,path,permanent=!1){_audio[key]={audio3d:_this.initClass(Audio3D,{src:Assets.getPath(path),autoload:!0}),permanent:permanent},_audio[key].audio3d.load()},this.play=function(key){_audio[key].audio3d.play()},this.clear=function(){for(let key in _audio){let audio=_audio[key];audio.permanent||audio.destroy()}}}),"static"),Class((function UI3DPrompt({dimensions:dimensions={x:1024,y:500},padding:padding={x:100,y:100},align:align="center",font:font="proxima-nova",fontSize:fontSize=60,fontColor:fontColor="#ffffff",lineHeight:lineHeight=1.2,text:text="Would you like to do this action?",textWidthProportion:textWidthProportion=.75,bgAlpha:bgAlpha=.8,bgColor:bgColor="#000",bgRadius:bgRadius=40,bgImg:bgImg,cancelButton:cancelButton={backgroundAlpha:.15,backgroundColor:"#ffffff",borderRadius:40,color:"#ffffff",font:font,fontSize:40,height:90,hoverBackgroundColor:"#ffffff",hoverColor:"#000000",text:"No",width:225},confirmButton:confirmButton={backgroundAlpha:.15,backgroundColor:"#ffffff",borderRadius:40,color:"#ffffff",font:font,fontSize:40,height:90,hoverBackgroundColor:"#ffffff",hoverColor:"#000000",text:"Yes",width:225},scale:scale=(Device.mobile.phone?1.4:1),singleOption:singleOption=!1}={}){Inherit(this,Object3D);const _this=this;var $root,$capture,$bg,$content,$text,_button1,_button2;function handleCancel(){_this.events.fire(Events.COMPLETE,{shouldStart:!1})}function handleConfirm(){_this.events.fire(Events.COMPLETE,{shouldStart:!0})}!async function(){GLSEO.registerPage(_this.group,"UI3DPrompt"),await async function init(){let capture=_this.initClass(StageLayoutCapture,dimensions.x,dimensions.y,!0);$root=capture.root,($capture=$gl(2,dimensions.y/dimensions.x*2,capture)).enable3D();let env=_this.findParent("GroupEnvironment"),shader=_this.initClass(Shader,"UI3DPromptShader",{transparent:!0,customCompile:Utils.getConstructorName(env.view)});$capture.useShader(shader),_this.add($capture.group),Platform.usingVR()||($capture.mesh.shader.depthTest=!1,$capture.mesh.shader.depthWrite=!1);$capture.mesh.shader.transparent=!0,$capture.mesh.renderOrder=99999,capture.object3d=$capture,_this.capture=capture}(),_this.startRender((_=>{})),await async function initLayers(){let bgShader;bgImg?($bg=$gl(dimensions.x,dimensions.y,bgImg),bgShader=_this.initClass(Shader,"UI3DPromptBackgroundShaderImg",{uOpacity:{value:bgAlpha},transparent:!0})):($bg=$gl(dimensions.x,dimensions.y,bgColor),bgShader=_this.initClass(Shader,"UI3DPromptBackgroundShader",{uBackground:{value:new Color(bgColor)},uOpacity:{value:bgAlpha},uRadius:{value:bgRadius},uSize:{value:new Vector2(dimensions.x,dimensions.y)},transparent:!0}));$bg.useShader(bgShader),$bg.setZ(-2),$root.add($bg),($content=$gl()).x=padding.x,$content.y=padding.y,$root.add($content),($text=$glText(text,UI3DPrompt.font||font,UI3DPrompt.fontSize||fontSize,{align:align,color:UI3DPrompt.fontColor||fontColor,lineHeight:UI3DPrompt.lineHeight||lineHeight,width:dimensions.x*textWidthProportion})).parentSeo=_this.group,$content.add($text),await $text.loaded(),$text.x=dimensions.x/2-padding.x,(_button1=_this.initClass(UI3DPromptButton,{...cancelButton,font:UI3DPrompt.font||font,hover:e=>{_this.events.fire(Events.HOVER,{...e,button:"cancel"})},click:handleCancel})).element.y=.5*dimensions.y-.5*padding.y+.5*cancelButton.height,$content.add(_button1.element),singleOption?_button1.element.x=-padding.x+.5*dimensions.x-.5*cancelButton.width:((_button2=_this.initClass(UI3DPromptButton,{...confirmButton,font:UI3DPrompt.font||font,hover:e=>{_this.events.fire(Events.HOVER,{...e,button:"confirm"})},click:handleConfirm})).element.y=.5*dimensions.y-.5*padding.y+.5*confirmButton.height,_button2.element.x=-padding.x+.5*dimensions.x+.25*confirmButton.width,$content.add(_button2.element),_button1.element.x=-padding.x+.5*dimensions.x-1.25*cancelButton.width)}(),_this.flag("initialized",!0),Global.PLAYGROUND||(_this.group.visible=!1),function addListeners(){_this.events.sub(UI3DPrompt.HIDE,(()=>{tween($root,{alpha:0},600,"easeOutCubic")})),_this.events.sub(UI3DPrompt.SHOW,(()=>{tween($root,{alpha:1},600,"easeOutCubic")}))}()}(),_this.ready=_=>_this.wait("initialized"),_this.animateIn=async function(){await _this.ready(),_this.group&&(_this.group.visible=!0,_this.group.scale.setScalar(0),PlayerControlsPathfinding.DISABLED=!0,tween(_this.group.scale,{x:scale,y:scale,z:scale},400,"easeInOutCubic"))},_this.animateOut=async function(){await _this.ready(),_this.group&&tween(_this.group.scale,{x:0,y:0,z:0},400,"easeInOutCubic").onComplete((_=>{_this.group.visible=!1}))},_this.setText=async function(text,textStyle){await _this.ready(),$text.setText(text,textStyle)},_this.setCancelText=async function(text,textStyle){_button1.setText(text,textStyle)},_this.setConfirmText=async function(text,textStyle){_button2.setText(text,textStyle)},_this.onInvisible=function(){},_this.onVisible=function(){},_this.onDestroy=function(){_this.group.deleted=!0},_this.get("mesh",(()=>$capture.mesh))}),(_=>{UI3DPrompt.HIDE="UI3DPrompt.HIDE",UI3DPrompt.SHOW="UI3DPrompt.SHOW",UI3DPrompt.setGlobalStyles=function({font:font,fontColor:fontColor,fontSize:fontSize,lineHeight:lineHeight}){font&&(UI3DPrompt.font=font),fontColor&&(UI3DPrompt.fontColor=fontColor),fontSize&&(UI3DPrompt.fontSize=fontSize),lineHeight&&(UI3DPrompt.lineHeight=lineHeight)},UI3DPrompt.hideAllPrompts=function(){Events._emitter.fireEvent(UI3DPrompt.HIDE)}})),Class((function UI3DPromptButton({align:align="center",backgroundAlpha:backgroundAlpha=.15,backgroundColor:backgroundColor="#ffffff",borderRadius:borderRadius=40,borderColor:borderColor,borderMask:borderMask="assets/images/ui/prompt-button.png",borderShader:borderShader="UI3DPromptButtonShaderBordered",click:click,hover:hover,color:color="#000000",font:font="proxima-nova",fontSize:fontSize=30,height:height,hoverColor:hoverColor="#ffffff",hoverBackgroundColor:hoverBackgroundColor="#000000",text:text="Yes",width:width}){Inherit(this,GLUIElement);const _this=this;var $text,$background;function onHover(e){"over"==e.action?($background.shader.tween("uHover",1,400,"easeOutCubic"),$text.tweenColor(new Color(hoverColor),400,"easeOutCubic")):($background.shader.tween("uHover",0,400,"easeOutCubic"),$text.tweenColor(new Color(color),400,"easeOutCubic")),hover?.(e)}function onClick(){click&&click()}!async function(){await async function initText(){$text=await $glText(text,font,fontSize,{align:align,color:color}),await $text.loaded(),$text.x=width/2,$text.y=.85*-$text.dimensions.height,_this.element.add($text)}(),async function initBackground(){let shader;borderColor?($background=$gl(width,height,borderMask),shader=_this.initClass(Shader,borderShader,{uBackgroundAlpha:{value:backgroundAlpha},uBackgroundColor:{value:new Color(backgroundColor)},uBorderColor:{value:new Color(borderColor)},uColor:{value:new Color(color)},uHover:{value:0},uHoverColor:{value:new Color(hoverColor)},uHoverBackgroundColor:{value:new Color(hoverBackgroundColor)},uRadius:{value:borderRadius},uSize:{value:new Vector2(width,height)},transparent:!0})):($background=$gl(width,height,backgroundColor),shader=_this.initClass(Shader,"UI3DPromptButtonShader",{uBackgroundAlpha:{value:backgroundAlpha},uBackgroundColor:{value:new Color(backgroundColor)},uColor:{value:new Color(color)},uHover:{value:0},uHoverColor:{value:new Color(hoverColor)},uHoverBackgroundColor:{value:new Color(hoverBackgroundColor)},uRadius:{value:borderRadius},uSize:{value:new Vector2(width,height)},transparent:!0}));$background.parentSeo=_this.parent.group,$background.x=0,$background.y=-height/2,$background.z=-.01,$background.useShader(shader),_this.element.add($background)}(),async function addListeners(){await _this.wait("isReady"),$background.interact(onHover,onClick,"#",text)}(),_this.element.alpha=1,_this.flag("isReady",!0)}(),_this.setText=function(text,textStyle){$text.setText(text,textStyle)},_this.ready=async function(){return _this.wait(_this,"isReady")},_this.animateIn=async function(delay){await _this.ready(),tween(_this.element,{alpha:1},1e3,"easeOutCubic",delay)}})),Class((function UI3DTutorialView({dimensions:dimensions={x:1024,y:500},font:font="proxima-nova",fontSize:fontSize=50,fontColor:fontColor="#FFFFFF",secondaryColor:secondaryColor="#AAAAAA",lineHeight:lineHeight=1.2,title:title="Tutorial",description:description="Tutorial description",bgAlpha:bgAlpha=.8,bgColor:bgColor="#000",bgRadius:bgRadius=40,icon:icon,scale:scale=1}){Inherit(this,Object3D);const _this=this;var $root,$capture,$bg,$content,$image,$title,$text,$line,$progress;function onClick(){_this.parent.next()}!async function(){!function init(){let capture=_this.initClass(StageLayoutCapture,1024,1024,!0);$root=capture.root,($capture=$gl(2,2,capture)).enable3D(),_this.add($capture.group),Platform.usingVR()||($capture.mesh.shader.depthTest=!1);$capture.mesh.shader.depthWrite=!1,$capture.mesh.shader.transparent=!0,$capture.mesh.renderOrder=999,capture.object3d=$capture,capture.mouseEnabled=!1,_this.capture=capture}(),function initBackground(){$bg=$gl(dimensions.x,dimensions.y,bgColor);let bgShader=_this.initClass(Shader,"UI3DPromptBackgroundShader",{uBackground:{value:new Color(bgColor)},uOpacity:{value:bgAlpha},uRadius:{value:bgRadius},uSize:{value:new Vector2(dimensions.x,dimensions.y)},transparent:!0});$bg.useShader(bgShader),$bg.setZ(-2),$root.add($bg)}(),function initContent(){$content=$gl(),$root.add($content)}(),function initIcon(){if(icon){let image=new Image;image.src=Assets.getPath(icon),image.onload=_=>{let width=236,height=width*(image.naturalHeight/image.naturalWidth);($image=$gl(width,height,Assets.getPath(icon))).x=100,$image.y=.5*dimensions.y-.5*height-50,$root.add($image)}}}(),async function initTitle(){title&&(($title=$glText(title,font,36,{width:dimensions.x-500,lineHeight:lineHeight,letterSpacing:0,color:fontColor})).x=400,$title.y=0,$content.add($title),await $title.loaded());($text=$glText(description,font,38,{width:dimensions.x-500,lineHeight:lineHeight,letterSpacing:0,color:secondaryColor})).x=400,$text.y=50,await $text.loaded(),$content.y=.5*dimensions.y,$content.y-=$title.dimensions.height/2+$text.dimensions.height/2,$content.y-=50,$content.add($text)}(),function initProgress(){($line=$gl(dimensions.x-200,10,"#2D2D2D")).x=100,$line.y=dimensions.y-100,$root.add($line),($progress=$gl(0,10,"#ffffff")).x=$line.x,$progress.y=$line.y,$progress.width=0,$progress.setZ(1),$root.add($progress)}(),async function addListeners(){$bg.interact(null,onClick)}(),_this.flag("initialized",!0),Global.PLAYGROUND||(_this.group.visible=!1)}(),this.animateIn=async function(){await _this.wait("initialized"),_this.group.visible=!0,_this.group.scale.setScalar(0),tween(_this.group.scale,{x:scale,y:scale,z:scale},400,"easeInOutCubic")},this.animateOut=async function(){await _this.wait("initialized"),tween(_this.group.scale,{x:0,y:0,z:0},400,"easeInOutCubic").onComplete((_=>{_this.group.visible=!1}))},this.updateProgress=function(progress){$progress&&($progress.width=dimensions.x*progress-200)},this.get("capt",(_=>_this.capture))})),Class((function CoreUIState(){Inherit(this,Component);const _this=this;_this.uiBuilder=_this.initClass(CoreUIBuilder),_this.styleguide=AppStyleController.styleguide,_this.colors=AppStyleController.colors,_this.uiBuilder.setStyleguide(_this.styleguide),_this.uiBuilder.setColors(_this.colors)}),"singleton"),Class((function UIController(){Inherit(this,Element);const _this=this,$this=_this.element;_this.constructorName=Utils.getConstructorName(_this),Hydra.LOCAL&&Utils.query("hotReload")&&function initSocket(){Hydra.LOCAL&&window.UILSocket&&_this.events.sub(UILSocket.JS_FILE,(e=>{if(e.file){let className=e.file.replace(/^.*[\\\/]/,"").split(".")[0];if(className.startsWith("DreamUI")){const namespacedClassName=className.split("DreamUI").slice(1).join("");className="DreamUI."+namespacedClassName}Utils.debounce((()=>{UIController.hotReload(className)}),50)}}))}(),function initSpritesheet(){Spritesheet.url=Assets.getPath("~assets/images/sprite.svg")}(),function initHTML(){$this.size("100%").css({display:"flex",flexDirection:"column",position:"fixed",opacity:1,zIndex:100}),Platform.usingVR()||Utils.query("orbit")||Stage.add($this)}(),function initHeader(){_this.header=$this.create(_this.constructorName+"__header"),_this.header.css({position:"relative"})}(),function initContent(){_this.content=$this.create(_this.constructorName+"__content"),_this.content.css({height:"100%",overflow:"hidden",position:"relative"})}(),function initFooter(){_this.footer=$this.create(_this.constructorName+"__footer"),_this.footer.css({position:"relative"})}(),defer((_=>World.instance().resize())),this.init=function({ClassComponent:ClassComponent=UIPageLayout,isIgnoringHeightResize:isIgnoringHeightResize=!1,isIgnoringWidthResize:isIgnoringWidthResize=!1}={}){_this.flag("isIgnoringHeightResize",isIgnoringHeightResize),_this.flag("isIgnoringWidthResize",isIgnoringWidthResize),_this.layout=_this.initClass(ClassComponent,[_this.content]),_this.flag("isReady",!0)},this.ready=function(){return _this.wait("isReady")},this.initHeader=function(Class){_this.headerInstance=_this.initClass(Class,[_this.header]),defer((_=>World.instance().resize()))},this.hideHeader=function(){_this.header.css({marginTop:-_this.sizes.top,transition:"margin 200ms ease"}),_this.delayedCall((_=>_this.header.invisible()),200)},this.showHeader=function(){_this.header.visible(),_this.header.css({marginTop:0,transition:"margin 200ms ease"})},this.destroyHeader=function(){_this.headerInstance?.destroy(),_this.headerInstance=null},this.initFooter=function(Class){_this.footerInstance=_this.initClass(Class,[_this.footer]),defer((_=>World.instance().resize()))},this.destroyFooter=function(){_this.footerInstance?.destroy(),_this.footerInstance=null},this.show=function(delay){_this.layout.show(delay)},this.hide=function(delay){_this.layout.hide(delay)},this.get("sizes",(_=>{let headerHeight=_this.flag("isIgnoringHeightResize")?0:_this.headerInstance?.element?.div?.clientHeight||0,footerHeight=_this.flag("isIgnoringHeightResize")?0:_this.footerInstance?.element?.div?.clientHeight||0,layoutWidth=_this.flag("isIgnoringWidthResize")?0:Number(_this.layout?.width)||0;return{height:window.innerHeight-headerHeight-footerHeight,left:0,top:headerHeight,width:window.innerWidth-layoutWidth}})),this.registerRoutes=function(routes){_this.layout.registerRoutes(routes)},this.get("route",(_=>_this.layout?.route)),this.setState=function(state,forced){_this.layout?.setState(state,forced)},this.setAVSettings=function(videoAllowed,audioAllowed){AVSettingsController.instance().audioAllowed=audioAllowed,AVSettingsController.instance().videoAllowed=videoAllowed}}),"singleton",(()=>{UIController.VIEW_ROUTE_UPDATE="UIController_VIEW_ROUTE_UPDATE",UIController.hotReload=function hotReload(className){const Class=window[className];if("function"!=typeof Class)return;const controller=UIController.instance();if(controller.headerInstance&&controller.headerInstance.constructorName===className)controller.destroyHeader(),controller.initHeader(Class);else if(controller.footerInstance&&controller.footerInstance.constructorName===className)controller.destroyFooter(),controller.initFooter(Class);else{const layoutView=window[controller.layout.view.constructorName];controller.layout.hotReload(layoutView)}}})),Class((function UIOverlay(){Inherit(this,AbstractUIComponent);const $this=this.element;$this.css({left:"100%",top:0,zIndex:1e4}).transform({x:"0%"}),UIController.instance().layout.element.add($this),this.animateIn=function(){$this.tween({x:"-100%"},400,"easeOutCubic")},this.animateOut=function(){$this.tween({x:"0%"},400,"easeOutCubic")}})),Class((function UIPageLayout(){Inherit(this,Element);const _this=this,$this=_this.element;var _routeCurrent,_viewCurrent,_viewOptions,_views=[];async function transition(view,viewOptions){_this.transition&&await _this.transition.cover(),_viewCurrent&&(_this.events.fire(UIPageLayout.HIDE),_viewCurrent.animateOut&&await _viewCurrent.animateOut(),_viewCurrent.destroy()),_viewOptions=viewOptions,(_viewCurrent=_this.initClass(view,viewOptions,[_this.content])).animateIn&&await _viewCurrent.animateIn(),_this.transition&&await _this.transition.reveal(),_this.events.fire(UIPageLayout.SHOW),notifyResize()}async function handleRouteUpdate(value){!async function handleRouteCreate({value:value}){if(!_views.length)return;let page=_views.find((({regex:regex})=>new RegExp(regex).test(value)));page&&page.guard&&((value=page.guard(value))?.then&&(value=await value),page=_views.find((({regex:regex})=>new RegExp(regex).test(value))));value!==_routeCurrent&&(_routeCurrent=value,page&&page.view&&_viewCurrent?.constructor!==page.view&&transition(page.view),_this.events.fire(UIController.VIEW_ROUTE_UPDATE,{value:value}))}(value)}function resize(){_this.flag("isHidden")||_this.flag("isFullscreen")||Utils.query("collapse")&&this.hide(0)}function notifyResize(){_this.width===window.innerWidth?World.instance().stopRender():_this.flag("isFullscreen")||World.instance().startRender(),World.instance().resize()}_this.constructorName=Utils.getConstructorName(_this),_this.width="100%",function initHTML(){$this.css({position:"relative",display:"flex",width:"100%",height:"100%"}).mouseEnabled(!1),_this.page=$this.create("Page"),_this.page.div.classList.add("prevent_interaction3d"),_this.page.div.classList.add("prevent_interactionScroll"),_this.page.mouseEnabled(!0),_this.page.css({position:"relative",height:"100%"}),function initWrapper(){_this.wrapper=_this.page.create(_this.constructorName+"__wrapper"),_this.wrapper.css({display:"flex",flexDirection:"column"}).size("100%")}(),function initHeader(){_this.header=_this.wrapper.create(_this.constructorName+"__header"),_this.header.css({position:"relative",width:"100%",zIndex:2}),_this.header.setZ(10),_this.initClass(CSSFilter,_this.header)}(),function initContent(){_this.content=_this.wrapper.create(_this.constructorName+"__content"),_this.content.css({height:"100%",position:"relative",overflowX:"hidden",zIndex:2}).overflowScroll({y:!0}),_this.initClass(CSSFilter,_this.content)}(),function initFooter(){_this.footer=_this.wrapper.create(_this.constructorName+"__footer"),_this.footer.css({position:"relative",width:"100%",zIndex:10})}()}(),function addListeners(){_this.onResize(resize),Config.DEPRECATED_ROUTING?_this.events.sub(Router,Router.UPDATE,handleRouteUpdate):_this.bindState(RoutesController.state,RoutesController.ROUTE_CONTROLLER_CHANGE,(({path:path,matchedRouteData:matchedRouteData})=>{!async function onRouteChange({path:path,matchedRouteData:matchedRouteData}){path!==_routeCurrent&&(_routeCurrent=path,matchedRouteData&&matchedRouteData.view&&_viewCurrent?.constructor!==matchedRouteData.view&&transition(matchedRouteData.view,matchedRouteData.viewOptions),_this.events.fire(UIController.VIEW_ROUTE_UPDATE,{value:path}))}({path:path,matchedRouteData:matchedRouteData})}))}(),resize(),this.addContent=function(obj){if(_viewCurrent&&_viewCurrent.destroy(),obj.element)_this.content.add(obj.element),_viewCurrent=obj;else{let instance=_this.initClass(obj,{parent:_this.page,showBackdrop:!0,closeOnBackdropClick:!0},[_this.content]);_viewCurrent=instance}return _viewCurrent},this.addHeader=function(Class){let instance=_this.initClass(Class,{parent:_this.page},[_this.header]);return _this.headerInstance=instance,_this.flag("isHeaderVisible",!0),instance},this.destroyHeader=_=>_this.headerInstance&&_this.headerInstance.destroy(),this.addFooter=function(Class){let instance=_this.initClass(Class,null,[_this.footer]);return _this.footerInstance=instance,_this.flag("isFooterVisible",!0),instance},this.destroyFooter=_=>_this.footerInstance&&_this.footerInstance.destroy(),this.setTransition=function(Class){_this.transition=_this.initClass(Class)},this.registerRoutes=function(routes){const msg="UIPageLayout::registerRoutes is deprecated, upgrade to RoutesController.registerRoutes()";Config.DEPRECATED_ROUTING?(Hydra.LOCAL&&console.warn(msg),_views=routes.map((({path:path,view:view,guard:guard,viewOptions:viewOptions})=>({guard:guard,regex:"object"==typeof path?new RegExp(path):`^${path}/?$`,view:view,viewOptions:viewOptions})))):Hydra.LOCAL&&console.warn(msg)},this.hide=function(duration=300){if(!_this.flag("isHidden"))return _this.flag("isHidden",!0),new Promise(((resolve,reject)=>{_this.widthPrevious=_this.width;let translation={x:0},onComplete=_=>{_this.width=0,_this.page.css({opacity:0,visibility:"hidden"}),resolve()};if(duration){tween(translation,{x:1},duration,"easeOutCubic",onComplete).onUpdate((_=>{_this.page.transform({x:100*translation.x+"%"}),_this.width=_this.widthPrevious*(1-translation.x)}))}else onComplete()}))},this.show=function(duration=300){if(_this.flag("isHidden"))return _this.flag("isHidden",!1),new Promise(((resolve,reject)=>{let translation={x:1},onComplete=_=>{_this.width=_this.widthPrevious,resolve()};if(_this.page.css({opacity:1,visibility:"visible"}),duration){tween(translation,{x:0},duration,"easeOutCubic",onComplete).onUpdate((_=>{_this.page.transform({x:100*translation.x+"%"}),_this.width=_this.widthPrevious*(1-translation.x)}))}else onComplete()}))},this.hideHeader=function({duration:duration=400,ease:ease="easeOutCubic"}={}){_this.header.transform({y:"0%"}).invisible().tween({y:"-100%"},duration,ease),_this.flag("isHeaderVisible",!1)},this.showHeader=function({duration:duration=400,ease:ease="easeOutCubic",height:height}={}){_this.header.transform({y:"-100%"}).visible().tween({y:"0%"},duration,ease),_this.flag("isHeaderVisible",!0)},this.hideFooter=function({duration:duration=400,ease:ease="easeOutCubic"}={}){_this.footer.transform({y:"0%"}).invisible().tween({y:"100%"},duration,ease),_this.flag("isFooterVisible",!1)},this.showFooter=function({duration:duration=400,ease:ease="easeOutCubic",height:height}={}){_this.footer.transform({y:"-100%"}).visible().tween({y:"0%"},duration,ease),_this.flag("isFooterVisible",!0)},this.init=function({width:width="100%"}={}){_this.width=width,_this.widthPrevious=width,_this.page.css({width:_this.width}),Config.DEPRECATED_ROUTING&&handleRouteUpdate({value:Router.getState().join("/")})},this.get("view",(_=>_viewCurrent)),this.get("route",(_=>_routeCurrent)),this.get("headerVisible",(_=>_this.flag("isHeaderVisible"))),this.get("footerVisible",(_=>_this.flag("isFooterVisible"))),this.setState=async function(state,forced){(state!==_routeCurrent||forced)&&(Config.DEPRECATED_ROUTING?handleRouteUpdate({value:state}):await RoutesController.onRouteChange({path:state}))},this.setSize=async function({duration:duration=0,ease:ease="easeOutCubic",width:width=500}={}){return _this.width=width,_this.widthPrevious=width,_this.page.tween({width:width},duration,ease,(_=>{notifyResize()})).promise()},this.hotReload=function(view){_viewCurrent.destroy(),_viewCurrent=_this.initClass(view,_viewOptions||null,[_this.content])}}),(_=>{UIPageLayout.SHOW="UIPageLayout.SHOW",UIPageLayout.HIDE="UIPageLayout.HIDE",UIPageLayout.RESIZE="UIPageLayout_reize"})),Class((function UIPanelLayout(){Inherit(this,Element);const _this=this,$this=_this.element;var _routeCurrent,_viewCurrent,_views=[];async function handleRouteUpdate(value){_this.destroyOverlay(),async function handleRouteCreate({value:value}){if(!_views.length)return;let page=_views.find((({regex:regex})=>new RegExp(regex).test(value)));page&&page.guard&&((value=page.guard(value))?.then&&(value=await value),page=_views.find((({regex:regex})=>new RegExp(regex).test(value))));value!==_routeCurrent&&(_routeCurrent=value,page&&page.view&&_viewCurrent?.constructor!==page.view.view&&async function transition(view,direction="right"){view.color&&_this.transitionElement.css({background:view.color}),_this.flag("isSwipeTransition")&&await new Promise((resolve=>AnimationBuilder.swipeTransition(_this.content,_this.transitionElement,direction,(_=>resolve())))),_viewCurrent&&(_viewCurrent.animateOut&&await _viewCurrent.animateOut(),_viewCurrent.destroy()),(_viewCurrent=_this.initClass(view.view,view.options,[_this.content])).animateIn&&await _viewCurrent.animateIn(),notifyResize()}(page.view),_this.events.fire(UIController.VIEW_ROUTE_UPDATE,{value:value}))}(value)}function resize(){_this.flag("isHidden")||_this.flag("isFullscreen")||(Utils.query("collapse")?this.hide(0):notifyResize())}function notifyResize(){_this.width===window.innerWidth?World.instance().stopRender():_this.flag("isFullscreen")||World.instance().startRender(),World.instance().resize()}_this.flag("isSwipeTransition",!0),_this.constructorName="Panel",_this.width=500,function initHTML(){$this.css({position:"relative",display:"flex",width:"100%",height:"100%"}).mouseEnabled(!1),_this.panel=$this.create("Panel"),_this.panel.div.classList.add("prevent_interaction3d"),_this.panel.div.classList.add("prevent_interactionScroll"),_this.panel.mouseEnabled(!0),_this.panel.css({position:"absolute",height:"100%",overflow:"hidden",right:0,top:0}),_this.panel.setZ(100),function initWrapper(){_this.wrapper=_this.panel.create(_this.constructorName+"__wrapper"),_this.wrapper.css({display:"flex",flexDirection:"column",left:0,overflow:"hidden",top:0}).size("100%")}(),function initHeader(){_this.header=_this.wrapper.create(_this.constructorName+"__header"),_this.header.css({position:"relative",width:"100%",zIndex:2}),_this.header.setZ(10),_this.initClass(CSSFilter,_this.header)}(),function initContent(){_this.content=_this.wrapper.create(_this.constructorName+"__content"),_this.content.css({height:"100%",position:"relative",overflowY:"auto",overflowX:"hidden",zIndex:2}),_this.initClass(CSSFilter,_this.content)}(),function initFooter(){_this.footer=_this.wrapper.create(_this.constructorName+"__footer"),_this.footer.css({position:"relative",width:"100%",zIndex:10})}()}(),function initTransition(){_this.transitionElement=_this.panel.create(_this.constructorName+"__transition"),_this.transitionElement.size("100%").css({left:0,opacity:0,position:"absolute",top:0,visibility:"hidden"}),_this.transitionElement.setZ(-1)}(),function addListeners(){_this.onResize(resize),_this.events.sub(Router,Router.UPDATE,handleRouteUpdate)}(),resize(),this.addContent=function(obj){if(_viewCurrent&&_viewCurrent.destroy(),obj.element)_this.content.add(obj.element),_viewCurrent=obj;else{let instance=_this.initClass(obj,{parent:_this.panel,showBackdrop:!0,closeOnBackdropClick:!0},[_this.content]);_viewCurrent=instance}return _viewCurrent},this.addHeader=function(Class){let instance=_this.initClass(Class,{parent:_this.panel},[_this.header]);return _this.headerInstance=instance,_this.flag("isHeaderVisible",!0),instance},this.destroyHeader=_=>_this.headerInstance&&_this.headerInstance.destroy(),this.addFooter=function(Class){let instance=_this.initClass(Class,null,[_this.footer]);return _this.footerInstance=instance,_this.flag("isFooterVisible",!0),instance},this.destroyFooter=_=>_this.footerInstance&&_this.footerInstance.destroy(),this.registerRoutes=function(routes){_views=routes.map((({path:path,color:color,view:view,guard:guard})=>({guard:guard,regex:"object"==typeof path?new RegExp(path):`^${path}/?$`,view:{color:color,view:view}})))},this.hide=function(duration=300){if(!_this.flag("isHidden"))return _this.events.fire(UIPanelLayout.HIDE),_this.flag("isHidden",!0),new Promise(((resolve,reject)=>{_this.widthPrevious=_this.width;let translation={x:0},onComplete=_=>{_this.width=0,_this.panel.css({opacity:0,visibility:"hidden"}),notifyResize(),resolve()};if(duration){tween(translation,{x:1},duration,"easeOutCubic",onComplete).onUpdate((_=>{_this.panel.transform({x:100*translation.x+"%"}),_this.width=_this.widthPrevious*(1-translation.x),notifyResize()}))}else onComplete()}))},this.show=function(duration=300){if(_this.flag("isHidden"))return _this.events.fire(UIPanelLayout.SHOW),_this.flag("isHidden",!1),new Promise(((resolve,reject)=>{let translation={x:1},onComplete=_=>{_this.width=_this.widthPrevious,notifyResize(),resolve()};if(_this.panel.css({opacity:1,visibility:"visible"}),duration){tween(translation,{x:0},duration,"easeOutCubic",onComplete).onUpdate((_=>{_this.panel.transform({x:100*translation.x+"%"}),_this.width=_this.widthPrevious*(1-translation.x),notifyResize()}))}else onComplete()}))},this.hideHeader=function({duration:duration=400,ease:ease="easeOutCubic"}={}){_this.header.tween({height:0},duration,ease,(_=>{_this.header.invisible()})),_this.isHeaderVisible=!1},this.showHeader=function({duration:duration=400,ease:ease="easeOutCubic",height:height}={}){_this.header.visible(),_this.header.tween({height:height||_this.header.children()[0].clientHeight},duration,ease),_this.isHeaderVisible=!0},this.hideFooter=function({duration:duration=400,ease:ease="easeOutCubic"}={}){_this.footer.tween({height:0},duration,ease,(_=>{_this.footer.invisible()})),_this.flag("isFooterVisible",!1)},this.showFooter=function({duration:duration=400,ease:ease="easeOutCubic",height:height}={}){_this.footer.visible(),_this.footer.tween({height:height||_this.footer.children()[0].clientHeight},duration,ease),_this.flag("isFooterVisible",!0)},this.showOverlay=function(Class,data,direction,background){_this.destroyOverlay(),_this.overlay=_this.content.create("overlay"),_this.overlay.size("100%").css({left:0,top:0,position:"absolute"}),_this.transitionElement.css({background:background}),AnimationBuilder.swipeTransition(_this.content,_this.transitionElement,direction,(_=>{_this.overlayInstance=_this.initClass(Class,data,[_this.overlay]),_viewCurrent?.element.css({opacity:0,visibility:"hidden"})}))},this.hideOverlay=function(direction,background){_this.transitionElement.css({background:background}),AnimationBuilder.swipeTransition(_this.content,_this.transitionElement,direction,(_=>{_this.destroyOverlay()}))},this.destroyOverlay=function(){_this.overlay&&(_this.overlayInstance?.destroy?.(),_this.overlayInstance=null,_this.overlay?.remove?.(),_this.overlay=null,_viewCurrent?.element.css({opacity:1,visibility:"visible"}))},_this.setSwipeTransition=function(isEnabled){_this.flag("isSwipeTransition",isEnabled)},_this.transition=function(direction,background,callback){_this.transitionElement.css({background:background}),AnimationBuilder.swipeTransition(_this.content,_this.transitionElement,direction,callback)},this.init=function({width:width=500}={}){_this.width=width,_this.widthPrevious=width,_this.panel.css({width:_this.width}),handleRouteUpdate({value:Router.getState().join("/")})},this.get("view",(_=>_viewCurrent)),this.get("route",(_=>_routeCurrent)),this.get("headerVisible",(_=>_this.flag("isHeaderVisible"))),this.get("footerVisible",(_=>_this.flag("isFooterVisible"))),this.setState=function(state,forced){(state!==_routeCurrent||forced)&&handleRouteUpdate({value:state})},this.setSize=async function({duration:duration=0,ease:ease="easeOutCubic",width:width=500}={}){return _this.width=width,_this.widthPrevious=width,_this.panel.tween({width:width},duration,ease,(_=>{notifyResize()})).promise()},this.enableFullscreen=async function({duration:duration=0,ease:ease="easeOutCubic"}={}){return _this.flag("isFullscreen",!0),_this.panel.tween({width:window.innerWidth},duration,ease).onComplete((_=>{_this.panel.css({width:"100%"}),notifyResize()})).promise()},this.disableFullscreen=async function({duration:duration=0,ease:ease="easeOutCubic"}={}){return _this.flag("isFullscreen",!1),World.instance().startRender(),_this.panel.tween({width:_this.width},duration,ease).onComplete((_=>{notifyResize()})).promise()}}),(_=>{UIPanelLayout.SHOW="UIPanelLayout.SHOW",UIPanelLayout.HIDE="UIPanelLayout.HIDE",UIPanelLayout.RESIZE="UIPanelLayout_reize"})),Class((function UICopy(){Inherit(this,Component);const _this=this;_this.en={privacyPolicy:"Privacy Policy",termsAndConditions:"Terms and Conditions",profileTitle:"Profile",profileLogout:"Log Out",profileAddName:"Add name",profileEditName:"Edit",profileSave:"Save",profileCancel:"Cancel",profileAvatar:"Avatar",profileAvatarAvatars:"Face",profileAvatarSkins:"Skins",profileAvatarColor:"Color",settingsTabGeneral:"General",settingsTabAudio:"Audio",settingsTabCamera:"Camera",settingsTitle:"Player Settings",settingsTheme:"UI Theme",settingsLightTheme:"Light",settingsDarkTheme:"Dark",settingsAutoTheme:"Auto",settingsCamera:"Camera POV",settingsCamera1st:"1st",settingsCamera3rd:"3rd",settingsCameraAerial:"Aerial",settingsDisturb:"Do Not Disturb",settingsDisturbOn:"On",settingsDisturbOff:"Off",settingsMotion:"Motion",settingsMotionOn:"On",settingsMotionOff:"Off",settingsVideoVolume:"Video Sound",settingsVideoVolumeOn:"On",settingsVideoVolumeOff:"Off",settingsSFX:"Sound FX",settingsSFXOn:"On",settingsSFXOff:"Off",settingsSoundMicrophone:"Microphone",settingsSoundSpeakers:"Speakers",settingsSoundSpeakersText:"Test",settingsSoundBlockedTitle:"Your device does not allow media access.",settingsSoundBlockedDescription:"Please fix your media access permissions and refresh your browser to ensure your changes are reflected.",settingsParty:"Watch Party",settingsPartyDescription:"Create a party room and invite friends to chat using the code provided. You can invite up to 10 people.",settingsPartyFull:"The party you tried to join is full.",settingsPartyCreate:"Create a Party",settingsPartyJoin:"Join a Party",settingsPartyExit:"Exit Party",settingsPartyInvite:"Invite Friends",settingsWorlds:"Environment",settingsChat:"Chat Zone",chatTitle:"Chat",emotesTooltip:"Emotes",chatTooltip:"Text Chat",voiceTooltip:"Voice Chat",walletTooltip:"Wallet",settingsTooltip:"Settings",profileTooltip:"Profile",metamaskTitle:"Wallet",metamaskDescription:"Connect with our wallet provider MetaMask or create a new one.",metamaskButton:"Metamask",metamaskTerms:"Terms and Conditions",metamaskCollection:"My Collection",metamaskEmpty:"You don't own any relevant NFTs",metamaskConnection:"Disconnected",metamaskInstructionsButton:"View Instructions",metamaskPromptDesktop:"Would you like to connect your metamask wallet?",metamaskDownloadButton:"Download Metamask",metamaskDownloadText:"Download the metamask "+(Device.mobile?"app":"extension"),metamaskMobileTitle:"Connect to your nft wallet",metamaskMobileDescription:"In order to connect your NFT wallet from this device, youre required to use and navigate within the METAMASK app",metamaskMobileStep1:"Open Metamask app to connect your NFT wallet",metamaskMobileStep2:"Once connected, click the button below to copy then paste the url in the app to navigate the experience.",metamaskPromptSuccess:"Success! Thanks for connecting your metamask wallet!",metamaskPromptFail:"Failed to connect...",metamaskNetworkPromptText:"Click here to switch to the ethereum mainnet",metamaskNetworkPromptButton:"Connect",friendsAndFamilyToast:"Access to Friends and Family skin granted!",profilePrompt:"",profilePromptTitle:"You can block this user from audio chatting with you by clicking below.",profilePromptReport:"Report",profilePromptReportTitle:"Report this user?",profilePromptBlock:"Block",profilePromptBlockTitle:"Block this user?",profilePromptUnblock:"Unblock",profilePromptUnblockTitle:"Unblock this user?",profilePromptNo:"No",profilePromptYes:"Yes",profilePromptReported:"User has been reported.",profilePromptBlocked:"User has been blocked.",profilePromptUnblocked:"User has been unblocked.",profilePromptConfirm:"Confirm",chatzoneTitle:"Create voice chat zone?",chatzoneCreate:"Create voice chat zone?",chatzoneJoin:"Join chat zone?",chatzoneCancel:"No",chatzoneAccept:"Yes",surveyTitle:"Help us improve",surveyDescription:"Take our quick survey to help us build the future of the Dreamwave.",surveyButton:"Let's go",vrTitle:"Dreamwave VR",vrDescription:"This is an example of a VR landing page to provide information to users before jumping in",vrButton:"Start VR",vrMode:"VR Mode",vrModeOn:"On",vrModeOff:"Off",vrPowered:"Powered by",emotes:"Emotes",emotesDescription:"Click or use your number keys to fire emotes"},_this.state=AppState.createLocal(_this.en),_this.set("language",(lang=>{for(const key in _this[lang])_this.state[key]=_this[lang][key]}))}),"static"),Class((function UICopyText(_options={type:"div"}){Inherit(this,Element,_options.type);const _this=this,$this=_this.element;!function initHTML(){_options?.customClass&&$this.div.classList.add(_options.customClass),_this.bindState(UICopy.state,_options.copy,(copy=>{$this.text(copy)}))}()})),Class((function UITests(){Inherit(this,Component),this.backdropFilter=function(value="255, 255, 255"){return"firefox"===Device?.system?.browser?"\n            background: linear-gradient(225.2deg, var(--white90) 28.31%, var(--white80) 62.97%);\n        ":"\n            background: linear-gradient(204.23deg, var(--white60) 24.85%, var(--white80) 99.34%);\n            backdrop-filter: blur(20px);\n        "}}),"static"),Class((function AbstractUIComponent(_element){Inherit(this,Element,_element);const _this=this;function checkModalModule(){if(void 0===DreamUI.Modal)throw Error("AbstractUIComponent.js Error:: You need to include DreamUI.Modal module in project.json")}this.parseConfig=function(config){for(let key in config)_this[key]=config[key]},this.getPrefix=function(className){return`${Utils.getConstructorName(this)}__${className}`},this.hideLoader=()=>{checkModalModule(),DreamUI.Modal.instance().close()},this.showLoader=(view,config)=>{checkModalModule(),DreamUI.Modal.instance().open(view,{options:{...config}})}})),Class((function GooberHelper(){goober.createGlobalStyles=gooberGlobal.createGlobalStyles,goober.setup((_=>{}),gooberPrefixer.prefix)}),"static"),Class((function AbstractDragUtil(){Inherit(this,Component);const _this=this;_this.dMap={},_this.pos={},_this.distanceThreshold=15,this.closestEdge=function(e,elem){var elemBounding=elem.getBoundingClientRect(),elementLeftEdge=elemBounding.left,elementTopEdge=elemBounding.top,elementRightEdge=elemBounding.right,elementBottomEdge=elemBounding.bottom,mouseX=e.x,mouseY=e.y,topEdgeDist=Math.abs(elementTopEdge-mouseY),bottomEdgeDist=Math.abs(elementBottomEdge-mouseY),leftEdgeDist=Math.abs(elementLeftEdge-mouseX),rightEdgeDist=Math.abs(elementRightEdge-mouseX);_this.dMap={top:topEdgeDist<=_this.distanceThreshold,bottom:bottomEdgeDist<=_this.distanceThreshold,left:leftEdgeDist<=_this.distanceThreshold,right:rightEdgeDist<=_this.distanceThreshold}},this.resolveCSS=function(){if(_this.pos.y<=Stage.height/2){let projectedTop=_this.pos.y;_this.object.css({top:projectedTop>=0?projectedTop:0,left:_this.pos.x})}else{let projectedBottom=Stage.height-_this.pos.y-_this.object.div.clientHeight;_this.object.css({bottom:projectedBottom>=0?projectedBottom:0,left:_this.pos.x})}},this.determineTransformOrigin=function(){return(_this.dMap.top?"top ":_this.dMap.bottom?"bottom ":"")+(_this.dMap.left?"left ":_this.dMap.right?"right ":"")},this.parseStyle=function(style){return style.includes("rem")?10*parseInt(style):parseInt(style)}}),(()=>{AbstractDragUtil.CHANGE_START="AbstractDragUtil_change_start",AbstractDragUtil.CHANGE_END="AbstractDragUtil_change_end"})),Class((function AnimationBuilder(){Inherit(this,Component);this.backOver=function(icon){icon.element.tween({opacity:0,x:-5},250,"easeOutCubic",(_=>{icon.element.transform({x:5}),icon.element.tween({opacity:1,x:0},250,"easeOutCubic")}))},this.backOut=function(icon){icon.element.tween({opacity:1,x:0},400,"easeOutCubic")},this.fadeInStagger=function({ease:ease,items:items,onComplete:onComplete,stagger:stagger,time:time,x:x=0,y:y=0}){items.forEach(((item,index)=>{item.css({opacity:0}).transform({x:x,y:y}),item.tween({opacity:1,x:0,y:0},time,ease,stagger*index,(_=>{index===items.length-1&&onComplete&&onComplete()}))}))},this.fadeOutStagger=function({ease:ease,items:items,onComplete:onComplete,stagger:stagger,time:time,x:x=0,y:y=0}){items.forEach(((item,index)=>{item.tween({opacity:0,x:x,y:y},time,ease,stagger*index,(_=>{index===items.length-1&&onComplete&&onComplete()}))}))},this.cardEntrance=function(card,delay){card.css({opacity:0}),card.transform({y:75}),card.tween({opacity:1,y:0},500,"easeOutCubic",delay)},this.cardEntranceHorizontal=function(card,direction,delay){card.css({opacity:0}),"left"==direction?card.transform({x:80}):card.transform({x:-80}),card.tween({opacity:1,x:0},400,"easeOutCubic",delay)},this.fadeInRight=function(item,delay){item.transform({x:50}).css({opacity:0}),item.tween({x:0,opacity:1},500,"easeOutCubic",delay)},this.fadeOutRight=function(item,delay){item.tween({x:50,opacity:0},500,"easeOutCubic",delay)},this.fadeOutUp=function(item,delay){return new Promise(((resolve,reject)=>{item.tween({y:-50,opacity:0},500,"easeOutCubic",delay,(()=>{resolve()}))}))},this.fadeInUp=function(item,delay){return new Promise(((resolve,reject)=>{item.css({opacity:0}).transform({y:75}),item.tween({y:0,opacity:1},500,"easeOutCubic",delay,(()=>{resolve()}))}))},this.fadeIn=function(item,delay){return new Promise(((resolve,reject)=>{item.css({opacity:0}).transform({scale:.8}),item.tween({opacity:1,scale:1,y:0},500,"easeOutCubic",delay,(()=>{resolve()}))}))},this.fadeOut=function(item,delay,shouldScale=!0){return new Promise(((resolve,reject)=>{item.tween({opacity:0,scale:shouldScale?.75:1,y:0},500,"easeOutCubic",delay,(()=>{resolve()}))}))},this.swipeTransition=function(content,layer,direction,callback){const layerInitial={opacity:1,visibility:"visible",zIndex:20},layerEnd={opacity:0,visibility:"hidden",zIndex:-1},easing="easeOutCubic";switch(direction){case"up":content.tween({y:"-50%",opacity:0},500,easing,(_=>{content.transform({y:"50%"}),content.tween({y:0,opacity:1},600,easing,300),callback()})),layer.css(layerInitial).transform({y:"101%"}),layer.tween({y:"-101%"},900,easing,200,(_=>{layer.css(layerEnd).transform({y:"101%"})}));break;case"down":content.tween({y:"50%",opacity:0},500,easing,(_=>{content.transform({y:"-50%"}),content.tween({y:0,opacity:1},600,easing,300),callback()})),layer.css(layerInitial).transform({y:"-101%"}),layer.tween({y:"101%"},900,easing,200,(_=>{layer.css(layerEnd).transform({y:"-101%"})}));break;case"left":content.tween({x:"-25%",opacity:0},500,easing,(_=>{content.transform({x:"25%"}),content.tween({x:0,opacity:1},600,easing,300),callback()})),layer.css(layerInitial).transform({x:"101%"}),layer.tween({x:"-101%"},900,easing,200,(_=>{layer.css(layerEnd).transform({x:"101%"})}));break;case"right":content.tween({x:"25%",opacity:0},500,easing,(_=>{content.transform({x:"-25%"}),content.tween({x:0,opacity:1},600,easing,300),callback()})),layer.css(layerInitial).transform({x:"-101%"}),layer.tween({x:"101%"},900,easing,200,(_=>{layer.css(layerEnd).transform({x:"-101%"})}))}}}),"static"),Class((function CoreUIBuilder(){Inherit(this,Component);const _this=this;_this.buildCircleAvatar=element=>{element.css({width:"5rem",height:"5rem",borderRadius:"50%",position:"relative",backgroundSize:"cover",backgroundPosition:"center"})},this.buildIcon=function(element){element.css(_this.styleguide.icon),element.css({position:"relative",backgroundSize:"contain",backgroundRepeat:"no-repeat"})},this.buildMaskIcon=function(element,iconSrc,height="2rem",width="2rem",color="black"){element.css({background:color,"-webkit-mask-size":"contain",maskSize:"contain","-webkit-mask-image":`url(${Assets.getPath(iconSrc)})`,maskImage:`url(${Assets.getPath(iconSrc)})`,width:height,height:width,position:"relative"})},this.buildCloseButton=function(element,height="2rem",width="2rem",color="black"){_this.buildMaskIcon(element,"~assets/images/icon/close.svg",height,width,color)},this.buildMediaAccessToastStyles=MediaAccessToastStyles.buildMediaAccessToastStyles.bind(_this),this.buildUIEmotes=EmoteUIStyles.buildUIEmotes.bind(_this),this.buildUIEmotesItem=EmoteUIStyles.buildUIEmotesItem.bind(_this),this.setStyleguide=function(styleguide){_this.styleguide=styleguide},this.setColors=function(colors){_this.colors=colors}})),Class((function VideoLoader({message:message}){Inherit(this,Element);const _this=this,$this=this.element;function resize(){$this.css({width:Stage.width,height:Stage.height})}!function initStyles(){$this.goob(`\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            width: ${Stage.width};\n            height: ${Stage.height};\n            pointer-events: auto;\n            opacity: 0;\n            left: 0;\n            top: 0;\n            z-index: 1000;\n\n            .message {\n                position: relative !important;\n                line-height: 1.6rem;\n                letter-spacing: 0.2rem;\n                opacity: 1;\n                color: var(--black);\n                margin-bottom: 4rem;\n            }\n\n            .wrapper {\n                display: flex;\n                flex-direction: column;\n                felx-flow: column-reverse;\n                align-items: center;\n                justify-content: center;\n                width: 20rem;\n                height: 20rem;\n            }\n\n            .spinner-anim-alt {\n                position: relative !important;\n                width: 10rem;\n                height: 10rem;\n            }\n        `)}(),function initHTML(){_this.wrapper=$this.create("wrapper")}(),message&&function initMessage(){_this.message=_this.wrapper.create("message","h5"),_this.message.text(message)}(),function initSpinner(){_this.spinner=_this.wrapper.create("spinner-anim-alt")}(),function addHandlers(){_this.onResize(resize)}(),this.appear=function(){$this.css({opacity:1})},this.hide=function(){$this.css({opacity:0})}})),Class((function VideoManager(_view,_previewConfig){Inherit(this,Component);const _this=this;var _preview,_loader,_videos=new Map,_objects=[],_players=[];function initPreview(){if(!_previewConfig.view)throw Error("When calling configureSpace() with a videoPreview, you must pass a videoPreview.view! Pass DreamUI.VideoPreview or a view that inherits from it");_this.preview=_preview=_this.initClass(_previewConfig.view,_previewConfig),_this.events.sub(_preview,Events.READY,previewComplete),_this.parent.getDOMElement().add(_preview.element),_view.hide&&_view.hide()}async function previewComplete(){_view.show&&_view.show(),await _preview.animateOut(),_preview=_preview.destroy(),_this.events.fire(VideoManager.PREVIEW_COMPLETE),_this.parent.enterVideoChat(),_loader=_this.initClass(VideoLoader,{message:"CONNECTING"}),_this.parent.getDOMElement().add(_loader.element),_loader.appear()}function updateVideo(e){if(!_this._invisible)if(_loader&&_loader.destroy&&(_loader=_loader.destroy()),"add"==e.type){let obj={video:e.media.video,screenShare:!!e.media.isScreenShare,data:e.media.player.data,gcPlayer:e.media.player,media:e.media,player:e.media.player.dreamPlayer};obj.me=obj.gcPlayer.me,obj.videoState=obj.gcPlayer.videoState,_videos.set(e.media,obj),_view.addVideo(obj,obj.gcPlayer.me),e.media.isScreenShare||(e.media.player._videoObject=obj),_objects.push(obj)}else{let obj=_videos.get(e.media);obj&&_view&&_view.removeVideo&&_view.removeVideo(obj),_videos.delete(e.media),e.media.isScreenShare||(e.media.player._videoObject=null),obj&&obj.view&&obj.view.destroy&&obj.view.destroy(),_objects.remove(obj)}}function handleVideoMute(player,value){player.videoState?.set("video_mute",value),player._videoObject?.onVideoMute?.(value)}function handleAudioMute(player,value){player.videoState?.set("audio_mute",value),player._videoObject?.onAudioMute?.(value)}function handleSpeaking(player,value){player.videoState?.set("speaking",value),player._videoObject?.onSpeaking?.(value)}async function handleMuteParticipant({playerId:playerId}){if(!_this._invisible)if(playerId==Multiplayer.room?.me.id)GameCenterMedia.userStream.disableAudio(),AVSettingsController.instance().audioEnabled=!1;else if(User.isAdmin()&&Multiplayer.room){(await Multiplayer.room.waitForPlayer(playerId))?.update?.({gcmedia_mute_audio:!0})}}async function handleKickParticipant({playerId:playerId}){if(!_this._invisible)if(playerId==Multiplayer.room.me.id)_this.parent.disconnectMultiplayer(),_this.events.fire(VideoManager.ME_KICKED),_view.handleKickParticipant?.(playerId);else if(User.isAdmin()){(await Multiplayer.room.waitForPlayer(playerId))?.update?.({kicked_from_room:!0})}}!function(){if(_this.parent.getDOMElement(),_previewConfig&&(initPreview(),Multiplayer.bindGlobalEvent("muteParticipant",handleMuteParticipant),Multiplayer.bindGlobalEvent("kickParticipant",handleKickParticipant)),!_view.addVideo||!_view.removeVideo)throw"VideoManager :: videoLayout requires .addVideo .removeVideo";_view.element&&_this.parent.getDOMElement().add(_view.element),_this.startRender((_=>{})),function addHandlers(){_this.events.sub(VideoManager.ADMIN_CONTROL_MUTED,(gcPLayer=>_this.muteParticipant(gcPLayer))),_this.events.sub(VideoManager.ADMIN_CONTROL_REMOVED,(gcPLayer=>_this.kickParticipant(gcPLayer))),_this.events.sub(VideoManager.ADMIN_CONTROL_REMOVED,(({data:data})=>{DreamModeration?.removeUser(data?.uid,"removed from: "+Multiplayer.room.id)}))}()}(),this.addPlayer=async function(player){if(player&&_this.events&&(await player.wait("gcPlayer"),!_players.includes(player.gcPlayer))){_players.push(player.gcPlayer),_this.events.sub(player.gcPlayer,GameCenterMedia.UPDATE_PLAYER_VIDEO,updateVideo),_this.events.sub(player.gcPlayer,GameCenterMedia.REMOVE_PLAYER_FROM_MULTIPLAYER,(gcPLayer=>_this.kickParticipant(gcPLayer))),_this.events.sub(player.gcPlayer,GameCenterMedia.MUTE_AUDIO,(gcPLayer=>_this.muteParticipant(gcPLayer))),player.gcPlayer.videoState=AppState.createLocal(),player.videoBindings=[],player.videoBindings.push(player.state.bind("gcmedia_mute_video",(value=>handleVideoMute(player.gcPlayer,value)))),player.videoBindings.push(player.state.bind("gcmedia_mute_audio",(value=>handleAudioMute(player.gcPlayer,value)))),player.videoBindings.push(player.state.bind("gcmedia_speaking",(value=>handleSpeaking(player.gcPlayer,value)))),player.gcPlayer.wait("_videoObject").then((_=>{_this.wait(player.gcPlayer._videoObject.media,"video").then((_=>{player.gcPlayer.videoState.videoElement=player.gcPlayer._videoObject.media.video})),_this.wait(player.gcPlayer._videoObject,"onAudioMute").then((_=>{player.state.get("gcmedia_mute_video")&&handleVideoMute(player.gcPlayer,!0),player.state.get("gcmedia_mute_audio")&&handleAudioMute(player.gcPlayer,!0),player.state.get("gcmedia_speaking")&&handleSpeaking(player.gcPlayer,!0)}))}));try{player.gcPlayer?.videos?.forEach((media=>{updateVideo({media:media,type:"add"})}))}catch(e){}}},this.removePlayer=function(player){try{_players.remove(player.gcPlayer),player.videoState?.destroy?.(),player.videoBindings?.forEach((b=>b.destroy?.())),player.gcPlayer.videos.forEach((media=>{updateVideo({media:media,type:"remove"})}))}catch(e){}},this.deactivate=this.clearPlayers=function(){_objects.forEach((obj=>{_view.removeVideo(obj),obj.view&&obj.view.destroy&&obj.view.destroy()})),_view?.hide?.(),_preview?.destroy?.(),_preview=null,_objects.length=0,_videos.clear(),_players.length=0},this.reset=function(){this.deactivate(),_previewConfig&&!_preview&&initPreview()},this.getViewFor=async function(gcPlayer){await _this.wait(gcPlayer,"videos"),await defer();for(let i=0;i<_objects.length;i++){let obj=_objects[i];if(obj.gcPlayer==gcPlayer)return await _this.wait(obj,"view"),obj.view}},this.getMyView=async function(){await _this.wait(_objects,"length");for(let i=0;i<_objects.length;i++){let obj=_objects[i];if(obj.gcPlayer.me)return await _this.wait(obj,"view"),obj.view}},this.hasVideo=function(){return _this.wait(_objects,"length")},this.muteParticipant=function(gcPlayer){Multiplayer.fireGlobalEvent("muteParticipant",{playerId:gcPlayer.id}),handleMuteParticipant({playerId:gcPlayer.id})},this.kickParticipant=function(gcPlayer){Multiplayer.fireGlobalEvent("kickParticipant",{playerId:gcPlayer.id}),handleKickParticipant({playerId:gcPlayer.id})},this.onDestroy=function(){_previewConfig&&(Multiplayer.unbindGlobalEvent("muteParticipant",handleMuteParticipant),Multiplayer.unbindGlobalEvent("kickParticipant",handleKickParticipant))}}),(_=>{VideoManager.PREVIEW_COMPLETE="VideoManager.PREVIEW_COMPLETE",VideoManager.ME_KICKED="VideoManager.ME_KICKED",VideoManager.ADMIN_CONTROL_MUTED="VideoManager.ADMIN_CONTROL_MUTE",VideoManager.ADMIN_CONTROL_REMOVED="VideoManager.ADMIN_CONTROL_REMOVED"})),Class((function DreamWorld(){Inherit(this,Component);const _this=this;var _active,_lastEnv,_capDPR,_capFPS,_config,_envs=[],_scenes=[],_preload=[];DreamWorld.active=_this;const VR=Platform.usingVR();this.createScene=function(params={}){_this.frustum||(_this.frustum=new Frustum,_this.testSphere=new Sphere(new Vector3,1.8));let msaa=Platform.msaaSamples(),options={manualRender:!0,mipmaps:!!params.mipmaps,multisample:!1!==msaa,samplesAmount:msaa},scene=_this.initClass(FXScene,World.NUKE,RTPool.instance(),options);return _capDPR&&scene.setDPR(_capDPR),RenderManager.type!=RenderManager.NORMAL?(scene.vrWorldMode(),scene.nuke.enabled=!1):Platform.useFXAA()&&(scene.fxaa=new FXAA,scene.nuke.add(scene.fxaa),scene.scene.opaqueSortOrder=World.SCENE.opaqueSortOrder=Scene.FRONT_TO_BACK),Global.PLAYGROUND||(_this.startRender((_=>{scene.visible&&scene.render(),_this.frustum.setFromCamera(World.CAMERA)}),World.NUKE),scene.startRender((_=>{}),World.NUKE)),scene.visible=!1,_scenes.push(scene),_this.onResize((_=>{scene.setSize(Stage.width,Stage.height)})),scene},this.displayScene=function(scene){_this.parent.displayScene(scene)},this.createEnvironment=async function(PlayerClass,EnvironmentClass,Environment,params){_config?.portals&&function setupPortals(){Worlds.instance().setShaderTransition(DreamWorldPortalTransition.instance())}();let scene=_this.createScene(params);!function parseForPreload(Class){if(_config&&_config.portals)return;let key=Utils.getConstructorName(Class)+"_env";_preload.push({key:key,Class:Class})}(EnvironmentClass);let obj,value={activeCount:0,Environment:Environment,EnvironmentClass:EnvironmentClass,params:params};return value.scene=scene,value.activate=async function(){if(obj=value.obj,obj?.events||(obj=null),_active&&_active.scene==scene)return;if(_active&&(_active.isActive=!1,_active.obj._deactivate(),_active.visible=_active.scene.visible=_active.obj.group.visible=!1,_active.scene.nuke.clearMemory(),_envs.length>3&&_active.obj.__index>0&&(_active.obj.layout.destroy(),_active.obj=_active.obj.destroy(),_active.scene.nuke.passes.length=0)),Environment.instance().registerPlayerClass(PlayerClass),VR&&VRInput.controllers.forEach((c=>c.group.visible=!1)),value.activeCount++,obj?obj.releasedTextureMemory&&await Initializer3D.uploadAll(obj.group):(_this.flag("hasEnv",!1),obj=value.obj=await Environment.instance().mount(EnvironmentClass,scene,params),obj.physics&&obj.physics.customTick(),VR&&(obj.group.position.y=9999,obj.wait("player").then((_=>{obj.player.controls.disable()}))),params&&params.custom&&obj.customEnvironment(),value.obj=obj,obj.__index=_envs.indexOf(value),await obj.loaded(),await Initializer3D.uploadAll(obj.group),!_this.flag("hasPreloaded")&&_envs.length<4&&async function preload(){if(await _this.wait(5e3),_active&&!Global.PLAYGROUND){_this.flag("hasPreloaded",!0);for(let i=0;i<_preload.length;i++){let{Class:Class,key:key}=_preload[i];_active.obj instanceof Class||await SceneLayoutPreloader.load(key)}}}()),VR&&(obj.group.position.y=9999),Global.PLAYGROUND)return;_lastEnv==Environment&&Environment.instance().deactivate(),_lastEnv=Environment,Environment.instance().activate(obj,scene),obj._activate();let multiplayer=obj._waitForMultiplayer();return await obj._playerReady,multiplayer&&await Promise.all([multiplayer,obj.wait("isLocalPlayerConnected")]),scene.visible=!0,scene.viewObj=obj,value.isActive=!0,obj.group.visible=!0,scene.scene.position.set(0,0,0),scene.scene.rotation.set(0,0,0),!0===scene.nukeEnabled&&(scene.nuke.enabled=!0),await multiplayer,_active={scene:scene,obj:obj,loadCount:value.activeCount},_this.flag("hasEnv",!0),scene},value.name=Utils.getConstructorName(EnvironmentClass),scene.onBeforeRender=_=>{Lighting.useScene(value.name),Physics.instance().useScene(value.name),obj&&obj.physics&&obj.isActive&&obj.physics.tick()},_envs.push(value),value},this.createActivityEnvironment=async function(PlayerClass,EnvironmentClass,params){return this.createEnvironment(PlayerClass,EnvironmentClass,GroupEnvironment,params)},this.createCommunityEnvironment=async function(PlayerClass,EnvironmentClass,params){return this.createEnvironment(PlayerClass,EnvironmentClass,GroupEnvironment,params)},this.createGroupEnvironment=async function(PlayerClass,EnvironmentClass,params){return this.createEnvironment(PlayerClass,EnvironmentClass,GroupEnvironment,params)},this.createGlobalEnvironment=async function(PlayerClass,EnvironmentClass,params){return this.createEnvironment(PlayerClass,EnvironmentClass,GlobalEnvironment,params)},this.createCustomEnvironment=async function(EnvironmentClass,params={}){return params.custom=!0,this.createEnvironment(AbstractAvatar,EnvironmentClass,GroupEnvironment,params)},this.configureWorld=this.setupWorld=function(config){_config=config},this._onRouteChange=function(route){route.shift(),this.route=route;let result=this.onRouteChange?this.onRouteChange(route):null;return defer((_=>{_envs.forEach((env=>{env.obj&&env.scene.visible&&env.obj.onRouteChange&&Render.TIME-env.obj.activateTime>200&&env.obj.onRouteChange(route)}))})),result},this.setupPortalScene=async function(name){let env=function(){for(let i=0;i<_envs.length;i++)if(_envs[i].name==name)return _envs[i]}();return env.obj?env.scene.scene.add(env.obj.group):env.obj=await env.Environment.instance().mount(env.EnvironmentClass,env.scene,env.params,!0),void 0===env.nukeEnabled&&(env.nukeEnabled=env.scene.nuke.enabled),env.scene.nuke.enabled=!1,await Initializer3D.uploadAllAsync(env.obj.layout),env},this._initRoute=function(route){this.baseRoute=route[0],route.shift(),this.route=route},this.setRoute=function(route){Worlds.instance().setState(route)},this.disable3D=function(){World.instance()._disable3D()},this.get("scene",(_=>_scenes)),this.capDPR=function(dpr){_capDPR=dpr,_scenes.forEach((scene=>scene.setDPR(dpr)))},this.capFPS=function(fps,config){const defaultFPS=_capFPS||(GPU.lt(1)||GPU.mobileLT(2)||GPU.lt(3)&&Math.max(Stage.width,Stage.height)>1600?30:GPU.lt(3)||GPU.lt(4)&&Math.max(Stage.width,Stage.height)>1600?Render.REFRESH_RATE>60?60:null:GPU.lt(4)?Render.REFRESH_RATE>100?100:null:Device.mobile&&Render.REFRESH_RATE>120?120:null);if(null!=fps&&null!=fps||(fps=defaultFPS),config||(_capFPS=fps),config){if(config.delay&&_this.delayedCall((_=>{World.instance()._capFPS(fps)}),config.delay),config.interaction){let on=!1;World.instance()._capFPS(fps);let timer,idle=_=>{on||(World.instance()._capFPS(fps),on=!0)},active=_=>{on&&(World.instance()._capFPS(defaultFPS),on=!1)};_this.events.sub(Mouse.input,Interaction.MOVE,(_=>{active(),clearTimeout(timer),timer=_this.delayedCall((_=>{idle()}),config.timeout||1e3)}))}}else World.instance()._capFPS(fps)},this.capFPS(),this.capturePixels=function(x,y,width,height){const createCanvas=(w,h)=>{let canvas=document.createElement("canvas");return canvas.width=w,canvas.height=h,canvas.context=canvas.getContext("2d"),canvas};width||(width=World.RENDERER.resolution.width),height||(height=World.RENDERER.resolution.height);let fullCanvas=createCanvas(Math.round(_active.scene.rt.width),Math.round(_active.scene.rt.height)),imageData=fullCanvas.context.createImageData(fullCanvas.width,fullCanvas.height);imageData.data.set(World.RENDERER.readPixels(_active.scene.rt,0,0)),fullCanvas.context.putImageData(imageData,0,0);let flipped=createCanvas(Stage.width,Stage.height);flipped.context.scale(1,-1),flipped.context.drawImage(fullCanvas,0,0,Stage.width,-Stage.height);let canvas=createCanvas(width,height);return canvas.context.drawImage(flipped,-x,-y),canvas},this._bindOnDestroy((_=>{World.instance()._capFPS(null),World.instance()._enable3D(),_scenes.forEach((s=>{s.viewObj&&s.viewObj.destroy(),Initializer3D.destroyAll(s.scene),s.destroy()})),_scenes=null})),this.getEnvironment=async function(){return await _this.wait("hasEnv"),_active.obj},this.getActiveObject=function(){return _active},this.submitPostRoutePrompt=function(config){AbstractEnvironment.PENDING_PROMPT=config},this.ensureSceneVisibility=function(){_active&&(_active.obj.group.position.y=0),VRInput.controllers.forEach((c=>c.group.visible=!0))}})),Class((function PreloadWorldLayout(_perma,_layout){Inherit(this,Component);var _assetPath,_local=Hydra.LOCAL||location.hostname.includes(["localhost","192.","10.0"]);function absolutePath(str){let path=Platform.PATH;return path+("/"==path.charAt(path.length-1)?"":"/")+str}async function loadRemote(){let uil=absolutePath(`worlds/${_perma}/assets/data/uil.json`);try{_assetPath=absolutePath(`worlds/${_perma}/`);let data=await get(uil),js=await get(_assetPath+"assets/js/app.js");parse(data,JSON.parse(js.split("window.ASSETS=")[1].split(";")[0]))}catch(e){throw"Not found"}}function getPath(path){return _assetPath+path}function parse(data,assets){Promise.create();let array=[],ext=function getCompressedExtension(){const gl=Device.graphics._webglContext.context;gl.getExtension("WEBGL_compressed_texture_astc");let etc1=gl.getExtension("WEBGL_compressed_texture_etc1"),pvrtc=gl.getExtension("WEBGL_compressed_texture_pvrtc")||gl.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),s3tc=gl.getExtension("WEBGL_compressed_texture_s3tc")||gl.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");return s3tc?"dxt":etc1?"astc":pvrtc?"pvrtc":s3tc?"astc":void 0}();const findMatch=src=>{if(!src)return!1;src=src.trim();for(let i=assets.length-1;i>-1;i--)if(assets[i].includes(src))return!0;return!1};let keys=Object.keys(data),i=0,worker=new Render.Worker((_=>{let key=keys[i];if(key){if(key.includes(_layout)){let val=data[key];if(!val.includes)return i++;if(key.includes("geometry")&&(val.includes(".json")&&val.includes(".bin")||(val+=".json"),val.includes("assets/")||(val="assets/geometry/"+val),findMatch(val.split("assets/")[1])&&array.push(GeomThread.loadGeometry(val,null,!0))),val.includes(".json")||val.includes(".bin"))val.includes("assets/")||(val="assets/geometry/"+val),findMatch(val.split("assets/")[1])&&array.push(fetch(getPath(val)).then((e=>{}),(e=>{})));else if(val.includes("src")){let obj=JSON.parse(val),src=obj.src;if(obj.compressed){let src0=src.split(".")[0],src1=src0.split("/");src=src0+"/"+src1[src1.length-1]+"-"+ext+".ktx"}findMatch(src.split("assets/")[1])&&array.push(fetch(getPath(src)).then((e=>{}),(e=>{})))}}i++}else worker.stop()}),1)}!async function(){if(_local)try{await async function loadLocal(){let root=window.location.href.toLowerCase().split("?")[0].split("#")[0].replace("platform/html","worlds/"+_perma+"/html");"8080"===window.location.port&&(root="worlds/"+_perma+"/html");"/"==root.charAt(root.length-1)&&(root=root.slice(0,-1));let uil=root+"/assets/data/uil.json";try{let data=await get(uil);_assetPath=root+"/";let assetString=await get(_assetPath+"assets/js/app/config/Assets.js");parse(data,JSON.parse(assetString.split("window.ASSETS = ")[1].split(";")[0]))}catch(e){throw console.log(e),"Not found"}}()}catch(e){try{await loadRemote()}catch(e){throw e}}else try{await loadRemote()}catch(e){throw e}}()})),Class((function World(){Inherit(this,Component);const _this=this;var _renderer,_scene,_camera,_nuke,_type=RenderManager.NORMAL,_manualResize=!1;World.RESIZE="World_resize",World.DPR=Tests.getDPR();const MOBILE=Tests.mobilePhone();async function init(){Platform.preventFullAccess()&&_this.flag("disable3D",!0),World.PLANE||(await async function initWorld(){World.PLANE=new PlaneGeometry(1,1),World.QUAD=Utils3D.getQuad(),World.BOX=new BoxGeometry(1,1,1),World.SPHERE=new SphereGeometry(1,16,16),World.SPHERE_HI=new SphereGeometry(1,100,100),World.TELEPORT_CYLINDER=new CylinderGeometry(1,1,3,60),World.FLOOR_CYLINDER=new CylinderGeometry(1,1,1.35,60);let options={powerPreference:"high-performance",antialias:Platform.usingVR(),forceWebGL1:Platform.forceWebGL1()};Platform.enableWorldNukeMSAA()&&(options.samplesAmount=Platform.msaaSamples()||void 0,options.multisample=!!options.samplesAmount);RenderManager.initialize(_type,options),_renderer=RenderManager.gl,_scene=RenderManager.scene,_camera=RenderManager.camera.worldCamera,_nuke=RenderManager.nuke,World.SCENE=_scene,World.RENDERER=_renderer,World.ELEMENT=$(_renderer.domElement),World.CAMERA=_camera,World.NUKE=_nuke,_camera.near=1,Global.PLAYGROUND&&(_camera.near=.1);_camera.updateProjectionMatrix(),Global.PLAYGROUND||(GroupEnvironment.instance(),UIController.instance());Platform.usingVR()&&Transition.instance().cover();Device.social&&setTimeout(resize,1e3);GlobalConfig.instance()}(),Config.SETTINGS?.disableGlobalAudio||GlobalAudio3D.setup(),_renderer&&(!function addHandlers(){_this.events.sub(Events.RESIZE,resize),_this.events.sub(Events.FULLSCREEN,fullScreen)}(),Utils.query("uilOnly")||Render.onDrawFrame(loop),RenderManager.type==RenderManager.NORMAL&&Camera.instance(_camera)))}function fullScreen(e){}async function resize(){if(!_this.flag("preventRender")&&!_manualResize){if(UIController.instance().layout){await UIController.instance().ready();let{height:height,left:left,top:top,width:width}=UIController.instance().sizes;if(![height,left,top,width].every((value=>!isNaN(value))))return;MOBILE||_this.flag("ignoreUIControllerSize")?Stage.height=height:(Stage.height=height,Stage.width=width),World.ELEMENT.css({left:left,top:top}),_this.events.fire(World.RESIZE)}resize3D()}}function resize3D(){_renderer.setSize(Stage.width,Stage.height),_camera.aspect=Stage.width/Stage.height,_camera.updateProjectionMatrix(),GLUI.Stage.resize()}function loop(tsl,delta){_this.flag("externalFullscreen")||_this.flag("preventRender")||_this.flag("disable3D")||RenderManager.render()}this.initXR=async function(type){_type=type,await init(),await XRDeviceManager.startSession()},this.init=function(){return init()},this.resize=function(width){width?(Stage.width=width,Stage.height=window.innerHeight,resize3D()):_manualResize||resize()},this.stopRender=function(){_this.flag("preventRender",!0)},this.startRender=function(){_this.flag("preventRender",!1),resize()},this.isRendering=function(){return!_this.flag("preventRender")},this._capFPS=function(fps){fps>0&&(fps+=.001),Render.capFPS=fps},this._disable3D=function(){_this.flag("disable3D",!0)},this._enable3D=function(){_this.flag("disable3D",!1),resize()},this.isDisabled=function(){return _this.flag("disable3D")},this.set("manualResize",(v=>{_manualResize=v})),this.doIgnoreUIControllerSize=_=>_this.flag("ignoreUIControllerSize",!0),this.doNotIgnoreUIControllerSize=_=>_this.flag("ignoreUIControllerSize",!1),this.isIgnoringControllerSize=_=>_this.flag("ignoreUIControllerSize")}),(function(){var _instance;World.instance=function(){return _instance||(_instance=new World),_instance}})),Class((function WorldEnvironment(_perma,_dependency){const _this=this;var _main,_remote,_local=Hydra.LOCAL||location.hostname.includes(["localhost","192.","10.0"]);if(this.perma=_perma,""==_perma)throw"Missing route!";let loadRemote=async _=>{try{let version=window._ES5_?"es5-app":"app",code=await get(function absolutePath(str){let path=Platform.PATH;return path+("/"==path.charAt(path.length-1)?"":"/")+str}(`worlds/${_perma}/assets/js/${version}.js?${window._CACHE_||Date.now()}`));window._ES5_&&code.includes("//es5-polyfill")&&(code=code.split("//es5-polyfill")[1]),WorldEnvironment.clearScripts();try{WorldEnvironment.addCode(code)}catch(e){throw console.error(e),e}_remote=!0}catch(e){throw console.error(e),e}},getBasePath=_=>{let base=Platform.PATH;return _remote?base+="worlds/"+_perma:base=base.split("platform")[0]+`worlds/${_perma}/html`,base},connectAssetsUILShaders=async dependency=>{let base=getBasePath(),project=window.UIL_ID?window.UIL_ID.split("-")[0]:"",uilPath=base+"/assets/data/uil.json",shaderPath=base+"/assets/shaders/compiled.vs";UILStorage.reload(`${project}-${_perma}`,uilPath,dependency),(_=>{let base=getBasePath();Assets.CDN=base+"/"})(),await Promise.all([AssetLoader.loadAssets([shaderPath]),UILStorage.ready()]),window.StageLayoutUtil&&await StageLayoutUtil.reload()};this.load=async function(){Dev.pathName=location.pathname.toLowerCase().split("/platform")[0]+"/worlds/"+_perma+"/html/",_this.loaded||(UILStorage.loaded=!1,await _this.evaluate(),await connectAssetsUILShaders(),_this.loaded=!0),(_main=new Main)._initRoute(Router.getState()),_this.element=_main.$element=Stage.create(_perma),World.ELEMENT.add(_this.element),(Router.virtualQuery||location.search.indexOf("p=")>0)&&Utils.query("p")&&Hydra.LOCAL?Playground.instance():_this.texture=await _main.init(_this.element)},this.evaluate=async function(){let state={};if(_dependency&&(state.assets=window.ASSETS),_local)try{await(async _=>{let root=window.location.href.toLowerCase().split("?")[0].split("#")[0].replace("platform/html","worlds/"+_perma+"/html");"8080"===window.location.port&&(root="worlds/"+_perma+"/html"),"/"==root.charAt(root.length-1)&&(root=root.slice(0,-1));let html=await get(root);if(!html.includes(["RUNTIME_SCRIPTS","eval('async () => {};')","eval('let obj = {}; obj?.prop')","runtime/boot.js"]))throw"404";try{let scripts;const parseScripts=code=>{scripts=JSON.parse(code.split("RUNTIME_SCRIPTS = ")[1].split(";")[0]),scripts=scripts.filter((path=>!path.includes(["hydra","accelerometer","shaders","fullscreen"]))),Utils.query("bundle")&&(scripts=["assets/runtime/bundle.js"])};html.includes("RUNTIME_SCRIPTS")?parseScripts(html):html.includes("runtime/boot.js")?parseScripts(await get(root+"/assets/runtime/boot.js")):scripts=["assets/js/app--debug.js"];let promises=scripts.map((s=>get(root+"/"+s))),files=await Promise.all(promises);Hydra.LOCAL&&Events.emitter._addEvent(WorldEnvironment.HOTLOAD_SCRIPT,(async e=>{if(scripts.includes(e.file))try{let code=await get(root+"/"+e.file);WorldEnvironment.addScript(code),Events.emitter._fireEvent(SceneLayout.HOTLOAD_SCRIPT,e)}catch(e){}}),_this),WorldEnvironment.clearScripts();for(let code of files)try{WorldEnvironment.addScript(code)}catch(e){throw console.log(code),e}_remote=!1}catch(e){throw console.log(e),e}})()}catch(e){try{await loadRemote()}catch(e){throw e}}else try{await loadRemote()}catch(e){throw e}let assets=window.ASSETS;return state.assets&&(window.ASSETS=state.assets),assets},this.evaluateWithAssets=async function(){let assets=await _this.evaluate();Assets.registerPath(getBasePath()+"/",assets),await connectAssetsUILShaders(!0)},this.onRouteChange=function(route){return _main?_main._onRouteChange(route):null},this.extraTransitionTime=function(){return _main&&_main.extraTransitionTime?_main.extraTransitionTime():0},this.shouldTransition=function(route){return(route=[...route]).shift(),!_main||!_main.shouldTransition||_main.shouldTransition(route)},this.unload=function(){_this.element&&_this.element.remove(),_this.killed=!0,_main&&_main.destroy(),Hydra.LOCAL&&Events.emitter._destroyEvents(_this)},this.displayScene=async function(scene){await _this.parent.transitionScene(scene),_this.texture=scene}}),(()=>{WorldEnvironment.HOTLOAD_SCRIPT="worldenv_hotload_script";var _scripts=[];WorldEnvironment.addScript=function(code){let script=document.createElement("script");script.innerHTML=code,document.getElementsByTagName("head")[0].appendChild(script),_scripts.push(script)},WorldEnvironment.addCode=function(code){let script=document.createElement("script");script.innerHTML=code,document.getElementsByTagName("head")[0].appendChild(script),_scripts.push(script)},WorldEnvironment.clearScripts=function(){try{_scripts.forEach((script=>script.parentNode.removeChild(script))),_scripts.length=0}catch(e){}}})),Class((function Worlds(){Inherit(this,Component);const _this=this;var _world,_shader,_mesh,_screenQuad,_shaderTransition,_isCoverTransition=!1;async function initWorld(perma){_this.flag("hasWorld",!1),_world?(Render.capFPS=null,Router.lock(),await Transition.instance().cover("external"),GLUI.clear(),Utils3D.clearTextureCache(),_shader.set("tMap",null),Multiplayer.reset(),GroupEnvironment.instance().unmount(),GlobalEnvironment.instance().unmount(),OptimizedAvatar.LOD="",SoundFX.clear(),_world.unload()):Transition.instance().firstLoad();let route=await Platform.getWorld(perma);_world=Worlds.stash[perma]||_this.initClass(WorldEnvironment,route),delete Worlds.stash[perma];try{_mesh&&(_mesh.shader=_screenQuad),_shaderTransition=null,await _world.load(),_this.flag("hasWorld",!0),_this.flag("initialized",!0),_shader?.set("tMap",_world.texture),await _this.wait(_world.extraTransitionTime()),await Transition.instance().reveal(),Router.unlock()}catch(e){_world=null,console.error(e),console.log("404 not found, display error screen")}}async function routeUpdate(e){if(e.value.includes("?"))return location.reload();let perma=Router.getState().join("/");await Platform.getWorld(perma)!=_world?.perma||Config.TEST_PERMA_RELOAD?_world&&initWorld(e.value):async function internalTransition(perma){if(_this.flag("internalTransitioning"))return;_this.flag("internalTransitioning",!0),await defer(),Router.lock(),_shaderTransition&&(_shaderTransition.setPreviousTexture(_shader.get("tMap")),_mesh&&(_mesh.shader=_shaderTransition.shader),await _shaderTransition.animateIn());let showTransition=_world.shouldTransition(perma);!_shaderTransition&&showTransition&&_isCoverTransition&&await Transition.instance().cover("internal");let scene=await _world.onRouteChange(perma);_shaderTransition?(await _shaderTransition.animateOut(),_shader?.set("tMap",scene),_mesh.shader=_screenQuad):(_shader?.set("tMap",scene),await _this.wait(_world.extraTransitionTime()),showTransition&&_isCoverTransition&&await Transition.instance().reveal()),Router.unlock(),_this.flag("internalTransitioning",!1),_this.events.fire(Worlds.TRANSITION_DONE)}(e.split)}!async function(){GroupEnvironment.instance(),GlobalEnvironment.instance(),AntimatterUtil.cache=!1,Platform.usingVR()&&Transition.instance().cover(!0),await Platform.mount(),Global.PLAYGROUND||await PlayerModel.ready(),_this.events.fire(Worlds.LOADED),function initMesh(){if(RenderManager.type!=RenderManager.NORMAL)return;_shader=_this.initClass(Shader,"ScreenQuad",{tMap:{value:null}}),_screenQuad=_shader;let mesh=new Mesh(World.QUAD,_shader);Global.PLAYGROUND||World.SCENE.add(mesh);mesh.frustumCulled=!1,_mesh=mesh}(),async function initFirstWorld(){_this.flag("blockingFirstLoad")&&await _this.wait("readyFirstLoad");initWorld(Router.getState().join("/"))}(),function addListeners(){Config.TEST_UI_ROUTES||_this.events.sub(Router,Router.UPDATE,routeUpdate);_this.events.sub(XRDeviceManager.SESSION_END,(_=>{XRDeviceManager.reloadWhenSessionEnds&&location.reload()}))}()}(),this.transitionScene=function(scene){_shader&&_shader.set("tMap",scene)},this.setState=function(route){let perma=`${_world.perma}/${route}`;Router.setState(perma)},this.canDisplayFirstWorld=function(){return!(!Platform.usingVR()&&!Global.PLAYGROUND)||_this.wait("initialized")},this.setCoverTransition=function(isCoverTransition){_isCoverTransition=isCoverTransition},this.setShaderTransition=function(transition){if(!(_shaderTransition=transition).shader)throw"Worlds::setShaderTransition requires shader";if(!_shaderTransition.animateIn)throw"Worlds::setShaderTransition requires animateIn";if(!_shaderTransition.animateOut)throw"Worlds::setShaderTransition requires animateOut";if(!_shaderTransition.setPreviousTexture)throw"Worlds::setShaderTransition requires setPreviousTexture"},this.blockFirstLoad=function(){_this.flag("blockingFirstLoad",!0)},this.unblockFirstLoad=function(){_this.flag("readyFirstLoad",!0)},DreamWorld.getActiveEnvironment=async function(){return Global.PLAYGROUND?null:(await _this.wait("hasWorld"),await _this.wait((_=>!_this.flag("internalTransitioning"))),DreamWorld.active.getEnvironment())}}),"singleton",(_=>{Worlds.stash={},Worlds.LOADED="worlds_loaded",Worlds.TRANSITION_DONE="worlds_transition_done"})),Class((function SceneView(){Inherit(this,Object3D);const _this=this;!function initMesh(){let mesh=new Mesh(new BoxGeometry(1,1,1),Utils3D.getTestShader());_this.add(mesh),mesh.position.z=-4,_this.startRender((t=>{mesh.position.y=.3*Math.sin(.002*t),mesh.rotation.y+=.01,mesh.rotation.x+=.004})),World.SCENE.add(_this.group);let camera=_this.initClass(GazeCamera);camera.moveXY.set(8,4),camera.position.set(0,0,6),camera.lerpSpeed=.07,camera.lookAt=new Vector3,camera.lock()}()})),Class((function AbstractAvatar(){Inherit(this,Object3D);const _this=this;this.state=this.parent.state,this.bindLink=this.parent.bindLink,this.bindEvent=this.parent.bindEvent,this.bindGlobal=this.parent.bindGlobal,this.bindGlobalEvent=this.parent.bindGlobalEvent,this.fireEvent=this.parent.fireEvent,this.fireEvent=this.parent.fireEvent,this.setUserData=async function(data){},this.getHitBox=async function(){},this.addToBatch=function(mesh,key){},this.getPlayerController=function(){return _this.findParent("GroupEnvironment").player},this.getPlayerControls=async function(){let player=_this.getPlayerController();return await player.wait("controls"),player.controls}})),Class((function AbstractEnvironment(_layout){Inherit(this,Object3D);const _this=this;var _multiplayerConfig,_batches,_config,_interaction,_savedCamera,_videoManager,_overrideConfig,_reconnectMultiplayer,_layers,_restoreTextures=[];const NAME=Utils.getConstructorName(_this);function setCamera(){if(!_this._type||"global"==_this._type)return;if(Global.PLAYGROUND)return;let player=_this.getPlayerController();player?player.wait("controls").then((_=>{Platform.usingVR()||player.controls.ready().then((_=>{Camera.instance().lock(_config.camera.camera||_config.camera)}))})):Camera.instance().lock(_config.camera.camera||_config.camera)}async function connectMultiplayer(){if(!Global.PLAYGROUND){if(_this.stageMultiplayer&&!_this.canEnterMultiplayer)return _this.hasStaged=!0;if(_multiplayerConfig){_config&&(null!=_config.audioStream&&(GameCenterMedia.audioStream=_config.audioStream),null!=_config.videoStream&&(GameCenterMedia.videoStream=!Platform.usingVR()&&_config.videoStream),null!=_config.p2pStream&&(GameCenterMedia.p2p=_config.p2pStream));for(let i=0;i<999;i++)try{let room=await Multiplayer.establish(_multiplayerConfig);_this.events.sub(room,GameCenterRoom.ERROR,(_=>_this._activate()));break}catch(e){if(Multiplayer.failed(),_this.onMultiplayerError)return _this.onMultiplayerError();await _this.wait(250)}}}}function setFXAAMaskShader(object){if(!_this.fxaaMask)return;let name=Utils.getConstructorName(object);if(object.dialog)!async function setFXAADialog(dialog){if(dialog.ready&&await dialog.ready(),!dialog.$gluiObject)return;let element=dialog.$gluiObject.mesh,shaderMesh=element.shader?.mesh,clone=_this.fxaaMask.add(element);clone.shader=_this.fxaaMaskShader,clone.visible=!1,element.shader&&(element.shader.mesh=shaderMesh)}(object.dialog);else if("Mesh"===name){let shaderMesh=object.shader?.mesh,clone=object.clone(),{positionMask:positionMask,quaternionMask:quaternionMask,scaleMask:scaleMask}=object;positionMask&&clone.position.copy(positionMask),quaternionMask&&clone.quaternion.copy(quaternionMask),scaleMask&&clone.scale.copy(scaleMask),_this.fxaaMeshMerge.add(clone),object.shader&&(object.shader.mesh=shaderMesh)}}_layout||(_layout=NAME+"_env"),this.layout=_this.initClass(SceneLayout,_layout,{physics:!!window.Physics}),this.players=[],_this.layout.getAllLayers().then((layers=>_layers=layers)),this.name=NAME,_this.startRender((_=>{})),GLSEO.registerPage(_this.group,NAME),_this.events.sub(GameCenter.LOST_CONNECTION,(async e=>{if(_this.isActive){if(_this.stageMultiplayer&&!_this.canEnterMultiplayer)return;if(_this.flag("lost"))return;_this.flag("lost",!0),_videoManager&&(_videoManager.removePlayer(_this.player),_videoManager.reset()),Multiplayer.reset(),await e.reconnected(),_this.player&&_this.player.onLocalActivate(),_this.isActive&&connectMultiplayer(),_this.flag("lost",!1),_videoManager&&_videoManager.addPlayer(_this.player)}})),this.getHitMesh=function(){if(_this.layout.exists("hitmesh"))return _this.layout.getLayer("hitmesh")},this.getHitMeshVR=function(){if(_this.layout.exists("hitmeshVR"))return _this.layout.getLayer("hitmeshVR")},this.getSpawn=function(){if(_this.layout.exists("spawn"))return _this.layout.getLayer("spawn")},this.getChairs=function(){if(_this.layout.exists("chairsData"))return _this.layout.getLayer("chairsData")},this.loaded=function(){return _this.layout.loadedAllLayers()},this._onPlayerConnect=function(player){_this.events.fire(AbstractEnvironment.PLAYER_CONNECT,{player:player}),_interaction&&_interaction.addPlayer(player),_videoManager&&_videoManager.addPlayer(player),_this.avatarPhysicsInteraction&&_this.avatarPhysicsInteraction.addPlayer(player),_this.players.push(player)},this._onPlayerDisconnect=function(player){_this.events.fire(AbstractEnvironment.PLAYER_DISCONNECT,{player:player}),_interaction&&_interaction.removePlayer(player),_videoManager&&_videoManager.removePlayer(player),_this.avatarPhysicsInteraction&&_this.avatarPhysicsInteraction.removePlayer(player),_this.emotes&&_this.emotes.removePlayer(player),_this.players.remove(player)},this._connectLocalPlayer=function(player){_this.events.fire(AbstractEnvironment.PLAYER_CONNECT,{player:player,local:!0}),_this.flag("isLocalPlayerConnected",!0),_this.avatarPhysicsInteraction&&_this.avatarPhysicsInteraction.addPlayer(player,!0),_this.emotes&&_this.emotes.addPlayer?.(player)},this.onConnectPlayer=function(player){_this.emotes&&player&&_this.emotes.addPlayer?.(player)},this.onDisconnectPlayer=function(){},this.configurePhysics=this.setupPhysics=async function(config={}){config.random=!1;let scene=this.getScene();return _this.physics=Physics.instance().createScene(Utils.getConstructorName(_this),scene,config),Global.PLAYGROUND,Physics.instance().useScene(Utils.getConstructorName(_this)),_this.avatarPhysicsInteraction||(_this.avatarPhysicsInteraction=_this.initClass(AvatarPhysicsInteraction)),_this.physics},this._activate=async function(){if(_this._playerReady=Promise.create(),_this.domActive=!0,_this.activateTime=Render.TIME,_this.avatarPromise=Promise.create(),Multiplayer.reset(),_this.players.length=0,_this.flag("isLocalPlayerConnected",!1),Global.PLAYGROUND||Lighting.useScene(Utils.getConstructorName(_this)),_this.element&&_this.element.show(),_this.needsReactivate&&(_this.needsReactivate=!1,_videoManager&&_videoManager.reset()),_restoreTextures.length&&(_restoreTextures.forEach((texture=>texture.restore())),_restoreTextures.length=0),"visible"!=Platform.visibility&&await Platform.waitForFocus(),_this.player=_this.getPlayerController(),_this.player&&(_this.player.onLocalActivate(),_this.players.push(_this.player)),_config||(_config=_overrideConfig),_config){if(!Global.PLAYGROUND)try{_this.player.wait("controls").then((_=>{_config.globalView||_config.preventMovement||_this.player.view instanceof AbstractAvatar?_this.player.controls.disable():_this.player.controls.enable(),_config.preventTeleport&&_this.player.controls.disableTeleport()}))}catch(e){}if(_config.camera&&(_config.camera.lock&&_config.camera.lock(),setCamera()),PlayerControls.FREE_MOVE=!1,_config.persistLocationScalar?Player.PERSIST_LOCATION_SCALAR=_config.persistLocationScalar:Player.PERSIST_LOCATION_SCALAR=!1,_config.walkingAvatar?PlayerControls.WALKING_AVATAR=!0:PlayerControls.WALKING_AVATAR=!1,_config.joystickSpeed?PlayerControlsVR.JOYSTICK_SPEED=_config.joystickSpeed:PlayerControlsVR.JOYSTICK_SPEED=1,_config.maxMouseTeleport?PlayerTeleportMouse.MAX_MOVE=_config.maxMouseTeleport:PlayerTeleportMouse.MAX_MOVE=PlayerTeleportMouse.MAX_MOVE_DEFAULT,_config.vrTransitionWaitTime?Transition.EXTRA_WAIT_TIME=_config.vrTransitionWaitTime:Transition.EXTRA_WAIT_TIME=0,_config.mobileControlsOffset?PlayerControls.MOBILE_CONTROLS_OFFSET=_config.mobileControlsOffset:PlayerControls.MOBILE_CONTROLS_OFFSET=!1,_config.noJumping?PlayerControls.NO_JUMP=!0:PlayerControls.NO_JUMP=!1,_config.clickPathfinding?PlayerControls.CLICK_PATHFINDING=!0:PlayerControls.CLICK_PATHFINDING=!1,_config.vrTeleportScalar?PlayerControlsVR.TELEPORT_SCALAR=_config.vrTeleportScalar:PlayerControlsVR.TELEPORT_SCALAR=1,_config.alternateArrowControls?PlayerControls.ALTERNATE_ARROWS=!0:PlayerControls.ALTERNATE_ARROWS=!1,_config.blockTeleport?PlayerControls.BLOCK_TELEPORT=!0:PlayerControls.BLOCK_TELEPORT=!1,_config.playerPhysics?PlayerControls.REAL_PHYSICS=!0:PlayerControls.REAL_PHYSICS=!1,_config.moveMultiplier?PlayerControls.MOVE_MULTIPLIER=_config.moveMultiplier:PlayerControls.MOVE_MULTIPLIER=1,_config.zoomMultiplier?PlayerControls.ZOOM_MULTIPLIER=_config.zoomMultiplier:PlayerControls.ZOOM_MULTIPLIER=1,_config.controlsFOV?PlayerControls.FOV=_config.controlsFOV:PlayerControls.FOV=void 0,_config.controlsFOVonResize?PlayerControls.FOV_RESIZE_LOGIC=_config.controlsFOVonResize:PlayerControls.FOV_RESIZE_LOGIC=void 0,_config.controlsConfig?PlayerControls.CUSTOM_CONFIG=_config.controlsConfig:PlayerControls.CUSTOM_CONFIG=void 0,_config.controlsFitment?PlayerControls.FITMENT=!0:PlayerControls.FITMENT=!1,!_config.globalView||_config.camera||_this.globalCamera||(_this.globalCamera=_this.initClass(GlobalViewCamera,_this)),_config.cameraViewToggle&&!_this.cameraViewToggleUI){if(void 0===DreamUI.CameraViewToggle)throw Error("AbstractEnvironment.js Error:: You need to include DreamUI.CameraViewToggle module in project.json");_this.cameraViewToggleUI=_this.initClass(DreamUI.CameraViewToggle,_config.cameraViewToggle,[_this.getDOMElement()])}try{_config.hidePlayer&&!Global.PLAYGROUND?_this.player.view.visible=!1:_this.player.view.visible=!0}catch(e){}_config.videoChatZones?.avatarProfileGrid&&(_config.avatarProfileGrid=_config.videoChatZones.avatarProfileGrid),_config.avatarProfileGrid&&(_this.avatarProfileGrid?_this.avatarProfileGrid.reset():_this.avatarProfileGrid=_this.initClass(AvatarProfileGrid,_config.avatarProfileGrid)),_config.videoChatZones&&(_config.videoStream=_config.videoStream?_config.videoStream:void 0!==_config.videoChatZones.audioOnly?!_config.videoChatZones.audioOnly:!Platform.usingVR(),_config.audioStream=!0,_config.videoPreview=!1,_config.videoLayout=_this.avatarProfileGrid,_config.preventMovement=!1,_config.avatarInteraction=_config.avatarInteraction||!0,_multiplayerConfig&&(_multiplayerConfig.chatZones=!0)),_config.avatarNameLabels&&(_this.avatarNameLabels?_this.avatarNameLabels.reset():_this.avatarNameLabels=_this.initClass(AvatarNameLabels,_config.avatarNameLabels)),_config.profilePrompt&&(_config.avatarInteraction=_config.avatarInteraction||!0,_this.profilePrompt||(_this.profilePrompt=_this.initClass(ProfilePrompt,_config.profilePrompt),_this.setFXAAMask(_this.profilePrompt))),null!=_config.audioStream&&(GameCenterMedia.audioStream=_config.audioStream),null!=_config.videoStream&&(_config.videoStream&&void 0===_config.videoPreview&&(_config.videoPreview=!0),!_videoManager&&_config.videoLayout&&(_videoManager=_this.videoManager=_this.initClass(VideoManager,_config.videoLayout,_config.videoPreview,_config.instructions),_this.videoLayout=_config.videoLayout,_this.flag(AbstractEnvironment.VIDEO_MANAGER_READY,!0)),GameCenterMedia.videoStream=_config.videoStream,_config.videoStream&&(!1===_config.preventMovement?_config.videoPreview=!1:!0!==_config.preventMovement&&(_config.preventMovement=!0),!1!==_config.videoPreview?(_this.stageMultiplayer=!0,_this.canEnterMultiplayer=!1,_config.videoPreview=!0):_videoManager&&_videoManager.addPlayer(_this.player))),!_config.videoStream&&_config.videoChatZones&&_videoManager&&_videoManager.addPlayer(_this.player),null!=_config.p2pStream&&(GameCenterMedia.p2p=_config.p2pStream),_config.avatarAudio&&(AvatarAudio.NEAR=_config.avatarAudio.near?_config.avatarAudio.near:5,AvatarAudio.FAR=_config.avatarAudio.far?_config.avatarAudio.far:10),_config.avatarInteraction?(_interaction||(_interaction=_this.initClass(AvatarInteraction,"object"==typeof _config.avatarInteraction?_config.avatarInteraction:void 0)),_interaction.activate()):_interaction&&(_interaction=_interaction.destroy()),_config.videoChatZones?(_this.videoChatZones&&_this.videoChatZones.destroy?.(),_this.videoChatZones=_this.initClass(VideoChatZones,"object"==typeof _config.videoChatZones?_config.videoChatZones:{},_interaction),_this.setFXAAMask(_this.videoChatZones)):_this.videoChatZones&&(_this.videoChatZones=_this.videoChatZones.destroy()),_config.screensContent&&(_this.screens=_this.initClass(ScreensContent,{name:NAME,..._config.screensContent})),_config.emotes&&(_this.emotes=_this.initClass(Emotes,{name:NAME,..._config.emotes}))}_this.onActivate&&_this.onActivate(),_this.onResetGame&&_this.onResetGame(),_this.physics&&Physics.instance().useScene(Utils.getConstructorName(_this)),connectMultiplayer(),_interaction&&_interaction.addLocalPlayer(_this.player),!_this.isActive&&AbstractEnvironment.PENDING_PROMPT&&async function displayPrompt(){await _this.wait(500);let config=AbstractEnvironment.PENDING_PROMPT;AbstractEnvironment.PENDING_PROMPT=null;let _prompt=_this.initClass(UI3DPrompt,config),_v3=new Vector3;_prompt.scale=1.25,_prompt.animateIn(),_prompt.group.visible=!0,_prompt.group.position.copy(_this.player.group.position),_prompt.group.position.y+=.6,_this.group.add(_prompt.group);let _target=new Group;const VR=Platform.usingVR();VR||_this.startRender((_=>{"1st"==PlayerSettings.instance().state.camera?(_target.position.copy(World.CAMERA.position),_target.position.add(_v3.set(0,0,-1.5).applyQuaternion(World.CAMERA.quaternion)),_target.lookAt(World.CAMERA.position),_prompt.group.position.lerp(_target.position,.1),_prompt.group.quaternion.slerp(_target.quaternion,.1)):(_target.quaternion.copy(World.CAMERA.quaternion),_prompt.group.quaternion.slerp(_target.getWorldQuaternion(),.1))})),(VR||"1st"==PlayerSettings.instance().state.camera)&&(_prompt.scale=.4,_prompt.group.position.copy(World.CAMERA.position),_prompt.group.position.y-=.25,_prompt.group.position.add(new Vector3(0,0,-1).applyQuaternion(World.CAMERA.quaternion)),_prompt.group.lookAt(World.CAMERA.position)),_this.events.sub(_prompt,Events.COMPLETE,(_=>{_prompt.animateOut()}))}(),_this.isActive=!0,Events.emitter._fireEvent(AbstractEnvironment.ACTIVATE,{env:_this})},this._waitForMultiplayer=function(){if(_multiplayerConfig)return Multiplayer.wait("room")},this.addToBatch=function(mesh,key,batchConfig={worldCoords:!0,parent:2,bypassVisibilityCheck:!0}){_batches||(_batches={}),_batches[key]||_this.getBatch(key,batchConfig),mesh.batch=_batches[key],_this.flag("notify_batch_"+key)||(_this.flag("notify_batch_"+key,!0),_this.onCreateBatch?.(_batches[key],mesh,key),"avatar"==key&&_batches[key].ready().then((_=>{_this.avatarPromise.resolve(_batches[key].mesh)}))),_batches[key].add(mesh),key.includes("avatar")&&_config&&_config.maxVisibleAvatars&&mesh.batch.wait("mesh").then((_=>{mesh.batch.mesh.maxInstancedCount=_config.maxVisibleAvatars}))},this.getBatch=function(key,config={worldCoords:!0,parent:2,bypassVisibilityCheck:!0}){return _batches||(_batches={}),_batches[key]||(_batches[key]=_this.initClass(MeshBatch,config),_batches[key].frustumCulled=!1,_batches[key].group.asyncPromise.resolve(),key.includes("avatar")&&(_batches[key].maxIndices=256)),_batches[key]},this.setupMultiplayer=this.configureMultiplayer=async function(obj){if(_multiplayerConfig)for(let key in obj)_multiplayerConfig[key]=obj[key];else _this.multiplayerConfig=_multiplayerConfig=obj;if(_multiplayerConfig){if(!_multiplayerConfig.roomKey)throw"setupMultiplayer must define roomKey";!0!==_multiplayerConfig.p2p&&(_multiplayerConfig.community=!0)}if(_this.isActive&&!Global.PLAYGROUND){if(_this.stageMultiplayer&&!_this.canEnterMultiplayer)return;GameCenter.TEMP_BLOCK_RESET=!0,_reconnectMultiplayer&&(Hydra.LOCAL&&console.warn("Attempting to reconfigure multiplayer & reconnect before the previous connection has been established"),await _reconnectMultiplayer),_reconnectMultiplayer=Promise.create(),_videoManager&&_videoManager.removePlayer(_this.player),Multiplayer.reset(),await _this.wait(100),_this.player&&(_this.player.onLocalActivate(),_this.players.push(_this.player)),_config?.videoChatZones?(_this.videoChatZones&&_this.videoChatZones.destroy?.(),_this.videoChatZones=_this.initClass(VideoChatZones,"object"==typeof _config.videoChatZones?_config.videoChatZones:{},_interaction),_this.setFXAAMask(_this.videoChatZones)):_this.videoChatZones&&(_this.videoChatZones=_this.videoChatZones.destroy()),_this.onResetGame&&_this.onResetGame(),await connectMultiplayer(),GameCenter.TEMP_BLOCK_RESET=!1,await _this.wait(500),_videoManager&&_videoManager.addPlayer(_this.player),_interaction&&_interaction.addLocalPlayer(_this.player),_reconnectMultiplayer.resolve(),_reconnectMultiplayer=null}},this.configureSpace=function(obj){_overrideConfig&&Utils.mergeObject(obj,_overrideConfig),_config=_this.config=obj,obj.avatarPlaygroundClass&&GlobalEnvironment.instance().registerPlayerClass(obj.avatarPlaygroundClass),_config.globalView&&!_this.globalCamera&&(_this.globalData=_this.initClass(GlobalViewData,_this)),(Global.PLAYGROUND||_this.isActive)&&_this._activate()},this.setCamera=function(camera){"object"!=typeof _config&&(_config={}),_config.camera=camera,setCamera()},this.deactivate=function(){_this.avatarPhysicsInteraction&&_this.avatarPhysicsInteraction.clear(),_this.emotes&&_this.emotes.destroy(),_this.screens&&_this.screens.destroy(),_this.element&&_this.element.hide(),_videoManager&&_videoManager.deactivate();for(let key in _batches)_batches[key].destroy();_batches=null,_this.onDeactivate&&_this.onDeactivate(),_this.isActive=!1,_this.domActive=!1,_this.needsReactivate=!0},this._bindOnDestroy((_=>{_this.group.deleted=!0,_this.element&&_this.element.remove&&_this.element.remove(),_this.physics&&Physics.instance().destroyScene(Utils.getConstructorName(_this))})),this.getPlayerController=function(){let env=_this.findParent("GroupEnvironment");return env?env.player:void 0},this.awaitPlayerController=function(){let promise=Promise.create();return _this.startRender((function check(){let player=_this.getPlayerController();player&&(_this.stopRender(check),promise.resolve(player))})),promise},this.overrideCamera=async function(camera,time=1,ease="easeOutCubic",delay){if(camera=camera.camera||camera,!(Global.PLAYGROUND||_config&&_config.globalView)){let parent=_this.findParent("GroupEnvironment");await parent.wait("player");let player=parent.player;await player.wait("controls")}_savedCamera||(_savedCamera=Camera.instance().lockCamera),Camera.instance().transition(camera,time,ease,delay)},this.restoreCamera=async function(time=500,ease="easeOutCubic",delay){_savedCamera&&(Camera.instance().transition(_savedCamera,time,ease,delay),_savedCamera=null)},this.customEnvironment=function(){_overrideConfig={preventMovement:!0,hidePlayer:!0}},this.enterVideoChat=function(){_this.canEnterMultiplayer||(_this.canEnterMultiplayer=!0,_videoManager&&_videoManager.addPlayer(_this.player),GameCenter.TEMP_BLOCK_RESET=!0,_this.wait(Multiplayer,"room").then((_=>GameCenter.TEMP_BLOCK_RESET=!1)),connectMultiplayer())},this.getDOMElement=function(isAutoResize=!0){if(!_this.element){let resize=[],left=0,top=0;if(UIController.instance().layout){let{sizes:sizes}=UIController.instance();left=sizes.left,top=sizes.top}_this.element=$(Utils.getConstructorName(_this)),_this.element.css({left:left,top:top}).size(Stage.width-left,Stage.height-top),UIController.instance().element.add&&UIController.instance().element.add(_this.element),_this.domActive||_this.element.hide();let fireResize=_=>{resize.forEach(((fn,i)=>{try{fn()}catch(e){resize.splice(i,1)}}))};_this.events.sub(World.RESIZE,(()=>{isAutoResize&&_this.element&&_this.element.size&&_this.element.size(Stage.width,Stage.height),fireResize()})),_this.element.onResize=async fn=>{resize.push(fn),await _this.wait(1e3),fn()}}return _this.element},this.disconnectMultiplayer=function(){return _this.players.length=0,_this.hasStaged&&(_this.stageMultiplayer=!0,_this.canEnterMultiplayer=!1),_this.videoChatZones&&_this.videoChatZones.disconnect().then((_=>_this.videoChatZones.destroy?.())),Multiplayer.reset()},this.getScene=function(){if(!_this.scene){let p=_this.group._parent;for(;p;)p instanceof Scene&&(_this.scene=p),p=p._parent}return _this.scene},this.setFXAAMask=function(objects){if(Platform.usingVR()||Global.PLAYGROUND)return!1;!function initFXAAMask(){_this.getScene()?.nuke?.parent?.fxaa}(),objects.length?objects.forEach((object=>setFXAAMaskShader(object))):setFXAAMaskShader(objects)},this._deactivate=function(){for(let key in _batches)_this.flag("notify_batch_"+key,!1);if(_config.releaseTextureMemory){_this.releasedTextureMemory=!0;for(let l in _layers){let layer=_layers[l];if(layer.shader){let uniforms=layer.shader.uniforms;for(let key in uniforms){let value=uniforms[key].value;value&&value.destroy&&value.restore&&1===value.exists&&(value.destroy(),_restoreTextures.push(value))}}}}}}),(_=>{AbstractEnvironment.ACTIVATE="abs_activate",AbstractEnvironment.PLAYER_CONNECT="abs_player_connect",AbstractEnvironment.PLAYER_DISCONNECT="abs_player_disconnect",AbstractEnvironment.VIDEO_MANAGER_READY="AbstractEnvironment.VIDEO_MANAGER_READY",AbstractEnvironment.findParent=function(obj){for(;obj;){if(obj.configureSpace)return obj;obj=obj.parent}}})),Class((function CrowdAvatar(){Inherit(this,Object3D);const _this=this;var _options,_map={};World.AVATAR_BOX||(World.AVATAR_BOX=new BoxGeometry(1,1,1).toNonIndexed(),World.AVATAR_SPHERE=new SphereGeometry(1).toNonIndexed()),this.create=async function(shader,options={}){let layout=_this.initClass(SceneLayout,"crowd_avatar_"+Utils.getConstructorName(_this),{noGraph:!_this.isPlayground()});await layout.loadedAllLayers();let geom=await async function merge(layers){let array=[],index=0;for(let key in layers)layers[key].geomIndex=index,_map[key]=index++,array.push(layers[key]);if(1==array.length)return array[0];let meshes=[],buffer=[];array.forEach(((mesh,i)=>{let position=mesh.geometry.attributes.position.array,uv=mesh.geometry.attributes.uv.array,normal=mesh.geometry.attributes.normal.array,positionClone=new Float32Array(position),uvClone=new Float32Array(uv),normalClone=new Float32Array(normal);mesh.updateMatrix(),meshes.push({p:positionClone,u:uvClone,n:normalClone,geomIndex:mesh.geomIndex,matrix:mesh.matrix.elements}),buffer.push(positionClone.buffer,uvClone.buffer,normalClone.buffer)}));let{arrays:arrays}=await Thread.shared().crowdAvatarMergeMeshes({meshes:meshes}),geom=new Geometry;for(let key in arrays)geom.addAttribute(key,new GeometryAttribute(arrays[key].array,arrays[key].components));return geom}(layout.layers);if(function editShader(shader){let vs=shader.vertexShader,fs=shader.fragmentShader;if(!fs)return;let modify=code=>{let defines="\n";for(let key in _map)defines+=`#define ${key} ${_map[key]}.0\n`;let split=code.split("__ACTIVE_THEORY_LIGHTS__");return split[0]+"__ACTIVE_THEORY_LIGHTS__"+defines+split[1]};shader.vertexShader=modify(vs),shader.fragmentShader=modify(fs)}(shader),_options=options,_this.mesh=new Mesh(geom,shader),_this.mesh.frustumCulled=!1,options.castShadow&&(_this.mesh.castShadow=!0),_this.isPlayground()){let plane=new Mesh(World.PLANE,Utils3D.getTestShader());_this.add(plane),plane.rotation.x=Math.radians(-90),plane.scale.setScalar(4),_this.group.add(_this.mesh),_this.mesh.position.x=.5}else _this.remove(layout.group)},this.loadAttribBuffers=async function(){let geom=_this.mesh.geometry,count=geom.attributes.random.count;for(let key in _options.attribs){let val=_options.attribs[key],components=function(){switch(val){case"f":return 1;case"v3":case"c":return 3}}(),buffer=new Float32Array(count*components);_this.fillAttributeBuffer&&_this.fillAttributeBuffer(buffer,count,key,val),geom.addAttribute(key,new GeometryAttribute(buffer,components,1))}},this.getMesh=async function(){return await _this.wait("mesh"),_this.mesh}}),(_=>{Thread.upload((function crowdAvatarMergeMeshes({meshes:meshes},id){let geometry;meshes.forEach((m=>{let geom=new Geometry;geom.addAttribute("position",new GeometryAttribute(m.p,3)),geom.addAttribute("uv",new GeometryAttribute(m.u,2)),geom.addAttribute("normal",new GeometryAttribute(m.n,3)),geom.addAttribute("geomIndex",new GeometryAttribute(((array,value)=>{for(let i=0;i<array.length;i++)array[i]=value;return array})(new Float32Array(m.u.length/2),m.geomIndex),1)),geom.applyMatrix((new Matrix4).fromArray(m.matrix)),geometry?geometry.merge(geom):geometry=geom}));let buffers=[],obj={};for(let key in geometry.attributes)obj[key]={array:geometry.attributes[key].array,components:geometry.attributes[key].itemSize},buffers.push(obj[key].array.buffer);resolve({arrays:obj},id,buffers)}))})),Class((function DefaultCrowdAvatar(){Inherit(this,CrowdAvatar);const _this=this;!async function(){World.CROWD_AVATAR_BOX||(World.CROWD_AVATAR_BOX=new BoxGeometry(.1,.1,.1).toNonIndexed());let shader=_this.initClass(Shader,"DefaultCrowdAvatar",{});await _this.create(shader,{attribs:{color0:"c",color1:"c",color2:"c"},castShadow:!0})}(),this.fillAttributeBuffer=function(buffer,count,key,type){for(let i=0;i<count;i++)buffer[3*i+0]=Math.random(0,1,4),buffer[3*i+1]=Math.random(0,1,4),buffer[3*i+2]=Math.random(0,1,4)}})),Class((function AvatarNameLabels(_config){Inherit(this,Object3D);const _this=this;var _worker,_mesh,_data,_shader,_currView,_players=[];Platform.usingVR();function loop(){for(let i=_players.length-1;i>-1;i--){let player=_players[i];if(!player.view)continue;player.avatarTextLabel;let offsetY=0;player.gcPlayer&&player.gcPlayer.me&&(offsetY+=_config.showSelf&&"1st"!=_currView?0:9999),player.hidden&&(offsetY+=9999);let index=player.view.mesh.batchIndex;_data.data[3*index+0]=player.group.position.x,_data.data[3*index+1]=player.group.position.y+_config.yPos+offsetY,_data.data[3*index+2]=player.group.position.z}_data.needsUpdate=!0}function applyIndex(geom,index){let count=geom.attributes.position.count,buffer=new Float32Array(count);for(let i=0;i<count;i++)buffer[i]=index;geom.addAttribute("tIndex",new GeometryAttribute(buffer,1))}function createMergedGeometry(){if(_worker&&_worker.stop(),!_players.length)return void(_mesh&&(_mesh.visible=!1));if(!_players[0].avatarGeom)return;let geom=_players[0].avatarGeom.toNonIndexed();geom.attributes.tIndex||applyIndex(geom,_players[0].view.mesh.batchIndex);let index=0;_mesh&&(_mesh.visible=!0);let complete=_=>{_mesh?(_this.group.remove(_mesh),_mesh.geometry.destroy(_mesh),(_mesh=new Mesh(geom,_shader)).frustumCulled=!1,_mesh.renderOrder=9999,_this.add(_mesh)):function initMesh(geom){_shader=_this.initClass(Shader,_config.shaderName||"AvatarNameLabels",{tData:{value:_data},uSize:{value:_data.width},uQuaternion:{value:World.CAMERA.quaternion},tMap:{value:_players[0].avatarTextLabel.mesh.shader.get("tMap")},uColor:{value:new Color(_config.color)},uAlpha:{value:_config.alpha},uDistanceFade:{value:new Vector2(_config.distanceFade[0],_config.distanceFade[1])},transparent:!0,depthTest:!1,depthWrite:!1}),(_mesh=new Mesh(geom,_shader)).frustumCulled=!1,_mesh.renderOrder=999999,_this.add(_mesh)}(geom)};_worker=new Render.Worker((_=>{index++;let player=_players[index];if(!player)return complete(),_worker.stop();if(player.avatarGeom){let pgeom=player.avatarGeom.toNonIndexed();pgeom.attributes.tIndex||applyIndex(pgeom,player.view.mesh.batchIndex),geom.merge(pgeom)}}),1)}function playerJoin({player:player}){_this._invisible||(player.__avatarNameBind=player.state.bind(_config.stateKey||"name",(async nameString=>{playerLeave({player:player},!0);let stringLabel=player.state.get(_config.stateKey||"name")||"";stringLabel=function truncateLongName(str){const MAX_LENGTH=_config.truncateLength;return str.length>MAX_LENGTH?str.substr(0,MAX_LENGTH)+"...":str}(stringLabel);let $text=$glText(stringLabel,_config.font,_config.size,{align:"center"});if(await Promise.all([player.view.ready(),$text.loaded()]),await _this.wait(1200),!player.view)return;player.avatarTextLabel=$text;let geometryText=$text.mesh.geometry,geometry=new Geometry;geometry.index=geometryText.index,geometry.addAttribute("position",geometryText.attributes.position.clone()),geometry.addAttribute("uv",geometryText.attributes.uv.clone()),player.avatarGeom=geometry,_players.push(player),Utils.debounce(createMergedGeometry,100)})))}function playerLeave({player:player},persistBinding){_this._invisible||(_players.remove(player),persistBinding||player.__avatarNameBind?.destroy?.(),Utils.debounce(createMergedGeometry,100))}function handleSwitchView(view){_currView=view}!function initConfig(){_config.font=_config.font||"proxima-nova",_config.size=_config.size||.3,_config.yPos=_config.yPos||1.8,_config.alpha=_config.alpha||1,_config.color=_config.color||"#ffffff",_config.distanceFade=_config.distanceFade||[10,15],_config.truncateLength=_config.truncateLength||20}(),function initBatches(){let batch=_this.parent?.getBatch?.("avatar");if(!batch)throw"AvatarNameLabels couldn't find batch??";batch.maxIndices||(batch.maxIndices=256);let pot=Math.pow(2,Math.ceil(Math.log(batch.maxIndices)/Math.log(2))),size=Math.sqrt(pot);_data=new DataTexture(new Float32Array(4*pot),size,size,Texture.RGBFormat)}(),function addListeners(){_this.events.sub(Player.JOIN,playerJoin),_this.events.sub(Player.LEAVE,playerLeave),_this.bindState(PlayerSettings.instance().state,"camera",handleSwitchView)}(),_this.startRender(loop),this.reset=function(){_players.length=0,_mesh&&(_mesh.visible=!1)},this.set("alpha",(v=>{_config.alpha=v,_mesh?.shader.set("uAlpha",v)})),this.get("alpha",(v=>_config.alpha))}),(_=>{})),Class((function NPCAvatar(_input,_config){Inherit(this,Component);const _this=this;var config,_group,_shader,_skinnedNPC,_env,_player,_bubblesGroup,_q1=new Quaternion,_v1=(new Quaternion,new Vector3),_v2=new Vector3,_interactionTime=0,_isTalking=!1,_finishedTalking=!1,_initial=[],_questProgress=[],_questComplete=[];async function loadDialog(path,textGroup){await AssetLoader.loadAssets(["~assets/js/lib/vtt.min.js"]),get(Assets.getPath(path)).then((res=>{const texts=[],parser=new WebVTT.Parser(window,WebVTT.StringDecoder());parser.oncue=function(cue){let text=cue.text.startsWith("- ")?cue.text.substring(2):cue.text;text=text.replace("\n- "," "),texts.push({text:text,start:cue.startTime,end:cue.endTime})},parser.parse(res),parser.flush(),texts.forEach((text=>textGroup.push(_this.initClass(NPCSpeechBubble,{dialog:text})))),textGroup.forEach((t=>_bubblesGroup.add(t.group)))})).catch((err=>console.log(err)))}_this.isNPC=!0,_this.quest={name:"",started:!1,completed:!1,rewarded:!1},async function(){if(await _this.wait(4e3),!1===_input.get("visible"))return;!function createGroup(){_group=new Group,_this.parent.group.add(_group);const positioning=InputUIL.create("NPC_positioning_"+_input.prefix,_config);positioning.setLabel("Mesh"),["Position","Rotation","Scale"].forEach(((e,i)=>{positioning.addVector(e,2===i?[1,1,1]:[0,0,0]);const setVal=val=>{_group[e.toLowerCase()].fromArray(val)};setVal(positioning.get(e));const field=positioning.getField(e);field&&field.onChange(setVal)})),_group._originalQuaternion=_group.quaternion.clone()}(),(config=InputUIL.create(_input.prefix+"_npcavatar",_config)).setLabel("NPC"),config.addFile("Model/bones json"),config.addFile("Idle json"),config.addFile("Talk json"),config.addFile("Dialog .vtt"),config.add("Quest Name"),config.addFile("Quest progress .vtt"),config.addFile("Quest complete .vtt");const avatarPath=config.getFilePath("Model/bones json");if(!avatarPath)return;_env=_this.parent.findParent("GroupEnvironment"),await async function loadNPC(path){!function createShader(){const shaderName=_input.get("shader")||"NPCAvatarTestShader";_shader=new Shader(shaderName,{unique:`Element_${_input.prefix}_npcavatar`,defines:["skinning"],customCompile:"skinning"}),window[shaderName]&&_this.initClass(window[shaderName],new Mesh,_shader,_input,_config);ShaderUIL.add(_shader,_config).setLabel("Shader")}();const geo=await GeomThread.loadSkinnedGeometry(Assets.getPath(path));_skinnedNPC=new Skin(geo,_shader),_this.mesh=_skinnedNPC,_this.mesh.castShadow=!0,_skinnedNPC.onBeforeRender=()=>{_skinnedNPC._drawing&&function loop(){if(!_this.quest)return;_player&&_player.group||(_player=_env?.player);const isNerby=(_player?.group?_player.group.position.distanceTo(_group.position):1/0)<4;isNerby||(_finishedTalking=!1);_isTalking?isNerby&&!_finishedTalking||(_isTalking=!1,_this.events.fire(NPCAvatar.END_DIALOG,{npc:_skinnedNPC})):isNerby&&!_finishedTalking&&(_isTalking=!0,_interactionTime=0,_this.events.fire(NPCAvatar.START_DIALOG,{npc:_skinnedNPC}));let activeBubbleGroup=_initial;(_this.quest.started||_this.quest.completed)&&(!_this.quest.completed&&_questProgress.length>0?activeBubbleGroup=_questProgress:_questComplete.length>0&&(activeBubbleGroup=_questComplete));if([_initial,_questProgress,_questComplete].forEach((g=>{g!==activeBubbleGroup&&g.forEach((b=>b.hideBubble()))})),_isTalking){const timeSeconds=(_interactionTime+=Render.DELTA)/1e3;activeBubbleGroup.forEach((b=>{timeSeconds>=b.start&&timeSeconds<=b.end?b.showBubble():b.hideBubble()})),!_finishedTalking&&isNerby&&(0===activeBubbleGroup.length||timeSeconds>activeBubbleGroup[activeBubbleGroup.length-1].end)&&(_finishedTalking=!0,""===_this.quest.name||_this.quest.started||(_this.quest.started=!0,_this.events.fire(NPCAvatar.START_QUEST,{name:_this.quest.name}))),_this.quest.completed&&!_this.quest.rewarded&&(_this.quest.rewarded=!0,_this.events.fire(NPCAvatar.REWARD_QUEST,{name:_this.quest.name}))}else activeBubbleGroup.forEach((t=>t.hideBubble()));_skinnedNPC.animations.forEach(((a,i)=>{a.elapsed+=.3*Render.HZ_MULTIPLIER,a.weight=0===i?Math.lerp(_isTalking?0:1,a.weight,.05,!0):1-_skinnedNPC.animations[0].weight})),_skinnedNPC.update(),_player&&_player.group&&(_isTalking?(_v1.copy(_player.group.position).sub(_group.position),_v1.y=0,_v1.normalize(),_q1.setFromUnitVectors(_v2.set(0,0,1),_v1),_group.quaternion.slerp(_q1,.035)):_group.quaternion.slerp(_group._originalQuaternion,.02));activeBubbleGroup.length>0&&Utils3D.billboard(_bubblesGroup)}()},_shader.addUniforms({boneTexture:{value:_skinnedNPC.boneTexture},boneTextureSize:{value:_skinnedNPC.boneTextureSize}});const anims=[config.getFilePath("Idle json"),config.getFilePath("Talk json")];for(let i=0;i<anims.length&&anims[i];i++){(await _skinnedNPC.loadAnimation(Assets.getPath(anims[i]))).weight=0===i?1:0}_group.add(_skinnedNPC)}(avatarPath),(_bubblesGroup=new Group).position.y=Math.abs(_skinnedNPC.geometry.boundingBox.min.y)+Math.abs(_skinnedNPC.geometry.boundingBox.max.y),_group.add(_bubblesGroup);const dialogPath=config.getFilePath("Dialog .vtt");dialogPath&&loadDialog(dialogPath,_initial);const questName=config.get("Quest Name");if(""!==questName){_this.quest.name=questName;const dialogProgress=config.getFilePath("Quest progress .vtt");dialogProgress&&loadDialog(dialogProgress,_questProgress);const dialogCompleted=config.getFilePath("Quest complete .vtt");dialogCompleted&&loadDialog(dialogCompleted,_questComplete),_this.events.sub(NPCAvatar.END_QUEST,(e=>{e?.name!==_this.quest.name||_this.quest.completed||(_this.quest.completed=!0)}))}}()}),(()=>{NPCAvatar.START_DIALOG="npcavatar_start_dialog",NPCAvatar.PLAY_DIALOG="npcavatar_step_dialog",NPCAvatar.END_DIALOG="npcavatar_end_dialog",NPCAvatar.START_QUEST="npcavatar_start_quest",NPCAvatar.END_QUEST="npcavatar_end_quest",NPCAvatar.REWARD_QUEST="npcavatar_reward_quest"})),Class((function NPCSpeechBubble({dialog:dialog={text:"There's a guy named Vicente who looks weird.",start:0},align:align="center",font:font="proxima-nova",fontSize:fontSize=.07,color:color="#444444",lineHeight:lineHeight=1.5,maxWidth:maxWidth=(Device.mobile?1.2:1.5)}={}){Inherit(this,Object3D);const _this=this;var $cnt,$bubble,$pointer,$text;_this.stateVisible=!1,_this.start=dialog.start,_this.end=dialog.end,async function(){await async function initText(){_this.group.scale.setScalar(0),($cnt=$gl()).alpha=0,$cnt.enable3D(),($bubble=$cnt.create()).setZ(-1);const bubbleShader=new Shader("NPCBubbleDefault",{uAlpha:{type:"f",value:1},uAspect:{value:1},transparent:!0,depthTest:!1});$bubble.useShader(bubbleShader),$bubble.enable3D(),($pointer=$cnt.create(.15,.15,"#ffffff")).useShader(new Shader("NPCPointDefault",{uAlpha:{type:"f",value:1},transparent:!0,depthTest:!1})),$pointer.enable3D(),$pointer.mesh.position.z=1e-4,$pointer.setZ(1),$text=$glText(dialog.text,font,fontSize,{align:align,color:color,lineHeight:lineHeight,width:maxWidth,shader:"NPCTextDefault"}),$cnt.add($text),await $text.loaded(),$text.mesh.shader.addUniforms({uTransition:{value:0},uWordCount:{value:$text.mesh.geometry.wordCount||1}}),$text.mesh.position.z=1e-4;const bottomSpacing=.1,textW=$text.dimensions.width,textH=$text.dimensions.height,paddingX=.35,paddingY=.2;$bubble.scaleX=textW+paddingX,$bubble.scaleY=textH+paddingY,$bubble.y=bottomSpacing+.5*$bubble.scaleY,bubbleShader.uniforms.uAspect.value=$bubble.scaleX/$bubble.scaleY,$pointer.y=bottomSpacing,$text.y=$bubble.y-.015,Platform.usingVR()?(_this.add($cnt.group),$text.mesh.renderOrder=99999,$pointer.mesh.renderOrder=99998,$bubble.mesh.renderOrder=99997):(GLUI.Scene.add($cnt),_this.add($cnt.anchor))}()}(),this.showBubble=function(){_this.stateVisible||(_this.stateVisible=!0,$cnt.alpha=1,TweenManager.clearTween(_this.group.scale),tween(_this.group.scale,{x:1,y:1,z:1,spring:1,damping:.8},1e3,"easeOutElastic"),$text.mesh.shader.set("uTransition",0),$text.mesh.shader.tween("uTransition",1,.5*(_this.end-_this.start)*1e3,"easeOutSine"),_this.events.fire(NPCAvatar.PLAY_DIALOG,{dialog:dialog,start:_this.start,end:_this.end}))},this.hideBubble=function(){_this.stateVisible&&(_this.stateVisible=!1,$text.mesh.shader.tween("uTransition",0,800,"easeInSine"),TweenManager.clearTween(_this.group.scale),tween(_this.group.scale,{x:0,y:0,z:0,spring:1,damping:1},800,"easeInElastic").onComplete((_=>{$cnt.alpha=0})))}})),Class((function DefaultOptimizedAvatar(){Inherit(this,OptimizedAvatar);const _this=this;!async function(){let shader=_this.initClass(Shader,"DefaultOptimizedAvatar",{uColor:{value:new Color(Utils.randomColor()),batchUnique:!0}});await _this.create(["accessory"],shader)}()})),Class((function OptimizedAvatar(){Inherit(this,AbstractAvatar);const _this=this;var _shader,_name,_visibility=[];this.rotation=0,World.AVATAR_BOX||(World.AVATAR_BOX=new BoxGeometry(1,1,1).toNonIndexed(),World.AVATAR_SPHERE=new SphereGeometry(1).toNonIndexed()),_this.parent.group&&(_this.parent.group.matrixAutoUpdate=!1,_this.parent.group.visible=!1),this.create=async function(groups,shader=Utils3D.getTestShader(),options={}){if(Array.isArray(options)&&(options={hiddenLayers:options}),_this.isPlayground()){let plane=new Mesh(World.PLANE,Utils3D.getTestShader());plane.scale.setScalar(3),_this.add(plane),plane.rotation.x=Math.radians(-90),plane.scale.setScalar(4)}let className=Utils.getConstructorName(_this);if(await _this.instance().create(className,groups,{...options,rotation:_this.rotation}),!_this.create)return;if(await _this.instance().ready(),!_this.create)return;if(shader.addUniforms({uAVVis:{value:new Vector4(-1,-1,-1,-1),batchUnique:!0}}),_this.instance().modifyShader(shader),_this.mesh=new Mesh(_this.instance().geometry,shader),_this.add(_this.mesh),_this.trackVelocity){const lastPosition=new Vector3,v3=new Vector3,v32=new Vector3,vUniform=new Vector4;let _throttle,_initialAngle,angle=0;if(shader.addUniforms({uVelocity:{value:vUniform,batchUnique:!0}}),_this.parent&&_this.parent.group?.position){lastPosition.copy(_this.parent.group.position);const VR=_this.parent?.isVR,THRESHOLD=VR?2e-4:36e-6,DAMP=.8,VEL_SCALE=.1;let tick=0;const velocityLoop=_=>{if(!_this.mesh)return Render.stop(velocityLoop);v32.copy(_this.parent.group.position).sub(lastPosition),lastPosition.copy(_this.parent.group.position),VR&&v32.lengthSq()<THRESHOLD&&v32.setScalar(0),v3.add(v32),v3.multiplyScalar(function normalizeFriction(t){return Math.exp(Math.log(t)*Render.HZ_MULTIPLIER)}(DAMP));const v3LengthSq=v32.lengthSq(),needsOldAngle=v3LengthSq<.001&&!_this.parent.isLocal;let newAngle=v3LengthSq<THRESHOLD||needsOldAngle?angle:Math.atan2(v3.x,v3.z);!_initialAngle&&needsOldAngle&&_this.parent.group.eD&&_this.parent.group.eD.a&&(newAngle=_this.parent.group.eD.a,_initialAngle=!0),angle=newAngle,tick++<.1*Render.REFRESH_RATE&&v3.setScalar(0),vUniform.set(v3.x*VEL_SCALE,v3.y*VEL_SCALE,v3.z*VEL_SCALE,angle),_this.parent.isLocal&&(_this.parent.extraData&&(_this.parent.extraData.a=Number(angle.toFixed(3))),VR||(v3LengthSq<.001?_throttle||(_throttle=Timer.create((_=>{PhysicalSync.throttle=!0}),1e3)):_throttle&&(clearTimeout(_throttle),_throttle=!1,PhysicalSync.throttle=!1)))};Render.start(velocityLoop)}}let parent=_this.findParent("GroupEnvironment");shader.waitForPromise&&await shader.waitForPromise,parent&&parent.view&&parent.view.addToBatch&&parent.view.addToBatch(_this.mesh,"avatar"),_shader=shader,_this.isPlayground()&&(_this.mesh.position.x=.8)},this.setVisibility=function(group,label,inline){if(!_visibility.includes(group)){if(4==_visibility.length)throw"Can only have 4 groups with visibility customization";_visibility.push(group)}let value=_this.instance().map[group][label];switch(_visibility.indexOf(group)){case 0:_shader.get("uAVVis").x=value;break;case 1:_shader.get("uAVVis").y=value;break;case 2:_shader.get("uAVVis").z=value;break;case 3:_shader.get("uAVVis").w=value}inline||PlayerModel.set(Utils.getConstructorName(_this)+"Vis_"+group,label)},this.getCustomizableLabels=function(){let obj={},map=_this.instance().map;for(let key in map){obj[key]=[];for(let key2 in map[key])key2.includes("perm")||obj[key].push(key2)}return obj},this.instance=function(){return OptimizedAvatar.getInstance(_this.isPlayground()?_this:null)},this.setUniform=async function(key,value){await _this.ready(),_this.create&&(_shader.set(key,value),value.toArray&&(value=value.toArray()),PlayerModel.set(Utils.getConstructorName(_this)+"_"+key,value))},this.setUserData=async function(data){if(_this.overrideUserData&&_this.overrideUserData(data),await _this.ready(),_this.create){_this.parent.group.visible=!0;try{_name||(_name=Utils.getConstructorName(_this));let name=_name;for(let key in data){let value=data[key];if(key.includes(name+"_")){let uniform=key.split(name+"_")[1];if(Array.isArray(value)){let shaderUniform=_shader.get(uniform);shaderUniform&&shaderUniform.fromArray(value)}else _shader.uniforms[uniform]&&_shader.set(uniform,value)}if(key.includes(name+"Vis_")){let group=key.split("Vis_")[1];_this.setVisibility(group,value,!0)}}}catch(e){}}},this.ready=function(){return this.wait("mesh")}}),(_=>{var _map={};OptimizedAvatar.LOD="",OptimizedAvatar.getInstance=function(inst){return _map[OptimizedAvatar.LOD]||(_map[OptimizedAvatar.LOD]=new OptimizedAvatarInstance(inst,OptimizedAvatar.LOD)),_map[OptimizedAvatar.LOD]},OptimizedAvatar.destroyInstance=function(){try{_map[OptimizedAvatar.LOD]&&_map[OptimizedAvatar.LOD].destroy(),delete _map[OptimizedAvatar.LOD]}catch(e){}}})),Class((function OptimizedAvatarInstance(_local,_lod){Inherit(this,Object3D);const _this=this;var _layouts,_name,_group=_local?_local.group:null;async function initMerge(groups,{hiddenLayers:hiddenLayers=[],attribs:extraAttribs}){await Promise.all(Object.values(_layouts).map((l=>l.loadedAllLayers())));let meshes=[],geomIndex=0,attribs={...extraAttribs};OptimizedAvatarInstance.cached||(OptimizedAvatarInstance.cached={});for(let key in _layouts){let input,layout=_layouts[key],groupIndex=groups.indexOf(key);_this.map[key]={},_this.groups[key]=layout.group,layout.group.groupIndex=groupIndex,_group&&"main"!=key&&(input=InputUIL.create("Customize_"+key));for(let key2 in layout.layers){let cached=OptimizedAvatarInstance.cached[_name+"/"+key+"/"+key2],mesh=layout.layers[key2];if(!hiddenLayers.includes(key2)){mesh.groupIndex=groupIndex,mesh.geomIndex=void 0!==cached?cached:key2.includes("perm")||"main"==key?geomIndex+100:geomIndex,_this.map[key][key2]=mesh.geomIndex,OptimizedAvatarInstance.cached[_name+"/"+key+"/"+key2]=mesh.geomIndex,mesh.geometry.attributes.uv2&&(attribs.uv2="v2"),mesh.geometry.attributes.vdata&&(attribs.vdata="v3");for(let attr in extraAttribs)mesh.geometry.attributes[attr]&&(attribs[attr]=extraAttribs[attr]);if(input&&!key2.includes("perm")){let callback=_=>_local.setVisibility(key,key2);input.addButton("on",{label:key2,actions:[{title:key2,callback:callback}]})}geomIndex++,meshes.push(mesh)}}}meshes.length&&await async function mergeMeshes(array,attribs){let buffer=[],meshes=[];array.forEach((mesh=>{let position=mesh.geometry.attributes.position.array,uv=mesh.geometry.attributes.uv.array,normal=mesh.geometry.attributes.normal.array,positionClone=new Float32Array(position),uvClone=new Float32Array(uv),normalClone=new Float32Array(normal),indexClone=!1;mesh.geometry.index&&(indexClone=new Uint16Array(mesh.geometry.index)),mesh.updateMatrixWorld(!0);let obj={p:positionClone,u:uvClone,n:normalClone,index:indexClone,geomIndex:mesh.geomIndex,groupIndex:mesh.groupIndex,matrix:mesh.matrixWorld.elements,attribs:attribs};meshes.push(obj),buffer.push(positionClone.buffer,uvClone.buffer,normalClone.buffer);for(let key in attribs){let components=function(){switch(attribs[key]){case"f":return 1;case"v2":return 2;case"v4":return 4}return 3}();obj[key]=new Float32Array(mesh.geometry.attributes[key]?mesh.geometry.attributes[key].array:mesh.geometry.attributes.position.count*components),buffer.push(obj[key].buffer)}}));let{index:index,arrays:arrays,boundingBox:boundingBox,boundingSphere:boundingSphere}=await Thread.shared().avatarMergeMeshes({meshes:meshes}),geom=new Geometry;index&&geom.setIndex(index);for(let key in arrays)geom.addAttribute(key,new GeometryAttribute(arrays[key].array,arrays[key].components));geom.boundingBox=boundingBox,geom.boundingSphere=boundingSphere,_this.geometry=geom}(meshes,attribs)}function overrideGeometry(geom,wildcard){return"lod"==wildcard&&_lod&&_lod.length?geom+_lod:geom}this.map={},this.groups={},this.create=async function(className,groups,options={}){if(_this.geometry)return;groups=["main",...groups],"number"==typeof options&&(options={rotation:options}),options.rotation||(options.rotation=0),arguments.length>3&&Array.isArray(arguments[3])&&(options.hiddenLayers=arguments[3]),_name=className;let layouts=_layouts={};return groups.forEach((name=>{layouts[name]=_this.initClass(SceneLayout,`${className}_${name}`,{noGraph:!_group}),layouts[name].onCreateGeometry=overrideGeometry,layouts[name].group.rotation.y=options.rotation,layouts[name].group.updateMatrixWorld(!0),_group&&_group.add(layouts[name].group),layouts[name].group.prefix=`${className}_${name}`})),await initMerge(groups,options),this},this.ready=function(){return _this.wait("geometry")},this.modifyShader=function(shader){if(_this.flag("shadermod")||!shader.vertexShader)return;_this.flag("shadermod",!0);let modify=code=>{let defines="\n";for(let key in _this.groups)defines+=`#define _${key} ${_this.groups[key].groupIndex}.0\n`;let split=code.split("__ACTIVE_THEORY_LIGHTS__");return(code=(code=split[0]+"__ACTIVE_THEORY_LIGHTS__"+defines+split[1]).split("\n")).forEach(((line,i)=>{if(line.includes("#define")&&line.includes("/")){let split=line.split(" ");split=split[split.length-1];let[group,label]=split.trim().split("/"),map=_this.map[group];if(!map)throw`modifyShader :: Group ${group} not found`;if(map=map[label],void 0===map)throw`modifyShader :: Label ${label} not found`;code[i]=line.replace(`${group}/${label}`,map+".0")}})),code.join("\n")},vs=modify(shader.vertexShader),fs=modify(shader.fragmentShader);shader.vertexShader=vs,shader.fragmentShader=fs,shader.restoreVS=vs,shader.restoreFS=fs},this.getLayers=function(key){let array=Object.keys(_this.map[key]);return array.sort(),array},this.onDestroy=function(){_this.geometry.destroy()}}),(_=>{Thread.upload((function avatarMergeMeshes({meshes:meshes},id){let geometry,fill=(array,value)=>{for(let i=0;i<array.length;i++)array[i]=value;return array};meshes.forEach((m=>{let geom=new Geometry;m.index&&geom.setIndex(m.index),geom.addAttribute("position",new GeometryAttribute(m.p,3)),geom.addAttribute("uv",new GeometryAttribute(m.u,2));for(let key in m.attribs){let components=function(){switch(m.attribs[key]){case"f":return 1;case"v2":return 2;case"v4":return 4}return 3}();geom.addAttribute(key,new GeometryAttribute(m[key],components))}geom.addAttribute("normal",new GeometryAttribute(m.n,3)),geom.addAttribute("geomIndex",new GeometryAttribute(fill(new Float32Array(m.u.length/2),m.geomIndex),1)),geom.addAttribute("groupIndex",new GeometryAttribute(fill(new Float32Array(m.u.length/2),m.groupIndex),1)),geom.applyMatrix((new Matrix4).fromArray(m.matrix)),geometry?geometry.merge(geom):geometry=geom})),geometry.computeBoundingSphere(),geometry.computeBoundingBox();let buffers=[],obj={};for(let key in geometry.attributes)obj[key]={array:geometry.attributes[key].array,components:geometry.attributes[key].itemSize},buffers.push(obj[key].array.buffer);resolve({index:geometry.index,arrays:obj,boundingBox:geometry.boundingBox,boundingSphere:geometry.boundingSphere},id,buffers)}))})),Class((function AvatarEnvironmentAnimationTrigger(_player,geometry,threshold=1,callbackEnabled=null,callbackDisabled=null,snapAvatar=!0){Inherit(this,Component);const _this=this;let boundingBox,positions,orientations,_playerPrevPosition=new Vector3;function checkChairPosition(){let pos=_player.group.position.clone(),isVR=null!=_player.view.parent.isVR,still=pos.distanceTo(_playerPrevPosition)<.001||isVR;if(_playerPrevPosition=pos.clone(),pos.x>=boundingBox.x&&pos.x<=boundingBox.y&&pos.z>=boundingBox.z&&pos.z<=boundingBox.w){let chairOrientation,chairPosition=pos,distance=1e7,planePosition=new Vector2(pos.x,pos.z);positions.map(((position,index)=>{let p=new Vector2(position.x,position.z),d=planePosition.distanceTo(p);d<distance&&(distance=d,chairPosition=position.clone(),chairOrientation=orientations[index])})),distance<threshold?still&&callbackEnabled&&(callbackEnabled(chairOrientation,chairPosition.y),!_this.flag("sitting")&&snapAvatar&&_player.snapTo2dPoint(new Vector2(chairPosition.x,chairPosition.z)),_this.flag("sitting",!0)):_this.flag("sitting")&&(callbackDisabled&&callbackDisabled(),_this.flag("sitting",!1))}else _this.flag("sitting")&&(callbackDisabled&&callbackDisabled(),_this.flag("sitting",!1))}_this.flag("sitting",!1),async function(){boundingBox=new Vector4(0),positions=[],_player.view.standUp();let positionBuffer=geometry.attributes.offset.array;for(let i=0;i<positionBuffer.length;i+=3){let x=positionBuffer[i],z=positionBuffer[i+2],position=new Vector3(x,positionBuffer[i+1]-.4,z);x<boundingBox.x&&(boundingBox.x=x),x>boundingBox.y&&(boundingBox.y=x),z<boundingBox.z&&(boundingBox.z=z),z>boundingBox.w&&(boundingBox.w=z),positions.push(position.clone())}boundingBox.x-=1,boundingBox.y+=1,boundingBox.z-=1,boundingBox.w+=1;let orientationBuffer=geometry.attributes.orientation.array;orientations=[];for(let i=0;i<orientationBuffer.length;i+=4){let orientation=new Vector4(orientationBuffer[i],orientationBuffer[i+1],orientationBuffer[i+2],orientationBuffer[i+3]);orientations.push(orientation)}_this.startRender(checkChairPosition)}()})),Class((function VideoChatZone(_position,_id,_config,_users){Inherit(this,Object3D);const _this=this;var _binding,_shader,_mesh;async function close(force){if(!_this.flag("closing")||force){_this.flag("closing",!0),setTimeout((_=>{_this.parent?.parent?.getBatch?.("chatZones",{}).remove(_mesh),_this.events?.fire(Events.END)}),300);try{_shader.tween("uAlpha",0,300,"easeOutCubic"),await tween(_this.group.position,{y:_this.group.position.y-1},300,"easeOutCubic").promise()}catch(e){}}}function handleVisibility(e){"focus"==e.type&&(_this.users.length||close(!0))}function cleanupPop(e){"P"==e.key&&_this.forceEnd()}this.position=_this.group.position,this.id=_id,this.users=Array.isArray(_users)?_users:[],this.createdTime=Render.TIME,this.radius=_config.radius,this.state=AppState.createLocal(),function(){_this.group.position.fromArray(_position),function initMesh(){let geom=World.FLOOR_CYLINDER,shader=_config.shader||_this.initClass(Shader,"BaseVideoChatZone",{uColor:{value:new Color(_config.color||"#ffffff")},uAlpha:{value:1,batchUnique:!0},blending:Shader.ADDITIVE_BLENDING,transparent:!0});shader.transparent=!0,shader.depthWrite=!1,shader.side=Shader.DOUBLE_SIDE;let mesh=new Mesh(geom,shader);mesh.scale.set(_config.radius,1.3,_config.radius),_shader=shader,_this.add(mesh),_mesh=mesh,_this.parent.parent.getBatch("chatZones",{})}(),_this.group.position.y+=.5;let targetY=_this.group.position.y;_shader.set("uAlpha",0),_shader.tween("uAlpha",1,500,"easeOutCubic"),_this.group.position.y-=1,tween(_this.group.position,{y:targetY},500,"easeOutCubic"),_this.events.sub(Events.VISIBILITY,handleVisibility)}(),this.update=function(data){if(Array.isArray(data.users)){if(!data.users.length&&Render.TIME-_this.createdTime<250)return;_this.users=data.users}_this.users.length||_id.includes("forced")||close(),_this.state.set("users",[..._this.users])},this.canJoin=function(){return _this.users.length<_config.maxUsers},this.join=function(){if(_this.flag("joined"))return;_this.flag("joined",!0),_this.events.fire(VideoChatZone.JOIN),PlatformSounds.play("audio_chat_join");let pushArray={key:"users",value:PlayerModel.get("uid")||Multiplayer.room.me.id};Multiplayer.room?.pin({chatZone:!0,unique:_id,pushArray:pushArray},99999),_binding=GameCenterMedia.state.bind("hasMediaAccess",(state=>{"fail"==state&&_this.leave()})),_this.state.set("localJoined",!0),Hydra.LOCAL&&_this.events.sub(Keyboard.PRESS,cleanupPop)},this.leave=function(){if(!_this.flag("joined"))return;_this.flag("joined",!1),_this.events.unsub(Keyboard.PRESS,cleanupPop),_this.events.fire(VideoChatZone.LEAVE);let popArray={key:"users",value:PlayerModel.get("uid")||Multiplayer.room.me.id};Multiplayer.room?.pin({chatZone:!0,unique:_id,popArray:popArray},99999),_binding?.destroy?.(),PlatformSounds.play("audio_chat_exit"),_this.state.set("localJoined",!1)},this.forceLeave=function(){let popArray={key:"users",value:PlayerModel.get("uid")||Multiplayer.room.me.id};Multiplayer.room?.pin({chatZone:!0,unique:_id,popArray:popArray},99999),_binding?.destroy?.()},this.forceEnd=function(){_this.users.length&&console.log("FORCE END",_id,_this.users.length),_this.users.forEach((id=>{let popArray={key:"users",value:id};Multiplayer.room?.pin({chatZone:!0,unique:_id,popArray:popArray},99999)})),_this.users.length=0,_this.state.set("localJoined",!1)},this.onDisconnect=function(player){let id=player.state.get("uid")||player.gcPlayer.id;if(_this.users.includes(id)){let popArray={key:"users",value:id};Multiplayer.room?.pin({chatZone:!0,unique:_id,popArray:popArray},99999)}},this.toggleFullZoneAlert=function(willShow){if(_this.flag("isFullZoneAlertFired")===willShow)return;_this.flag("isFullZoneAlertFired",willShow);const event=willShow?VideoChatZone.SHOW_FULL_ZONE_ALERT:VideoChatZone.CLOSE_FULL_ZONE_ALERT;_this.events.fire(event,{zone:_this,maxUsers:_config.maxUsers,position:_this.group.position})}}),(_=>{VideoChatZone.JOIN="video_chat_zone_join",VideoChatZone.LEAVE="video_chat_zone_leave",VideoChatZone.SHOW_FULL_ZONE_ALERT="video_chat_zone_show_full_zone_alert",VideoChatZone.CLOSE_FULL_ZONE_ALERT="video_chat_zone_close_full_zone_alert"})),Class((function MediaAccessToast(_config){Inherit(this,AbstractUIComponent);const _this=this,$this=_this.element;let $content,$title,$desc;_this.parseConfig(_config),function initHTML(){$content=$this.create(_this.getPrefix("content")),$title=$content.create(_this.getPrefix("title")),$title.text(_this.titleText),$desc=$content.create(_this.getPrefix("desc")),$desc.text(_this.descText)}(),function initStyles(){CoreUIState.instance().uiBuilder.buildMediaAccessToastStyles({$container:$this,$content:$content,$title:$title,$desc:$desc})}(),_this.show=function(){console.log("showing"),$this.show(),$this.css({display:"flex"}),$this.tween({opacity:1},500,"easeOutCubic")},_this.hide=async function(){await $this.tween({opacity:0},500,"easeOutCubic").promise(),$this.hide()}})),Class((function MediaAccessToastStyles(){Inherit(this,Component),this.buildMediaAccessToastStyles=function(els,props){const{$container:$container,$content:$content,$title:$title,$desc:$desc}=els;$container.css({background:"black",padding:"1.3rem 1.8rem",borderRadius:"0.5rem",height:"13rem",width:"41.6rem",boxShadow:"0 0.4rem 0.4rem rgba(0,0,0,0.25)",display:"flex",justifyContent:"center",alignItems:"center",top:"3rem",left:"3rem",zIndex:"100000",opacity:0}).hide(),$content.css({display:"flex",justifyContent:"space-between",position:"relative",flexDirection:"column"}),$title.css({...this.styleguide.button3,color:this.colors.white[0],marginBottom:"0.7rem"}),$desc.css({...this.styleguide.button2,color:this.colors.monochrome[0],maxWidth:"25rem",lineHeight:"120%"})}}),"static"),Class((function Emotes({name:name,offset:offset}={}){Inherit(this,Component);const _this=this;var _proton;function handleEmote({index:index}){_this.parent.getPlayerController().fireEvent("emote",{index:index})}!function initProton(){_proton=_this.initClass(EmotesProton,{offset:offset}),_this.parent.add(_proton)}(),function addHandlers(){_this.events.sub(Emotes.FIRE,handleEmote)}(),_this.get("uniforms",(async _=>(await _proton.ready(),_proton.uniforms))),_this.fire=(position,index=0)=>{if(!position){position=_this.parent.getPlayerController().group.position}_proton.fire(position,index)},_this.addPlayer=player=>{player.bindEvent("emote",(async({index:index})=>{!function handleEmoteFired(position,index){_proton.fire(position,index)}(player.group.position,index)}))},_this.removePlayer=player=>{},_this.onDestroy=function(){_this.parent.remove(_proton)}}),(_=>{Emotes.FIRE="Emotes.FIRE"})),Class((function EmotesParticle(_proton,_group){Inherit(this,Object3D);const _this=this;!async function initMesh(){await _proton.spawn.ready();let geometry=(new Geometry).instanceFrom(new PlaneGeometry(1,1));_proton.applyToInstancedGeometry(geometry);let shader=_this.initClass(Shader,"EmotesParticleShader",{uIndex:{value:0},uLength:{value:0},uScale:{value:1},tMap:{value:null},uQuaternion:{value:World.CAMERA.quaternion},depthTest:!1,depthWrite:!1,blending:Shader.PREMULTIPLIED_ALPHA_BLENDING,transparent:!0});_proton.applyToShader(shader),_proton.spawn.applyToShader(shader),ShaderUIL.add(shader,_group).setLabel("Shader");let mesh=new Mesh(geometry,shader);mesh.frustumCulled=!1,mesh.renderOrder=99999999999,_this.add(mesh)}()})),Class((function EmotesProton({offset:offset}={}){Inherit(this,Object3D);const _this=this;var _layout,_proton;!async function(){_layout=_this.initClass(SceneLayout,"emotes"),await _layout.loadedAllLayers(),(_proton=await _layout.getLayer("proton")).group.frustumCulled=!1,Utils.query("fire")&&setInterval((_=>{_this.fire(new Vector3,Math.random(0,3),0)}),Utils.query("fire")),Dev.expose("emoteFire",_this.fire),_this.flag("isReady",!0)}(),_this.fire=function(position,index){if(_proton&&_proton.spawn){let vector=position.clone();offset&&vector.add(offset),_proton.spawn.emit(vector.toArray(),[index,0,0])}},_this.get("uniforms",(_=>_proton.customClass.group.children[0].shader.uniforms)),_this.ready=function(){return _this.wait("isReady")}})),Class((function AvatarShadows(_shadowGroup){Inherit(this,Component);const _this=this;var _player;function loop(){_player&&_player.group&&_shadowGroup.position.copy(_player.group.position)}async function onActivate({env:env}){let player=await env.awaitPlayerController();await player.wait("view");let batch=await env.getBatch("avatar");await batch.ready(),await _this.wait(batch,"mesh"),await _this.wait(batch.mesh,"shader"),batch.mesh.castShadow=!0,await _this.wait(batch.mesh.shader,"shadow"),await _this.wait(400),batch.mesh?.shader?.shadow&&!Platform.renderShadowsAllInstances()&&(batch.mesh.shader.shadow.maxInstancedCount=1),_player=player}!async function(){_this.events.sub(AbstractEnvironment.ACTIVATE,onActivate),_this.startRender(loop),_this.parent.parent.SUN_POSITION={value:_shadowGroup.children[0].position}}()})),Class((function EnvironmentShadowAttachment(_mesh,_shader){Inherit(this,Component);const _this=this;!async function(){await _this.parent.loadedAllLayers();for(let key in _this.parent.layers)_this.parent.layers[key]instanceof EnvironmentShadows&&_this.parent.layers[key].applyTo(_shader)}()})),Class((function EnvironmentShadows(_input,_group){Inherit(this,Object3D);const _this=this;var _mesh,_batch,_config,_scale,_offset,_scene=_this.initClass(FXScene,World.NUKE,{rtFormat:Texture.RGBAFormat,rtType:Texture.FLOAT}),_env=AbstractEnvironment.findParent(_this),_players=[],_shaders=[],_remove=[],_box=new Vector4;function initBatch(){_batch=_this.initClass(MeshBatch),_scene.scene.add(_batch.group),_batch.group.asyncPromise.resolve()}function loop(){for(let i=_players.length-1;i>-1;i--){let player=_players[i];player.shadowMesh?(player.shadowMesh.position.copy(player.group.position),player.shadowMesh.position.x+=_offset.x,player.shadowMesh.position.z+=_offset.y,player.shadowMesh.position.y=0,player.shadowMesh.scale.x=player.shadowMesh.scale.z=player.shadowMesh.scale.y=_scale*player.group.scale.x,player.shadowMesh.shader.set("uYPos",player.group.position.y)):_remove.push(player)}_remove.length&&(_remove.forEach((r=>_players.remove(r))),_remove.length=0)}function playerConnect({player:player}){player.shadowMesh=function initMesh(){_batch||initBatch();let shader=_this.initClass(Shader,"EnvironmentShadow",{uYPos:{value:0,batchUnique:!1},tMap:{value:Utils3D.getTexture("~assets/images/avatar/shadow.jpg")},transparent:!0,depthWrite:!1,depthTest:!1}),mesh=new Mesh(World.PLANE,shader);return mesh.scale.setScalar(_scale),mesh.frustumCulled=!1,mesh.rotation.x=Math.radians(-90),_batch.add(mesh),mesh}(),_players.push(player)}function playerDisconnect({player:player}){_players.remove(player),_batch.remove(player.shadowMesh)}!async function(){(_mesh=new Mesh(World.PLANE,Utils3D.getTestShader())).rotation.x=Math.radians(-90),Utils.query("editShadows")||(_mesh.shader.neverRender=!0),_this.add(_mesh),(_config=InputUIL.create(_input.prefix+"env_shadow_config",_group)).setLabel("Config"),_config.add("scale",2.5),_config.addVector("offset",[0,0]),_config.onUpdate=_=>{_scale=_config.get("scale")||2.5,_offset=(new Vector2).fromArray(_config.get("offset")||[0,0])},_config.onUpdate(),"default"===Router.getStateString()&&(_scale=200,_this.delayedCall((_=>_scale=2),5e3)),await defer();let box=new Box3;box.setFromObject(_this.group),_box.set(box.min.x,box.max.x,box.min.z,box.max.z),Global.PLAYGROUND||(!function initCamera(){let aspect=_this.group.scale.x/_this.group.scale.z;_scene.setSize(1024,1024/aspect,!0),_scene.clearColor="#000000";let shader=_this.initClass(Shader,"TextureMaterial",{tMap:{value:Utils3D.getTexture("assets/images/_scenelayout/uv.jpg")}}),mesh=new Mesh(World.PLANE,shader);mesh.scale.copy(_this.group.scale),mesh.scale.y=mesh.scale.z,mesh.rotation.x=Math.radians(-90);let camera=new PerspectiveCamera(45,aspect,.1,1e3);camera.rotation.x=Math.radians(-90),camera.position.y=Utils3D.getPositionFromCameraSize(camera,mesh.scale.z)/2.17,_scene.useCamera(camera)}(),function addListeners(){_env.players.forEach((player=>playerConnect({player:player}))),_this.events.sub(_env,AbstractEnvironment.PLAYER_CONNECT,playerConnect),_this.events.sub(_env,AbstractEnvironment.PLAYER_DISCONNECT,playerDisconnect)}(),_this.startRender(loop))}(),this.applyTo=function(shader){(shader=shader.shader||shader).addUniforms({uBox:{value:_box},tShadowMap:{value:_scene.rt}}),_shaders.push(shader)},this.onInvisible=function(){!function reset(){_batch&&(_scene.scene.remove(_batch.group),_batch.destroy()),initBatch(),_players.length=0,_scene.render()}()},this.onDestroy=function(){_shaders.forEach((shader=>{shader.set("tShadowMap",null)}))}})),Class((function GlobalCrowd(_input,_group){Inherit(this,Object3D);const _this=this;var _config,_particles,_first,_visibility=1;function getMask(){let data=JSON.parse(_config.get("mask"));if(!data||!data.src)return Utils3D.getTexture("assets/images/_scenelayout/mask.jpg");let src=data.src;return data.compressed&&(src+="-compressKtx"),Utils3D.getTexture(src)}function loop(){let lerp=_first?.1:1;_particles.behavior.uniforms.uVisibility.value=Math.lerp(_visibility,_particles.behavior.uniforms.uVisibility.value,lerp),_first=!0}!async function(){!function initConfig(){(_config=InputUIL.create(_input.prefix+"crowd",_group)).setLabel("Config"),_config.add("particleCount",1e3),_config.addNumber("radius",10),_config.addNumber("seed",1),_config.addNumber("moveSpeed",.4),_config.addNumber("moveRadius",.4),_config.addNumber("randomRotation",0),_config.addImage("mask"),_config.addVector("maskBoundingMin",[-1,-1]),_config.addVector("maskBoundingMax",[1,1]),_config.addToggle("debugMask"),_config.addToggle("castShadow"),_config.onUpdate=_=>{_particles.behavior.setUniform("uRadius",_config.getNumber("radius")),_particles.behavior.setUniform("uSeed",_config.getNumber("seed")),_particles.behavior.setUniform("uTimeScale",_config.getNumber("moveSpeed")),_particles.behavior.setUniform("uSinRadius",_config.getNumber("moveRadius")),_this.mesh&&(_this.mesh.shader.get("uMaskMin").fromArray(_config.get("maskBoundingMin")),_this.mesh.shader.get("uMaskMax").fromArray(_config.get("maskBoundingMax")),_this.mesh.shader.set("tMask",getMask()),_this.mesh.shader.set("uMaskDebug",_config.get("debugMask")?1:0),_this.mesh.shader.set("uRotation",_config.getNumber("randomRotation")),_this.mesh.castShadow=_config.get("castShadow"))}}();let data={particleCount:_config.getNumber("particleCount")},layout=_this.initClass(SceneLayout,"globalcrowd",{noGraph:!0,data:data});_particles=await layout.getLayer("particles"),await _particles.ready(),_config.onUpdate(),async function initMesh(){let avatar=_this.initClass(GlobalEnvironment.instance().getPlayerClass()),mesh=await avatar.getMesh();mesh.castShadow=_config.get("castShadow"),mesh.shader.addUniforms({tMask:{value:getMask()},uMaskMin:{value:(new Vector2).fromArray(_config.get("maskBoundingMin"))},uMaskMax:{value:(new Vector2).fromArray(_config.get("maskBoundingMax"))},uMaskOffset:{value:_config.getNumber("maskOffset")},uRotation:{value:_config.getNumber("randomRotation")},uMaskDebug:{value:!(!_config.get("debugMask")||!Hydra.LOCAL)}}),_particles.applyToInstancedGeometry(mesh.geometry),_particles.applyToShader(mesh.shader),await avatar.loadAttribBuffers(),_this.add(mesh),_this.mesh=mesh}(),_this.startRender(loop)}(),this.set("visibility",(v=>{_visibility=v})),this.ready=function(){return _this.wait("mesh")}})),Class((function GlobalViewData(_env){Inherit(this,Component);const _this=this;var _range,_min=0,_bindings=[],_crowds={};async function loadData(){if(!window.Config||!Config.COMMUNITY)return console.warn("Missing Config.COMMUNITY");let data=await get(`${Config.COMMUNITY}?${Date.now()}`);Array.isArray(data)||(data=[data]);let connections=0;data.forEach((d=>connections+=d.connections));let scalar=_range?Math.range(connections,_range.min,_range.max,_range.minScalar,_range.maxScalar,!0):1;_bindings.forEach((({labels:labels,crowd:crowd})=>{let total=0;data.forEach((server=>{for(let key in server)labels.forEach((label=>{key.includes(label)&&(total+=server[key])}))})),_crowds[crowd].visibility=Math.max(_min,total/connections*scalar)})),_this.delayedCall(loadData,3e4)}!async function(){await _env.layout.loadedAllLayers();for(let key in _env.layout.layers){let layer=_env.layout.layers[key];layer instanceof GlobalCrowd&&(_crowds[key]=layer)}_this.startRender((_=>{}))}(),this.setRange=function(min,max,minScalar,maxScalar){_range={min:min,max:max,minScalar:minScalar,maxScalar:maxScalar}},this.setMin=function(min){_min=min},this.bind=function(labels,crowd){Array.isArray(labels)||(labels=[labels]),_bindings.push({labels:labels,crowd:crowd})},this.onVisible=function(){loadData()},this.onInvisible=function(){_this.clearTimers()}})),Class((function LoaderView(_config){Inherit(this,Element);const _this=this,$this=this.element;var $text,$wrapper,$message,_percent=0;function loop(){if($text){let rate=Math.range($text.percent-_percent,.1,.5,.0175,.035,!0);$text.percent>=1&&(rate=.35),_percent=Math.lerp(Math.lerp($text.percent,_percent,rate),_percent,.275),$text&&$text.html(""+Math.round(100*_percent))}}!function initHTML(){$this.size("100%").setZ(1e3),($wrapper=$this.create(".wrapper")).size(200,200).center().css({opacity:0}).tween({opacity:1},250,"easeOutCubic",150),_this.delayedCall((_=>{Stage.css({opacity:1})}),150)}(),function initSpinner(){let size=Device.mobile.phone?100:110;$wrapper.create(".spinner-anim").size(size,size).center()}(),_config&&_config.hidePercent||function initText(){let size=16;($text=$wrapper.create("LoaderViewText")).size(200,size).center().css({textAlign:"center",lineHeight:1,letterSpacing:2,opacity:.8}),$text.percent=0}(),_config&&_config.message&&function initMessage(){($message=$wrapper.create("LoaderViewText","h5")).size(200,16).css({textAlign:"center",lineHeight:1,letterSpacing:2,opacity:.8}),$message.text(_config.message)}(),_this.startRender(loop),this.progress=function(e){$text&&($text.percent=e.percent)},this.animateOut=async function(callback,time){let tweenTime=time||500;await tween($text,{percent:1},tweenTime,"easeOutSine").promise(),$this.tween({opacity:0},tweenTime,"easeInOutSine",tweenTime).onComplete((()=>callback&&callback())),$wrapper.tween({opacity:0},tweenTime,"easeInOutSine")}})),Class((function PartyUI(_state){})),Class((function PartyUIPlayer(_obj){})),Class((function ProfilePrompt(_config={}){Inherit(this,Object3D);const _this=this;var _viewing,_posDistance,_hoverUniform;if("object"!=typeof _config&&(_config={}),_config.y||(_config.y=1),!_config.view)throw"profilePrompt must have a view property!";Platform.usingVR();function hideUI(){_viewing&&(_posDistance=null,_viewing=null,_this.dialog.close())}function loop(){if(!_posDistance)return;let player=_posDistance.player,me=_posDistance.me,originalDistance=player.distanceTo(me);player.distanceTo(_this.parent.player.group.position)>originalDistance+1&&hideUI()}function playerJoin({player:player}){_this._invisible||player.isLocal||(_this.events.sub(player,AvatarInteraction.HOVER,avatarHover),_this.events.sub(player,AvatarInteraction.CLICK,avatarClick))}function playerLeave(e){_this._invisible||e.player==_viewing&&hideUI()}function avatarHover(e){if(_this._invisible)return;let shader=e.object.view?.mesh?.shader;shader&&_hoverUniform&&shader.tween(_hoverUniform,"over"!=e.action||_this.parent.videoChatZones?.interacting?0:1,300,"easeOutCubic")}function avatarClick(e){if(_this.parent.videoChatZones?.interacting)return;if(_this._invisible||e.isLeaveEvent)return;let player=e.object;_viewing!=player&&(_viewing=player,_this.dialog.setPosition(player.group.position.clone().add(new Vector3(0,1,0))),_this.dialog.updateInfo(player),_this.dialog.open(),_posDistance={me:_this.parent.player.group.position.clone(),player:player.group.position.clone()})}!function initDialog(){_this.dialog=_this.initClass(_config.view),_this.group.add(_this.dialog.group)}(),function addListeners(){_this.events.sub(Player.JOIN,playerJoin),_this.events.sub(Player.LEAVE,playerLeave),_this.events.sub(TriggerZone.INSIDE,hideUI),_this.events.sub(VideoChatZones.PROMPT,hideUI),_this.events.sub(_this.dialog,Events.END,hideUI)}(),_this.startRender(loop),this.setHoverUniform=function(key){_hoverUniform=key},this.hideUI=hideUI})),Class((function ProfilePrompt_bk(_config={}){Inherit(this,Object3D);const _this=this;var $root,$capture,_capture,_viewing,_posDistance,_view,_hoverUniform;if("object"!=typeof _config&&(_config={}),_config.scale||(_config.scale=1),_config.width||(_config.width=1024),_config.height||(_config.height=512),_config.y||(_config.y=1),!_config.view)throw"profilePrompt must have a view property!";var _toDestroy=[];const VR=Platform.usingVR();function clearDestroy(){for(let i=0;i<_toDestroy.length;i++){let obj=_toDestroy[i];obj&&Render.TIME-obj.time>5e3&&(obj.view&&obj.view.destroy&&obj.view.destroy(),_toDestroy.splice(i,1))}}async function hideUI(){if(_viewing&&(_posDistance=null,_viewing=null,await tween(_this.group.scale,{x:0,y:0,z:0},300,"easeOutCubic"),_capture.visible=!1,$capture.hide(),_view)){_toDestroy.push({time:Render.TIME,view:_view});try{$root.removeChild(_view.element)}catch(e){}}}function loop(){if(!_posDistance)return;let player=_posDistance.player,me=_posDistance.me,originalDistance=player.distanceTo(me);VR||_this.group.lookAt(World.CAMERA.position),player.distanceTo(_this.parent.player.group.position)>originalDistance+1&&hideUI()}function playerJoin({player:player}){_this._invisible||player.isLocal||(_this.events.sub(player,AvatarInteraction.HOVER,avatarHover),_this.events.sub(player,AvatarInteraction.CLICK,avatarClick))}function playerLeave(e){_this._invisible||e.player==_viewing&&hideUI()}function avatarHover(e){if(_this._invisible)return;let shader=e.object.view?.mesh?.shader;shader&&_hoverUniform&&shader.tween(_hoverUniform,"over"!=e.action||_this.parent.videoChatZones?.interacting?0:1,300,"easeOutCubic")}function avatarClick(e){if(_this.parent.videoChatZones?.interacting)return;if(_this._invisible||e.isLeaveEvent)return;let player=e.object;if(_viewing==player)return;if(_view){_toDestroy.push({time:Render.TIME,view:_view});try{$root.removeChild(_view.element)}catch(e){}}_this.group.position.copy(player.group.position),_this.group.position.y+=_config.y,VR&&_this.group.position.add(new Vector3(0,0,.4).applyQuaternion(World.CAMERA.quaternion)),_this.group.lookAt(World.CAMERA.position),_viewing=player,_capture.visible=!0,$capture.show(),_this.group.scale.setScalar(0);let scale=VR?.4:_config.scale;tween(_this.group.scale,{x:scale,y:scale,z:scale},300,"easeOutCubic"),_view=_this.initClass(_config.view,player),_this.events.sub(_view,Events.END,hideUI),$root.add(_view.element),_posDistance={me:_this.parent.player.group.position.clone(),player:player.group.position.clone()}}_this.group.scale.setScalar(0),function addListeners(){_this.events.sub(Player.JOIN,playerJoin),_this.events.sub(Player.LEAVE,playerLeave),_this.events.sub(TriggerZone.INSIDE,hideUI),_this.events.sub(VideoChatZones.PROMPT,hideUI)}(),async function initStageLayoutCapture(){(_capture=_this.initClass(StageLayoutCapture,_config.width,_config.height,!0)).visible=!1;let aspect=_config.height/_config.width;($capture=$gl(2,2*aspect,_capture)).enable3D();let environment=_this.findParent("GroupEnvironment");if(environment&&(await _this.wait(environment,"view"),environment.view.bloomLayer)){let shader=_this.initClass(Shader,"ProfilePromptShader");$capture.useShader(shader)}_this.add($capture.group),Platform.usingVR()||($capture.mesh.shader.depthTest=!1,$capture.mesh.shader.depthWrite=!1),$capture.mesh.shader.transparent=!0,$capture.mesh.renderOrder=9999,$capture.hide(),_capture.object3d=$capture,$root=_capture.root}(),_this.startRender(loop),_this.startRender(clearDestroy,10),this.setHoverUniform=function(key){_hoverUniform=key},this.onDestroy=function(){_toDestroy.forEach((obj=>{obj.view?.destroy?.()}))},this.hideUI=hideUI,_this.get("mesh",(()=>$capture.mesh))})),Class((function ScreenContentHover(_config={}){Inherit(this,Object3D);const _this=this;var $capture,_shader;function handleHover({action:action,object:object}){action}function handleClick(){_this.events.fire(ScreenContentHover.CLICK,{screen:_this.parent.parent})}!function initLayout(){_this.layout=_this.initClass(StageLayout,"screensContent_hover_ui",{glui:!0,noGraph:"ScreenContentHover"!==Global.PLAYGROUND})}(),async function initLayers(){_this.layers=await _this.layout.getAllLayers(),_this.layers.background.interact(handleHover,handleClick)}(),function initCapture(){let capture=_this.initClass(StageLayoutCapture,_this.layout,500,500);($capture=$gl(1,1,capture)).enable3D(),_shader=_this.initClass(Shader,"ScreenContentHoverShader",{uAlpha:{value:1},uOpacity:{value:"ScreenContentHover"===Global.PLAYGROUND?1:0},uHover:{value:1},tMap:{value:null},transparent:!0}),$capture.useShader(_shader),capture.object3d=$capture,"ScreenContentHover"===Global.PLAYGROUND&&(_this.group.add(capture.object3d.group),_this.group.renderOrder=9999999)}(),_this.animateIn=_=>{_this.group.add($capture.group),_this.visible=!0,_shader.neverRender=!1,_shader.tween("uOpacity",1,400,"easeOutCubic")},_this.animateOut=_=>{_shader.tween("uOpacity",0,400,"easeOutCubic",(_=>{_this.group.remove($capture.group),_this.visible=!1,_shader.neverRender=!0}))}}),(_=>{ScreenContentHover.CLICK="ScreenContentHover.CLICK"})),Class((function ScreensContent(_config){Inherit(this,Component);const _this=this,PREFIX=_config.name+"_screensContent";var _uil,_disabledScreens=Utils.query("disableScreens");!async function(){_disabledScreens||(!function initInput(){(_uil=InputUIL.create(PREFIX,Global.PLAYGROUND?void 0:null)).setLabel("Screens Content"),_uil.add("screens",""),_uil.add("activations","")}(),await async function initScreens(){let file=_uil.get("screens");if(file){let data=await get(file);_uil.add("screens_y",0),_this.elements=data.layers.map((config=>{let screenClass=_config.screen||ScreensContentScreen;return _this.initClass(screenClass,{..._config,...config,uil:_uil,parent:_this.parent})}))}}(),await async function initActivations(){_uil.get("activations")&&(_uil.add("activations_shader","ScreensContentActivationsShader"),_uil.add("activations_y",.5),_uil.add("activations_z",5),_this.activations=_this.initClass(ScreensContentActivations,{screens:_this.elements,uil:_uil}),_this.parent.add(_this.activations))}())}(),_this.onDestroy=function(){_this.elements&&_this.elements.forEach((element=>{_this.parent.remove(element),element.destroy()})),_this.activations&&(_this.parent.remove(_this.activations),_this.activations.destroy())}})),Class((function ScreensContentActivations(_config={}){Inherit(this,Object3D);const _this=this;let _box,_radius,_env,_activation=null,_activations=[];function checkCollision(){_env.player&&_activations.forEach(((group,index)=>{if(!group.visible)return;_this.playerDistance=_env.player.group.position.distanceToSquared(group.origin);let isCloseToUser=_this.playerDistance<_radius;isCloseToUser?group.isCurrent||(_activation=group,group.screen.animateOverlayIn(),group.isCurrent=!0,group.layers.forEach(((layer,index)=>{0!==index&&(layer.position.y=layer.original-.15*index,layer.rotation.y=Math.PI*(index%2==0?.2:-.2),layer.shader.tween("uTransition",1,700,"easeOutQuart",50*index),tween(layer.position,{y:layer.original},700,"easeOutQuart",50*index),tween(layer.rotation,{y:0},700,"easeOutQuart",50*index))})),_this.events.fire(ScreensContentActivations.ON)):group.isCurrent&&(_activation=null,group.screen.animateOverlayOut(),group.isCurrent=!1,group.layers.forEach(((layer,index)=>{0!==index&&(layer.shader.tween("uTransition",0,700,"easeInCubic"),tween(layer.position,{y:layer.original-.1*index},420,"easeInCubic"),tween(layer.rotation,{y:0},420,"easeInCubic"))})),_this.events.fire(ScreensContentActivations.OUT))}))}function handleKeyboard({key:key}){_activation&&("Escape"===key&&(_this.events.fire(ScreensContentActivations.ESCAPE,{screen:_activation.screen}),_activation.screen.animateOut()),"Enter"===key&&_this.events.fire(ScreensContentActivations.ENTER,{screen:_activation.screen}))}_config.screens&&(_env=_this.parent.parent,async function initActivations(){let asset=Assets.getPath("~"+_config.uil.get("activations")),geometry=await GeomThread.loadGeometry(asset),screens=_config.screens.filter((screen=>screen.cms?.active&&screen.hasActivation));for(let i=0;i<screens.length;i++){let screen=screens[i];await screen.ready;let group=new Group;group.layers=[];for(let index=0;index<4;index++){let y=_config.uil.get("activations_y")*index,shaderActivation=_this.initClass(Shader,_config.uil.get("activations_shader"),{transparent:!0,depthWrite:!1,tMap:{value:null},uColorActive:{value:new Color("#5e5e5e"),ignoreUIL:!0},uColorInactive:{value:new Color("#1c1c1c"),ignoreUIL:!0},uOpacity:{value:1-.2*index,batchUnique:!0,ignoreUIL:!0},uPosition:{value:y,batchUnique:!0,ignoreUIL:!0},uTransition:{value:0===index?1:0,batchUnique:!0},blending:Shader.ADDITIVE_BLENDING}),activation=new Mesh(geometry,shaderActivation);activation.original=_config.uil.get("activations_y")*index*1.5,activation.position.y=y,activation.position.z=_config.uil.get("activations_z"),activation.scale.multiplyScalar(1.4),_env.addToBatch(activation,"screenActivations",{bypassVisibilityCheck:!0,parent:null,worldCoords:!0}),group.layers.push(activation),group.add(activation)}group.origin=group.layers[0].worldPos,group.position.copy(screen.group.position),group.quaternion.copy(screen.group.quaternion),group.name=screen.name,group.screen=screen,group.position.y+=.1,screen.activation=group,_activations.push(group),_box=new Box3,_box.setFromObject(group.layers[0]),_radius=2*_box.getBoundingSphere().radius,_this.add(group)}}(),function addHandlers(){_this.events.sub(Keyboard.DOWN,handleKeyboard)}(),_this.startRender(checkCollision,28))}),(_=>{ScreensContentActivations.ENTER="ScreensContentActivations.ENTER",ScreensContentActivations.ESCAPE="ScreensContentActivations.ESCAPE",ScreensContentActivations.ON="ScreensContentActivations.ON",ScreensContentActivations.OUT="ScreensContentActivations.OUT"})),Class((function ScreensContentScreen(_config={}){Inherit(this,Object3D);const _this=this;var _data,_env,_id,_wrapper,_element,_hover,_position,_quaternion,_texture,_videoTexture,_disabledScreensCollision=Utils.query("disableScreensCollision"),_disabledScreensFloat=Utils.query("disableScreensFloat"),_v3=new Vector3,_time=0,_up=new Vector3(0,1,0),_lookAtMatrix=new Matrix4,_lookAtVector=new Vector3,_lookLerp=0,_floatSeed=Math.rand(0,200),_floatRotate=new Vector3,_floatWobble=new Vector3,_scale=1,_scaleExtra=0,_scaleMultiplier=1,_activated=0,_activatedValue=0;let[scaleMinimum,scaleMaximum]=Tests.screensRadius();function checkCollision(){if(_disabledScreensCollision)return;if(!_env)return;let player=_env.player;if(player&&player.group){let radius=150;_this.playerDistanceRadius<radius?_this.flag("isCurrent")||(_this.flag("isCurrent",!0),Hydra.LOCAL&&console.log("Current Screen: "+_this.name),_this.animateVisited(),_this.animateIn(),_this.events.fire(Screen.ACTIVATE,{screen:_this})):_this.flag("isCurrent")&&(_this.flag("isCurrent",!1),_this.animateOut(),_this.events.fire(Screen.DEACTIVATE,{screen:_this}))}}function loop(){if(_disabledScreensFloat)return;if(!_env)return;let player=_env.player;if(!player)return;player&&player.group&&(_this.playerDistanceY=Math.abs(player.group.position.y-_this.group.position.y),_this.playerDistanceRadius=player.group.position.distanceToSquared(_this.group.position));if(_this.playerDistanceRadius>300)return;_scaleMultiplier=Math.range(_this.playerDistanceRadius,scaleMinimum,scaleMaximum,1,0,!0),_scaleMultiplier+=_scaleExtra;let scaleFloor=_this.playerDistanceY<5?1:0,scale=_scaleMultiplier*scaleFloor;if(_scale=Math.lerp(scale,_scale,.04),_this.group.scale.setScalar(_scale),_element.shader.neverRender=_scale<.02,_element.shader.neverRender)return;_activatedValue=Math.lerp(_activated,_activatedValue,.04),_element.shader.set("uActive",_activatedValue),_time+=.05,_floatWobble.y=.5+.1*Math.sin(_floatSeed+.3*_time*Render.HZ_MULTIPLIER),_floatWobble.y-=_scale*_activatedValue*.2;const playerPosition=_v3.copy(player.group.position);playerPosition.y=_this.group.position.y,_lookAtVector.lerp(playerPosition,.05),_lookAtMatrix.lookAt(_lookAtVector,_this.group.position,_up);_lookLerp=Math.lerp(Math.map(_this.playerDistanceRadius,25,225,0,1),_lookLerp,.03),_this.group.quaternion.setFromRotationMatrix(_lookAtMatrix),_this.group.quaternion.slerp(_quaternion,_lookLerp),_wrapper.position.lerp(_floatWobble,.02)}_this.ready=Promise.create(),async function(){if(_data=_config.data,_env=AbstractEnvironment.findParent(_this),_id=_config.id,_this.group.visible=!1,_this.name=_config.name,"ScreensContentScreen"!==Global.PLAYGROUND){if(await async function initData(){if(!_data)return Promise.resolve();await _data.ready(),_data.state[_id].forEach((entry=>{entry.id===_this.name&&(_this.cms=entry)})),_this.cms&&(_this.cms.image||_this.cms.video)&&(_this.hasMedia=!0);_this.cms&&(_this.cms.link||_this.cms.video)&&(_this.hasActivation=!0);_this.cms&&"link"===_this.cms.type&&(_this.isHoverEnabled=!0)}(),!_this.cms?.active||!_this.hasMedia)return void _this.ready.resolve();_config.parent.add(_this)}await async function initLayers(){_this.layout=_this.initClass(SceneLayout,"screenContent_screen",{noGraph:"ScreensContentScreen"!==Global.PLAYGROUND}),_this.layers=await _this.layout.getAllLayers(),_wrapper=_this.layers.wrapper,_floatRotate.copy(_wrapper.position),_floatWobble.copy(_wrapper.position),_element=_this.layers.element,(_hover=_this.layers.hover)?.animateOut?.()}(),_this.isPlayground()||await function initConfig(){_quaternion=new Quaternion(...JSON.parse(_config.quaternion)),_position=JSON.parse(_config.position),_this.group.position.set(..._position),_this.group.quaternion.copy(_quaternion)}(),async function initTexture(){if(!_this.cms)return;if("video"===_this.cms.type){_videoTexture=_this.initClass(VideoTexture,_this.cms.video,{autoplay:!1,muted:"ios"===Device.system.os}),_this.cms.image?(_texture=Utils3D.getTexture(_this.cms.image),_config.autoplayVideo?(_element.shader.set("tMap",_videoTexture.texture),_videoTexture.video.seek(0),defer((_=>{_videoTexture.muted=!0,_videoTexture.video.play(),_videoTexture.start()}))):_element.shader.set("tMap",_texture)):_element.shader.set("tMap",_videoTexture.texture),await _this.wait(_texture,"dimensions");const{height:height,width:width}=_texture.dimensions;width>=height?_element.scale.x=_element.scale.y*width/height:(_element.scale.y=_element.scale.x*height/width,_element.position.y+=.5*_element.scale.y),_element.shader.set("uType",1),_element.shader.set("tVideo",_videoTexture.videoTexture||_videoTexture.texture)}else{_texture=Utils3D.getTexture(_this.cms.image),await _this.wait(_texture,"dimensions");const{height:height,width:width}=_texture.dimensions;width>=height?_element.scale.x=_element.scale.y*width/height:(_element.scale.y=_element.scale.x*height/width,_element.position.y+=.5*_element.scale.y),_element.shader.set("tMap",_texture),_element.shader.set("uType",0)}}(),Global.PLAYGROUND||_this.startRender(checkCollision,24),_this.group.visible=!0,_this.startRender(loop),_this.ready.resolve()}(),_this.get("shader",(_=>_element.shader)),_this.animateIn=_=>{_scaleExtra=.15,_activated=1},_this.animateOut=_=>{_element.shader.tween("uActive",0,1e3,"easeOutCubic"),_scaleExtra=0,_activated=0},_this.animateVisited=_=>{_element.shader.tween("uVisited",1,800,"easeOutCubic")},_this.animateOverlayIn=_=>{_this.flag("isOverlayIn")||(_this.flag("isOverlayIn",!0),_element.shader.tween("uHover",1,1e3,"easeOutCubic"),_videoTexture&&(_videoTexture.video.seek(0),defer((_=>{"ios"!==Device.system.os&&(_videoTexture.muted=!1),_videoTexture.video.play(),_videoTexture.start()}))),_this.isHoverEnabled&&_hover?.animateIn?.())},_this.animateOverlayOut=_=>{_this.flag("isOverlayIn")&&(_this.flag("isOverlayIn",!1),_element.shader.tween("uHover",0,1e3,"easeOutCubic"),_videoTexture&&!_config.autoplayVideo&&("ios"!==Device.system.os&&(_videoTexture.muted=!0),_videoTexture.video.pause(),_videoTexture.stop()),_this.isHoverEnabled&&_hover?.animateOut?.())},_this.enableHover=_=>_this.isHoverEnabled=!0,_this.disableHover=_=>_this.isHoverEnabled=!1,_this.onDestroy=function(){_videoTexture&&_videoTexture.destroy(),_texture&&_texture.destroy()}}),(_=>{Screen.ACTIVATE="Screen.ACTIVATE",Screen.DEACTIVATE="Screen.DEACTIVATE",Screen.CLICK="Screen.CLICK"})),Class((function ObjectSnapshot(){Inherit(this,Object3D);this.capture=async function(_mesh,_type="image/png",_overlay){let bb=new Box3;bb.setFromObject(_mesh);let points=[new Vector3(bb.min.x,bb.max.y,bb.min.z),new Vector3(bb.min.x,bb.max.y,bb.max.z),new Vector3(bb.min.x,bb.min.y,bb.min.z),new Vector3(bb.min.x,bb.min.y,bb.max.z),new Vector3(bb.max.x,bb.max.y,bb.min.z),new Vector3(bb.max.x,bb.max.y,bb.max.z),new Vector3(bb.max.x,bb.min.y,bb.min.z),new Vector3(bb.max.x,bb.min.y,bb.max.z)];points=points.map((p=>(new Vector2).copy(ScreenProjection.find(World.CAMERA).project(p))));let minX=9999,minY=9999,maxX=0,maxY=0;points.forEach((p=>{minX=Math.min(minX,p.x),minY=Math.min(minY,p.y),maxX=Math.max(maxX,p.x),maxY=Math.max(maxY,p.y)}));let x=Math.max(Math.round(minX),0),y=Math.min(Math.round(minY),Stage.width),width=Math.min(Math.round(maxX-minX),Stage.width),height=Math.min(Math.round(maxY-minY),Stage.height),canvas=DreamWorld.active.capturePixels(x,y,width,height);return _overlay&&canvas.context.drawImage(_overlay.image,_overlay.x,_overlay.y,_overlay.width,_overlay.height),Utils.query("snapshotDebug")&&Stage.add(canvas),canvas.toDataURL(_type)}}),"singleton"),Class((function BoxTest(){Inherit(this,Object3D);const _this=this;!async function(){var layout=_this.initClass(SceneLayout,"boxtest");let[b0,b1]=await layout.getLayers("b0","b1");_this.startRender((_=>{console.log(b0.isInsideOf(b1))}),10)}()})),Class((function PhysicsTest(){Inherit(this,Object3D);const _this=this;var _balls=[],_states=[];function loop(){for(let[i,ball]of _balls.entries())ball.applyPhysicsState(_states[i])}!async function(){!function initLayout(){_this.layout=_this.initClass(SceneLayout,"phystest",{physics:!0})}(),await async function getLayers(){let layers=await _this.layout.getAllLayers();for(let id in layers)id.includes("ball")&&_balls.push(layers[id])}(),function snap(){for(let ball of _balls)_states.push(ball.getPhysicsState());_this.startRender(loop,.5)}()}()})),Class((function TestEnvironment(){Inherit(this,AbstractEnvironment);const _this=this;!function(){let shader=_this.initClass(Shader,"TextureMaterial",{tMap:{value:Utils3D.getTexture("assets/images/_scenelayout/uv.jpg")}}),plane=new Mesh(World.PLANE,shader);_this.add(plane),plane.scale.setScalar(30),plane.rotation.x=Math.radians(-90)}()})),Class((function DreamWorldPortalTransition(){Inherit(this,Component);const _this=this;var _shader;!function initShader(){_shader=_this.shader=_this.initClass(Shader,"DreamWorldPortalTransition",{tFrom:{value:null},tTo:{value:null},uTransition:{value:0}})}(),this.animateIn=async function(){return _shader.tween("uTransition",1,1e3,"easeOutCubic").promise()},this.animateOut=function(){},this.setPreviousTexture=function(texture){_shader.set("tFrom",texture)},this.setNextTexture=function(texture){_shader.set("tTo",texture)}}),"singleton"),Class((function Transition(){Inherit(this,Element);const _this=this,$this=_this.element,VR=Platform.usingVR();var _view,_vrCover,_ui=UIController.instance().layout?UIController.instance().layout.element:Stage,_transitions={};!function initHTML(){$this.size("100%"),_ui&&_ui.add($this),$this.setZ(100).hide()}(),function initViews(){_transitions.external=_this.initClass(TransitionBasicView),_transitions.internal=_this.initClass(TransitionBasicView),_transitions.external.element.hide(),_transitions.internal.element.hide()}(),VR&&function initVRCover(){let shader=_this.initClass(Shader,"VRCover",{uAlpha:{value:1}});(_vrCover=new Mesh(World.SPHERE,shader)).shader.transparent=!0,_vrCover.shader.side=Shader.BACK_SIDE,_vrCover.shader.depthTest=!1,_vrCover.renderOrder=99999,_vrCover.scale.setScalar(.5),_vrCover.visible=!1;let spinner=new Mesh(World.PLANE,_this.initClass(Shader,"VRCoverSpinner",{tMap:{value:Utils3D.getTexture("~assets/images/icon/spinner.png")},uAlpha:shader.uniforms.uAlpha,uColor:{value:new Color},transparent:!0,depthWrite:!1,depthTest:!1}));spinner.scale.setScalar(.4),spinner.position.set(-.07,0,-1),spinner.renderOrder=999999,_vrCover.add(spinner);let div=document.createElement("div");div.className="spinner-anim",document.body.appendChild(div);let color=getComputedStyle(div).borderTopColor;color.includes("rgb")&&(color=color.split("rgb(")[1].split(")")[0],color=color.trim().split(",").map((v=>Number(v))),spinner.shader.uniforms.uColor.value.setRGB(color[0]/255,color[1]/255,color[2]/255),"#000000"==spinner.shader.uniforms.uColor.value.getHexString()&&spinner.shader.uniforms.uColor.value.set("#ffffff")),document.body.removeChild(div),World.SCENE.add(_vrCover),_this.startRender((_=>{spinner.rotation.z+=.06*Render.HZ_MULTIPLIER,_vrCover.position.copy(World.CAMERA.position),_vrCover.quaternion.copy(World.CAMERA.quaternion)}),World.NUKE)}(),this.cover=async function(type){_this.flag("cover")||(_this.flag("cover",!0),_this.vrTransition=Promise.create(),VR?(DreamWorld.getActiveEnvironment?.().then((env=>env.player.controls.disable())),_vrCover.type=type,_vrCover.visible=!0,await _vrCover.shader.tween("uAlpha",1,300,"easeOutSine").promise()):(_this.flag("animating",!0),(_view=_transitions[type])&&($this.setZ(9999999),$this.show(),(_view=_transitions[type]).element.show(),await _view.cover())))},this.firstLoad=function(){_this.flag("cover",!0)},this.reveal=async function(){_this.flag("cover")&&(_this.flag("cover",!1),VR?(VRInput.controllers.forEach((c=>c.hideBeam())),await _this.wait(750+Transition.EXTRA_WAIT_TIME),DreamWorld.active.ensureSceneVisibility(),_this.vrTransition.resolve(),await _vrCover.shader.tween("uAlpha",0,500,"easeOutSine").promise(),_vrCover.visible=!1,DreamWorld.getActiveEnvironment?.().then((env=>env.player.controls.enable()))):(_view&&(await(_view?.reveal?.()),$this.setZ(9999999),_view?.element?.hide?.(),$this.hide()),_this.flag("animating",!1)))},this.registerView=function(Class,type){_transitions[type]&&_transitions[type].destroy(),_transitions[type]=_this.initClass(Class),_transitions[type].element.hide()},this.updateVRPosition=function(obj){_vrCover.position.copy(obj.position),_vrCover.quaternion.copy(obj.quaternion)}}),"singleton",(_=>{Transition.STARTED="Transition_started",Transition.COMPLETE="Transition_complete",Transition.EXTRA_WAIT_TIME=0})),Class((function TransitionBasicView(){Inherit(this,Element);const _this=this;var $this;!function initHTML(){($this=_this.element).size("100%").bg("#eeeeee")}(),this.cover=function(){return $this.transformPoint("100%","50%").transform({scaleX:0}).tween({scaleX:1},600,"easeOutCubic").promise()},this.reveal=function(){return $this.transformPoint("0%","50%").tween({scaleX:0},1e3,"easeOutCubic").promise()}})),Class((function Main(){!async function(){if(await Config.ready(),await Device.system.detectXR(),Utils.query("performance"))return Performance.displayResults();Utils.query("status")&&await StatusPage.displayResults(),function init(){if(GLUI.init(),window.location.search.includes("p=")&&!Router.virtualQuery&&Hydra.LOCAL)return AssetLoader.loadAssets(Assets.list().filter(["data","shaders"])).then(Playground.instance);Container.instance(),Hydra.LOCAL&&Utils.query("streamKey")&&DesktopStream.instance(Platform.usingVR()||Utils.query("client"))}()}()}));
window._MINIFIED_=true;
window._BUILT_=true;